(function(s,r){typeof module=="object"&&module.exports?module.exports=r():s.game={config:r()}})(typeof self!="undefined"?self:this,function(){return{build_time:"10.02.2021 14:54:06",build_version:148,publisher:"poki",game_title:"Impossible 13",game_title_short:"Impossible13",game_slug:"get-13"}});var __extends=this&&this.__extends||function(){var s=function(r,n){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},s(r,n)};return function(r,n){s(r,n);function e(){this.constructor=r}r.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}}(),__awaiter=this&&this.__awaiter||function(s,r,n,e){function t(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function a(u){try{l(e.next(u))}catch(c){o(c)}}function h(u){try{l(e.throw(u))}catch(c){o(c)}}function l(u){u.done?i(u.value):t(u.value).then(a,h)}l((e=e.apply(s,r||[])).next())})},__generator=this&&this.__generator||function(s,r){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},e,t,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return h([l,u])}}function h(l){if(e)throw new TypeError("Generator is already executing.");for(;n;)try{if(e=1,t&&(i=l[0]&2?t.return:l[0]?t.throw||((i=t.return)&&i.call(t),0):t.next)&&!(i=i.call(t,l[1])).done)return i;(t=0,i)&&(l=[l[0]&2,i.value]);switch(l[0]){case 0:case 1:i=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,t=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(!(i=n.trys,i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){n.label=l[1];break}if(l[0]===6&&n.label<i[1]){n.label=i[1],i=l;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(l);break}i[2]&&n.ops.pop(),n.trys.pop();continue}l=r.call(s,n)}catch(u){l=[6,u],t=0}finally{e=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},__spreadArrays=this&&this.__spreadArrays||function(){for(var s=0,r=0,n=arguments.length;r<n;r++)s+=arguments[r].length;for(var e=Array(s),t=0,r=0;r<n;r++)for(var i=arguments[r],o=0,a=i.length;o<a;o++,t++)e[t]=i[o];return e},__assign=this&&this.__assign||function(){return __assign=Object.assign||function(s){for(var r,n=1,e=arguments.length;n<e;n++){r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(s[t]=r[t])}return s},__assign.apply(this,arguments)},game;(function(s){var r=function(){function n(){}return n.GAME_TITLE="Impossible_13",n.LANGUAGES=["en","ru"],n.SOURCE_GAME_WIDTH=640,n.SOURCE_GAME_HEIGHT=850,n.IS_LANDSCAPE=n.SOURCE_GAME_WIDTH>n.SOURCE_GAME_HEIGHT,n.IS_PORTRAIT=n.SOURCE_GAME_HEIGHT>n.SOURCE_GAME_WIDTH,n.GAME_CENTER=new Phaser.Point(n.SOURCE_GAME_WIDTH/2,n.SOURCE_GAME_HEIGHT/2),n.GAME_BOUNDS=new Phaser.Rectangle(0,0,n.SOURCE_GAME_WIDTH,n.SOURCE_GAME_HEIGHT),n.GAME_WIDTH=n.SOURCE_GAME_WIDTH,n.GAME_HEIGHT=n.SOURCE_GAME_HEIGHT,n.HALF_GAME_WIDTH=n.GAME_WIDTH*.5,n.HALF_GAME_HEIGHT=n.GAME_HEIGHT*.5,n.WORLD_SCALE=1,n.ASPECT_RATIO=n.SOURCE_GAME_WIDTH/n.SOURCE_GAME_HEIGHT,n.ASSETS_SCALE=1,n}();s.Config=r})(game||(game={}));var utils;(function(s){var r=function(){function n(){}return n.createRectTexture=function(e,t,i,o,a){o===void 0&&(o="#000000");var h=Phaser.Color.hexToColor(o),l=!!a,u=e.add.bitmapData(t,i,a,l);return u.fill(h.r,h.g,h.b),u},n.createCircleTexture=function(e,t,i,o){i===void 0&&(i="#000000");var a=!!o,h=e.add.bitmapData(t*2,t*2,o,a);return h.context.fillStyle=i,h.circle(t,t,t),h},n}();s.DrawUtil=r})(utils||(utils={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t,t.plugins)||this;i.overlayDuration=150;var o=utils.DrawUtil.createRectTexture(i.game,1,1,"#FFF3E0","black_rect");return i.overlay=new Phaser.Image(t,0,0,o),i.overlay.visible=!1,i.game.stage.addChild(i.overlay),i}return e.prototype.fillStage=function(){this.overlay.width=s.Config.GAME_WIDTH,this.overlay.height=s.Config.GAME_HEIGHT},e.prototype.changeState=function(t,i){this.fillStage(),this.game.input.enabled=!1,this.showOverlay(t,i)},e.prototype.showOverlay=function(t,i){var o=this;this.overlay.visible=!0,this.overlay.alpha=0,this.overlayTween=this.game.add.tween(this.overlay).to({alpha:1},this.overlayDuration,Phaser.Easing.Cubic.Out,!0),this.overlayTween.onComplete.addOnce(function(){o.doChangeState(t,i)},this)},e.prototype.doChangeState=function(t,i){var o=this;this.game.input.enabled=!0,this.game.state.start(t,!0,!1,i),setTimeout(function(){o.hideOverlay()},100),setTimeout(function(){o.overlay.visible=!1},100+this.overlayDuration)},e.prototype.hideOverlay=function(){this.overlayTween=this.game.add.tween(this.overlay).to({alpha:0},this.overlayDuration,Phaser.Easing.Cubic.Out,!0)},e}(Phaser.Plugin);s.StateTransition=r})(game||(game={}));var game;(function(s){var r=function(){function n(){this.name="Runtime Storage",this.storage={}}return Object.defineProperty(n.prototype,"namespace",{get:function(){return this._namespace},enumerable:!1,configurable:!0}),n.prototype.init=function(){},n.prototype.setNamespace=function(e){this._namespace=e},n.prototype.saveValue=function(e,t){this.storage[this.getSaveKey(e)]=t},n.prototype.getValue=function(e){return this.storage[this.getSaveKey(e)]},n.prototype.getNumber=function(e){return this.getValue(e)||0},n.prototype.getBoolean=function(e){return this.getValue(e)||!1},n.prototype.getString=function(e){return this.getValue(e)||""},n.prototype.getObject=function(e){return this.getValue(e)||{}},n.prototype.getContent=function(e){var t=this;if(e===void 0&&(e=!1),e)return this.storage;var i=Object.keys(this.storage).filter(function(a){return a.indexOf(t._namespace)>-1}),o={};return i.forEach(function(a){o[a]=t.storage[a]}),o},n.prototype.clear=function(e){var t=this;if(e===void 0&&(e=!1),e)this.storage={};else{var i=Object.keys(this.storage).filter(function(o){return o.indexOf(t._namespace)>-1});i.forEach(function(o){delete t.storage[o]})}},n.prototype.getSaveKey=function(e){return this._namespace+"__"+e},n}();s.RuntimeStorage=r})(game||(game={}));var game;(function(s){var r=function(){function n(e){this.type="Local Forage",this.storeName=e}return n.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),this.instance=localforage.createInstance({driver:[localforage.LOCALSTORAGE,localforage.INDEXEDDB],storeName:this.storeName,name:"robowhale"}),e="testKey",[4,Promise.all([this.instance.setItem(e,e),this.instance.getItem(e),this.instance.removeItem(e)])];case 1:return t=o.sent(),[3,3];case 2:return i=o.sent(),this.instance=null,[2,Promise.reject(i)];case 3:return[2]}})})},n.prototype.saveValue=function(e,t){var i;return(i=this.instance)===null||i===void 0?void 0:i.setItem(this.getStorageKey(e),t)},n.prototype.getStorageKey=function(e){return"__"+e},n.prototype.getValue=function(e){var t;return(t=this.instance)===null||t===void 0?void 0:t.getItem(this.getStorageKey(e))},n.prototype.getNumber=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.getValue(e)]})})},n.prototype.getBoolean=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.getValue(e)]})})},n.prototype.getString=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.getValue(e)]})})},n.prototype.getObject=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,this.getValue(e)]})})},n.prototype.remove=function(e){var t;(t=this.instance)===null||t===void 0||t.removeItem(this.getStorageKey(e))},n.prototype.clear=function(){var e;return(e=this.instance)===null||e===void 0?void 0:e.clear()},n.prototype.getDriverType=function(){if(!this.instance)return"none";switch(this.instance._driver){case localforage.LOCALSTORAGE:return"localStorage";case localforage.INDEXEDDB:return"indexed db";case localforage.WEBSQL:return"websql";default:return"none"}},n}();s.LocalForageWrapper=r})(game||(game={}));var game;(function(s){var r;(function(e){e.LANGUAGE="language",e.SOUND_MUTED="sound_muted",e.MUSIC_MUTED="music_muted",e.SAVED_GAME_STATE="saved_game_state",e.TUTORIAL_COMPLETE="Tutorial",e.GAME_OVER_TUTORIAL_COMPLETE="game_over_tutorial_complete",e.COINS="Coins",e.BEST_ITEM="best_item",e.HEADSTART_POPUP_DSIABLED="headstart_popup_disabled",e.COINSx2_POPUP_DSIABLED="coinsx2_popup_disabled",e.SHUFFLE_TIMES="shuffle_times",e.GAMES_PLAYED="games_played",e.SHARE_REWARD_CLAIMED="share_reward",e.PLAYER_ID="player_id",e.PLAYER_NAME="player_name",e.FREE_COINS_DISABLED="free_coins_enabled"})(r=s.GameStoreKey||(s.GameStoreKey={}));var n=function(){function e(t,i){this.game=t,this.storeName=i,this.initRuntimeStorage()}return e.prototype.initRuntimeStorage=function(){this._runtimeStorage=new s.RuntimeStorage,this._runtimeStorage.setNamespace(game.Config.GAME_TITLE)},e.prototype.initActualStorage=function(){return this.useLocalForage()},e.prototype.useLocalForage=function(){var t=this,i=new s.LocalForageWrapper(this.storeName);return new Promise(function(o,a){i.init().then(function(){t.setStorage(i),o()}).catch(function(h){a(h)}).finally(function(){var h,l,u=i.getDriverType();(h=t.game.raven)===null||h===void 0||h.addTagsContext({storage:u}),(l=t.game.analytics)===null||l===void 0||l.sendDesignEvent("Storage:"+u)})})},e.prototype.setStorage=function(t){this._storage=t},e.prototype.getValue=function(t){return this._runtimeStorage.getValue(t)},e.prototype.getBoolean=function(t){return this._runtimeStorage.getBoolean(t)},e.prototype.getNumber=function(t){return this._runtimeStorage.getNumber(t)},e.prototype.getObject=function(t){return this._runtimeStorage.getObject(t)},e.prototype.saveValue=function(t,i){var o=this,a;this._runtimeStorage.saveValue(t,i),(a=this._storage)===null||a===void 0||a.saveValue(t,i).catch(function(h){var l;(l=o.game.raven)===null||l===void 0||l.captureException(h,{extra:{key:t}})})},e.prototype.changeNumericValue=function(t,i){var o=this.getNumber(t),a=o+i;return this.saveValue(t,a),a},e.prototype.getCoins=function(){return this.getNumber(r.COINS)},e.prototype.getPlayerId=function(){return this.getValue(r.PLAYER_ID)},e.prototype.changeCoins=function(t){var i=this.getCoins(),o=Math.max(0,i+t);return this.saveValue(r.COINS,o),o},e.prototype.loadInitialValues=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,Promise.all(__spreadArrays([this.loadValue(r.SAVED_GAME_STATE,""),this.loadValue(r.LANGUAGE,""),this.loadValue(r.TUTORIAL_COMPLETE,!1),this.loadValue(r.GAME_OVER_TUTORIAL_COMPLETE,!1),this.loadValue(r.BEST_ITEM,2),this.loadValue(r.COINS,0),this.loadValue(r.GAMES_PLAYED,0),this.loadValue(r.SHUFFLE_TIMES,0),this.loadValue(r.HEADSTART_POPUP_DSIABLED,!1),this.loadValue(r.COINSx2_POPUP_DSIABLED,!1),this.loadValue(r.SOUND_MUTED,!1),this.loadValue(r.MUSIC_MUTED,!1),this.loadValue(r.SHARE_REWARD_CLAIMED,!1),this.loadValue(r.FREE_COINS_DISABLED,!1),this.loadValue(r.PLAYER_ID,""),this.loadValue(r.PLAYER_NAME,"")],this.loadBoosters()))];case 1:return t.sent(),this.checkLoadedValues(),this.clearDataOnLoad(),this._runtimeStorage.getContent(!0),[2]}})})},e.prototype.checkLoadedValues=function(){var t=Object.keys(e).map(function(a){return e[a]}),i=Object.keys(this._runtimeStorage.getContent()).map(function(a){return a.split("__")[1]}),o=_.difference(t,i);o.length>0},e.prototype.loadValue=function(t,i,o,a){return __awaiter(this,void 0,void 0,function(){var h,l,u;return __generator(this,function(c){switch(c.label){case 0:return this._storage?(h=o||this.getLoadCallbackByValueType(i),l=a||this._storage,[4,h.call(l,t)]):(this._runtimeStorage.saveValue(t,i),[2]);case 1:return u=c.sent()||i,this._runtimeStorage.saveValue(t,u),[2]}})})},e.prototype.getLoadCallbackByValueType=function(t){var i=typeof t;switch(i){case"number":return this._storage.getNumber;case"string":return this._storage.getValue;case"boolean":return this._storage.getBoolean;case"object":return this._storage.getObject;default:return this._storage.getValue}},e.prototype.clear=function(){var t;this._runtimeStorage.clear(),(t=this._storage)===null||t===void 0||t.clear()},e.prototype.initPlayer=function(){var t=this.getValue(r.PLAYER_ID);t===""&&this.saveValue(r.PLAYER_ID,this.game.rnd.uuid().toString())},e.prototype.clearDataOnLoad=function(){var t=utils.NetUtil.getParamBool("clearData");if(!t)return;this.saveValue(r.SAVED_GAME_STATE,""),this.saveValue(r.TUTORIAL_COMPLETE,!1),this.saveValue(r.GAME_OVER_TUTORIAL_COMPLETE,!1),this.saveValue(r.BEST_ITEM,2),this.saveValue(r.COINS,0),this.saveValue(r.GAMES_PLAYED,0),this.saveValue(r.SHUFFLE_TIMES,0),this.saveValue(r.HEADSTART_POPUP_DSIABLED,!1),this.saveValue(r.COINSx2_POPUP_DSIABLED,!1),this.saveValue(r.SHARE_REWARD_CLAIMED,!1),this.clearBoosters()},e.prototype.loadBoosters=function(){var t=this;return s.BoosterTypeUtil.getAllTypes().map(function(i){return t.loadValue(i,0)})},e.prototype.clearBoosters=function(){var t=this;return s.BoosterTypeUtil.getAllTypes().map(function(i){return t.saveValue(i,0)})},e.prototype.migrateSaveData=function(){var t=this;try{var i="Impossible_13";Object.keys(localStorage).filter(function(o){return o.includes(i)}).forEach(function(o){var a=o.split("__")[1],h=localStorage.getItem(o),l=a===r.SAVED_GAME_STATE?h:JSON.parse(h);t.saveValue(a,l),localStorage.removeItem(o)})}catch(o){}},e}();s.GameStore=n})(game||(game={}));var utils;(function(s){var r=function(){function n(){}return n.getCurrentHost=function(){return window.location&&window.location.hostname?window.location.hostname:null},n.isLocalhost=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.isHostAllowed(__spreadArrays(e,["localhost"]))},n.isHostAllowed=function(e){var t=n.getCurrentHost();return t?e.some(function(i){return t.includes(i)}):!1},n.inIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},n.getParam=function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),i=new RegExp("[\\?&]"+t+"=([^&#]*)"),o=i.exec(location.search);return o===null?null:decodeURIComponent(o[1].replace(/\+/g," "))},n.getParamInt=function(e,t){t===void 0&&(t=0);var i=this.getParam(e);if(i){var o=parseInt(i);return isNaN(o)?t:o}return t},n.getParamFloat=function(e,t){t===void 0&&(t=0);var i=this.getParam(e);if(i){var o=parseFloat(i);return isNaN(o)?t:o}return t},n.getParamBool=function(e,t){t===void 0&&(t="1");var i=n.getParam(e);return!!(i&&i===t)},n}();s.NetUtil=r})(utils||(utils={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a,h,l){var u=n.call(this,t,i,o,a,h)||this;return u.callbackDelay=0,u._enabled=!0,u.disableInput=!1,u.userData=null,u.soundKey="tap",u.areTweensEnabled=!0,l=l!=null?l:u.game.world,l.add(u),u._callback=new Phaser.Signal,u.anchor.set(.5,.5),u.inputEnabled=!0,u.events.onInputDown.add(u.onInputDown,u),u.events.onInputUp.add(u.onInputUp,u),u.userData={},u.name=h,u.game.device.desktop&&(u.input.useHandCursor=!0),u}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t,this.input.enabled=this._enabled},enumerable:!1,configurable:!0}),e.prototype.onInputDown=function(){if(this.disableInput)return;this.executeCallback(),this.game.cache.checkSoundKey(this.soundKey)&&this.game.sound.play(this.soundKey),this.areTweensEnabled&&this.game.add.tween(this.scale).to({x:.9,y:.9},50,Phaser.Easing.Cubic.Out,!0)},e.prototype.onInputUp=function(){if(this.disableInput)return;this.areTweensEnabled&&(this.game.tweens.removeFrom(this.scale),this.game.add.tween(this.scale).to({x:1,y:1},150,Phaser.Easing.Cubic.Out,!0))},e.prototype.executeCallback=function(){this.callbackDelay>0?this.game.time.events.add(this.callbackDelay,this._callback.dispatch,this._callback,this):this._callback.dispatch(this)},e.prototype.setCallbackDelay=function(t){this.callbackDelay=t},e.prototype.destroy=function(){n.prototype.destroy.call(this),this._callback.dispose(),this._callback=null},Object.defineProperty(e.prototype,"callback",{get:function(){return this._callback},enumerable:!1,configurable:!0}),e}(Phaser.Image);s.SimpleButton=r})(game||(game={}));var game;(function(s){var r;(function(n){n.BOOT="Boot",n.PRELOADER="WebPreloader",n.MAIN_MENU="MainMenu",n.LEADERBOARDS="LEADERBOARDS",n.BOOSTERS_SHOP="BoostersShop",n.LEVEL="Level",n.GAME_OVER="GameOver"})(r=s.StateKey||(s.StateKey={}))})(game||(game={}));var utils;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i||t.stage,"fps_meter")||this;return o.timer=0,o.updateInterval=100,o.initBackground(),o.initText(),o.onResize(),o.game.state.onStateChange.add(o.addPointerCallback,o),o.game.scale.onSizeChange.add(o.onResize,o),o.game.time.advancedTiming=!0,o}return e.prototype.addPointerCallback=function(){this.game.input.onDown.has(this.onInputDown,this)===!1&&this.game.input.onDown.add(this.onInputDown,this)},e.prototype.onInputDown=function(t){var i=this.getBounds(this.parent),o=i.contains(t.x,t.y);o&&this.toggleVisibility()},e.prototype.toggleVisibility=function(){this.alive?this.kill():this.revive()},e.prototype.initBackground=function(){var t=s.DrawUtil.createRectTexture(this.game,164,26);this.bg=this.game.add.image(0,0,t,null,this)},e.prototype.initText=function(){var t={font:"18px Consolas",fill:"#FFFFFF",align:"left"};this.text=this.game.add.text(6,4,"0 fps",t,this)},e.prototype.update=function(){this.timer+=this.game.time.elapsed,this.timer>=this.updateInterval&&(this.timer-=this.updateInterval,this.updateStats())},e.prototype.updateStats=function(){var t="FPS: "+this.game.time.fps,i="DC: "+this.getDrawCallsNum(),o=t+" | "+i;this.text.setText(o)},e.prototype.getDrawCallsNum=function(){if(this.game.renderType===Phaser.CANVAS)return 0;var t=this.game.renderer.renderSession.drawCount,i=2;return t-i},e.prototype.onResize=function(){this.top=game.Config.GAME_HEIGHT-this.bg.height,this.left=0},e.prototype.destroy=function(){this.game.time.advancedTiming=!1,n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.FPSMeter=r})(utils||(utils={}));var game;(function(s){var r=utils.NetUtil,n=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return this.game.analytics||(this.game.analytics=new s.GameAnalyticsWrapper(this.game)),i=this.game,[4,this.checkAvifSupport()];case 1:return i.avif=o.sent(),this.patchLoader(),[2]}})})},t.prototype.checkAvifSupport=function(){var i=r.getParamBool("noAvif");if(i)return Promise.resolve(!1);var o=window.environment===GameEnvironment.DEVELOP;return o?Promise.resolve(!1):new Promise(function(a){var h=function(){return l.height===2?a(!0):a(!1)},l=new Image;l.onload=h,l.onerror=h,l.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="})},t.prototype.checkWebpSupport=function(){var i=r.getParamBool("noWebp");if(i)return!1;var o=window.environment===GameEnvironment.DEVELOP;return o?!1:this.checkWebP()},t.prototype.checkWebP=function(){var i=navigator.userAgent.match(/(Edge|Firefox)\/(\d+)\.(\d*)/);if(i&&i[1]==="Firefox"&&+i[2]>=65)return!0;if(i&&i[1]==="Edge"&&+i[2]===18&&+i[3]===17763)return!1;var o=Phaser.CanvasPool.create(document.body),a=o.toDataURL?o.toDataURL("image/webp").indexOf("data:image/webp")==0:!1;return Phaser.CanvasPool.remove(o),a},t.prototype.patchLoader=function(){if(!this.game.avif&&!this.game.webp)return;var i=this.game.avif?".avif":".webp",o=[".png",".jpg"],a=Phaser.Loader.prototype.addToFileList;Phaser.Loader.prototype.addToFileList=function(h,l,u,c,d,f){var p=o.find(function(g){return u.includes(g)});return p&&(u=u.replace(p,i)),a.call(this,h,l,u,c,d,f),this}},t.prototype.preload=function(){},t.prototype.create=function(){var i=this;this.addPlugins(),this.setupScale(),this.addFPSMeter(),this.detectModernDevice(),this.fixAndroidDoubleClickBug(),this.decoratePage(),this.game.raven.setTagsOnStart(),this.game.raven.trackStateChanges(),this.game.raven.trackInputDown(),this.game.input.maxPointers=1,Promise.allSettled([this.loadWebFonts(),this.initPokiSdk()]).catch(function(o){}).finally(function(){i.game.state.start("Preloader",!0,!1)})},t.prototype.addPlugins=function(){this.game.stateTransitionPlugin=this.game.add.plugin(new s.StateTransition(this.game)),this.game.kineticScrolling=this.game.plugins.add(Phaser.Plugin.KineticScrolling),this.game.plugins.add(PhaserCachebuster.CacheBuster),Phaser.Plugin.SceneGraph&&this.game.plugins.add(Phaser.Plugin.SceneGraph,{quiet:!0})},t.prototype.setupScale=function(){this.game.device.desktop?this.scaleForDesktop():(this.scaleForMobile(),this.scaleGame(),this.isLandscape()&&this.onEnterIncorrectOrientation())},t.prototype.scaleForDesktop=function(){var i=this.game.scale;i.scaleMode=Phaser.ScaleManager.SHOW_ALL,i.aspectRatio=s.Config.SOURCE_GAME_WIDTH/s.Config.SOURCE_GAME_HEIGHT,i.pageAlignHorizontally=!0,i.pageAlignVertically=!0},t.prototype.scaleForMobile=function(){var i=this.game.scale;i.scaleMode=Phaser.ScaleManager.EXACT_FIT,i.forceOrientation(!1,!0),i.onOrientationChange.add(this.onOrientationChange,this),window.addEventListener("resize",this.onSizeChange.bind(this))},t.prototype.onOrientationChange=function(i,o,a){a&&this.fillViewport()},t.prototype.onSizeChange=function(){var i=s.Config.IS_PORTRAIT&&this.isPortrait(),o=s.Config.IS_LANDSCAPE&&this.isLandscape(),a=i||o;a?(this.scaleGame(),this.game.state.resize(s.Config.GAME_WIDTH,s.Config.GAME_HEIGHT),this.onEnterCorrectOrientation()):this.onEnterIncorrectOrientation()},t.prototype.fillViewport=function(){var i=this;typeof this.resizeTimeout!="undefined"&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){document.body.style.width="100vw",document.body.style.height="100vh",i.resizeTimeout=setTimeout(function(){i.onSizeChange()},300)},300)},t.prototype.decoratePage=function(){var i=utils.NetUtil.getParamBool("noSidebars");if(i===!1){this.addSidebars(this.game.canvas);var o=this.getDefaultImageFormat();this.game.canvas.parentElement.style.backgroundImage="url('assets/graphics/page_background."+o+"')",this.game.canvas.style.boxShadow="0px 0px 5px 5px rgba(0, 0, 0, 0.07)",this.game.scale.refresh()}else this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.align(!0,!0)},t.prototype.getDefaultImageFormat=function(){return this.game.avif?"avif":this.game.webp?"webp":"png"},t.prototype.addSidebars=function(i){var o=this.getDefaultImageFormat(),a=document.createElement("div");a.className="sidebar",a.style.backgroundImage="url('assets/graphics/page_sidebar_left."+o+"')",i.parentNode.insertBefore(a,i);var h=document.createElement("div");h.className="sidebar",h.style.backgroundImage="url('assets/graphics/page_sidebar_right."+o+"')",i.parentNode.insertBefore(h,i.nextSibling)},t.prototype.addFPSMeter=function(){var i=r.getParamBool("stats");i&&this.stage.addChild(new utils.FPSMeter(this.game))},t.prototype.detectModernDevice=function(){s.Main.modernDevice=this.game.renderType===Phaser.WEBGL||this.game.renderType===Phaser.WEBGL_MULTI},t.prototype.scaleGame=function(){var i=window.innerWidth,o=window.innerHeight,a=s.Config.SOURCE_GAME_WIDTH,h=s.Config.SOURCE_GAME_HEIGHT,l=s.Config.IS_PORTRAIT?i/a:o/h;this.scale.setGameSize(i/l,o/l),this.game.canvas.parentElement.style.width=i+"px",this.game.canvas.parentElement.style.height=o+"px",s.Config.WORLD_SCALE=l,s.Config.GAME_WIDTH=this.game.width,s.Config.GAME_HEIGHT=this.game.height,s.Config.HALF_GAME_WIDTH=s.Config.GAME_WIDTH*.5,s.Config.HALF_GAME_HEIGHT=s.Config.GAME_HEIGHT*.5,s.Config.ASPECT_RATIO=s.Config.GAME_WIDTH/s.Config.GAME_HEIGHT,s.Config.GAME_BOUNDS.setTo(0,0,s.Config.GAME_WIDTH,s.Config.GAME_HEIGHT),s.Config.GAME_CENTER.set(s.Config.HALF_GAME_WIDTH,s.Config.HALF_GAME_HEIGHT)},t.prototype.onEnterIncorrectOrientation=function(){document.getElementById("rotate").style.display="flex"},t.prototype.onEnterCorrectOrientation=function(){document.getElementById("rotate").style.display="none"},t.prototype.isLandscape=function(){return window.innerWidth>window.innerHeight},t.prototype.isPortrait=function(){return window.innerHeight>window.innerWidth},t.prototype.fixAndroidDoubleClickBug=function(){this.game.device.touch&&this.game.device.android&&(this.game.input.mouse.enabled=!1,this.game.input.mouse.stop())},t.prototype.loadWebFonts=function(){return new Promise(function(i,o){WebFont.load({custom:{families:["Nunito:n4,n7"],urls:["css/fonts.css"]},inactive:o,active:i})})},t.prototype.initPokiSdk=function(){return this.game.poki=new s.PokiSdkWrapper(this.game),this.game.poki.init()},t}(Phaser.State);s.Boot=n})(game||(game={}));var game;(function(s){var r=function(){function n(e){this.coins=0,this.moves=0,this._isHighscore=!1,this.game=e,this.bestItemTypeOnStart=this.game.store.getNumber(s.GameStoreKey.BEST_ITEM),this.totalTime=0,this.lastActiveTime=this.game.time.now}return n.prototype.updateTime=function(){var e=this.game.time.now-this.lastActiveTime;this.lastActiveTime=this.game.time.now,this.totalTime+=e},n.prototype.onLevelEnd=function(e){this.updateTime(),this.calculateTime(),this.bestItemTypeAtEnd=_.maxBy(e,"itemType").itemType,this.bestItemTypeAtEnd>this.bestItemTypeOnStart&&(this._isHighscore=!0)},n.prototype.calculateTime=function(){this._timeInSeconds=Math.round(this.totalTime/1e3),this._timeInMinutes=Math.round(this._timeInSeconds/60)},Object.defineProperty(n.prototype,"timeInMinutes",{get:function(){return this._timeInMinutes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"timeInSeconds",{get:function(){return this._timeInSeconds},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isHighscore",{get:function(){return this._isHighscore},enumerable:!1,configurable:!0}),n.prototype.clone=function(){var e=new n(this.game);return e.moves=this.moves,e.coins=this.coins,e.lastActiveTime=this.lastActiveTime,e.totalTime=this.totalTime,e},n.prototype.toString=function(){var e={coins:this.coins,moves:this.moves,totalTime:this.totalTime,timeInSeconds:this.timeInSeconds,timeInMinutes:this.timeInMinutes,bestItemTypeOnStart:this.bestItemTypeOnStart,currentBestItemType:this.currentBestItemType,bestItemTypeAtEnd:this.bestItemTypeAtEnd,isHighscore:this._isHighscore};return JSON.stringify(e)},n.fromString=function(e,t){var i=_.attempt(JSON.parse,e);if(_.isError(i))return i.name,i.message,null;var o=new n(t);return o.coins=i.coins,o.moves=i.moves,o.totalTime=i.totalTime,o.lastActiveTime=t.time.now,o._timeInSeconds=i.timeInSeconds,o._timeInMinutes=i.timeInMinutes,o.bestItemTypeOnStart=i.bestItemTypeOnStart,o.currentBestItemType=i.currentBestItemType,o.bestItemTypeAtEnd=i.bestItemTypeAtEnd,o._isHighscore=i.isHighscore,o},n}();s.LevelStats=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t)||this;return i.coins=i.game.rnd.integerInRange(0,1999),i.moves=i.game.rnd.integerInRange(1,1e3),i._timeInSeconds=i.game.rnd.integerInRange(30,4e3),i._timeInMinutes=i.game.rnd.integerInRange(0,100),i.bestItemTypeAtEnd=i.game.rnd.integerInRange(2,200),i._isHighscore=!0,i}return e}(s.LevelStats);s.FakeLevelStats=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.fadeOutLoadingSpinner=function(){var t=this.getLoadingSpinner();t&&t.classList.add("spinner-fadeout")},e.prototype.removeLoadingSpinner=function(){var t=this.getLoadingSpinner();t&&t.remove()},e.prototype.getLoadingSpinner=function(){return document.getElementById("loading-spinner-container")},e.prototype.preload=function(){this.game.analytics.sendLoadingEvent("main","start"),this.game.poki.sdk.gameLoadingStart(),this.load.cacheBuster=window.game.config.build_version.toString(),this.load.maxParallelDownloads=this.game.device.android?6:32,this.load.onFileComplete.add(this.onLoadProgress,this),this.loadOtherAssets(),this.loadFonts(),this.loadAudio(),this.loadGraphics()},e.prototype.onLoadProgress=function(){},e.prototype.loadOtherAssets=function(){this.load.json("texts","assets/texts.json"),this.load.json("boosters","assets/configs/boosters.json")},e.prototype.loadFonts=function(){this.load.bitmapFontFromAtlas(s.GameFonts.BOOSTERS_SHOP_BARIOL_BOLD,"boosters_shop","bariol_bold0000","assets/fonts/bitmap/bariol_bold.fnt"),this.load.bitmapFontFromAtlas(s.GameFonts.BARIOL_BOLD_BMP,"interface","bariol_bold0000","assets/fonts/bitmap/bariol_bold.fnt"),this.load.bitmapFontFromAtlas(s.GameFonts.BARIOL_REGULAR_BMP,"interface","bariol_regular0000","assets/fonts/bitmap/bariol_regular.fnt"),this.load.bitmapFontFromAtlas(s.GameFonts.GAME_OVER_BARIOL_BOLD,"game_over","bariol_bold0000","assets/fonts/bitmap/bariol_bold.fnt")},e.prototype.loadAudio=function(){},e.prototype.loadGraphics=function(){this.load.atlasJSONHash("leaderboard","assets/graphics/leaderboard.png","assets/graphics/leaderboard.json"),this.load.atlasJSONHash("main_menu","assets/graphics/main_menu.png","assets/graphics/main_menu.json"),this.load.atlasJSONHash("language_button","assets/graphics/button_language.png","assets/graphics/button_language.json"),this.load.atlasJSONHash("boosters_shop","assets/graphics/boosters_shop.png","assets/graphics/boosters_shop.json"),this.load.atlasJSONHash("interface","assets/graphics/interface.png","assets/graphics/interface.json"),this.load.atlasJSONHash("game_over","assets/graphics/game_over.png","assets/graphics/game_over.json")},e.prototype.create=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadSaveData()];case 1:return t.sent(),this.initPlayfab(),this.addToast(),this.initTexts(),this.initBoosters(),this.initAudio(),this.loadAudioDelayed(),this.game.poki.sdk.gameLoadingFinished(),this.game.analytics.sendLoadingEvent("main","complete"),this.startGame(),[2]}})})},e.prototype.loadSaveData=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,3,6]),[4,this.game.store.initActualStorage()];case 1:return o.sent(),[3,6];case 2:return t=o.sent(),i=t instanceof DOMException?t.message:t.toString(),this.game.analytics.sendErrorEvent("Storage:Init:"+i,gameanalytics.EGAErrorSeverity.Warning),[3,6];case 3:return[4,this.game.store.loadInitialValues()];case 4:return o.sent(),[4,this.game.store.migrateSaveData()];case 5:return o.sent(),[7];case 6:return[2]}})})},e.prototype.initPlayfab=function(){var t=this.game.store,i=t.getPlayerId();i===""&&(i=this.game.rnd.uuid().toString(),t.saveValue(s.GameStoreKey.PLAYER_ID,i)),this.game.playfab=new game.PlayfabWrapper(this.game)},e.prototype.addToast=function(){this.game.toast=new s.Toast(this.game,this.stage),this.game.toast.kill()},e.prototype.initTexts=function(){this.game.texts=new s.GameTexts(this.game),this.game.analytics.sendDesignEvent("Language:browser:"+navigator.language),this.game.analytics.sendDesignEvent("Language:game:"+this.game.texts.language)},e.prototype.initBoosters=function(){this.game.boosters=new s.BoostersManager(this.game);var t=utils.NetUtil.getParamBool("boosters");t&&(this.game.boosters.getBooster(s.BoosterType.MAGNET).num=9,this.game.boosters.getBooster(s.BoosterType.REMOVE).num=9,this.game.boosters.getBooster(s.BoosterType.UPGRADE).num=3,this.game.boosters.getBooster(s.BoosterType.SORT).num=9,this.game.boosters.getBooster(s.BoosterType.UNDO).num=9)},e.prototype.initAudio=function(){this.game.audio=new s.GameAudio(this.game),this.game.audio.trackFocusChange(),this.game.audio.loadMute()},e.prototype.loadAudioDelayed=function(){var t="assets/audio/",i=new Phaser.Loader(this.game);i.cacheBuster="1",i.audio("tap",t+"tap.mp3"),i.audio("fancy_tap",t+"fancy_tap.mp3"),i.audio("coins_prize",t+"coins_prize.mp3"),i.audio("score_count_2",t+"score_count_2.mp3"),i.audio("pop_1",t+"Pop_A.mp3"),i.audio("pop_2",t+"Pop_B.mp3"),i.audio("pop_4",t+"Pop_D.mp3"),i.audio("item_convert",t+"item_convert.mp3"),i.audio("item_convert_2",t+"item_convert_2.mp3"),i.audio("toast_1",t+"toast_1.mp3"),i.audio("muted_error",t+"muted_error.mp3"),i.audio("new_item",t+"new_item.mp3"),i.audio("purchase",t+"purchase.mp3"),i.audio("game_complete_1",t+"game_complete_1.mp3"),i.audio("game_complete_2",t+"game_complete_2.mp3"),i.audio("coins_2",t+"coins_2.mp3"),i.audio("coins_3",t+"coins_3.mp3"),i.audio("no_moves_1",t+"no_moves_1.mp3"),i.audio("no_moves_2",t+"no_moves_2.mp3"),i.audio("whoosh",t+"whoosh_up.mp3"),i.audio("popup",t+"popup.mp3"),i.audio("shuffle",t+"shake.mp3"),i.audio("restart_1",t+"restart_1.mp3"),i.audio("booster_selected",t+"booster_selected.mp3"),i.audio("fforward",t+"fforward.mp3"),i.audio("tutorial",t+"tutorial.mp3"),i.resetLocked=!0,i.onLoadComplete.addOnce(this.onAudioLoadComplete,this,0,i),i.start()},e.prototype.onAudioLoadComplete=function(t){t._fileList.forEach(function(i){i.key,i.url,i.loaded})},e.prototype.addCheatResources=function(){this.game.store.saveValue(s.GameStoreKey.COINS,1e3),this.game.boosters.getBooster(s.BoosterType.MAGNET).num=5,this.game.boosters.getBooster(s.BoosterType.UNDO).num=10,this.game.boosters.getBooster(s.BoosterType.REMOVE).num=99,this.game.boosters.getBooster(s.BoosterType.SORT).num=2,this.game.boosters.getBooster(s.BoosterType.UPGRADE).num=3},e.prototype.startGame=function(){var t=window.environment===GameEnvironment.DEVELOP;t?this.startGameDev():this.startGameDeploy()},e.prototype.getSavedGameplayData=function(){var t=this.game.store.getValue(s.GameStoreKey.SAVED_GAME_STATE);return _.isEmpty(t)?null:s.SavedGameState.fromString(t,this.game)},e.prototype.createFakeLeaderBoard=function(){var t=this.cache.getJSON("leaderboard",!0);t.forEach(function(i){i.DisplayName=i.name,i.PlayFabId=i.id,i.Position=i.rank,i.StatValue=i.points,delete i.name,delete i.id,delete i.rank,delete i.points}),JSON.stringify(t,null,4)},e.prototype.startGameDev=function(){this.game.changeState("MainMenu")},e.prototype.startGameDeploy=function(){var t=this,i=this.game.store.getBoolean(s.GameStoreKey.TUTORIAL_COMPLETE)===!1;if(i){this.game.poki.commercialBreak("Preloader").finally(function(){t.game.changeState("Level")});return}var o=this.getSavedGameplayData();if(o){this.game.poki.commercialBreak("Preloader").finally(function(){t.game.changeState("Level",o)});return}this.game.changeState("MainMenu")},e.prototype.shutdown=function(t){var i=this;this.fadeOutLoadingSpinner(),setTimeout(function(){i.removeLoadingSpinner()},200)},e}(Phaser.State);s.BasePreloader=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.init=function(){n.prototype.init.call(this),this.resize()},e.prototype.onLoadProgress=function(){n.prototype.onLoadProgress.call(this)},e.prototype.create=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,n.prototype.create.call(this)]})})},e.prototype.resize=function(){},e.prototype.shutdown=function(t){n.prototype.shutdown.call(this,t)},e}(s.BasePreloader);s.WebPreloader=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"game_logo")||this;return o.starsNum=3,o.scales=[.44,.66,1],o.addLogo(),o.addLeftStars(),o.addRightStars(),o}return e.prototype.addLogo=function(){this.logo=this.game.add.image(0,0,"main_menu","Item_130000",this),this.logo.anchor.set(.5,.5),this.logo.inputEnabled=!0,this.logo.data.clicks=0,this.logo.events.onInputDown.add(this.onClick,this),this.logo.name="game_logo",s.Main.development&&(this.logo.input.useHandCursor=!0)},e.prototype.onClick=function(){if(++this.logo.data.clicks===5){this.logo.data.clicks=0;var t=typeof window.confirm!="undefined"&&window.confirm("Clear all saved data?")===!0;t&&(this.game.store.clear(),this.game.state.restart(!0,!1))}},e.prototype.addLeftStars=function(){this.leftStars=this.createStars(),this.leftStars.name="left_stars",this.leftStars.right=this.logo.left-20,this.leftStars.centerY=this.logo.centerY},e.prototype.addRightStars=function(){this.rightStars=this.createStars(),this.rightStars.name="right_stars",this.rightStars.scale.x=-1,this.rightStars.left=this.logo.right+20,this.rightStars.centerY=this.leftStars.centerY},e.prototype.createStars=function(){var t=this,i=this.game.add.group(this);return i.createMultiple(this.starsNum,"main_menu","Title_Star0000",!0),i.children.forEach(function(o,a){o.anchor.set(.5,.5),o.scale.set(t.scales[a])}),i.align(this.starsNum,1,52,70,Phaser.CENTER),i.children[1].x-=9,i},e.prototype.show=function(t){this.showItem(t),this.showStars(t)},e.prototype.showItem=function(t){this.game.add.tween(this.logo).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.logo.scale).from({x:.66,y:.66},400,Phaser.Easing.Back.Out,!0,t),this.centerY=this.originalY-100,this.game.add.tween(this).to({y:this.originalY},500,Phaser.Easing.Back.Out,!0,t)},e.prototype.showStars=function(t){var i=t+200;this.doShowStars(this.leftStars,i),this.doShowStars(this.rightStars,i)},e.prototype.doShowStars=function(t,i){var o=this;t.children.reverse().forEach(function(a,h){var l=330+120*h,u=i+h*100;o.game.add.tween(a).from({x:"-66",alpha:0,angle:30},l,Phaser.Easing.Cubic.Out,!0,u)})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.GameLogo=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"circles")||this;return o.addCircles(),o.bringToTop(o.bestItemCircle),o}return e.prototype.addCircles=function(){var t=200,i=15896576,o="main_menu",a="Circle0000",h=this.game.store.getCoins().toString();this.coinsCircle=new s.StatCircle(this.game,this,o,a,i,h),this.coinsCircle.addIcon("main_menu","Icon_Coin0000"),this.coinsCircle.scale.set(.9),this.coinsCircle.name="coins_circle",this.coinsCircle.centerX=-t;var l=this.game.store.getNumber(s.GameStoreKey.BEST_ITEM)||2;this.bestItemCircle=new s.BestItemCircle(this.game,this,o,a,i,l.toString(),l),this.bestItemCircle.innerCircle.loadTexture("main_menu","Circle_Inner0000"),this.bestItemCircle.item.getAt(0).loadTexture("main_menu","Item_Back0000"),this.bestItemCircle.addIcon("main_menu","Icon_Crown0000"),this.bestItemCircle.scale.set(1.13),this.bestItemCircle.name="best_item_circle";var u=this.getGamesPlayedText();this.gamesPlayedCircle=new s.StatCircle(this.game,this,o,a,i,u),this.gamesPlayedCircle.addIcon("main_menu","Icon_Time0000"),this.gamesPlayedCircle.text.scale.set(.9),this.gamesPlayedCircle.text.y-=5,this.gamesPlayedCircle.scale.set(.9),this.gamesPlayedCircle.centerX=t,this.circles=[this.coinsCircle,this.bestItemCircle,this.gamesPlayedCircle]},e.prototype.getGamesPlayedText=function(){var t=this.game.store.getNumber(s.GameStoreKey.GAMES_PLAYED),i=this.game.texts.texts.games,o=i.replace("#",t+"\n");return o},e.prototype.show=function(t){var i=this;this.visible=!0,this.circles.forEach(function(o,a){var h=t+150+a*120;i.game.add.tween(o).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,h),i.game.add.tween(o).from({y:"+22"},400,Phaser.Easing.Back.Out,!0,h)})},e.prototype.animateCircle=function(t){this.game.add.tween(this).to({y:"+16"},1e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.prototype.updateCoinsCircle=function(){var t=this.game.store.getCoins();this.coinsCircle.updateText(t.toString())},e.prototype.onLanguageChange=function(){this.gamesPlayedCircle.updateText(this.getGamesPlayedText())},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.circles=null},e}(Phaser.Group);s.MainMenuCircles=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"credits")||this;return o.addBack(),o.addTitle(),o.addBackButton(),o.addContent(),o.alignContent(),o.backButton.kill(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"main_menu","Settings_GUI_Back0000",this),this.back.alpha=0},e.prototype.addTitle=function(){var t=this.geTitleContent(),i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:46,fill:"#F29000",align:"center"};this.title=this.game.add.text(0,0,t,i,this),this.title.anchor.set(.5,.5),this.title.centerX=this.back.centerX,this.title.centerY=this.back.top+56},e.prototype.geTitleContent=function(){return this.game.texts.texts.credits},e.prototype.addBackButton=function(){this.backButton=new s.SimpleButton(this.game,0,0,"main_menu","Button_Back0000",this),this.backButton.areTweensEnabled=!1,this.backButton.left=this.back.left,this.backButton.centerY=this.title.centerY+1},e.prototype.addContent=function(){this.content=new s.SimpleButton(this.game,0,0,"main_menu","credits_content0000",this),this.content.input.enabled=!1},e.prototype.alignContent=function(){var t=this.title.bottom,i=this.back.bottom,o=i-t;this.content.centerX=this.back.centerX,this.content.centerY=t+o/2},e.prototype.onRobowhaleClick=function(){window.open(e.ROBOWHALE_URL)},e.prototype.show=function(t){this.visible=!0,this.exists=!0,this.backButton.enabled=!0,this.alpha=0,this.game.tweens.removeFrom(this),this.game.add.tween(this).to({alpha:1},250,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.hide=function(){var t=this;this.backButton.enabled=!1,this.game.tweens.removeFrom(this),this.game.add.tween(this).to({alpha:0},120,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.exists=!1,t.visible=!1})},e.prototype.onLanguageChange=function(){this.title.text=this.geTitleContent()},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e.ROBOWHALE_URL="https://robowhale.com/?utm_source=get13_fbinstant",e}(Phaser.Group);s.CreditsContent=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"settings_popup")||this;return o.addBack(),o.addCloseButton(),o.addCreditsContent(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"main_menu","Settings_GUI_Back0000",this),this.back.inputEnabled=!0,this.back.name="settings_popup"},e.prototype.addCloseButton=function(){var t=-6*s.Config.ASSETS_SCALE;this.closeButton=new s.SimpleButton(this.game,0,0,"main_menu","Button_Close0000",this),this.closeButton.centerX=this.back.right+t,this.closeButton.centerY=this.back.top-t,this.closeButton.name="settings_close_button"},e.prototype.addCreditsContent=function(){this.content=new s.CreditsContent(this.game,this)},e.prototype.show=function(t){this.visible=!0,this.exists=!0,this.game.tweens.removeFrom(this),this.game.add.tween(this).from({alpha:0},150,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this).from({y:"+50"},350,Phaser.Easing.Back.Out,!0,t),this.showCloseButton(t+200)},e.prototype.showCloseButton=function(t){this.closeButton.alpha=0,this.closeButton.scale.set(.77),this.game.tweens.removeFrom(this.closeButton),this.game.tweens.removeFrom(this.closeButton.scale),this.game.add.tween(this.closeButton).to({alpha:1},150,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.closeButton.scale).to({x:1,y:1},350,Phaser.Easing.Back.Out,!0,t)},e.prototype.hide=function(){var t=this;this.game.tweens.removeFrom(this),this.game.add.tween(this).to({alpha:0,y:"+40"},160,Phaser.Easing.Cubic.In,!0).onComplete.addOnce(function(){t.visible=!1,t.exists=!1})},e.prototype.getWidth=function(){return this.back.width},e.prototype.getHeight=function(){return this.back.height},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.CreditsPopup=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"settings_screen")||this;return o.addBackdrop(),o.addPopup(),o}return e.prototype.addBackdrop=function(){this.backdrop=this.game.add.image(0,0,"main_menu","white_rect0000",this),this.backdrop.tint=1713022,this.backdrop.alpha=.66,this.backdrop.inputEnabled=!0,this.backdrop.name="settings_background"},e.prototype.addPopup=function(){this.window=new s.CreditsPopup(this.game,this),this.window.closeButton.callback.add(this.hide,this)},e.prototype.show=function(){this.parent.bringToTop(this),this.backdrop.events.onInputDown.add(this.onBackClick,this),this.visible=!0,this.exists=!0,this.window.closeButton.enabled=!0,this.alpha=1,this.showBackdrop(),this.window.show(100)},e.prototype.onBackClick=function(t,i){if(i.interactiveCandidates.length>1)return;this.hide()},e.prototype.showBackdrop=function(){this.backdrop.alpha=0,this.game.add.tween(this.backdrop).to({alpha:.66},150,Phaser.Easing.Cubic.Out,!0)},e.prototype.hide=function(){var t=this;this.backdrop.events.onInputDown.remove(this.onBackClick,this),this.window.closeButton.enabled=!1,this.game.add.tween(this).to({alpha:0},200,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.exists=!1,t.visible=!1})},e.prototype.resize=function(){this.resizeBackdrop(),this.window.closeButton.visible=!1,this.window.centerX=s.Config.HALF_GAME_WIDTH,this.window.centerY=s.Config.HALF_GAME_HEIGHT,this.window.closeButton.visible=!0},e.prototype.resizeBackdrop=function(){this.backdrop.width=s.Config.GAME_WIDTH*1.2,this.backdrop.height=s.Config.GAME_HEIGHT*1.2,this.backdrop.centerX=s.Config.HALF_GAME_WIDTH,this.backdrop.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.CreditsScreen=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.addBack(),o.addArrows(),o.addLanguageText(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"language_button","button_language_back0000",this),this.back.anchor.set(.5)},e.prototype.addArrows=function(){var t=135,i=-6;this.leftArrow=this.game.add.image(0,0,"language_button","arrow_left0000",this),this.leftArrow.anchor.set(.5,.5),this.leftArrow.x=this.back.centerX-t,this.leftArrow.y=i,this.leftArrow.inputEnabled=!0,this.leftArrow.input.useHandCursor=!0,this.rightArrow=this.game.add.image(0,0,"language_button","arrow_right0000",this),this.rightArrow.anchor.set(.5,.5),this.rightArrow.x=this.back.centerX+t,this.rightArrow.y=i,this.rightArrow.inputEnabled=!0,this.rightArrow.input.useHandCursor=!0},e.prototype.addLanguageText=function(){var t={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:38,fill:"#ffffff",align:"center"};this.text=this.game.add.text(0,0,"Language",t,this),this.text.anchor.set(.5,.5),this.text.resolution=2,this.text.y=this.leftArrow.y+1},e.prototype.updateText=function(t){this.text.setText(t,!0),this.adjustTextSize()},e.prototype.adjustTextSize=function(){var t=this.leftArrow.right,i=this.rightArrow.left,o=i-t,a=o*.9;this.text.scale.set(1);var h=Math.min(1,a/this.text.width);this.text.scale.set(h)},Object.defineProperty(e.prototype,"enabled",{set:function(t){t?(this.leftArrow.input.enabled=!0,this.rightArrow.input.enabled=!0):(this.leftArrow.input.enabled=!1,this.rightArrow.input.enabled=!1)},enumerable:!1,configurable:!0}),e}(Phaser.Group);s.LanguageButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"settings_content")||this;return o.addBack(),o.addTitle(),o.addButtons(),o.buttons=[o.soundButton,o.languageButton],o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"main_menu","Settings_GUI_Back0000",this),this.back.alpha=0},e.prototype.addTitle=function(){var t=this.getTitleContent(),i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:46,fill:"#F29000",align:"center"};this.title=this.game.add.text(0,0,t,i,this),this.title.anchor.set(.5,.5),this.title.centerX=this.back.centerX,this.title.centerY=this.back.top+56},e.prototype.getTitleContent=function(){return this.game.texts.texts.settings},e.prototype.addButtons=function(){this.buttonsContainer=this.game.add.group(this,"buttons"),this.addSoundButton(),this.addLanguageButton(),this.alignButtons()},e.prototype.addSoundButton=function(){this.soundButton=new s.ToggleButton(this.game,0,0,"main_menu","Button_Sound_On0000","Button_Sound_Off0000",this.buttonsContainer),this.soundButton.buttonState=this.game.sound.mute?s.ToggleButtonState.STATE_2:s.ToggleButtonState.STATE_1,this.soundButton.callback.add(this.onSoundButtonClick,this)},e.prototype.onSoundButtonClick=function(){this.game.audio.soundMute=!this.game.audio.soundMute},e.prototype.addLanguageButton=function(){var t=this,i=s.LanguageUtil.getLanguageTitle(this.game.texts.language);this.languageButton=new s.LanguageButton(this.game,this.buttonsContainer),this.languageButton.centerX=this.soundButton.centerX,this.languageButton.top=this.soundButton.bottom+30,this.languageButton.leftArrow.events.onInputDown.add(function(){return t.updateLanguage(-1)}),this.languageButton.rightArrow.events.onInputDown.add(function(){return t.updateLanguage(1)}),this.languageButton.updateText(i)},e.prototype.updateLanguage=function(t){this.game.audio.playSound("tap");var i=this.game.texts,o=i.language,a=i.allLanguages,h=a.indexOf(o),l=Phaser.Math.wrap(h+t,0,a.length),u=a[l];this.game.store.saveValue(s.GameStoreKey.LANGUAGE,u),this.game.texts.setLanguage(u),this.languageButton.updateText(s.LanguageUtil.getLanguageTitle(u))},e.prototype.alignButtons=function(){var t=this.title.bottom,i=this.back.bottom,o=i-t;this.buttonsContainer.centerX=this.back.centerX,this.buttonsContainer.centerY=t+o/2},e.prototype.show=function(t){this.visible=!0,this.exists=!0,this.buttons.forEach(function(i){i.enabled=!0}),this.alpha=0,this.game.add.tween(this).to({alpha:1},250,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.hide=function(){var t=this;this.buttons.forEach(function(i){i.enabled=!1}),this.game.tweens.removeFrom(this),this.game.add.tween(this).to({alpha:0},120,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.exists=!1,t.visible=!1})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.buttons=null},e.prototype.onLanguageChange=function(){this.title.text=this.getTitleContent()},e}(Phaser.Group);s.SettingsContent=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"settings_popup")||this;return o.addBack(),o.addCloseButton(),o.addSettingsContent(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"main_menu","Settings_GUI_Back0000",this),this.back.inputEnabled=!0,this.back.name="settings_popup"},e.prototype.addCloseButton=function(){var t=-6*s.Config.ASSETS_SCALE;this.closeButton=new s.SimpleButton(this.game,0,0,"main_menu","Button_Close0000",this),this.closeButton.centerX=this.back.right+t,this.closeButton.centerY=this.back.top-t,this.closeButton.name="settings_close_button"},e.prototype.addSettingsContent=function(){this.content=new s.SettingsContent(this.game,this)},e.prototype.show=function(t){this.visible=!0,this.exists=!0,this.game.tweens.removeFrom(this),this.game.add.tween(this).from({alpha:0},150,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this).from({y:"+50"},350,Phaser.Easing.Back.Out,!0,t),this.showCloseButton(t+200)},e.prototype.showCloseButton=function(t){this.closeButton.alpha=0,this.closeButton.scale.set(.77),this.game.tweens.removeFrom(this.closeButton),this.game.tweens.removeFrom(this.closeButton.scale),this.game.add.tween(this.closeButton).to({alpha:1},150,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.closeButton.scale).to({x:1,y:1},350,Phaser.Easing.Back.Out,!0,t)},e.prototype.hide=function(){var t=this;this.game.tweens.removeFrom(this),this.game.add.tween(this).to({alpha:0,y:"+40"},160,Phaser.Easing.Cubic.In,!0).onComplete.addOnce(function(){t.visible=!1,t.exists=!1})},e.prototype.getWidth=function(){return this.back.width},e.prototype.getHeight=function(){return this.back.height},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.SettingsPopup=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"settings_screen")||this;return o.addBackdrop(),o.addWindow(),o.addBuildInfo(),o}return e.prototype.addBackdrop=function(){this.backdrop=this.game.add.image(0,0,"main_menu","white_rect0000",this),this.backdrop.tint=1713022,this.backdrop.alpha=.66,this.backdrop.inputEnabled=!0,this.backdrop.name="settings_background"},e.prototype.addWindow=function(){this.window=new s.SettingsPopup(this.game,this),this.window.closeButton.callback.add(this.hide,this)},e.prototype.addBuildInfo=function(){var t=window.game.config.build_version,i=window.game.config.build_time,o="Build #"+t+"\n"+i,a={font:s.GameFonts.NUNITO_CSS,fontWeight:s.FontWeight.NORMAL,fontSize:30,fill:"#ffffff",align:"center"};this.buildInfo=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_REGULAR_BMP,o,30,this),this.buildInfo.align="center",this.buildInfo.anchor.set(.5,1),this.buildInfo.alpha=.7},e.prototype.show=function(){this.parent.bringToTop(this),this.backdrop.events.onInputDown.add(this.onBackClick,this),this.visible=!0,this.exists=!0,this.window.closeButton.enabled=!0,this.alpha=1,this.showBackdrop(),this.window.show(100)},e.prototype.onBackClick=function(t,i){if(i.interactiveCandidates.length>1)return;this.hide()},e.prototype.showBackdrop=function(){this.backdrop.alpha=0,this.game.add.tween(this.backdrop).to({alpha:.66},150,Phaser.Easing.Cubic.Out,!0)},e.prototype.hide=function(){var t=this;this.backdrop.events.onInputDown.remove(this.onBackClick,this),this.window.closeButton.enabled=!1,this.game.add.tween(this).to({alpha:0},200,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.exists=!1,t.visible=!1})},e.prototype.resize=function(){this.resizeBackdrop(),this.window.closeButton.visible=!1,this.window.centerX=s.Config.HALF_GAME_WIDTH,this.window.centerY=s.Config.HALF_GAME_HEIGHT,this.window.closeButton.visible=!0,this.buildInfo.x=s.Config.HALF_GAME_WIDTH,this.buildInfo.bottom=s.Config.GAME_HEIGHT-20},e.prototype.resizeBackdrop=function(){this.backdrop.width=s.Config.GAME_WIDTH*1.2,this.backdrop.height=s.Config.GAME_HEIGHT*1.2,this.backdrop.centerX=s.Config.HALF_GAME_WIDTH,this.backdrop.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.SettingsScreen=r})(game||(game={}));var game;(function(s){var r;(function(n){var e=function(t){__extends(i,t);function i(o,a){var h=t.call(this,o,a,"avatar")||this;return h.addAvatar(),h.addMask(),h}return i.prototype.addAvatar=function(){this.avatar=this.game.add.image(0,0,"leaderboard","avatar_mask0000",this),this.avatar.anchor.set(.5,.5),this.avatar.data.maxHeight=this.avatar.height},i.prototype.addMask=function(){this.alphaMask=this.game.make.image(0,0,"leaderboard","avatar_mask0000"),this.alphaMask.anchor.set(.5,.5)},i.prototype.updateImage=function(o){this.alpha=1,this.avatar.loadTexture(o),this.avatar.scale.set(this.avatar.data.maxHeight/this.avatar.height);var a=this.game.make.bitmapData(this.avatar.width,this.avatar.height);a.draw(this.avatar,this.avatar.width/2,this.avatar.height/2),a.blendDestinationAtop(),a.draw(this.alphaMask,this.avatar.width/2,this.avatar.height/2),this.avatar.loadTexture(a),this.avatar.scale.set(1)},i.prototype.clearImage=function(){this.avatar.loadTexture("leaderboard","avatar_mask0000"),this.alpha=.66},i.prototype.destroy=function(){t.prototype.destroy.call(this,!0,!1)},i}(Phaser.Group);n.Avatar=e})(r=s.leaderboard||(s.leaderboard={}))})(game||(game={}));var game;(function(s){var r=s.leaderboard.Avatar,n=function(e){__extends(t,e);function t(i,o){var a=e.call(this,i,o,"leaderboard_entry")||this;return a.avatarSideMargin=20,a._selected=!1,a._dark=!1,a._empty=!0,a.textSize=30,a.textColor=15896576,a.textFont=s.GameFonts.BARIOL_REGULAR_BMP,a.addBack(),a.addRank(),a.addAvatar(),a.addPlayerName(),a.addPoints(),a.addBorder(),a.bringToTop(a.avatar),a.resize(a.back.width,a.back.height),a}return Object.defineProperty(t.prototype,"empty",{get:function(){return this._empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dark",{set:function(i){this._dark=i,this._dark?(this.back.tint=15896576,this.back.alpha=.1):this.back.alpha=0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selected",{get:function(){return this._selected},set:function(i){this._selected=i,this.border.visible=this._selected},enumerable:!1,configurable:!0}),t.prototype.addBack=function(){this.back=this.game.add.image(0,0,"leaderboard","Leaderboard_Entry_Back0000",this)},t.prototype.addRank=function(){this.rank=this.game.add.bitmapText(0,0,this.textFont,"1",this.textSize,this),this.rank.anchor.set(.5,.5),this.rank.tint=this.textColor},t.prototype.addAvatar=function(){this.avatar=new r(this.game,this),this.avatar.alpha=.66},t.prototype.addPlayerName=function(){var i="Vladislav",o="#"+this.textColor.toString(16),a={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.NORMAL,fontSize:this.textSize,fill:o,align:"left"};this.playerName=this.game.add.text(0,0,i,a,this),this.playerName.anchor.set(0,.5)},t.prototype.addPoints=function(){this.points=this.game.add.bitmapText(0,0,this.textFont,"0000",this.textSize,this),this.points.align="right",this.points.anchor.set(1,.5),this.points.tint=this.textColor},t.prototype.addBorder=function(){this.border=this.game.add.image(0,0,"leaderboard","LeaderboardEntry_Border0000",this),this.border.anchor.set(.5,.5),this.border.tint=15896576,this.border.visible=!1},t.prototype.resize=function(i,o){this.back.width=i,this.back.height=o,this.alignAvatar(),this.alignRank(),this.playerName.left=this.back.left+110,this.playerName.centerY=this.back.centerY,this.points.right=this.back.right-20,this.points.centerY=this.back.centerY,this.border.width=this.back.width,this.border.height=this.back.height,this.border.centerX=this.back.centerX,this.border.centerY=this.back.centerY},t.prototype.alignRank=function(){var i=this.back.left,o=this.avatar.left,a=o-i;this.rank.centerX=i+a/2,this.rank.centerY=this.back.centerY},t.prototype.alignAvatar=function(){var i=this.back.height*.8;this.avatar.scale.set(1),this.avatar.scale.set(i/this.avatar.height),this.avatar.centerX=this.back.left+140,this.avatar.centerY=this.back.centerY},t.prototype.setEmpty=function(){[this.rank,this.avatar,this.playerName,this.points].forEach(function(i){i.visible=!1}),this.avatar.clearImage(),this.data=null,this._empty=!0},t.prototype.setData=function(i){this.data=i,[this.rank,this.avatar,this.playerName,this.points].forEach(function(o){o.visible=!0}),this.avatar.kill(),this.updateRank(this.data.Position),this.updateName(this.data.DisplayName),this.updatePoints(this.data.StatValue),this._empty=!1},t.prototype.updateRank=function(i){this.rank.setText(this.formatNumber(i+1)),this.rank.scale.set(1);var o=80;this.rank.width>o&&(this.rank.scale.set(o/this.rank.width),this.alignRank())},t.prototype.updateName=function(i){var o=_.truncate(i,{length:20,omission:"..."}),a=_.deburr(o);this.playerName.setText(a)},t.prototype.updatePoints=function(i){this.points.setText(this.formatNumber(i))},t.prototype.formatNumber=function(i){return i.toLocaleString().split(",").join(" ")},t.prototype.updateAvatar=function(){var i="avatar_"+this.getPlayerID();this.game.cache.checkImageKey(i)?(this.avatar.updateImage(i),this.alignAvatar()):this.avatar.clearImage()},t.prototype.getPlayerID=function(){return this.data?this.data.PlayFabId:""},t.prototype.destroy=function(){e.prototype.destroy.call(this,!0,!1)},t}(Phaser.Group);s.LeaderboardRow=n})(game||(game={}));var game;(function(s){var r=function(){function n(e){this.destroyed=!1,this.game=e,this.onLoadComplete=new Phaser.Signal}return n.prototype.load=function(e){var t=this;this.avatarsTotal=e.length,this.avatarsLoaded=0,this.avatarsData=e,e.forEach(function(i){if(t.game.cache.checkImageKey(i.key))i.loaded=!0,t.avatarsLoaded++,t.checkIfComplete();else{var o=new Image;o.crossOrigin="anonymous",o.onerror=t.onAvatarImageLoadError.bind(t,i),o.onload=t.onAvatarImageLoaded.bind(t,o,i),o.alt=i.key,o.src=i.url}})},n.prototype.onAvatarImageLoadError=function(e,t){e.loaded=!1,e.error=t.type,this.avatarsLoaded++,this.checkIfComplete()},n.prototype.onAvatarImageLoaded=function(e,t){this.game.cache.addImage(e.alt,e.src,e),t.loaded=!0,this.avatarsLoaded++,this.checkIfComplete()},n.prototype.checkIfComplete=function(){if(this.destroyed)return;this.avatarsLoaded>=this.avatarsTotal&&(this.onLoadComplete.dispatch(this.avatarsData),this.autoDestroy&&this.destroy())},n.prototype.destroy=function(){this.destroyed===!1&&(this.destroyed=!0,this.onLoadComplete.dispose(),this.onLoadComplete=null)},n}();s.AvatarsLoader=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i,"leaderboard")||this;return a.addTitle(),a.addSubtitle(),a.addSeparator(),a.addRows(o),a.resetRows(),a}return e.prototype.addTitle=function(){var t="Title",i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:36,fill:"#F29000"};this.title=this.game.add.text(0,0,"Title",i,this)},e.prototype.addSubtitle=function(){this.subtitle=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_REGULAR_BMP,"Subtitle",26,this),this.subtitle.tint=15896576},e.prototype.updateSubtitle=function(t){this.subtitle.setText(t),this.subtitle.right=this.separator.right-5},e.prototype.addSeparator=function(){this.separator=this.game.add.image(0,0,"leaderboard","leaderboard_separator0000",this)},e.prototype.addRows=function(t){this.rows=this.createRows(t),this.rowsGroup=this.game.add.group(this,"rows"),this.rowsGroup.addMultiple(this.rows,!0)},e.prototype.createRows=function(t){var i=this;return _.times(t,function(o){var a=new s.LeaderboardRow(i.game,i);return a.dark=o%2===0,a})},e.prototype.resize=function(t,i){this.title.left=5,this.title.top=0,this.subtitle.right=t-5,this.subtitle.bottom=this.title.bottom,this.separator.width=t,this.separator.centerX=t/2,this.separator.centerY=this.title.bottom+14,this.alignRows(t)},e.prototype.alignRows=function(t){this.rows.forEach(function(i,o){i.resize(t,e.ENTRY_HEIGHT*.9),i.centerX=t/2,i.top=o*e.ENTRY_HEIGHT}),this.rowsGroup.centerX=this.separator.centerX,this.rowsGroup.top=this.separator.centerY+20},e.prototype.setData=function(t){var i=this.rows[0].width;this.rowsGroup.destroy(!0,!1),this.rows=null,this.addRows(t.length),this.alignRows(i),this.updateRowsData(t)},e.prototype.resetRows=function(){this.rows.forEach(function(t,i){t.setEmpty(),t.selected=!1})},e.prototype.updateRowsData=function(t){this.rows.forEach(function(i,o){var a=t[o];a&&i.setData(t[o])})},e.prototype.updateAvatars=function(){this.rows.forEach(function(t){t.updateAvatar()})},e.prototype.setSelected=function(t){this.rows.forEach(function(i){i.getPlayerID()===t&&(i.selected=!0)})},e.prototype.reset=function(){var t=this.game.texts.texts.leaderboard.all_players;this.updateSubtitle(t),this.resetRows()},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e.ENTRY_HEIGHT=90,e}(Phaser.Group);s.Leaderboard=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,0,0,i,o)||this;return a.anchor.set(.5,.5),a.visible=!1,a}return e.prototype.show=function(t){var i=this;t===void 0&&(t=0),this.doReset(),this.game.add.tween(this).from({alpha:0},150,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.scale).from({x:.8,y:.8},400,Phaser.Easing.Back.Out,!0,t).onComplete.addOnce(function(){i.startAnimation()})},e.prototype.doReset=function(){this.stopAnimation(),this.visible=!0,this.scale.set(1),this.angle=0},e.prototype.startAnimation=function(){var t=this.game.add.tween(this.scale).to({x:.9,y:.9},400,Phaser.Easing.Sinusoidal.InOut,!1,0,-1,!0);t.repeatDelay(300),t.start();var i=this.game.add.tween(this).to({angle:360},800,Phaser.Easing.Sinusoidal.InOut,!1,0,-1);i.repeatDelay(300),i.start()},e.prototype.stopAnimation=function(){this.game.tweens.removeFrom(this),this.game.tweens.removeFrom(this.scale)},e.prototype.hide=function(){var t=this;this.stopAnimation(),this.game.add.tween(this.scale).to({x:1.1,y:1.1},400,Phaser.Easing.Back.In,!0),this.game.add.tween(this).to({alpha:0},200,Phaser.Easing.Cubic.Out,!0,200).onComplete.addOnce(function(){t.visible=!1})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0)},e}(Phaser.Image);s.LoadingSpinner=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"loading_overlay")||this;return o.addBack(),o.addSpinner(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"leaderboard","white_rect0000",this),this.back.tint=16774112},e.prototype.addSpinner=function(){this.spinner=new s.LoadingSpinner(this.game,"leaderboard","Loading_Icon0000"),this.spinner.tint=15437824,this.add(this.spinner)},e.prototype.resize=function(t,i){this.back.width=t,this.back.height=i,this.spinner.centerX=this.back.centerX,this.spinner.centerY=this.back.centerY},e.prototype.show=function(){this.game.tweens.removeFrom(this),this.visible=!0,this.alpha=1,this.spinner.show(230)},e.prototype.hide=function(){var t=this;this.game.add.tween(this).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.visible=!1})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.LoadingOverlay=r})(game||(game={}));var game;(function(s){var r=function(){function n(e,t){this.inputDown=!1,this.enabled=!1,this.maxOverscrollDistance=300,this.game=e,this.leaderboardScreen=t,this.leaderboardScreen.back.events.onInputDown.add(this.onInputDown,this),this.leaderboardScreen.back.events.onInputUp.add(this.onInputUp,this),this.scrollbar=this.leaderboardScreen.scrollbar,this.updateOverscrollDistance(),this.game.input.mouse.mouseWheelCallback=this.onMouseWheel.bind(this)}return n.prototype.onInputDown=function(){if(this.enabled===!1)return;this.inputDown=!0,this.lastPointerPosition=this.game.input.activePointer.position.clone(),this.showScrollbar()},n.prototype.showScrollbar=function(){this.game.tweens.removeFrom(this.leaderboardScreen.scrollbar),this.game.add.tween(this.leaderboardScreen.scrollbar).to({alpha:.66},200,Phaser.Easing.Cubic.Out,!0),this.game.time.events.removeBy(this.hideScrollbar,this),this.game.time.events.add(1e3,this.hideScrollbar,this)},n.prototype.hideScrollbar=function(){if(this.inputDown)return;this.game.tweens.removeFrom(this.leaderboardScreen.scrollbar),this.game.add.tween(this.leaderboardScreen.scrollbar).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0,500)},n.prototype.onInputUp=function(){if(this.enabled===!1)return;this.inputDown=!1,this.alignAfterScroll(),this.hideScrollbar()},n.prototype.alignAfterScroll=function(){var e=this.leaderboardScreen.leaderboards.y,t=this.getTopLimit(),i=this.getBottomLimit();e>i?this.alignWithTween(i):e<t&&this.alignWithTween(t)},n.prototype.getTopLimit=function(){return this.leaderboardScreen.leaderboardsBounds.y+this.leaderboardScreen.leaderboardsBounds.height-this.leaderboardScreen.leaderboards.height-10},n.prototype.getBottomLimit=function(){return this.leaderboardScreen.leaderboardsBounds.y},n.prototype.alignWithTween=function(e){var t=this;this.game.tweens.removeFrom(this.leaderboardScreen.leaderboards),this.game.add.tween(this.leaderboardScreen.leaderboards).to({y:e},400,Phaser.Easing.Cubic.Out,!0).onUpdateCallback(function(){t.updateScrollbarSize(),t.updateScrollbarPosition()})},n.prototype.onMouseWheel=function(e){if(this.enabled===!1)return;var t=this.leaderboardScreen.leaderboards,i=s.Leaderboard.ENTRY_HEIGHT/2*Phaser.Math.sign(e.deltaY);t.y=Phaser.Math.clamp(t.y-i,this.getTopLimit(),this.getBottomLimit()),this.updateScrollbarPosition(),this.showScrollbar()},n.prototype.update=function(){this.enabled&&this.inputDown&&(this.updateScroll(),this.updateScrollbarSize(),this.updateScrollbarPosition())},n.prototype.updateScroll=function(){var e=this.game.input.activePointer.position,t=e.y-this.lastPointerPosition.y;this.scrollBy(t),e.clone(this.lastPointerPosition)},n.prototype.scrollBy=function(e){var t=this.leaderboardScreen.leaderboards,i=t.y+e,o=this.getTopLimit()-i,a=i-this.getBottomLimit(),h=1.5,l=h;if(o>0||a>0){var u=Math.max(o,a);l=Phaser.Math.mapLinear(u,0,this.maxOverscrollDistance,h,0)}t.y+=e*l},n.prototype.updateScrollbarPosition=function(){var e=this.leaderboardScreen.leaderboardsBounds,t=this.leaderboardScreen.leaderboards,i=e.y-t.y,o=Math.max(0,i),a=t.height-e.height,h=Phaser.Math.clamp(o/a,0,1),l=this.leaderboardScreen.scrollbar.height/2+5,u=e.top+l,c=e.top+e.height-l;this.leaderboardScreen.scrollbar.centerY=u+(c-u)*h},n.prototype.updateScrollbarSize=function(){var e=this.leaderboardScreen.leaderboards.y,t=this.getTopLimit()-e,i=e-this.getBottomLimit(),o=1,a=1;if(t>0||i>0){var h=Math.max(t,i);a=Phaser.Math.mapLinear(h,0,this.maxOverscrollDistance,o,.5)}this.scrollbar.height=this.scrollbar.originalHeight*a},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.resize=function(){this.updateOverscrollDistance()},n.prototype.updateOverscrollDistance=function(){this.maxOverscrollDistance=this.leaderboardScreen.leaderboardsBounds.height*.33},n.prototype.destroy=function(){this.game.input.mouse.mouseWheelCallback=null},n}();s.LeaderboardScrollHandler=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"exit_confirm_screen")||this;return o.onNameEnter=new Phaser.Signal,o.addBackdrop(),o.addBack(),o.addTitle(),o.addSubtitle(),o.addButtons(),o.alignSubtitle(),o}return e.prototype.addBackdrop=function(){this.backdrop=this.game.add.image(0,0,"interface","white_rect0000",this),this.backdrop.tint=1713022,this.backdrop.alpha=.5,this.backdrop.inputEnabled=!0},e.prototype.addBack=function(){this.window=this.game.add.group(this,"popup"),this.windowBack=this.game.add.image(0,0,"interface","Modal_Back0000",this.window),this.windowBack.anchor.set(.5,.5)},e.prototype.addTitle=function(){var t=this.game.texts.texts.quit_popup_title,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:44,fill:"#FF9933"};this.title=this.game.add.text(0,0,t,i,this.window),this.title.anchor.set(.5,.5),this.title.centerX=this.windowBack.centerX,this.title.top=this.windowBack.top+25,this.title.kill()},e.prototype.addSubtitle=function(){var t=this.game.texts.texts.leaderboard.login,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.NORMAL,fontSize:32,fill:"#FF9933"};this.subtitle=this.game.add.text(0,0,t,i,this.window),this.subtitle.anchor.set(.5,.5),this.subtitle.wordWrap=!0,this.subtitle.wordWrapWidth=this.windowBack.width*.8,this.subtitle.lineSpacing=-6,this.subtitle.align="center"},e.prototype.alignSubtitle=function(){var t=this.windowBack.top,i=this.yesButton.top,o=i-t;this.subtitle.centerX=this.windowBack.centerX,this.subtitle.y=t+o/2+4},e.prototype.addButtons=function(){var t=90*s.Config.ASSETS_SCALE,i=160*s.Config.ASSETS_SCALE;this.noButton=new s.SimpleButton(this.game,0,0,"interface","Button_No0000",this.window),this.noButton.x=this.windowBack.centerX-t,this.noButton.top=this.windowBack.top+i,this.noButton.callback.add(this.onNoButtonClick,this),this.yesButton=new s.SimpleButton(this.game,0,0,"interface","Button_Yes0000",this.window),this.yesButton.x=this.windowBack.centerX+t,this.yesButton.top=this.windowBack.top+i,this.yesButton.callback.add(this.onYesButtonClick,this),this.buttons=[this.noButton,this.yesButton],this.alignButtons()},e.prototype.alignButtons=function(){var t=this.windowBack.bottom-114,i=this.windowBack.bottom,o=i-t;this.buttons.forEach(function(a,h){a.y=t+o/2})},e.prototype.onNoButtonClick=function(){this.hide()},e.prototype.onYesButtonClick=function(){this.promptName()},e.prototype.promptName=function(){var t=this.game.texts.texts.leaderboard.name_prompt,i=window.prompt(t);if(i===null)return;var o=_.trim(i);o.length<=2?this.promptName():this.onNameEnter.dispatch(o)},e.prototype.enableButtons=function(){this.buttons.forEach(function(t){t.enabled=!0})},e.prototype.disableButtons=function(){this.buttons.forEach(function(t){t.enabled=!1})},e.prototype.updateContent=function(t,i){this.title.text=t,this.subtitle.text=i},e.prototype.show=function(){this.revive(),this.enableButtons(),this.alpha=1,this.game.add.tween(this.backdrop).from({alpha:0},150,Phaser.Easing.Cubic.Out,!0);var t=0;this.game.add.tween(this.window).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.window.scale).from({x:.8,y:.8},400,Phaser.Easing.Back.Out,!0,t)},e.prototype.hide=function(){var t=this;this.game.add.tween(this).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.kill()})},e.prototype.resize=function(){this.resizeBackdrop(),this.alignWindow()},e.prototype.resizeBackdrop=function(){this.backdrop.width=s.Config.GAME_WIDTH*1.2,this.backdrop.height=s.Config.GAME_HEIGHT*1.2,this.backdrop.centerX=s.Config.HALF_GAME_WIDTH,this.backdrop.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.alignWindow=function(){this.window.centerX=s.Config.HALF_GAME_WIDTH,this.window.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.LoginPopup=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.useRealData=!0,t.isShutdown=!1,t}return e.prototype.init=function(t){this.initData=t,this.isShutdown=!1},e.prototype.create=function(){this.onShow=new Phaser.Signal,this.onHide=new Phaser.Signal,this.addBackground(),this.addTopPanel(),this.addLeaderboards(),this.addLeaderboardBounds(),this.addErrorMessage(),this.addScrollbar(),this.addLoadingOverlay(),this.addLoginPopup(),this.world.bringToTop(this.topPanel),this.world.bringToTop(this.loginPopup),this.addKeyboardCallbacks(),this.addKineticScroll(),this.resize(),this.loadingOverlay.show(),this.loadData()},e.prototype.gotoLastState=function(){this.initData?this.game.changeState(this.initData.lastState,this.initData.lastStateData):this.game.changeState(s.StateKey.MAIN_MENU,!0)},e.prototype.addBackground=function(){this.back=this.game.add.image(0,0,"leaderboard","white_rect0000"),this.back.tint=16774112,this.back.anchor.set(.5,.5),this.back.fixedToCamera=!0},e.prototype.addTopPanel=function(){this.topPanel=this.game.add.group(this.world,"top_panel"),this.topPanel.fixedToCamera=!0,this.topPanelBack=this.game.add.image(0,0,"leaderboard","Leaderboard_TopPanel_Back0000",this.topPanel),this.addTitle(),this.backButton=new s.SimpleButton(this.game,0,0,"leaderboard","Button_Back0000",this.topPanel),this.backButton.callback.add(this.onBackButtonClick,this)},e.prototype.addTitle=function(){var t=this.game.texts.texts.leaderboard.title,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:50,fill:"#EB9000"};this.title=this.game.add.text(0,0,t,i,this.topPanel)},e.prototype.adjustTitleSize=function(){var t=this.topPanel.width*.7;this.title.scale.set(1),this.title.scale.set(Math.min(1,t/this.title.width))},e.prototype.onBackButtonClick=function(){this.gotoLastState()},e.prototype.addLeaderboards=function(){this.leaderboards=this.game.add.group(this.world,"leaderboards"),this.leaderboards.kill(),this.addAroundLeaderboard(),this.addTopLeaderboard()},e.prototype.addAroundLeaderboard=function(){var t=this.game.texts.texts.leaderboard.friends,i=11;this.aroundLeaderboard=new s.Leaderboard(this.game,this.leaderboards,i),this.aroundLeaderboard.title.setText(t),this.aroundLeaderboard.subtitle.visible=!1},e.prototype.addTopLeaderboard=function(){var t=this.game.texts.texts.leaderboard.top.replace("#",e.TOP_ENTRIES_NUM.toString()),i=this.game.texts.texts.leaderboard.all_players;this.topLeaderboard=new s.Leaderboard(this.game,this.leaderboards,e.TOP_ENTRIES_NUM),this.topLeaderboard.title.setText(t),this.topLeaderboard.subtitle.visible=!1},e.prototype.addScrollbar=function(){this.scrollbar=this.game.add.image(0,0,"leaderboard","scrollbar0000"),this.scrollbar.anchor.set(1,.5),this.scrollbar.height*=1.33,this.scrollbar.originalHeight=this.scrollbar.height,this.scrollbar.tint=15437824,this.scrollbar.fixedToCamera=!0,this.scrollbar.kill()},e.prototype.addLeaderboardBounds=function(){this.leaderboardsBounds=new Phaser.Rectangle(0,0,s.Config.GAME_WIDTH,400)},e.prototype.addErrorMessage=function(){var t=this.game.texts.texts.leaderboard.error,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.NORMAL,fontSize:44,fill:"#EB9000",align:"center"};this.errorMessage=this.game.add.text(0,0,t,i),this.errorMessage.align="center",this.errorMessage.anchor.set(.5),this.errorMessage.wordWrap=!0,this.errorMessage.wordWrapWidth=s.Config.GAME_WIDTH*.8,this.errorMessage.x=s.Config.HALF_GAME_WIDTH,this.errorMessage.y=s.Config.HALF_GAME_HEIGHT,this.errorMessage.kill(),this.errorMessage.fixedToCamera=!0},e.prototype.addLoadingOverlay=function(){this.loadingOverlay=new s.LoadingOverlay(this.game,this.world)},e.prototype.addLoginPopup=function(){this.loginPopup=new s.LoginPopup(this.game,this.world),this.loginPopup.kill()},e.prototype.addKeyboardCallbacks=function(){this.game.input.keyboard.addKey(Phaser.Keyboard.ESC).onDown.add(this.gotoLastState,this),s.Main.development&&this.game.input.keyboard.addKey(Phaser.Keyboard.R).onDown.add(this.restart,this)},e.prototype.restart=function(){this.game.changeState(this.key,this.initData)},e.prototype.addKineticScroll=function(){this.game.kineticScrolling.configure({kineticMovement:!0,timeConstantScroll:325,horizontalScroll:!1,verticalScroll:!0,horizontalWheel:!1,verticalWheel:!0,deltaWheel:20})},e.prototype.resize=function(){this.resizeBackground(),this.adjustTitleSize(),this.alignTopPanel(),this.resizeLeaderboardsBounds(),this.alignLeaderboards(),this.alignScrollbar(),this.resizeLoadingOverlay(),this.updateWorldBounds(),this.loginPopup.resize()},e.prototype.updateWorldBounds=function(){this.game.world.setBounds(0,0,s.Config.GAME_WIDTH,this.leaderboards.height+134)},e.prototype.resizeBackground=function(){this.back.width=s.Config.GAME_WIDTH*1.1,this.back.height=s.Config.GAME_HEIGHT*1.1,this.back.cameraOffset.x=s.Config.HALF_GAME_WIDTH,this.back.cameraOffset.y=s.Config.HALF_GAME_HEIGHT},e.prototype.alignTopPanel=function(){this.topPanelBack.width=s.Config.GAME_WIDTH+2,this.topPanelBack.height=120,this.backButton.left=this.topPanelBack.centerX-s.Config.HALF_GAME_WIDTH+25,this.backButton.centerY=this.topPanelBack.centerY+2;var t=this.backButton.right,i=this.topPanelBack.right,o=i-t;this.title.centerX=t+o/2,this.title.centerY=this.backButton.centerY-4,this.topPanel.top=0},e.prototype.resizeLeaderboardsBounds=function(){var t=35,i=s.Config.GAME_WIDTH-t*2,o=this.topPanel.bottom,a=s.Config.GAME_HEIGHT,h=a-o;this.leaderboardsBounds.width=i,this.leaderboardsBounds.height=h,this.leaderboardsBounds.centerX=s.Config.HALF_GAME_WIDTH,this.leaderboardsBounds.y=o},e.prototype.alignLeaderboards=function(){var t=this.leaderboardsBounds.width,i=this.leaderboardsBounds.height;this.aroundLeaderboard.resize(t,i),this.aroundLeaderboard.top=0,this.topLeaderboard.resize(t,i),this.topLeaderboard.top=this.aroundLeaderboard.bottom+50,this.leaderboards.top=this.leaderboardsBounds.top,this.leaderboards.centerX=this.leaderboardsBounds.centerX},e.prototype.alignScrollbar=function(){this.scrollbar.x=s.Config.GAME_WIDTH-10},e.prototype.resizeLoadingOverlay=function(){this.loadingOverlay.resize(s.Config.GAME_WIDTH,this.leaderboardsBounds.height),this.loadingOverlay.top=this.leaderboardsBounds.top,this.loadingOverlay.centerX=s.Config.HALF_GAME_WIDTH},e.prototype.disableButtons=function(){this.backButton.enabled=!1},e.prototype.enableButtons=function(){this.backButton.enabled=!0},e.prototype.update=function(){this.updateScrollBar()},e.prototype.updateScrollBar=function(){var t=this.scrollbar.height/2,i=this.topPanel.height+t,o=s.Config.GAME_HEIGHT-t-14,a=o-i,h=0,l=this.game.world.bounds.height-this.game.camera.height,u=l-h,c=this.game.camera.y/u;this.scrollbar.cameraOffset.x=s.Config.GAME_WIDTH-10,this.scrollbar.cameraOffset.y=i+a*c},e.prototype.loadLeaderboardData=function(){var t=this;Promise.all([this.game.playfab.getPlayerLeaderboardEntry(),this.game.playfab.getAroundPlayerLeaderboard(7),this.game.playfab.getTopLeaderboard(e.TOP_ENTRIES_NUM)]).then(function(i){var o=i[0],a=i[1],h=i[2];t.onDataLoaded(o,a,h)}).catch(function(){t.showErrorMessage()})},e.prototype.onDataLoaded=function(t,i,o){if(this.isShutdown)return;this.leaderboards.visible=!0,this.updateAroundPlayerLeaderboard(i,t),this.updateTopLeaderboard(o,t),this.leaderboards.cacheAsBitmap=!0,this.loadingOverlay.hide(),this.scrollbar.revive(),this.game.kineticScrolling.start(),this.updateWorldBounds()},e.prototype.updateAroundPlayerLeaderboard=function(t,i){this.aroundLeaderboard.setData(t),this.aroundLeaderboard.visible=!0,i&&this.aroundLeaderboard.setSelected(i.PlayFabId)},e.prototype.updateTopLeaderboard=function(t,i){this.topLeaderboard.setData(t),this.topLeaderboard.top=this.aroundLeaderboard.visible?this.aroundLeaderboard.bottom+50:0,i&&this.topLeaderboard.setSelected(i.PlayFabId)},e.prototype.formatNumber=function(t){return t.toLocaleString().split(",").join(" ")},e.prototype.loadAvatars=function(t){var i=t.map(function(a){return{key:"avatar_"+a.PlayFabId,url:a.Profile.AvatarUrl,extraData:a.PlayFabId,loaded:!1}}),o=new s.AvatarsLoader(this.game);o.autoDestroy=!0,o.onLoadComplete.addOnce(this.onAvatarsLoaded,this),o.load(i)},e.prototype.onAvatarsLoaded=function(t){if(this.isShutdown)return;[this.aroundLeaderboard,this.topLeaderboard].forEach(function(i){i.updateAvatars()}),this.updateLeaderboardsCachedImage()},e.prototype.updateLeaderboardsCachedImage=function(){if(this.game.renderer.type===Phaser.CANVAS)return;this.leaderboards._generateCachedSprite()},e.prototype.loadData=function(){var t=this,i=this.game.playfab.isLoggedIn;i?this.onLoginComplete():this.game.playfab.login(this.game.store.getPlayerId()).then(this.onLoginComplete.bind(this)).catch(function(){t.loadingOverlay.hide(),t.showErrorMessage()})},e.prototype.onLoginComplete=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return t=this.game.store.getValue(s.GameStoreKey.PLAYER_NAME),t===""?(this.loginPopup.noButton.callback.addOnce(this.hide,this),this.loginPopup.onNameEnter.addOnce(this.onNameEnter,this),this.loginPopup.show(),[3,3]):[3,1];case 1:return[4,this.onNameReady(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},e.prototype.onNameEnter=function(t){return __awaiter(this,void 0,void 0,function(){var i,o;return __generator(this,function(a){switch(a.label){case 0:i=t.slice(0,25),this.loginPopup.hide(),this.game.store.saveValue(s.GameStoreKey.PLAYER_NAME,i),a.label=1;case 1:return a.trys.push([1,4,,5]),[4,this.game.playfab.updatePlayerName(i)];case 2:return a.sent(),[4,this.onNameReady(i)];case 3:return a.sent(),[3,5];case 4:return o=a.sent(),this.loadingOverlay.hide(),this.showErrorMessage(),[3,5];case 5:return[2]}})})},e.prototype.onNameReady=function(t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,this.game.playfab.updatePlayerScore(this.game.store.getNumber(s.GameStoreKey.BEST_ITEM))];case 1:return o.sent(),[4,this.loadLeaderboardData()];case 2:return o.sent(),[3,4];case 3:return i=o.sent(),this.loadingOverlay.hide(),this.showErrorMessage(),[3,4];case 4:return[2]}})})},e.prototype.reset=function(){this.enableButtons(),this.aroundLeaderboard.reset(),this.topLeaderboard.reset(),this.leaderboards.visible=!1},e.prototype.hide=function(){var t=this;this.game.add.tween(this).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.gotoLastState(),t.onHide.dispatch(!0)})},e.prototype.showErrorMessage=function(){this.errorMessage.alpha=0,this.errorMessage.revive(),this.game.add.tween(this.errorMessage).to({alpha:1},150,Phaser.Easing.Cubic.Out,!0)},e.prototype.shutdown=function(){this.isShutdown=!0,this.onShow.dispose(),this.onHide.dispose(),this.game.kineticScrolling.stop()},e.TOP_ENTRIES_NUM=30,e}(Phaser.State);s.LeaderboardScreen=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.init=function(t){t===void 0&&(t=!1),this.skipStartAnimation=t},e.prototype.create=function(){this.addBackground(),this.addTitle(),this.addButtons(),this.addCircles(),this.addSettingsScreen(),this.addCreditsScreen(),this.addKeyboardCallbacks(),this.resize(),this.skipStartAnimation===!1&&this.show(),this.game.texts.onLanguageChange.add(this.onLanguageChange,this)},e.prototype.onLanguageChange=function(){this.settingsScreen.window.content.onLanguageChange(),this.creditsScreen.window.content.onLanguageChange(),this.circles.onLanguageChange()},e.prototype.addBackground=function(){this.background=new s.GameBackground(this.game,"main_menu","white_rect_large0000")},e.prototype.addTitle=function(){this.gameLogo=new s.GameLogo(this.game,this.world)},e.prototype.addButtons=function(){this.playButton=new s.SimpleButton(this.game,0,0,"main_menu","Button_Play_20000"),this.playButton.callback.addOnce(this.onPlayButtonClick,this);var t=21;this.leaderboardsButton=new s.SimpleButton(this.game,0,0,"main_menu","Button_Stats0000"),this.leaderboardsButton.top=this.playButton.bottom+t,this.leaderboardsButton.left=this.playButton.left,this.leaderboardsButton.callback.add(this.onLeaderboardClick,this),this.creditsButton=new s.SimpleButton(this.game,0,0,"main_menu","Button_Credits0000"),this.creditsButton.top=this.playButton.bottom+t,this.creditsButton.centerX=this.playButton.centerX,this.creditsButton.callback.add(this.onCreditsButtonClick,this),this.settingsButton=new s.SimpleButton(this.game,0,0,"main_menu","Button_Settings0000"),this.settingsButton.right=this.playButton.right,this.settingsButton.top=this.playButton.bottom+t,this.settingsButton.callback.add(this.onSettingsButtonClick,this),this.buttons=[this.playButton,this.leaderboardsButton,this.creditsButton,this.settingsButton],this.buttonsGroup=this.game.add.group(this.world,"buttons"),this.buttonsGroup.addMultiple(this.buttons,!0)},e.prototype.onPlayButtonClick=function(){var t=this;this.game.boosters.canBuyAnyBooster()?this.game.changeState("BoostersShop"):this.game.poki.commercialBreak("MainMenu:PlayButton").finally(function(){t.game.changeState("Level")})},e.prototype.onLeaderboardClick=function(){this.game.changeState(s.StateKey.LEADERBOARDS,{lastState:this.key,lastStateData:!0})},e.prototype.onCreditsButtonClick=function(){this.creditsScreen.show()},e.prototype.onSettingsButtonClick=function(){this.settingsScreen.show()},e.prototype.addCircles=function(){this.circles=new s.MainMenuCircles(this.game,this.world)},e.prototype.addSettingsScreen=function(){this.settingsScreen=new s.SettingsScreen(this.game,this.world),this.settingsScreen.kill()},e.prototype.addCreditsScreen=function(){this.creditsScreen=new s.CreditsScreen(this.game,this.world),this.creditsScreen.kill()},e.prototype.addKeyboardCallbacks=function(){this.game.input.keyboard.addKey(Phaser.Keyboard.ESC).onDown.add(this.onEscPressed,this),this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER).onDown.add(this.onPlayButtonClick,this),s.Main.development&&(this.game.input.keyboard.addKey(Phaser.Keyboard.T).onDown.add(this.showTestToast,this),this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(this.onPlayButtonClick,this),this.game.input.keyboard.addKey(Phaser.Keyboard.R).onDown.add(this.restart,this))},e.prototype.showTestToast=function(){this.game.toast.show("Some multiline unbelievibly long content. That's just insane, folks!",0,4e3)},e.prototype.onEscPressed=function(){if(this.settingsScreen.visible){this.settingsScreen.hide();return}},e.prototype.restart=function(){this.game.changeState("MainMenu")},e.prototype.resize=function(){this.background.resize(),this.buttonsGroup.centerX=s.Config.HALF_GAME_WIDTH,this.buttonsGroup.centerY=s.Config.HALF_GAME_HEIGHT,this.alignLogo(),this.alignCircles(),this.settingsScreen.resize(),this.creditsScreen.resize()},e.prototype.alignLogo=function(){var t=0,i=this.buttonsGroup.top,o=i-t;this.gameLogo.centerX=s.Config.HALF_GAME_WIDTH,this.gameLogo.centerY=t+o/2,this.gameLogo.originalY=this.gameLogo.y},e.prototype.alignCircles=function(){var t=this.buttonsGroup.bottom,i=s.Config.GAME_HEIGHT,o=i-t;this.circles.centerX=s.Config.HALF_GAME_WIDTH,this.circles.centerY=t+o/2-20},e.prototype.show=function(){this.gameLogo.show(200),this.showButtons(500),this.circles.show(600),this.game.time.events.add(2200,this.animatePlayButton,this)},e.prototype.showButtons=function(t){var i=this;this.buttons.forEach(function(o,a){var h=t+a*100;i.game.add.tween(o.scale).from({x:.66,y:.66},400,Phaser.Easing.Back.Out,!0,h),i.game.add.tween(o).from({alpha:0},200,Phaser.Easing.Quadratic.Out,!0,h)})},e.prototype.animatePlayButton=function(){var t=this,i=1.07;this.game.add.tween(this.playButton.scale).to({x:i,y:i},300,Phaser.Easing.Sinusoidal.InOut,!0,0,2,!0).onComplete.addOnce(function(){t.game.time.events.add(3e3,t.animatePlayButton,t)})},e.prototype.shutdown=function(){this.buttons=null,this.game.texts.onLanguageChange.remove(this.onLanguageChange,this)},e}(Phaser.State);s.MainMenu=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a){var h=n.call(this,t,i)||this;return h._enabled=!0,h.callbackDelay=0,h.soundKey="tap",h.userData={},h.name="button_"+o+", "+a,h._callback=new Phaser.Signal,h.addBack(o,a),h}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t,this.back.input.enabled=this._enabled},enumerable:!1,configurable:!0}),e.prototype.addBack=function(t,i){this.back=this.game.add.image(0,0,t,i,this),this.back.anchor.set(.5,.5),this.back.inputEnabled=!0,this.back.events.onInputDown.add(this.onInputDown,this),this.back.events.onInputUp.add(this.onInputUp,this),this.back.name=i,this.game.device.desktop&&(this.back.input.useHandCursor=!0)},e.prototype.onInputDown=function(){this.game.cache.checkSoundKey(this.soundKey)&&this.game.sound.play(this.soundKey),this.executeCallback(),this.originalScale=this.scale.clone(),this.game.tweens.removeFrom(this.scale),this.game.add.tween(this.scale).to({x:this.scale.x*.9,y:this.scale.y*.9},100,Phaser.Easing.Cubic.Out,!0)},e.prototype.onInputUp=function(t,i){this.game.tweens.removeFrom(this.scale),this.game.add.tween(this.scale).to({x:this.originalScale.x,y:this.originalScale.y},150,Phaser.Easing.Cubic.Out,!0)},e.prototype.executeCallback=function(){this.callbackDelay>0?this.game.time.events.add(this.callbackDelay,this._callback.dispatch,this._callback,this):this._callback.dispatch(this)},e.prototype.addIcon=function(t,i,o){o===void 0&&(o=Phaser.CENTER),this.icon=this.game.add.image(0,0,t,i,this),this.icon.anchor.set(.5,.5),this.icon.alignIn(this.back,o)},e.prototype.addBmpText=function(t,i,o,a,h){return a===void 0&&(a=0),h===void 0&&(h=0),this.bmpText=this.game.add.bitmapText(0,0,i,t,o,this),this.bmpText.align="center",this.bmpText.anchor.set(.5,.5),this.bmpText.centerX=this.back.centerX+a,this.bmpText.centerY=this.back.centerY+h,this.bmpText},e.prototype.addText=function(t,i){return this.text=this.game.add.text(0,0,t,i,this),this.text.anchor.set(.5,.5),this.text.alignIn(this.back,Phaser.CENTER),this.text},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this._callback.dispose(),this._callback=null,this.userData=null},Object.defineProperty(e.prototype,"callback",{get:function(){return this._callback},enumerable:!1,configurable:!0}),e}(Phaser.Group);s.ComplexButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"boosters_shop","Button_Add_Coins0000")||this;return o.addWhite(),o}return e.prototype.addWhite=function(){this.white=this.game.add.image(0,0,"boosters_shop","Button_Add_Coins_White0000",this),this.white.anchor.set(.5,.5),this.white.scale.set(.995),this.white.centerX=this.back.centerX,this.white.centerY=this.back.centerY,this.white.visible=!1},e.prototype.highlight=function(){var t=this,i=330;this.white.alpha=0,this.white.visible=!0,this.game.tweens.removeFrom(this.white),this.game.add.tween(this.white).to({alpha:.66},i,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0).onComplete.addOnce(function(){t.white.visible=!1});var o=1.1;this.scale.set(1),this.game.tweens.removeFrom(this.scale),this.game.add.tween(this.scale).to({x:o,y:o},i,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0)},e}(s.ComplexButton);s.AddCoinsButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"coins_label")||this;return o.coinsNum=0,o.textInitialX=0,o.addBack(),o.addCoinIcon(),o.addGetCoinsButton(),o.addText(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"boosters_shop","Coins_Label_Back0000",this),this.back.anchor.set(.5,.5),this.back.scale.x=.9},e.prototype.addCoinIcon=function(){this.coinIcon=this.game.add.image(0,0,"boosters_shop","Coins_Label_Coin0000",this),this.coinIcon.anchor.set(.5,.5),this.coinIcon.left=this.back.left+18,this.coinIcon.centerY=this.back.centerY},e.prototype.addGetCoinsButton=function(){this.getCoinsButton=new s.AddCoinsButton(this.game,this),this.getCoinsButton.right=this.back.right,this.getCoinsButton.centerY=this.back.centerY,this.getCoinsButton.visible=!1},e.prototype.addText=function(){this.text=this.game.add.bitmapText(0,0,s.GameFonts.BOOSTERS_SHOP_BARIOL_BOLD,"0000",42,this),this.text.anchor.set(1,.5),this.text.x=this.back.right-20,this.text.centerY=this.coinIcon.centerY+1,this.textInitialX=this.text.x},e.prototype.updateCount=function(t,i,o){var a=this;if(i===void 0&&(i=!1),o===void 0&&(o=!0),this.coinsNum!==t)if(this.game.tweens.removeFrom(this),this.text.setText(t.toString()),i&&(this.text.x=this.textInitialX,this.game.tweens.removeFrom(this.text),this.game.add.tween(this.text).to({x:"-10"},220,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0)),o){var h=this.game.add.tween(this).to({coinsNum:t},1333,Phaser.Easing.Exponential.Out);h.onStart.addOnce(function(){a.game.audio.playSound("score_count_2",.44)}),h.onComplete.addOnce(function(){a.game.add.tween(a.text.scale).to({x:1.2,y:1.2},216,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0)}),h.onUpdateCallback(function(){a.text.setText(a.coinsNum.toFixed(0))}),h.start()}else this.coinsNum=t},e.prototype.shake=function(){this.game.tweens.removeFrom(this.text),this.text.x=this.textInitialX,this.game.add.tween(this.text).to({x:"-10"},80,Phaser.Easing.Sinusoidal.InOut,!0,0,3,!0)},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.ShopCoinsLabel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"top_panel")||this;return o.addBack(),o.addBackButton(),o.addSoundButton(),o.addCoinsCounter(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"boosters_shop","Top_Panel_Back0000",this),this.back.inputEnabled=!0},e.prototype.addBackButton=function(){this.backButton=new s.SimpleButton(this.game,0,0,"boosters_shop","Button_Main_Menu0000",this)},e.prototype.addSoundButton=function(){this.soundButton=new s.ToggleButton(this.game,0,0,"interface","Button_Sound_On0000","Button_Sound_Off0000",this),this.soundButton.scale.set(.7),this.soundButton.areTweensEnabled=!1,this.soundButton.buttonState=this.game.sound.mute?s.ToggleButtonState.STATE_2:s.ToggleButtonState.STATE_1,this.soundButton.callback.add(this.onSoundButtonClick,this)},e.prototype.onSoundButtonClick=function(){this.game.audio.soundMute=!this.game.audio.soundMute},e.prototype.addCoinsCounter=function(){var t=this.game.store.getCoins();this.coinsLabel=new s.ShopCoinsLabel(this.game,this),this.coinsLabel.updateCount(t,!1,!1)},e.prototype.show=function(t){this.game.add.tween(this).from({y:"-60",alpha:0},400,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.resize=function(t){this.back.width=t,this.alignButtons(),this.alignCoinsLabel()},e.prototype.alignButtons=function(){var t=20,i=this.back.centerY+2;this.backButton.left=this.back.left+t,this.backButton.centerY=i,this.soundButton.right=this.back.right-t-12,this.soundButton.centerY=i},e.prototype.alignCoinsLabel=function(){this.coinsLabel.centerX=this.back.centerX,this.coinsLabel.centerY=this.back.centerY},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.BoostersShopTopPanel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"boosters_shop","Button_Free_Coins0000")||this;return o.addCustomText(),o.addWhite(),o}return e.prototype.addCustomText=function(){var t=this.game.texts.texts.coins_1000,i=1e3,o=t.replace("#",i.toString()),a={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:31,fill:"#ffffff",align:"center"};this.addText(o,a),this.text.x+=56,this.text.y-=5,this.text.lineSpacing=-10},e.prototype.addWhite=function(){this.white=this.game.add.image(0,0,"boosters_shop","Button_Highlight0000",this),this.white.centerX=this.back.centerX,this.white.top=this.back.top,this.white.visible=!1},e.prototype.highlight=function(){this.animateWhite(),this.scale.set(1),this.game.tweens.removeFrom(this.scale),this.game.add.tween(this.scale).to({x:1.15,y:1.15},330,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0)},e.prototype.animateWhite=function(){var t=this;this.white.visible=!0,this.white.alpha=0,this.game.tweens.removeFrom(this.white),this.game.add.tween(this.white).to({alpha:.66},330,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0).onComplete.addOnce(function(){t.white.visible=!1})},e.prototype.disable=function(){this.alpha=.33,this.enabled=!1},e}(s.ComplexButton);s.FreeCoinsButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"bottom_panel")||this;return o.addBack(),o.addFreeCoinsButton(),o.addPlayButton(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"boosters_shop","Bottom_Panel_Back0000",this),this.back.inputEnabled=!0},e.prototype.addFreeCoinsButton=function(){this.freeCoinsButton=new s.FreeCoinsButton(this.game,this),this.freeCoinsButton.name="1000_coins_button"},e.prototype.addPlayButton=function(){this.playButton=new s.SimpleButton(this.game,0,0,"boosters_shop","Button_Play0000",this)},e.prototype.resize=function(t){this.back.width=t,this.alignButtons()},e.prototype.alignButtons=function(){var t=s.Config.GAME_WIDTH*.24,i=this.back.centerY+2;this.freeCoinsButton.centerX=this.back.centerX-t,this.freeCoinsButton.centerY=i,this.playButton.centerX=this.back.centerX+t,this.playButton.centerY=i},e.prototype.show=function(t){this.game.add.tween(this).from({y:"+60",alpha:0},400,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.getHeight=function(){return this.back.height},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.BoostersShopBottomPanel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"booster_num_label")||this;return o.addBack(),o.addText(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"boosters_shop","Booster_Count_Label_Back0000",this),this.back.anchor.set(.5,.5)},e.prototype.addText=function(){this.text=this.game.add.bitmapText(0,0,s.GameFonts.BOOSTERS_SHOP_BARIOL_BOLD,"x0",40,this),this.text.anchor.set(.5,.5)},e.prototype.updateContent=function(t,i){i===void 0&&(i=!0),this.text.setText("x"+t.toString()),i&&(this.text.y=0,this.game.tweens.removeFrom(this.text),this.game.add.tween(this.text).to({y:"-6"},200,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0),this.back.scale.x=1,this.game.tweens.removeFrom(this.back.scale),this.game.add.tween(this.back.scale).to({x:1.4},200,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0))},e.prototype.setBackgroundColor=function(t){this.back.tint=t},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.BoosterCountLabel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i,"item_card_"+o)||this;return a.shadowOffset=6,a._config=o,a.addShadow(),a.addBack(),a.addWhiteStripe(),a.addIcon(),a.addTitle(),a.addCountLabel(),a.addBuyButton(),a.addDescription(),a.addInfoButton(),a.addWhite(),a.initMainContent(),a}return e.prototype.addShadow=function(){this.shadow=this.game.add.image(0,this.shadowOffset,"boosters_shop","Card_Shadow0000",this),this.shadow.anchor.set(.5,.5)},e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"boosters_shop","Card_Back0000",this),this.back.anchor.set(.5,.5),this.back.tint=3518427},e.prototype.addWhiteStripe=function(){this.whiteStripe=this.game.add.image(0,0,"boosters_shop","White_Stripe0000",this),this.whiteStripe.left=this.back.left,this.whiteStripe.top=this.back.top+35},e.prototype.addIcon=function(){var t="Booster_"+this._config.booster.type+"0000";this.icon=this.game.add.image(0,0,"boosters_shop",t,this),this.icon.anchor.set(.5,.5),this.icon.x=this.back.left+77,this.icon.centerY=this.whiteStripe.centerY},e.prototype.addTitle=function(){var t=this._config.booster.title,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:36,fill:"#ffffff",align:"left"};this.title=this.game.add.text(0,0,t,i,this),this.title.lineSpacing=-14,this.title.anchor.set(0,.5),this.title.x=this.back.left+136,this.title.y=this.whiteStripe.centerY},e.prototype.addCountLabel=function(){var t=this._config.booster.num;this.countLabel=new s.BoosterCountLabel(this.game,this),this.countLabel.setBackgroundColor(this.back.tint),this.countLabel.x=this.back.left+390,this.countLabel.y=this.whiteStripe.centerY,this.countLabel.updateContent(t,!1)},e.prototype.addBuyButton=function(){var t=this._config.booster.price;this.buyButton=new s.CardBuyButton(this.game,this),this.buyButton.centerX=this.back.centerX,this.buyButton.y=this.back.top+146,this.buyButton.updatePrice(t),this.buyButton.card=this,this.buyButton.name="buy_button_"+this._config.booster.title,this.buyButton.back.name="buy_button_"+this._config.booster.title},e.prototype.addDescription=function(){var t=this._config.booster.description,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:33,fill:"#ffffff",align:"center"};this.description=this.game.add.text(0,0,t,i,this),this.description.anchor.set(.5,.5),this.description.lineSpacing=-10,this.description.wordWrap=!0,this.description.wordWrapWidth=this.back.width*.75,this.description.setShadow(0,2,"rgba(0,0,0,0.2)",0,!1,!0),this.description.centerX=this.back.centerX,this.description.centerY=this.back.centerY,this.description.visible=!1},e.prototype.addInfoButton=function(){this.infoButton=new s.ToggleButton(this.game,0,0,"boosters_shop","Button_Info0000","Button_Info0001"),this.infoButton.right=this.back.right,this.infoButton.bottom=this.back.bottom,this.infoButton.areTweensEnabled=!1,this.infoButton.callback.add(this.onInfoButtonClick,this),this.add(this.infoButton)},e.prototype.updateContent=function(){this.countLabel&&this.countLabel.updateContent(this.config.booster.num)},Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),e.prototype.onInfoButtonClick=function(t){this.description.visible?(this.hideDescription(),this.showMainContent(100)):(this.hideMainContent(),this.showDescription(100))},e.prototype.hideDescription=function(){var t=this;this.game.tweens.removeFrom(this.description),this.game.add.tween(this.description).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.description.visible=!1})},e.prototype.showMainContent=function(t){var i=this;this.mainContent.forEach(function(o,a){o.visible=!0,o.alpha=0,i.game.tweens.removeFrom(o),i.game.add.tween(o).to({alpha:1},200,Phaser.Easing.Cubic.Out,!0,t)}),this.buyButton.enabled=!0},e.prototype.hideMainContent=function(){var t=this;this.mainContent.forEach(function(i,o){t.game.tweens.removeFrom(i),t.game.add.tween(i).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0)}),this.buyButton.enabled=!1},e.prototype.showDescription=function(t){this.description.visible=!0,this.description.alpha=0,this.game.tweens.removeFrom(this.description),this.game.add.tween(this.description).to({alpha:1},200,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.initMainContent=function(){this.mainContent=[this.whiteStripe,this.icon,this.title,this.countLabel,this.buyButton]},e.prototype.addWhite=function(){this.white=this.game.add.image(0,0,"boosters_shop","Card_Back0000",this),this.white.centerX=this.back.centerX,this.white.centerY=this.back.centerY,this.white.visible=!1},e.prototype.highlight=function(){var t=this;this.white.visible=!0,this.white.alpha=0,this.game.tweens.removeFrom(this.white),this.game.add.tween(this.white).to({alpha:.66},300,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0).onComplete.addOnce(function(){t.white.visible=!1})},e.prototype.resetHighlight=function(){this.game.tweens.removeFrom(this.white),this.white.visible=!1},e.prototype.animateBuyButton=function(){this.stopAnimateBuyButton(),this.game.add.tween(this.buyButton.scale).to({x:1.1,y:1.1},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.prototype.stopAnimateBuyButton=function(){this.game.tweens.removeFrom(this.buyButton.scale),this.buyButton.scale.set(1)},e.prototype.getHeight=function(){return this.back.height},e.prototype.destroy=function(){this.game.tweens.removeFrom(this.buyButton.scale),this.mainContent=null,n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.ShopCard=r})(game||(game={}));var game;(function(s){var r=function(){function n(){this.backTextureColor=3518427,this.videoButton=!1,this.booster=null,this.counterVisible=!0}return n}();s.ShopCardConfig=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"boosters_shop","Button_Buy_Back0000")||this;return o.addBmpText("0000",s.GameFonts.BOOSTERS_SHOP_BARIOL_BOLD,36,0,-2),o.bmpText.anchor.set(1,.5),o.bmpText.right=o.back.right-24,o}return e.prototype.updatePrice=function(t){this.bmpText.setText(t.toString())},e}(s.ComplexButton);s.CardBuyButton=r})(game||(game={}));var game;(function(s){var r=function(){function n(e,t){this._enabled=!0,this.pointerDown=!1,this.game=e,this.state=t,this.cards=this.state.cardsContainer,this.cardsBounds=this.state.cardsBounds,this.scroll=this.state.scroll,this.createScrollRect(),this.game.input.onDown.add(this.onInputDown,this),this.game.input.onUp.add(this.onInputUp,this),this.game.input.mouse.mouseWheelCallback=this.onMouseWheel.bind(this)}return Object.defineProperty(n.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!1,configurable:!0}),n.prototype.onMouseWheel=function(e){if(this._enabled===!1)return;this.game.tweens.removeFrom(this.cards);var t=100*Phaser.Math.sign(e.deltaY),i=this.cards.y+t;this.cards.y=Phaser.Math.clamp(i,this.scrollBounds.top,this.scrollBounds.bottom),this.updateScrollbar(),this.scroll.show(),this.scroll.hide(1e3)},n.prototype.createScrollRect=function(){var e=this.cardsBounds.bottom-this.cards.height-40,t=this.cardsBounds.top,i=t-e;this.scrollBounds=new Phaser.Rectangle(0,s.Config.GAME_WIDTH,e,i)},n.prototype.onInputDown=function(e){if(this._enabled){if(e.interactiveCandidates.length>0)return;this.pointerDown=!0,this.lastPointerPosition=e.position.clone(),this.scroll.show(),this.game.tweens.removeFrom(this.cards),this.cards.children.forEach(function(t){t instanceof s.ShopCard&&t.resetHighlight()})}},n.prototype.onInputUp=function(e){this._enabled&&(this.pointerDown=!1,this.scroll.hide())},n.prototype.update=function(){this._enabled&&(this.pointerDown&&(this.updateScroll(),this.updateScrollbar()))},n.prototype.updateScroll=function(){var e=this.game.input.activePointer.position,t=e.y-this.lastPointerPosition.y,i=1.3,o=this.cards.y+t*i;this.cards.y=Phaser.Math.clamp(o,this.scrollBounds.top,this.scrollBounds.bottom),e.clone(this.lastPointerPosition)},n.prototype.updateScrollbar=function(){var e=this.scrollBounds.y-this.cards.y,t=Math.abs(e)/this.scrollBounds.height;this.scroll.setPosition(1-t)},n.prototype.updateCardVisibility=function(){var e=this;this.cards.children.forEach(function(t){t.updateTransform(t.parent);var i=t.top+e.cards.y,o=t.bottom+e.cards.y;t.visible=i<e.cardsBounds.bottom&&o>e.cardsBounds.top+20})},n.prototype.resize=function(){var e=this.cardsBounds.bottom-this.cards.height-40,t=this.cardsBounds.top,i=t-e;this.scrollBounds.y=e,this.scrollBounds.height=i},n.prototype.destroy=function(){this._enabled=!1,this.game.input.onDown.remove(this.onInputDown,this),this.game.input.onUp.remove(this.onInputUp,this)},n}();s.ScrollHandler=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,0,0,i,o)||this;return a._minY=0,a._maxY=0,a.delta=0,a.anchor.set(.5,.5),a}return e.prototype.setLimits=function(t,i){this._minY=t,this._maxY=i,this.delta=i-t},e.prototype.setPosition=function(t){t=Phaser.Math.clamp(t,0,1),this.y=this._minY+this.delta*t},e.prototype.show=function(){this.game.time.events.removeBy(this.doHide,this),this.game.tweens.removeFrom(this),this.game.add.tween(this).to({alpha:1},100,Phaser.Easing.Cubic.Out,!0)},e.prototype.hide=function(t){t===void 0&&(t=660),this.game.time.events.removeBy(this.doHide,this),this.game.time.events.add(t,this.doHide,this)},e.prototype.doHide=function(){this.game.add.tween(this).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0)},Object.defineProperty(e.prototype,"minY",{get:function(){return this._minY},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxY",{get:function(){return this._maxY},enumerable:!1,configurable:!0}),e}(Phaser.Image);s.ScrollbarHandle=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.create=function(){this.addBackground(),this.addTopPanel(),this.addCards(),this.addScroll(),this.addBottomPanel(),this.addCoinsSpreadFx(),this.addKineticScroll(),this.addKeyboardCallbacks(),this.resize(),this.world.setChildIndex(this.cardsContainer,1),this.show()},e.prototype.addBackground=function(){this.background=new s.GameBackground(this.game,"boosters_shop","Bottom_Panel_Back0000"),this.background.tint=16777215,this.background.fixedToCamera=!0},e.prototype.addTopPanel=function(){this.topPanel=new s.BoostersShopTopPanel(this.game,this.world),this.topPanel.backButton.callback.addOnce(this.gotoMainMenu,this),this.topPanel.coinsLabel.getCoinsButton.callback.add(this.showRewardedVideo,this),this.topPanel.fixedToCamera=!0},e.prototype.gotoMainMenu=function(){this.game.changeState("MainMenu")},e.prototype.onShareButtonClick=function(){var t=this.game.store.getNumber(s.GameStoreKey.BEST_ITEM),i=this.game.texts.texts.share_message;this.game.share.share(i).catch(function(o){})},e.prototype.getShareImage=function(){var t=this.game.make.image(0,0,"main_menu","Item_130000"),i=this.game.make.bitmapData(t.width,t.height).drawFull(t).canvas.toDataURL();return i},e.prototype.onShareComplete=function(){this.highlightBuyButtons()},e.prototype.addCards=function(){var t=this,i=this.game.boosters.boosters.sort(this.sortBoostersByPrice).map(function(o){var a=new s.ShopCardConfig;return a.booster=o,a});this.cards=i.map(function(o){return new s.ShopCard(t.game,t.world,o)}),this.cardsContainer=this.game.add.group(this.world,"cards"),this.cardsContainer.addMultiple(this.cards,!0),this.cardsContainer.align(1,this.cards.length,this.cards[0].width,226,Phaser.BOTTOM_CENTER),this.cardsContainer.forEach(function(o){o.buyButton.callback.add(t.onBuyButtonClick,t)},this),this.cardsBounds=new Phaser.Rectangle(0,0,game.Config.GAME_WIDTH,game.Config.GAME_HEIGHT)},e.prototype.sortBoostersByPrice=function(t,i){var o=t.price-i.price;return Phaser.Math.sign(o)},e.prototype.onBuyButtonClick=function(t){var i=t.card,o=i.config.booster,a=this.game.store.getCoins();if(a>=o.price)if(o.num<o.maxNum)this.game.sound.play("purchase",1),a-=o.price,this.game.store.changeCoins(-o.price),this.topPanel.coinsLabel.updateCount(a,!0,!1),o.num++,i.updateContent(),i.highlight(),this.highlightBuyButtons();else{var h=this.game.texts.texts.booster_maxed_warning;this.game.toast.show(h)}else this.game.sound.play("muted_error",.66),this.topPanel.coinsLabel.shake(),this.topPanel.coinsLabel.getCoinsButton.highlight(),this.bottomPanel.freeCoinsButton.enabled&&this.bottomPanel.freeCoinsButton.highlight()},e.prototype.addScroll=function(){this.scroll=new s.ScrollbarHandle(this.game,"boosters_shop","Scroll0000"),this.scroll.x=s.Config.GAME_WIDTH-20*s.Config.ASSETS_SCALE,this.scroll.fixedToCamera=!0,this.world.add(this.scroll)},e.prototype.addBottomPanel=function(){this.bottomPanel=new s.BoostersShopBottomPanel(this.game,this.world),this.bottomPanel.freeCoinsButton.onChildInputUp.add(this.showRewardedVideo,this),this.bottomPanel.playButton.callback.addOnce(this.onPlayButtonClick,this),this.bottomPanel.fixedToCamera=!0;var t=this.game.store.getBoolean(s.GameStoreKey.FREE_COINS_DISABLED);t&&this.bottomPanel.freeCoinsButton.disable()},e.prototype.showRewardedVideo=function(){var t=this;this.game.poki.rewardedBreak("BoostersShop:1000_coins",{onSuccess:function(){t.giveFreeCoins(),t.bottomPanel.freeCoinsButton.disable(),t.game.store.saveValue(s.GameStoreKey.FREE_COINS_DISABLED,!0)}})},e.prototype.giveFreeCoins=function(){var t=this,i=1e3;this.game.store.changeCoins(i);var o=this.getCoinsFxEmitPoint(),a=this.getCoinsFxCollectPoint();this.coinsSpreadFX.show(o,a,1330),this.coinsSpreadFX.onCoinsCollectedSignal.addOnce(function(){var h=1.07;t.game.add.tween(t.topPanel.coinsLabel.scale).to({x:h,y:h},230,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0),t.updateCoinsLabel(),t.highlightBuyButtons()})},e.prototype.getCoinsFxEmitPoint=function(){return new Phaser.Point(game.Config.HALF_GAME_WIDTH,game.Config.HALF_GAME_HEIGHT)},e.prototype.getCoinsFxCollectPoint=function(){var t=this.topPanel.coinsLabel,i=t.toGlobal(t.coinIcon.position).toPhaser();return i},e.prototype.updateCoinsLabel=function(){var t=this.game.store.getCoins();this.topPanel.coinsLabel.updateCount(t)},e.prototype.onPlayButtonClick=function(){var t=this;this.game.poki.commercialBreak("BoostersShop:PlayButton").finally(function(){t.gotoLevel()})},e.prototype.gotoLevel=function(){this.game.changeState("Level")},e.prototype.addCoinsSpreadFx=function(){this.coinsSpreadFX=new s.CoinsSpreadFX(this.game,this.world,30),this.coinsSpreadFX.background.loadTexture("boosters_shop","white_rect_large0000"),this.coinsSpreadFX.setCoinTexture("boosters_shop","Coins_Label_Coin0000"),this.coinsSpreadFX.fixedToCamera=!0},e.prototype.addKineticScroll=function(){this.game.kineticScrolling.configure({kineticMovement:!0,timeConstantScroll:325,horizontalScroll:!1,verticalScroll:!0,horizontalWheel:!1,verticalWheel:!0,deltaWheel:25}),this.game.kineticScrolling.start()},e.prototype.addKeyboardCallbacks=function(){var t=this;this.game.input.keyboard.addKey(Phaser.Keyboard.ESC).onDown.add(this.gotoMainMenu,this),s.Main.development&&(this.game.input.keyboard.addKey(Phaser.Keyboard.R).onDown.add(this.restart,this),this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR).onDown.add(this.gotoLevel,this),this.game.input.keyboard.addKey(Phaser.Keyboard.EQUALS).onDown.add(function(){t.changeCoins(1e3)}),this.game.input.keyboard.addKey(Phaser.Keyboard.UNDERSCORE).onDown.add(function(){t.changeCoins(-1e3)}),this.game.input.keyboard.addKey(Phaser.Keyboard.OPEN_BRACKET).onDown.add(this.giveFreeCoins,this))},e.prototype.restart=function(){this.game.changeState("BoostersShop")},e.prototype.changeCoins=function(t){var i=this.game.store.changeCoins(t);this.topPanel.coinsLabel.updateCount(i,!0,!1),this.highlightBuyButtons()},e.prototype.resize=function(){this.background.resize(),this.alignTopPanel(),this.alignBottomPanel(),this.alignCards(),this.alignScroll(),this.game.world.setBounds(0,0,s.Config.GAME_WIDTH,this.cardsContainer.height+this.bottomPanel.getHeight()+this.topPanel.height+50),this.coinsSpreadFX.resize()},e.prototype.alignTopPanel=function(){this.topPanel.resize(game.Config.GAME_WIDTH),this.topPanel.centerX=game.Config.HALF_GAME_WIDTH,this.topPanel.top=0},e.prototype.alignBottomPanel=function(){this.bottomPanel.resize(game.Config.GAME_WIDTH),this.bottomPanel.centerX=game.Config.HALF_GAME_WIDTH,this.bottomPanel.cameraOffset.y=s.Config.GAME_HEIGHT-this.bottomPanel.getHeight()},e.prototype.alignCards=function(){this.cardsBounds.x=0,this.cardsBounds.width=game.Config.GAME_WIDTH,this.cardsBounds.y=this.topPanel.bottom,this.cardsBounds.height=this.bottomPanel.top-this.topPanel.bottom,this.cardsContainer.centerX=this.cardsBounds.centerX,this.cardsContainer.y=this.cardsBounds.top},e.prototype.alignScroll=function(){var t=this.scroll.height/2+10,i=this.cardsBounds.top+t,o=this.cardsBounds.bottom-t;this.scroll.setLimits(i,o),this.scroll.right=this.cardsBounds.right-8},e.prototype.show=function(){this.topPanel.show(100),this.bottomPanel.show(100),this.showScroll(250),this.highlightBuyButtons()},e.prototype.showCards=function(t){this.cardsContainer.y=this.bottomPanel.y-this.cardsContainer.height-70*s.Config.ASSETS_SCALE;var i=Math.abs(this.cardsContainer.y-this.cardsBounds.top),o=i/1e3*2600,a=this.game.add.tween(this.cardsContainer).to({y:this.cardsBounds.top},o,Phaser.Easing.Cubic.Out,!0,t);a.onUpdateCallback(function(){}),this.game.add.tween(this.cardsContainer).from({alpha:0},330,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.showScroll=function(t){this.game.add.tween(this.scroll).from({alpha:1},330,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.highlightBuyButtons=function(){var t=this.game.store.getCoins();this.cards.forEach(function(i){i.config.booster.price<=t?i.animateBuyButton():i.stopAnimateBuyButton()})},e.prototype.update=function(t){n.prototype.update.call(this,t),this.updateScrollPosition()},e.prototype.updateScrollPosition=function(){var t=this.scroll.height/2+10,i=this.topPanel.height+t,o=s.Config.GAME_HEIGHT-this.bottomPanel.getHeight()-t,a=o-i,h=0,l=this.game.world.bounds.height-this.game.camera.height,u=l-h,c=this.game.camera.y/u;this.scroll.cameraOffset.y=i+a*c},e.prototype.shutdown=function(){this.game.kineticScrolling.stop()},e}(Phaser.State);s.BoostersShop=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"item")||this;return o._itemType=0,o.dropCell=null,o.z=0,o.onCollectComplete=new Phaser.Signal,o.onRemoveBoosterComplete=new Phaser.Signal,o.addBack(),o.addTextfield(),o.addWhite(),o.addBorder(),o.visible=!1,o.exists=!1,o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Item_White0000",this),this.back.anchor.set(.5,.5)},e.prototype.addTextfield=function(){this.text=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_BOLD_BMP,"0",45,this),this.text.anchor.set(.5,.5)},e.prototype.addWhite=function(){this.white=this.game.add.image(0,0,"interface","Item_White0000",this),this.white.anchor.set(.5,.5),this.white.visible=!1},e.prototype.addBorder=function(){this.border=this.game.add.image(0,0,"interface","Item_Shine0000",this),this.border.anchor.set(.5,.5),this.border.visible=!1},e.prototype.setItemType=function(t){this._itemType=t,this._title="Item "+this._itemType.toString(),this.name=this._title,this.back.tint=e.getBackColor(this._itemType),this.border.tint=this.back.tint,this.text.tint=e.getTextColor(this._itemType),this.text.setText(this._itemType)},e.getBackColor=function(t){var i=Phaser.Math.wrap(t-1,0,e.BACK_COLORS.length-1);return e.BACK_COLORS[i]},e.getTextColor=function(t){var i=Phaser.Math.wrap(t-1,0,e.TEXT_COLORS.length-1);return e.TEXT_COLORS[i]},e.prototype.onSelected=function(){this.showBorderOnSelect(),this.game.add.tween(this.scale).to({x:1.1,y:1.1},200,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0);var t=7*this.game.rnd.sign();this.wiggleTween=this.game.add.tween(this).to({y:this.y+t},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.prototype.showBorderOnSelect=function(){var t=this;this.game.tweens.removeFrom(this.border),this.game.tweens.removeFrom(this.border.scale),this.border.visible=!0,this.border.alpha=1,this.border.scale.set(.9),this.game.add.tween(this.border).to({alpha:0},1e3,Phaser.Easing.Exponential.Out,!0),this.game.add.tween(this.border.scale).to({x:1.2,y:1.2},1e3,Phaser.Easing.Exponential.Out,!0).onComplete.addOnce(function(){t.border.visible=!1})},e.prototype.onDeselected=function(){this.game.tweens.removeFrom(this,!1),this.game.tweens.removeFrom(this.scale),this.stopWiggleTween(),this.hideBorder(),this.scale.set(1),this.alignToCellCenterSmooth()},e.prototype.hideBorder=function(){this.game.tweens.removeFrom(this.border),this.game.tweens.removeFrom(this.border.scale),this.border.visible=!1},e.prototype.stopWiggleTween=function(){this.wiggleTween&&(this.game.tweens.remove(this.wiggleTween),this.wiggleTween.stop(!1),this.wiggleTween=null)},e.prototype.onConverted=function(t){var i=this;t===void 0&&(t=1.2),this.game.tweens.removeFrom(this.white),this.game.tweens.removeFrom(this.white.scale),this.white.visible=!0,this.white.alpha=.7,this.white.scale.set(1),this.game.add.tween(this.white).to({alpha:0},400,Phaser.Easing.Cubic.In,!0).onComplete.addOnce(function(){i.white.visible=!1}),this.angle=-20,this.game.add.tween(this).to({angle:0},400,Phaser.Easing.Back.Out,!0),this.game.add.tween(this.scale).to({x:t,y:t},400,Phaser.Easing.Back.Out,!0).onComplete.addOnce(function(){i.game.add.tween(i.scale).to({x:1,y:1},300,Phaser.Easing.Back.Out,!0)})},e.prototype.applyRemoveBooster=function(){var t=this;this.border.visible=!1,this.white.visible=!1,this.game.add.tween(this).to({y:"+13"},500,Phaser.Easing.Back.InOut,!0),this.game.add.tween(this.scale).to({x:.77,y:.77},160,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.onRemove2()})},e.prototype.onRemove2=function(){var t=this,i=330;this.game.add.tween(this.scale).to({x:2,y:2},i,Phaser.Easing.Cubic.In,!0),this.game.add.tween(this).to({alpha:0},i,Phaser.Easing.Cubic.In,!0).onComplete.addOnce(function(){t.onRemoveBoosterComplete.dispatch(t)})},e.prototype.showOnGrid=function(t,i){t===!1&&this.game.add.tween(this).from({y:"-40",alpha:0},300,Phaser.Easing.Cubic.Out,!0,i)},e.prototype.collect=function(t,i){var o=this;this.parent.bringToTop(this),this.onDeselected();var a=this.getCollectTweenDuration(this._itemType);this.game.add.tween(this).to({x:t,y:i},200,Phaser.Easing.Back.In,!0).onComplete.addOnce(function(){o.onCollectComplete.dispatch(o,o._itemType),o.onAddToPool()})},e.prototype.getCollectTweenDuration=function(t){var i=150,o=Phaser.Math.mapLinear(t,1,13,250,i);return Math.max(o,i)},e.prototype.linkCell=function(t){var i=t.isFree();i===!1&&""+t.column+t.row+t.item.itemType,this.cell&&this.clearCell(),this.cell=t,this.cell.item=this},e.prototype.clearCell=function(){this.cell&&(this.cell.item=null,this.cell=null)},e.prototype.removeFromGrid=function(){this.clearCell(),this.onAddToPool()},e.prototype.dropToCell=function(t,i){i===void 0&&(i=0);var o=t.column*s.Cell.WIDTH+s.Cell.WIDTH*.5,a=t.row*s.Cell.HEIGHT+s.Cell.HEIGHT*.5,h=Phaser.Math.distance(this.x,this.y,o,a),l=h*1.01;return this.game.add.tween(this).to({x:o,y:a},l,Phaser.Easing.Quadratic.Out,!0,i)},e.prototype.onAddToPool=function(){this.visible=!1,this.exists=!1,this.game.tweens.removeFrom([this,this.scale,this.white,this.white.scale,this.border,this.border.scale])},e.prototype.onRemoveFromPool=function(){this.visible=!0,this.exists=!0,this.alpha=1,this.scale.set(1),this.rotation=0,this.border.visible=!1,this.white.visible=!1},e.prototype.alignToCellCenterSmooth=function(t){t===void 0&&(t=150),this.cell&&(this.stopAlignTween(),this.game.tweens.removeFrom(this),this.alignTween=this.game.add.tween(this).to({x:this.cell.centerX,y:this.cell.centerY},t,Phaser.Easing.Cubic.Out,!0))},e.prototype.stopAlignTween=function(){this.alignTween&&(this.alignTween.stop(),this.alignTween=null)},e.prototype.alignToCellCenterInstant=function(){this.cell&&(this.x=this.cell.centerX,this.y=this.cell.centerY)},e.prototype.upgrade=function(t,i){var o=this;t===void 0&&(t=0),i===void 0&&(i=0),t===0&&(t=this._itemType+1),this._itemType=t,this.game.add.tween(this).to({alpha:0},330,Phaser.Easing.Cubic.Out,!0,i),this.game.add.tween(this.scale).to({x:.2,y:.2},330,Phaser.Easing.Back.In,!0,i).onComplete.addOnce(function(){o.upgrade2(t)})},e.prototype.upgrade2=function(t){var i=this;this.setItemType(t),this.white.visible=!0,this.white.alpha=0,this.game.add.tween(this.white).to({alpha:.55},200,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){i.hideWhite()}),this.game.add.tween(this).to({alpha:1},200,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.scale).to({x:1,y:1},440,Phaser.Easing.Back.Out,!0)},e.prototype.hideWhite=function(){this.game.add.tween(this.white).to({alpha:0},660,Phaser.Easing.Cubic.Out,!0)},e.prototype.destroy=function(){this.clearCell(),n.prototype.destroy.call(this,!0,!1)},Object.defineProperty(e.prototype,"title",{get:function(){return this._title},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"itemType",{get:function(){return this._itemType},enumerable:!1,configurable:!0}),e.prototype.animateAsMagnet=function(){var t=this;this.game.tweens.removeFrom(this.scale),this.game.add.tween(this.scale).to({x:1.25,y:1.25},300,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.game.add.tween(t.scale).to({x:1.1,y:1.1},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)}),this.white.visible=!0,this.white.alpha=0,this.game.add.tween(this.white).to({alpha:.33},233,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.prototype.stopMagnetAnimation=function(){this.game.tweens.removeFrom(this.scale),this.game.tweens.removeFrom(this.white)},e.RADIUS=55*s.Config.ASSETS_SCALE,e.RADIUS_SQUARED=e.RADIUS*e.RADIUS,e.CONTACT_RADIUS=190*s.Config.ASSETS_SCALE,e.CONTACT_RADIUS_SQUARED=e.CONTACT_RADIUS*e.CONTACT_RADIUS,e.BACK_COLORS=[16083344,5227511,10147142,10918089,8439997,15487834,14257229,14661120,6732650],e.TEXT_COLORS=[11553639,3771312,7247922,7892625,6066055,11090238,10249528,10256384,4884301],e}(Phaser.Group);s.Item=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,0,0,"interface","white_rect0000")||this;return a.item=null,a._row=i,a._column=o,a.name="cell {"+a.column+", "+a.row+"}",a.width=e.WIDTH,a.height=e.HEIGHT,a.tint=2864886,a}return e.prototype.isFree=function(){return this.item===null},e.prototype.toString=function(){return"Cell {row: "+this._row+", column: "+this._column+"}"},Object.defineProperty(e.prototype,"centerX",{get:function(){return this.x+this.width*.5},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this.y+this.height*.5},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"column",{get:function(){return this._column},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return this._row},enumerable:!1,configurable:!0}),e.WIDTH=130,e.HEIGHT=130,e}(Phaser.Image);s.Cell=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a){var h=n.call(this,t,i||t.world,"grid_["+a+", "+o+"]")||this;return h._rows=0,h._columns=0,h.cellsVisible=!1,h._rows=o,h._columns=a,h.createCells(),h}return e.prototype.createCells=function(){var t=this,i=this._rows*this._columns;this.cells=_.times(i,function(o){var a=Math.floor(o/t._columns),h=o-a*t._columns,l=new s.Cell(t.game,a,h);return l.alpha=0,l.left=h*s.Cell.WIDTH,l.top=a*s.Cell.HEIGHT,t.add(l),l})},e.prototype.alignCells=function(){this.children,this.align(10,this._rows,100,100,Phaser.CENTER)},e.prototype.toggleVisibility=function(){var t=this;this.cellsVisible=!this.cellsVisible,this.cells.forEach(function(i){i.alpha=t.cellsVisible?.66:0})},e.prototype.getCellAt=function(t,i){for(var o=this.cells.length,a=0;a<o;a++){var h=this.cells[a];if(h.row===t&&h.column===i)return h}return null},e.prototype.getFreeCell=function(){for(var t=0;t<this.cells.length;t++){var i=this.cells[t];if(i.isFree())return i}return null},e.prototype.getFreeCellsNum=function(){var t=0;return this.cells.forEach(function(i){i.isFree()&&t++}),t},e.prototype.getCellUnderPoint=function(t,i){var o=this.toLocal(new PIXI.Point(t,i),this.game.world),a=Math.floor(o.y/s.Cell.WIDTH),h=Math.floor(o.x/s.Cell.HEIGHT);return this.getCellAt(a,h)},e.prototype.topRowIsEmpty=function(){for(var t=0;t<this._columns;t++){var i=this.getCellAt(0,t);if(i.isFree()===!1)return!1}return!0},e.prototype.getWidth=function(){var t=this.cells[0].x,i=this.cells[this.cells.length-1].x+this.cells[this.cells.length-1].width;return i-t},e.prototype.getHeight=function(){var t=this.cells[0].y,i=this.cells[this.cells.length-1].y+this.cells[this.cells.length-1].height;return i-t},e.prototype.logState=function(){for(var t=this.game.time.now.toString()+" GRID:\n",i=0;i<this._rows;i++){for(var o=0;o<this._columns;o++){var a=this.getCellAt(i,o);a.isFree()?t+="-  ":t+=a.item.itemType+"  "}t+="\n"}},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.cells=null},Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},enumerable:!1,configurable:!0}),e.ROWS=5,e.COLUMNS=4,e}(Phaser.Group);s.Grid=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"coins_label")||this;return o.addBack(),o.addIcon(),o.addText(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","CoinsCounter_Back0000",this)},e.prototype.addIcon=function(){this.icon=this.game.add.image(0,0,"interface","CoinsCounter_Coin0000",this),this.icon.anchor.set(.5,.5),this.icon.left=this.back.left+20,this.icon.centerY=this.back.centerY},e.prototype.addText=function(){this.text=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_BOLD_BMP,"0000",42,this),this.text.anchor.set(1,.5),this.text.x=this.back.right-20,this.text.y=this.back.centerY},e.prototype.updateContent=function(t,i){i===void 0&&(i=!1),this.text.setText(t),i===!1&&(this.game.tweens.removeFrom(this.text),this.text.x=this.back.right-20,this.game.add.tween(this.text).to({x:"-10"},200,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0))},e.prototype.resize=function(t){this.back.height=t,this.icon.centerY=this.back.centerY,this.text.centerY=this.back.centerY+2},e}(Phaser.Group);s.LevelCoinsLabel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"top_panel")||this;return o.addBack(),o.addCoinsLabel(),o.addPauseButton(),o.addBoostersButton(),o.buttons=[o.boostersButton,o.pauseButton],o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Panel_Back0000",this),this.back.tint=s.LevelGUI.NORMAL_COLOR},e.prototype.addCoinsLabel=function(){var t=this.game.store.getCoins();this.coinsLabel=new s.LevelCoinsLabel(this.game,this),this.coinsLabel.updateContent(t,!0)},e.prototype.addBoostersButton=function(){this.boostersButton=new s.ToggleButton(this.game,0,0,"interface","Boosters_Button_Show0000","Boosters_Button_Hide0000"),this.add(this.boostersButton)},e.prototype.addPauseButton=function(){this.pauseButton=new s.SimpleButton(this.game,0,0,"interface","Button_Pause0000"),this.add(this.pauseButton)},e.prototype.resize=function(t,i,o){this.back.width=t,this.back.height=i,this.alignContent(t,o)},e.prototype.alignContent=function(t,i){var o=(t-i)/2;this.coinsLabel.resize(this.back.height),this.coinsLabel.left=this.back.left+o,this.coinsLabel.centerY=this.back.centerY,this.pauseButton.right=this.back.right-o,this.pauseButton.centerY=this.back.centerY+4,this.boostersButton.x=this.pauseButton.x-90,this.boostersButton.centerY=this.pauseButton.centerY},e.prototype.hideForTutorial=function(){this.coinsLabel.alpha=0,this.buttons.forEach(function(t){t.visible=!1})},e.prototype.showAfterTutorial=function(){this.coinsLabel.alpha=1,this.buttons.forEach(function(t){t.visible=!0})},e.prototype.enableButtons=function(){this.buttons.forEach(function(t){t.enabled=!0,t.alpha=1})},e.prototype.disableButtons=function(){this.buttons.forEach(function(t){t.enabled=!1,t.alpha=s.LevelGUI.DISABLED_BUTTON_ALPHA})},e.prototype.enableInput=function(){this.buttons.forEach(function(t){t.enabled=!0})},e.prototype.disableInput=function(){this.buttons.forEach(function(t){t.enabled=!1})},e.prototype.onBoosterHintShow=function(){this.coinsLabel.visible=!1,this.buttons.forEach(function(t){t.visible=!1})},e.prototype.onBoosterHintHide=function(){this.coinsLabel.visible=!0,this.buttons.forEach(function(t){t.visible=!0})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.LevelTopPanel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a){return n.call(this,t,0,0,i,o,a)||this}return e.prototype.disable=function(){this.alpha=.5,this.enabled=!1},e}(s.SimpleButton);s.FreeBoostersButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"free_boosters_popover")||this;return o.onBoosterRewarded=new Phaser.Signal,o.addBack(),o.addText(),o.addButtons(),o.alignButtons(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Free_Boosters_Back0000",this),this.back.anchor.set(.5,0)},e.prototype.addText=function(){var t=this.game.texts.texts.watch_video,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:33,fill:"#ffffff",align:"center"},o=100;this.text=this.game.add.text(0,0,t,i,this),this.text.anchor.set(.5,.5),this.text.wordWrap=!0,this.text.wordWrapWidth=this.back.width*.9,this.text.lineSpacing=-10,this.text.scale.set(Math.min(1,o/this.text.height)),this.text.centerX=this.back.centerX,this.text.centerY=this.back.top+86},e.prototype.addButtons=function(){var t=this;this.freeRemoveButton=new s.FreeBoostersButton(this.game,"interface","Button_Free_Remove0000",this),this.freeRemoveButton.booster=s.BoosterType.REMOVE,this.freeRemoveButton.boostersNum=2,this.freeUndoButton=new s.FreeBoostersButton(this.game,"interface","Button_Free_Undo0000",this),this.freeUndoButton.booster=s.BoosterType.UNDO,this.freeUndoButton.boostersNum=3,this.buttons=[this.freeRemoveButton,this.freeUndoButton],this.buttons.forEach(function(i){i.events.onInputUp.add(t.onButtonClick,t)}),this.buttonsGroup=this.game.add.group(this,"buttons"),this.buttonsGroup.addMultiple(this.buttons,!0),this.buttonsGroup.align(1,2,this.freeUndoButton.width,this.freeUndoButton.height*1.25,Phaser.CENTER)},e.prototype.alignButtons=function(){var t=this.text.bottom,i=this.back.bottom,o=i-t;this.buttonsGroup.centerX=this.back.centerX,this.buttonsGroup.centerY=t+o/2},e.prototype.onButtonClick=function(t){var i=this;this.game.poki.rewardedBreak("Gameplay:FreeBoostersPopover:"+t.booster,{onSuccess:function(){t.disable(),i.onRewardedAdComplete(t.booster,t.boostersNum)}})},e.prototype.onRewardedAdComplete=function(t,i){this.onBoosterRewarded.dispatch(t,i)},e.prototype.onRewardedAdFail=function(){this.game.toast.showRewardedVideoWarning()},e.prototype.show=function(){this.revive(),this.game.tweens.removeFrom(this),this.game.tweens.removeFrom(this.scale),this.alpha=1,this.scale.set(1),this.game.add.tween(this.scale).from({x:.9,y:.9},400,Phaser.Easing.Back.Out,!0),this.game.add.tween(this).from({alpha:0,y:"-20"},200,Phaser.Easing.Cubic.Out,!0)},e.prototype.hide=function(){var t=this;this.game.add.tween(this).to({alpha:0,y:"+25"},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.visible=!1,t.exists=!1})},e.prototype.getButtonByBoosterType=function(t){return this.buttons.find(function(i){return i.booster===t})},e.prototype.getSaveState=function(){return this.buttons.reduce(function(t,i){var o;return __assign(__assign({},t),(o={},o[i.booster]=i.enabled===!1,o))},{})},e.prototype.loadState=function(t){var i=this;Object.keys(t).forEach(function(o){var a=t[o];a===!0&&i.getButtonByBoosterType(o).disable()})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.buttons=null,this.onBoosterRewarded.dispose(),this.onBoosterRewarded=null},e}(Phaser.Group);s.FreeBoostersPopover=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"booster_num_label")||this;return o.addBack(),o.addText(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Booster_Label_Double0000",this),this.back.anchor.set(.5,.5),this.back.tint=e.NORMAL_COLOR},e.prototype.addText=function(){var t="0";this.text=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_BOLD_BMP,t,28,this),this.text.anchor.set(.5,.5),this.text.y=1},e.prototype.updateContent=function(t){this.text.setText(t),this.back.width=this.getBackWidth()},e.prototype.getBackWidth=function(){var t=32,i=this.text.width+7*2;return Math.max(t,i)},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e.NORMAL_COLOR=16740096,e.GAME_OVER_COLOR=12016989,e}(Phaser.Group);s.BoosterNumLabel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i,"booster_button")||this;return a._enabled=!0,a._selected=!1,a._boosterType=o,a.booster=a.game.boosters.getBooster(a._boosterType),a.onSelected=new Phaser.Signal,a.onClick=new Phaser.Signal,a.addBack(),a.addSelectedMark(),a.addIcon(),a.addLabel(),a}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boosterType",{get:function(){return this._boosterType},enumerable:!1,configurable:!0}),e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","white_rect_large0000",this),this.back.alpha=0,this.back.inputEnabled=!0,this.back.events.onInputDown.add(this.onClickCallback,this),this.back.name="booster_button_"+this._boosterType},e.prototype.onClickCallback=function(){this._enabled&&this.onClick.dispatch(this,this.booster)},e.prototype.addSelectedMark=function(){this.selectedMark=this.game.add.image(0,0,"interface","white_rect0000",this),this.selectedMark.width=this.back.width,this.selectedMark.height=10,this.selectedMark.visible=!1},e.prototype.addIcon=function(){var t="Booster_"+this._boosterType+"0000";this.icon=this.game.add.image(0,0,"interface",t,this),this.icon.anchor.set(.5,.5)},e.prototype.addLabel=function(){this.labelOffset=new Phaser.Point(38,-22),this.label=new s.BoosterNumLabel(this.game,this)},e.prototype.updateData=function(){var t=this.booster.num;this.label.updateContent(t),this.alignLabel(),this._enabled=t>0,this._enabled?(this.icon.alpha=1,this.label.alpha=1,this.back.input.enabled=!0):(this.icon.alpha=.5,this.label.alpha=.66,this.back.input.enabled=!0)},e.prototype.select=function(){if(this._selected===!1){this._selected=!0,this.game.tweens.removeFrom(this),this.game.add.tween(this.back).to({alpha:.2},100,Phaser.Easing.Cubic.Out,!0),this.selectedMark.visible=!0,this.game.add.tween(this.selectedMark).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0);var t=this.back.centerY-4,i=t+this.labelOffset.y;this.game.add.tween(this.icon).to({y:t},400,Phaser.Easing.Back.Out,!0,50),this.game.add.tween(this.label).to({y:i},400,Phaser.Easing.Back.Out,!0,100),this.onSelected.dispatch(this)}},e.prototype.deselect=function(){if(this._selected){this._selected=!1,this.game.tweens.removeFrom(this),this.back.alpha=0,this.selectedMark.visible=!1;var t=this.back.centerY+2;this.game.tweens.removeFrom(this.icon),this.game.add.tween(this.icon).to({y:t},200,Phaser.Easing.Cubic.Out,!0,50);var i=t+this.labelOffset.y;this.game.tweens.removeFrom(this.label),this.game.add.tween(this.label).to({y:i},200,Phaser.Easing.Cubic.Out,!0,100)}},e.prototype.resize=function(t,i){this.back.width=t,this.back.height=i,this.selectedMark.width=this.back.width,this.selectedMark.centerX=this.back.centerX,this.selectedMark.bottom=this.back.bottom,this.icon.alignIn(this.back,Phaser.CENTER,0,2),this.alignLabel()},e.prototype.alignLabel=function(){this.label.x=this.icon.x+this.labelOffset.x,this.label.y=this.icon.y+this.labelOffset.y},e.prototype.highlight=function(){this.game.tweens.removeFrom(this.back),this.back.alpha=0,this.game.add.tween(this.back).to({alpha:.5},200,Phaser.Easing.Sinusoidal.InOut,!0,0,3,!0),this.game.tweens.removeFrom(this.label.scale),this.label.scale.set(1),this.game.add.tween(this.label.scale).to({x:1.12,y:1.12},200,Phaser.Easing.Sinusoidal.InOut,!0,0,3,!0)},e.prototype.highlightForTutorial=function(){this.back.visible=!0,this.game.add.tween(this.back).to({alpha:.25},250,Phaser.Easing.Cubic.InOut,!0,0,-1,!0)},e.prototype.stopHighlightForTutorial=function(){this.game.tweens.removeFrom(this.back),this.back.alpha=0},e.prototype.setGameOverColors=function(){this.label.back.tint=s.BoosterNumLabel.GAME_OVER_COLOR},e.prototype.setNormalColors=function(){this.label.back.tint=s.BoosterNumLabel.NORMAL_COLOR},e.prototype.shake=function(){this.icon.y=this.back.centerY+2,this.game.tweens.removeFrom(this.icon),this.game.add.tween(this.icon).to({y:"-6"},100,Phaser.Easing.Sinusoidal.InOut,!0,0,3,!0),this.back.visible=!0,this.back.alpha=0,this.game.tweens.removeFrom(this.back),this.game.add.tween(this.back).to({alpha:.2},200,Phaser.Easing.Sinusoidal.InOut,!0,0,2,!0)},e.prototype.emulateClick=function(){this.onClickCallback()},e.prototype.shakeIcon=function(){this.game.add.tween(this.icon).to({angle:"-15"},80,Phaser.Easing.Sinusoidal.InOut,!0,0,3,!0)},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.onSelected.dispose(),this.onSelected=null,this.onClick.dispose(),this.onClick=null},e}(Phaser.Group);s.BoosterButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"boosters_panel")||this;return o.onBoosterSelected=new Phaser.Signal,o.onBoosterCanceled=new Phaser.Signal,o.addBack(),o.addGameOverBack(),o.addBoostersButtons(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Panel_Back0000",this),this.back.tint=16365394,this.back.name="simple_back"},e.prototype.addGameOverBack=function(){this.gameOverBack=this.game.add.image(0,0,"interface","Panel_Back0000",this),this.gameOverBack.tint=s.LevelGUI.GAME_OVER_COLOR,this.gameOverBack.visible=!1,this.gameOverBack.name="game_over_back"},e.prototype.addBoostersButtons=function(){var t=this,i=[s.BoosterType.MAGNET,s.BoosterType.UNDO,s.BoosterType.REMOVE,s.BoosterType.SORT,s.BoosterType.UPGRADE];this.buttons=i.map(function(o){return new s.BoosterButton(t.game,t,o)}),this.buttons.forEach(function(o){o.onClick.add(t.onBoosterButtonClick,t)})},e.prototype.onBoosterButtonClick=function(t){t.selected?this.onBoosterCanceled.dispatch(t.boosterType):(this.game.audio.playSound("fancy_tap",.66),this.onBoosterSelected.dispatch(t.boosterType))},e.prototype.onBoosterButtonSelected=function(t){_.without(this.buttons,t).forEach(function(i){i.deselect()})},e.prototype.updateData=function(){this.buttons.forEach(function(t){t.updateData()})},e.prototype.resize=function(t){this.back.width=s.Config.GAME_WIDTH,this.back.height=t,this.gameOverBack.width=this.back.width,this.gameOverBack.height=this.back.height,this.resizeButtons()},e.prototype.resizeButtons=function(){var t=this,i=this.back.width/this.buttons.length;this.buttons.forEach(function(o,a){o.resize(i,t.back.height),o.left=a*i,o.centerY=t.back.centerY})},e.prototype.getButton=function(t){return _.find(this.buttons,{boosterType:t})},e.prototype.enableInput=function(){this.ignoreChildInput=!1,this.buttons.forEach(function(t){t.ignoreChildInput=!1})},e.prototype.disableInput=function(){this.ignoreChildInput=!0,this.buttons.forEach(function(t){t.ignoreChildInput=!0})},e.prototype.disableButtonsExcept=function(t){this.buttons.forEach(function(i){i!==t&&(i.ignoreChildInput=!0)})},e.prototype.deselectAllButtons=function(){this.buttons.forEach(function(t){t.deselect()})},e.prototype.setGameOverColors=function(){this.gameOverBack.visible=!0,this.gameOverBack.alpha=0,this.game.add.tween(this.gameOverBack).to({alpha:1},450,Phaser.Easing.Cubic.Out,!0),this.buttons.forEach(function(t){t.setGameOverColors()})},e.prototype.setNormalColors=function(){var t=this;this.game.add.tween(this.gameOverBack).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.gameOverBack.visible=!1}),this.buttons.forEach(function(i){i.setNormalColors()})},e.prototype.shakeButtons=function(){var t=this;this.buttons.forEach(function(i){var o=t.game.boosters.getBooster(i.boosterType).num;o>0&&i.shake()})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.onBoosterSelected.dispose(),this.onBoosterSelected=null,this.onBoosterCanceled.dispose(),this.onBoosterCanceled=null},e}(Phaser.Group);s.BoostersPanel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"booster_hint")||this;return o.wasResized=!1,o.onCancel=new Phaser.Signal,o.addBack(),o.addCancelButton(),o.addHintText(),o.alignText(),o.game.time.events.add(50,function(){o.kill()},o),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Panel_Back0000",this),this.back.width=s.Cell.WIDTH*s.Grid.COLUMNS,this.back.height=100,this.back.tint=16294178},e.prototype.addCancelButton=function(){this.cancelButton=new s.SimpleButton(this.game,0,0,"interface","Booster_Hint_Close0000",this),this.cancelButton.callback.add(this.onCancelButtonClick,this),this.cancelButton.centerX=this.back.left+this.back.width*.8,this.cancelButton.centerY=this.back.centerY},e.prototype.onCancelButtonClick=function(){this.onCancel.dispatch()},e.prototype.addHintText=function(){var t=this.game.boosters.getBooster(s.BoosterType.MAGNET).hint,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:30,fill:"#ffffff",align:"center"};this.text=this.game.add.text(0,0,t,i,this),this.text.anchor.set(.5,.5),this.text.lineSpacing=-6,this.text.align="center"},e.prototype.alignText=function(){var t=this.back.left,i=this.cancelButton.left,o=i-t,a=o*.85,h=this.back.height*.85;if(this.text.scale.set(1),this.text.wordWrap=!0,this.text.wordWrapWidth=a,this.text.width>a||this.text.height>h){var l=a/this.text.width,u=h/this.text.height,c=Math.min(l,u);this.text.scale.set(c)}this.text.centerX=t+o/2,this.text.centerY=this.back.centerY},e.prototype.updateContent=function(t){this.text.setText(t),this.alignText()},e.prototype.show=function(){this.game.tweens.removeFrom(this),this.visible=!0,this.exists=!0,this.alpha=1,this.game.add.tween(this).from({alpha:0},150,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this).from({y:"-10"},250,Phaser.Easing.Cubic.Out,!0)},e.prototype.hide=function(){var t=this;this.game.add.tween(this).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.visible=!1,t.exists=!1})},e.prototype.hideInstant=function(){this.visible=!1,this.exists=!1},e.prototype.resize=function(t,i){this.back.width=t,this.back.height=i,this.cancelButton.right=this.back.right-20,this.cancelButton.centerY=this.back.centerY,this.alignText()},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.onCancel.dispose(),this.onCancel=null},e}(Phaser.Group);s.BoosterHint=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"highscore_toast")||this;return o.titleLines=o.game.texts.texts.highscore_titles,o.addBack(),o.addShadow(),o.addTitle(),o.addSubtitle(),o.addRipples(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Highscore_Back0000",this),this.back.anchor.set(.5,.5),this.back.tint=15348025},e.prototype.addShadow=function(){this.shadow=this.game.add.image(0,0,"interface","Highscore_Back0000",this),this.shadow.alpha=.2,this.shadow.tint=this.back.tint,this.shadow.centerX=this.back.centerX,this.shadow.bottom=this.back.bottom+8},e.prototype.addTitle=function(){var t=this.game.rnd.pick(this.titleLines),i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:40,fill:"#ffffff",align:"center"};this.title=this.game.add.text(0,0,t,i,this),this.title.anchor.set(.5,.5),this.title.centerX=this.back.centerX,this.title.y=this.back.top+32},e.prototype.addSubtitle=function(){var t=this.game.texts.texts.highscore_subtitle,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:22,fill:"#ffffff",align:"center"};this.subtitle=this.game.add.text(0,0,t,i,this),this.subtitle.anchor.set(.5,.5),this.subtitle.centerX=this.back.centerX,this.subtitle.y=this.back.y+24},e.prototype.addRipples=function(){var t=this;this.ripples=_.times(3,function(i){var o=t.game.add.image(0,0,"interface","Highscore_Back0000",t);return o.anchor.set(.5,.5),o.visible=!1,t.sendToBack(o),o})},e.prototype.updateContent=function(t){this.updateTitle(t.itemType),this.updateSubtitle(t.itemType),this.back.tint=s.Item.getBackColor(t.itemType),this.shadow.tint=s.Item.getBackColor(t.itemType)},e.prototype.updateTitle=function(t){var i=t===12?this.game.texts.texts.highscore_title_12:this.game.rnd.pick(this.titleLines);this.title.setText(i),this.adjustTitleSize()},e.prototype.adjustTitleSize=function(){var t=this.back.width*.82;this.title.scale.set(1),this.title.scale.set(Math.min(1,t/this.title.width))},e.prototype.updateSubtitle=function(t){this.subtitle.text=this.game.texts.texts.highscore_subtitle.replace("#",t.toString())},e.prototype.show=function(){this.revive(),this.game.tweens.removeFrom(this),this.game.tweens.removeFrom(this.scale),this.scale.set(1.3),this.alpha=0,this.game.add.tween(this.scale).to({x:1,y:1},800,Phaser.Easing.Bounce.Out,!0),this.game.add.tween(this).to({alpha:1},300,Phaser.Easing.Linear.None,!0),this.game.add.tween(this).to({y:"-14"},900,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.showRipples(),this.game.time.events.removeBy(this.hide,this),this.game.time.events.add(3e3,this.hide,this)},e.prototype.showRipples=function(){var t=this;this.ripples.forEach(function(i,o){i.visible=!0,i.alpha=.66,i.scale.set(1),t.game.tweens.removeFrom(i),t.game.tweens.removeFrom(i.scale);var a=220+200*o,h=1.2;t.game.add.tween(i).to({alpha:0},500,Phaser.Easing.Linear.None,!0,a),t.game.add.tween(i.scale).to({x:h,y:h},500,Phaser.Easing.Linear.None,!0,a)})},e.prototype.hide=function(){var t=this;this.game.tweens.removeFrom(this),this.game.tweens.removeFrom(this.scale),this.game.add.tween(this.scale).to({x:.66,y:.66},330,Phaser.Easing.Back.In,!0),this.game.add.tween(this).to({alpha:0},130,Phaser.Easing.Cubic.Out,!0,200).onComplete.addOnce(function(){t.visible=!1,t.exists=!1})},e.prototype.destroy=function(){this.game.time.events.removeBy(this.hide,this),n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.HighscoreToast=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i,"interface","Game_Over_Button_Back0000")||this;return a.back.name="game_over_button_"+_.snakeCase(o),a.back.scale.set(1.1,1),a.addCustomText(o),a.addWhite(),a}return e.prototype.addCustomText=function(t){var i={font:s.GameFonts.NUNITO_CSS,fontSize:25,fontWeight:s.FontWeight.BOLD,fill:"#ffffff",align:"center"};this.addText(t,i),this.text.lineSpacing=-8,this.text.y+=2},e.prototype.addWhite=function(){this.white=this.game.add.image(0,0,"interface","Game_Over_Button_White0000",this),this.white.centerX=this.back.centerX,this.white.centerY=this.back.centerY,this.white.visible=!1},e.prototype.enable=function(){this.enabled=!0,this.alpha=1},e.prototype.disable=function(){this.enabled=!1,this.alpha=.66},e.prototype.highlight=function(){var t=this;this.game.tweens.removeFrom(this.white),this.white.visible=!0,this.white.alpha=0,this.game.add.tween(this.white).to({alpha:.33},100,Phaser.Easing.Sinusoidal.InOut,!0,0,6,!0).onComplete.addOnce(function(){t.white.visible=!1})},e}(s.ComplexButton);s.GameOverButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i,o)||this;return a._wasUsed=!1,a.addVideoIcon(),a.alignText(),a}return Object.defineProperty(e.prototype,"wasUsed",{get:function(){return this._wasUsed},enumerable:!1,configurable:!0}),e.prototype.addVideoIcon=function(){this.videoIcon=this.game.add.image(0,0,"interface","Video_Icon0000",this),this.videoIcon.anchor.set(.5,.5),this.videoIcon.centerX=this.back.left+this.back.width*.23,this.videoIcon.centerY=this.back.centerY},e.prototype.alignText=function(){var t=this.videoIcon.right,i=this.back.right,o=i-t,a=o*.8;this.text.scale.set(1),this.text.scale.set(Math.min(1,a/this.text.width)),this.text.centerX=t+o/2},e.prototype.markAsUsed=function(){this._wasUsed=!0,this.disable()},e}(s.GameOverButton);s.GameOverVideoButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"game_over_gui")||this;return o.onShuffle=new Phaser.Signal,o.onUndo=new Phaser.Signal,o.onEndGame=new Phaser.Signal,o.addBack(),o.addTitle(),o.addButtons(),o.bringToTop(o.title),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Game_Over_Top_Panel0000",this)},e.prototype.addTitle=function(){var t=this.game.texts.texts.no_moves,i={font:s.GameFonts.NUNITO_CSS,fontSize:48,fontWeight:s.FontWeight.BOLD,fill:"#ffffff",align:"center"};this.title=this.game.add.text(0,0,t,i,this),this.title.anchor.set(.5,.5),this.title.centerX=this.back.centerX,this.title.top=this.back.top+20},e.prototype.alignTitle=function(){var t=this.back.width*.8;this.title.scale.set(1),this.title.width>t&&this.title.scale.set(t/this.title.width),this.title.centerX=this.back.centerX,this.title.centerY=this.back.top+(this.buttonsGroup.top-this.back.top)/2+4},e.prototype.addButtons=function(){var t=this.game.texts.texts.video_shuffle;this.shuffleButton=new s.GameOverVideoButton(this.game,this,t),this.shuffleButton.name="SHUFFLE",this.shuffleButton.userData.signal=this.onShuffle,this.shuffleButton.callback.addOnce(this.onIncentiveButtonClick,this);var i=this.game.texts.texts.game_end;this.endGameButton=new s.GameOverButton(this.game,this,i),this.buttons=[this.shuffleButton,this.endGameButton],this.buttonsGroup=this.game.add.group(this,"buttons"),this.buttonsGroup.addMultiple(this.buttons,!0),this.buttonsGroup.align(this.buttons.length,1,250,this.shuffleButton.height,Phaser.CENTER)},e.prototype.onIncentiveButtonClick=function(t){this.game.poki.rewardedBreak("GameOver:ShuffleButton",{onSuccess:function(){t.markAsUsed(),t.userData.signal.dispatch()}})},e.prototype.enableButtons=function(){this.buttons.forEach(function(t){t instanceof s.GameOverVideoButton?t.wasUsed===!1&&t.enable():t.enable()})},e.prototype.disableButtons=function(){this.buttons.forEach(function(t){t.disable()})},e.prototype.show=function(){this.revive(),this.alpha=1,this.game.add.tween(this).from({alpha:0,y:"-30"},300,Phaser.Easing.Cubic.Out,!0),this.title.visible=!0,this.alignTitle(),this.enableButtons(),this.showButtons(150)},e.prototype.showButtons=function(t){var i=this;t===void 0&&(t=0),this.buttons.forEach(function(o,a){o.visible=!0,o.scale.set(1);var h=t+a*100;i.game.add.tween(o).from({alpha:0},150,Phaser.Easing.Cubic.Out,!0,h),i.game.add.tween(o.scale).from({x:.8,y:.8},400,Phaser.Easing.Back.Out,!0)})},e.prototype.hide=function(){var t=this;this.disableButtons(),this.game.add.tween(this).to({y:"-50",alpha:0},200,Phaser.Easing.Cubic.In,!0).onComplete.addOnce(function(){t.visible=!1,t.exists=!1})},e.prototype.shake=function(){this.shakeText(),this.shakeButtons()},e.prototype.shakeText=function(){this.game.tweens.removeFrom(this.title),this.title.x=this.back.centerX,this.game.add.tween(this.title).to({x:"-14"},50,Phaser.Easing.Sinusoidal.InOut,!0,0,6,!0)},e.prototype.shakeButtons=function(){var t=this;_.filter(this.buttons,{enabled:!0,visible:!0}).forEach(function(i,o){var a=o*100;t.game.tweens.removeFrom(i.scale),i.scale.set(1),t.game.add.tween(i.scale).to({x:1.15,y:1.15},200,Phaser.Easing.Sinusoidal.InOut,!0,a,0,!0)})},e.prototype.onBoosterSelected=function(t){this.title.visible=!1,this.buttons.forEach(function(i){i.visible=!1}),this.y=-1*(this.height-t.height)+5*s.Config.ASSETS_SCALE},e.prototype.onBoosterCancelled=function(){this.title.visible=!0,this.buttons.forEach(function(t){t.visible=!0}),this.y=0},e.prototype.enableInput=function(){this.ignoreChildInput=!1,this.buttons.forEach(function(t){t.ignoreChildInput=!1})},e.prototype.disableInput=function(){this.ignoreChildInput=!0,this.buttons.forEach(function(t){t.ignoreChildInput=!0})},e.prototype.resize=function(t){this.back.width=t,this.alignButtons(),this.alignTitle()},e.prototype.alignButtons=function(){this.buttonsGroup.centerX=this.back.centerX,this.buttonsGroup.centerY=120},e.prototype.getButtonGlobalPosition=function(t){return t.parent.toGlobal(t.position)},e.prototype.getSaveState=function(){return{shuffleUsed:this.shuffleButton.wasUsed}},e.prototype.loadState=function(t){t.shuffleUsed&&this.shuffleButton.markAsUsed()},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.buttons=null,this.disposeSignals()},e.prototype.disposeSignals=function(){this.onShuffle.dispose(),this.onShuffle=null,this.onUndo.dispose(),this.onUndo=null,this.onEndGame.dispose(),this.onEndGame=null},e}(Phaser.Group);s.GameOverGUI=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"game_over_tutorial")||this;return o.currentTextLine=-1,o.clicksNum=0,o.onComplete=new Phaser.Signal,o.textLines=o.game.texts.texts.game_over_tutorial,o.addBack(),o.addCentralText(),o.addHint(),o.addBottomPanelHint(),o.addButtonHint(),o.visible=!1,o.exists=!1,o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","white_rect0000",this),this.back.alpha=.66,this.back.tint=1713022},e.prototype.addCentralText=function(){var t=this.textLines[0];this.centralText=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_BOLD_BMP,t,44,this),this.centralText.anchor.set(.5,.5),this.centralText.align="center"},e.prototype.addHint=function(){var t=this.game.texts.texts.game_over_tutorial_hint;this.textHint=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_BOLD_BMP,t,40,this),this.textHint.anchor.set(.5,.5),this.textHint.align="center"},e.prototype.addBottomPanelHint=function(){this.bottomPanelHint=this.game.add.image(0,0,"interface","Bottom_Panel_Hint0000",this),this.bottomPanelHint.anchor.set(.5,.5),this.bottomPanelHint.visible=!1},e.prototype.addButtonHint=function(){this.buttonHint=this.game.add.image(0,0,"interface","Button_Hint0000",this),this.buttonHint.anchor.set(.5,.5),this.buttonHint.visible=!1},e.prototype.show=function(t){this.visible=!0,this.gameOver=t,this.parent.addChildAt(this.back,0),this.resizeBackground(),this.showNextTextLine(),this.animateHint(),this.game.input.onDown.add(this.onInputDown,this)},e.prototype.animateHint=function(){this.game.add.tween(this.textHint).to({alpha:.5},400,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.prototype.onInputDown=function(){switch(this.clicksNum++){case 0:this.hideTextHint(),this.showNextTextLine(),this.showBottomPanelHint();break;case 1:this.hideBottomPanelHint(),this.showNextTextLine(),this.showVideoButtonsHints();break;case 2:this.hideVideoButtonsHints(),this.showNextTextLine(),this.showEndGameButtonHint();break;case 3:this.hide();break;default:this.hide();break}},e.prototype.showNextTextLine=function(){var t=this.textLines[++this.currentTextLine];t&&(this.centralText.setText(t),this.game.tweens.removeFrom(this.centralText),this.game.tweens.removeFrom(this.centralText.scale),this.centralText.alpha=1,this.centralText.scale.set(1),this.game.add.tween(this.centralText).to({alpha:1},150,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.centralText.scale).to({x:1,y:1},330,Phaser.Easing.Cubic.Out,!0))},e.prototype.showBottomPanelHint=function(){this.bottomPanelHint.visible=!0,this.bottomPanelHint.alpha=.2,this.game.add.tween(this.bottomPanelHint).to({alpha:1},200,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.bottomPanelHint.scale.set(1.5),this.game.add.tween(this.bottomPanelHint.scale).to({x:1,y:1},500,Phaser.Easing.Cubic.Out,!0)},e.prototype.hideBottomPanelHint=function(){this.game.tweens.removeFrom(this.bottomPanelHint),this.game.tweens.removeFrom(this.bottomPanelHint.scale),this.bottomPanelHint.visible=!1},e.prototype.showVideoButtonsHints=function(){var t=this.gameOver.getButtonGlobalPosition(this.gameOver.shuffleButton);this.buttonHint.x=t.x,this.buttonHint.y=t.y,this.buttonHint.visible=!0,this.buttonHint.alpha=.2,this.game.add.tween(this.buttonHint).to({alpha:1},200,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.buttonHint.scale.set(1.5),this.game.add.tween(this.buttonHint.scale).to({x:1,y:1},500,Phaser.Easing.Cubic.Out,!0)},e.prototype.hideVideoButtonsHints=function(){this.removeButtonHintTweens(),this.buttonHint.visible=!1},e.prototype.removeButtonHintTweens=function(){this.game.tweens.removeFrom(this.buttonHint),this.game.tweens.removeFrom(this.buttonHint.scale)},e.prototype.showEndGameButtonHint=function(){var t=this.gameOver.getButtonGlobalPosition(this.gameOver.endGameButton);this.buttonHint.x=t.x,this.buttonHint.y=t.y,this.buttonHint.visible=!0,this.buttonHint.alpha=.2,this.game.add.tween(this.buttonHint).to({alpha:1},200,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.buttonHint.scale.set(1.5),this.game.add.tween(this.buttonHint.scale).to({x:1,y:1},500,Phaser.Easing.Cubic.Out,!0)},e.prototype.hide=function(){var t=this;this.game.store.saveValue(s.GameStoreKey.GAME_OVER_TUTORIAL_COMPLETE,!0),this.game.input.onDown.remove(this.onInputDown,this),this.removeButtonHintTweens(),this.game.add.tween(this.back).to({alpha:0},200,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.back.visible=!1}),this.game.add.tween(this).to({alpha:0},200,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.onHideComplete()})},e.prototype.onHideComplete=function(){this.onComplete.dispatch(),this.pendingDestroy=!0},e.prototype.hideTextHint=function(){this.game.tweens.removeFrom(this.textHint),this.game.tweens.removeFrom(this.textHint.scale),this.textHint.visible=!1},e.prototype.resize=function(){this.resizeBackground(),this.centralText.maxWidth=s.Config.GAME_WIDTH*.8,this.centralText.centerX=s.Config.HALF_GAME_WIDTH,this.centralText.centerY=s.Config.HALF_GAME_HEIGHT,this.textHint.maxWidth=s.Config.GAME_WIDTH*.8,this.textHint.centerX=s.Config.HALF_GAME_WIDTH,this.textHint.y=s.Config.GAME_HEIGHT-110-this.textHint.height*.5-20,this.bottomPanelHint.x=s.Config.HALF_GAME_WIDTH,this.bottomPanelHint.y=s.Config.GAME_HEIGHT-this.bottomPanelHint.height*.5,this.buttonHint.x=s.Config.HALF_GAME_WIDTH,this.buttonHint.y=s.Config.GAME_HEIGHT-this.buttonHint.height*.5+16*s.Config.ASSETS_SCALE},e.prototype.resizeBackground=function(){this.back.width=s.Config.GAME_WIDTH*1.2,this.back.height=s.Config.GAME_HEIGHT*1.2,this.back.centerX=s.Config.HALF_GAME_WIDTH,this.back.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.destroy=function(){this.hideTextHint(),n.prototype.destroy.call(this,!0,!1),this.onComplete.dispose(),this.onComplete=null,this.textLines=null},e}(Phaser.Group);s.GameOverTutorial=r})(game||(game={}));var game;(function(s){var r;(function(e){e[e.STATE_1=0]="STATE_1",e[e.STATE_2=1]="STATE_2"})(r=s.ToggleButtonState||(s.ToggleButtonState={}));var n=function(e){__extends(t,e);function t(i,o,a,h,l,u,c){var d=e.call(this,i,o,a,h,l,c)||this;return d.spriteSheet=h,d.textureKey1=l,d.textureKey2=u,d._buttonState=r.STATE_1,d.events.onInputDown.add(d.switchTextures,d),d}return t.prototype.switchTextures=function(){this.buttonState=this._buttonState===r.STATE_1?r.STATE_2:r.STATE_1},Object.defineProperty(t.prototype,"buttonState",{get:function(){return this._buttonState},set:function(i){this._buttonState=i,this.frameName=this._buttonState===r.STATE_1?this.textureKey1:this.textureKey2},enumerable:!1,configurable:!0}),t}(game.SimpleButton);s.ToggleButton=n})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a){var h=n.call(this,t,i,"checkbox")||this;return h._checked=!0,h.onChange=new Phaser.Signal,h.props=a,h.addCheck(),h.addLabel(o),h.onChildInputDown.add(h.onClick,h),h}return Object.defineProperty(e.prototype,"checked",{get:function(){return this._checked},set:function(t){this._checked=t,this._checked?this.setChecked():this.setUnchecked()},enumerable:!1,configurable:!0}),e.prototype.addCheck=function(){this.check=this.game.add.image(0,0,this.props.textureKey,this.props.onFrame,this),this.check.anchor.set(.5,.5),this.check.inputEnabled=!0,this.check.input.useHandCursor=!0},e.prototype.addLabel=function(t){var i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.NORMAL,fontSize:32,fill:"#ffffff",align:"left"};this.label=this.game.add.text(0,0,t,i,this),this.label.anchor.set(0,.5),this.label.x=this.check.right+8,this.label.centerY=this.check.centerY+1,this.label.data.originalX=this.label.x,this.label.inputEnabled=!0,this.label.input.useHandCursor=!0,this.label.hitArea=new Phaser.Rectangle(0,-this.label.height/2,this.label.width,this.label.height)},e.prototype.onClick=function(){this._checked?this.setUnchecked():this.setChecked()},e.prototype.setChecked=function(){this._checked=!0,this.check.frameName=this.props.onFrame,this.playTweens(),this.playClickSound(),this.onChange.dispatch(this)},e.prototype.setUnchecked=function(){this._checked=!1,this.check.frameName=this.props.offFrame,this.playTweens(),this.playClickSound(),this.onChange.dispatch(this)},e.prototype.playClickSound=function(){this.game.audio.playClickSound(.5)},e.prototype.playTweens=function(){this.game.tweens.removeFrom(this.label),this.label.x=this.label.data.originalX,this.game.add.tween(this.label).to({x:"+8"},150,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0)},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.onChange.dispose(),this.onChange=null},e}(Phaser.Group);s.Checkbox=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"exit_confirm_screen")||this;return o.addBackdrop(),o.addBack(),o.addTitle(),o.addSubtitle(),o.addButtons(),o.alignSubtitle(),o}return e.prototype.addBackdrop=function(){this.backdrop=this.game.add.image(0,0,"interface","white_rect0000",this),this.backdrop.tint=1713022,this.backdrop.alpha=.5,this.backdrop.inputEnabled=!0},e.prototype.addBack=function(){this.window=this.game.add.group(this,"popup"),this.windowBack=this.game.add.image(0,0,"interface","Modal_Back0000",this.window),this.windowBack.anchor.set(.5,.5)},e.prototype.addTitle=function(){var t=this.game.texts.texts.quit_popup_title,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:40,fill:"#FF9933",align:"center"};this.title=this.game.add.text(0,0,t,i,this.window),this.title.anchor.set(.5,.5),this.title.centerX=this.windowBack.centerX,this.title.top=this.windowBack.top+25},e.prototype.addSubtitle=function(){var t=this.game.texts.texts.progress_lost_warinig,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.NORMAL,fontSize:28,fill:"#FF9933",align:"center"};this.subtitle=this.game.add.text(0,0,t,i,this.window),this.subtitle.anchor.set(.5,.5),this.subtitle.wordWrap=!0,this.subtitle.wordWrapWidth=this.windowBack.width*.85,this.subtitle.lineSpacing=-8,this.subtitle.centerX=this.windowBack.centerX},e.prototype.addButtons=function(){var t=90*s.Config.ASSETS_SCALE,i=160*s.Config.ASSETS_SCALE;this.noButton=new s.SimpleButton(this.game,0,0,"interface","Button_No0000",this.window),this.noButton.x=this.windowBack.centerX-t,this.noButton.top=this.windowBack.top+i,this.noButton.callback.add(this.onNoButtonClick,this),this.yesButton=new s.SimpleButton(this.game,0,0,"interface","Button_Yes0000",this.window),this.yesButton.x=this.windowBack.centerX+t,this.yesButton.top=this.windowBack.top+i,this.buttons=[this.noButton,this.yesButton]},e.prototype.alignButtons=function(){var t=this.subtitle.bottom,i=this.windowBack.bottom,o=i-t;this.buttons.forEach(function(a,h){a.y=t+o/2})},e.prototype.alignSubtitle=function(){var t=this.title.bottom-12,i=this.yesButton.top,o=i-t;this.subtitle.y=t+o/2},e.prototype.onNoButtonClick=function(){this.disableButtons(),this.hide()},e.prototype.onYesButtonClick=function(){this.disableButtons(),this.game.changeState("BoostersShop")},e.prototype.enableButtons=function(){this.buttons.forEach(function(t){t.enabled=!0})},e.prototype.disableButtons=function(){this.buttons.forEach(function(t){t.enabled=!1})},e.prototype.updateContent=function(t,i){this.title.text=t,this.subtitle.text=i},e.prototype.show=function(){this.visible=!0,this.exists=!0,this.enableButtons(),this.alpha=1,this.game.add.tween(this.backdrop).from({alpha:0},150,Phaser.Easing.Cubic.Out,!0);var t=0;this.game.add.tween(this.window).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.window.scale).from({x:.8,y:.8},400,Phaser.Easing.Back.Out,!0,t)},e.prototype.hide=function(){var t=this;this.yesButton.callback.removeAll(),this.game.add.tween(this).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.visible=!1,t.exists=!1})},e.prototype.resize=function(){this.resizeBackdrop(),this.alignWindow()},e.prototype.resizeBackdrop=function(){this.backdrop.width=s.Config.GAME_WIDTH*1.2,this.backdrop.height=s.Config.GAME_HEIGHT*1.2,this.backdrop.centerX=s.Config.HALF_GAME_WIDTH,this.backdrop.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.alignWindow=function(){this.window.centerX=s.Config.HALF_GAME_WIDTH,this.window.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.ExitConfirmPopup=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"pause_screen")||this;return o.onShow=new Phaser.Signal,o.onHide=new Phaser.Signal,o.level=o.game.state.getCurrentState(),o.addBackground(),o.addMainGroup(),o.addResumeButton(),o.addMiddleButtons(),o.addCheckboxes(),o.updateCheckboxes(),o.addBuildInfo(),o.addConfirmExitPopup(),o}return e.prototype.addBackground=function(){this.background=this.game.add.image(0,0,"interface","white_rect0000",this),this.background.inputEnabled=!0,this.background.tint=16774112,this.background.anchor.set(.5,.5),this.background.name="pause_screen_back"},e.prototype.addMainGroup=function(){this.mainGroup=this.game.add.group(this,"main_group")},e.prototype.addResumeButton=function(){this.resumeButton=new s.SimpleButton(this.game,0,0,"interface","Button_Resume0000",this.mainGroup)},e.prototype.addMiddleButtons=function(){this.homeButton=new s.SimpleButton(this.game,0,0,"interface","Button_Home0000"),this.homeButton.callback.add(this.onHomeButtonClick,this),this.restartButton=new s.SimpleButton(this.game,0,0,"interface","Button_Restart0000"),this.restartButton.callback.add(this.onRestartButtonClick,this),this.soundButton=new s.ToggleButton(this.game,0,0,"interface","Button_Sound_On0000","Button_Sound_Off0000"),this.soundButton.callback.add(this.onSoundButtonClick,this),this.updateSoundButtonState(),this.middleButtons=this.game.add.group(this.mainGroup,"middle_buttons"),this.middleButtons.addMultiple([this.homeButton,this.restartButton,this.soundButton],!0),this.middleButtons.align(3,1,150,100,Phaser.CENTER)},e.prototype.onHomeButtonClick=function(){if(this.showConfirmExitPopup()){var t=this.game.texts.texts.quit_popup_title,i=this.game.texts.texts.progress_lost_warinig;this.confirmExitPopup.updateContent(t,i),this.confirmExitPopup.yesButton.callback.addOnce(this.switchToBoosterShop,this),this.confirmExitPopup.show()}else this.switchToBoosterShop()},e.prototype.switchToBoosterShop=function(){var t=this;this.game.poki.commercialBreak("PauseScreen:Quit").finally(function(){t.game.changeState("BoostersShop")})},e.prototype.onRestartButtonClick=function(){var t=this.showConfirmExitPopup()===!1;if(t){this.restartLevel();return}var i=this.game.texts.texts.restart_popup_title,o=this.game.texts.texts.progress_lost_warinig;this.confirmExitPopup.updateContent(i,o),this.confirmExitPopup.yesButton.callback.addOnce(this.restartLevel,this),this.confirmExitPopup.show()},e.prototype.restartLevel=function(){var t=this;this.game.poki.commercialBreak("PauseScreen:Restart").finally(function(){t.game.changeState("Level")})},e.prototype.showConfirmExitPopup=function(){return this.level.levelStats.moves>3},e.prototype.onSoundButtonClick=function(){this.game.audio.soundMute=!this.game.audio.soundMute},e.prototype.addCheckboxes=function(){var t={textureKey:"interface",onFrame:"Checkbox0001",offFrame:"Checkbox0000"},i=this.game.texts.texts.headstart_popup_cb;this.headstartCheckbox=new s.Checkbox(this.game,this,i,t),this.headstartCheckbox.onChange.add(this.onHeadstartCbChanged,this),this.headstartCheckbox.label.tint=16750899,this.headstartCheckbox.name="headstart_checkbox";var o=this.game.texts.texts.coinsx2_popup_cb;this.doubleCoinsCheckbox=new s.Checkbox(this.game,this,o,t),this.doubleCoinsCheckbox.onChange.add(this.onDoubleCoinsCbChanged,this),this.doubleCoinsCheckbox.label.tint=16750899,this.doubleCoinsCheckbox.name="double_coins_checkbox",this.doubleCoinsCheckbox.kill();var a=[this.headstartCheckbox,this.doubleCoinsCheckbox];this.checkboxes=this.game.add.group(this.mainGroup,"checkboxes"),this.checkboxes.addMultiple(a,!0),this.checkboxes.align(1,a.length,s.Config.GAME_WIDTH,80,Phaser.LEFT_CENTER)},e.prototype.onHeadstartCbChanged=function(t){this.game.store.saveValue(s.GameStoreKey.HEADSTART_POPUP_DSIABLED,!t.checked)},e.prototype.onDoubleCoinsCbChanged=function(t){this.game.store.saveValue(s.GameStoreKey.COINSx2_POPUP_DSIABLED,!t.checked)},e.prototype.resize=function(){this.resizeBackground(),this.resumeButton.centerX=s.Config.HALF_GAME_WIDTH,this.resumeButton.top=0,this.middleButtons.centerX=s.Config.HALF_GAME_WIDTH,this.middleButtons.top=this.resumeButton.bottom+40,this.checkboxes.centerX=s.Config.HALF_GAME_WIDTH,this.checkboxes.top=this.middleButtons.bottom+45,this.mainGroup.centerX=s.Config.HALF_GAME_WIDTH,this.mainGroup.centerY=s.Config.HALF_GAME_HEIGHT,this.buildInfo.centerX=s.Config.HALF_GAME_WIDTH,this.buildInfo.bottom=s.Config.GAME_HEIGHT-20,this.confirmExitPopup.resize()},e.prototype.resizeBackground=function(){this.background.width=s.Config.GAME_WIDTH*1.25,this.background.height=s.Config.GAME_HEIGHT*1.25,this.background.centerX=s.Config.HALF_GAME_WIDTH,this.background.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.show=function(){var t=this;this.revive(),this.updateCheckboxes(),this.updateSoundButtonState(),this.onShow.dispatch(this),this.game.tweens.removeFrom(this),this.alpha=1,this.background.alpha=0,this.game.add.tween(this.background).to({alpha:1},100,Phaser.Easing.Cubic.Out,!0),__spreadArrays([this.resumeButton],this.middleButtons.children).forEach(function(i,o){t.game.add.tween(i).from({alpha:0,y:"+20"},150,Phaser.Easing.Cubic.Out,!0,o*66)}),[this.headstartCheckbox,this.doubleCoinsCheckbox].forEach(function(i,o){t.game.add.tween(i).from({x:"+20",alpha:0},150,Phaser.Easing.Cubic.Out,!0,100+o*66)})},e.prototype.updateSoundButtonState=function(){this.soundButton.buttonState=this.game.sound.mute?s.ToggleButtonState.STATE_2:s.ToggleButtonState.STATE_1},e.prototype.updateCheckboxes=function(){var t=this.game.store;this.headstartCheckbox.checked=t.getBoolean(s.GameStoreKey.HEADSTART_POPUP_DSIABLED)===!1,this.doubleCoinsCheckbox.checked=t.getBoolean(s.GameStoreKey.COINSx2_POPUP_DSIABLED)===!1},e.prototype.addBuildInfo=function(){var t=this,i=window.game.config.build_version,o=window.game.config.build_time,a="Build #"+i+"\n"+o;this.buildInfo=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_REGULAR_BMP,a,30,this),this.buildInfo.align="center",this.buildInfo.anchor.set(.5,1),this.buildInfo.tint=16750899,this.buildInfo.alpha=0,this.buildInfo.inputEnabled=!0,this.buildInfo.hitArea=this.buildInfo.getBounds(this),this.buildInfo.events.onInputDown.add(function(){t.buildInfo.alpha=t.buildInfo.alpha===0?1:0})},e.prototype.addConfirmExitPopup=function(){this.confirmExitPopup=new s.ExitConfirmPopup(this.game,this),this.confirmExitPopup.kill()},e.prototype.hide=function(){var t=this;this.game.tweens.removeFrom(this),this.game.add.tween(this).to({alpha:0},100,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.onHide.dispatch(t),t.visible=!1,t.exists=!1})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.PauseScreen=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"popup")||this;return o.hiding=!1,o.onShow=new Phaser.Signal,o.onHide=new Phaser.Signal,o.onRewardedAdComplete=new Phaser.Signal,o.addBackdrop(),o.addWindow(),o.addTitle(),o.addMainText(),o.addContent(),o.addButtons(),o.addCheckbox(),o.alignContent(),o.kill(),o}return e.prototype.addBackdrop=function(){this.backdrop=this.game.add.image(0,0,"interface","white_rect0000",this),this.backdrop.anchor.set(.5,.5),this.backdrop.alpha=.5,this.backdrop.tint=1713022,this.backdrop.inputEnabled=!0},e.prototype.addWindow=function(){this.window=this.game.add.group(this,"container"),this.windowBack=this.game.add.image(0,0,"interface","Popup_Back0000",this.window),this.windowBack.anchor.set(.5,.5)},e.prototype.addTitle=function(){this.titleBack=this.game.add.image(0,0,"interface","Popup_Title_Back0000",this.window),this.titleBack.centerX=this.windowBack.centerX,this.titleBack.top=this.windowBack.top+40;var t={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:44,fill:"#ffffff",align:"center"};this.title=this.game.add.text(0,0,"Title",t,this.window),this.title.anchor.set(.5,.5),this.title.centerX=this.titleBack.centerX,this.title.centerY=this.titleBack.centerY},e.prototype.addMainText=function(){var t="Some multiline\ncontent?!?!",i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.NORMAL,fontSize:30,fill:"#F89932",align:"center"};this.mainText=this.game.add.text(0,0,t,i,this.window),this.mainText.anchor.set(.5,.5),this.mainText.lineSpacing=-8,this.mainText.wordWrap=!0,this.mainText.wordWrapWidth=this.windowBack.width*.9,this.mainText.x=this.windowBack.centerX,this.mainText.top=this.windowBack.top+130},e.prototype.addContent=function(){this.content=this.game.add.image(0,0,"interface","Headstart_Popup_Content0000",this.window),this.content.anchor.set(.5,.5),this.content.centerX=this.windowBack.centerX,this.content.top=this.mainText.bottom+10},e.prototype.addButtons=function(){var t=90,i=this.windowBack.top+410;this.noButton=new s.SimpleButton(this.game,0,0,"interface","Button_No0000",this.window),this.noButton.x=this.windowBack.centerX-t,this.noButton.y=i,this.noButton.callback.addOnce(this.hide,this),this.yesButton=new s.SimpleButton(this.game,0,0,"interface","Button_Yes0000",this.window),this.yesButton.x=this.windowBack.centerX+t,this.yesButton.y=i},e.prototype.addCheckbox=function(){var t=this.game.texts.texts.dont_ask_cb;this.checkbox=new s.Checkbox(this.game,this.window,t,{textureKey:"interface",onFrame:"Checkbox0001",offFrame:"Checkbox0000"}),this.checkbox.checked=this.game.store.getBoolean(s.GameStoreKey.HEADSTART_POPUP_DSIABLED),this.checkbox.centerX=this.windowBack.centerX,this.checkbox.centerY=this.yesButton.bottom+(this.windowBack.bottom-this.yesButton.bottom)/2,this.checkbox.label.tint=16750899},e.prototype.alignContent=function(){var t=this.mainText.bottom,i=this.noButton.top,o=i-t;this.content.centerX=this.windowBack.centerX,this.content.centerY=t+o/2},e.prototype.show=function(){this.parent.bringToTop(this),this.revive(),this.showBackdrop(),this.showWindow(250)},e.prototype.showBackdrop=function(){this.backdrop.alpha=0,this.game.add.tween(this.backdrop).to({alpha:.66},500,Phaser.Easing.Cubic.Out,!0)},e.prototype.showWindow=function(t){var i=this;this.alignWindow(),this.game.add.tween(this.window).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.window).from({y:"+60"},600,Phaser.Easing.Back.Out,!0,t),this.window.scale.set(.8);var o=this.game.add.tween(this.window.scale).to({x:1,y:1},400,Phaser.Easing.Back.Out,!0,t);o.onStart.addOnce(function(){i.game.sound.play("popup",.33)}),o.onComplete.addOnce(function(){i.animateYesButton()})},e.prototype.animateYesButton=function(){var t=1.15;this.game.add.tween(this.yesButton.scale).to({x:t,y:t},440,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.prototype.hide=function(){var t=this;if(this.hiding)return;this.hiding=!0,this.disableInput(),this.game.add.tween(this).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.onHideComplete()})},e.prototype.disableInput=function(){[this.noButton,this.yesButton].forEach(function(t){t.enabled=!1}),this.checkbox.ignoreChildInput=!0},e.prototype.onHideComplete=function(){this.onHide.dispatch(),this.visible=!1,this.pendingDestroy=!0},e.prototype.resize=function(){this.resizeBackground(),this.alignWindow()},e.prototype.resizeBackground=function(){this.backdrop.width=s.Config.GAME_WIDTH*1.2,this.backdrop.height=s.Config.GAME_HEIGHT*1.2,this.backdrop.centerX=s.Config.HALF_GAME_WIDTH,this.backdrop.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.alignWindow=function(){this.window.centerX=s.Config.HALF_GAME_WIDTH,this.window.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.showRewardedVideo=function(t){this.game.poki.rewardedBreak(t,{onSuccess:this.onRewardedAdCompleteCallback.bind(this)})},e.prototype.onRewardedAdCompleteCallback=function(){this.onRewardedAdComplete.dispatch(this),this.hide()},e.prototype.onRewardedAdFail=function(){this.game.toast.showRewardedVideoWarning(),this.hide()},e.prototype.destroy=function(){this.game.tweens.removeFrom(this.yesButton.scale),n.prototype.destroy.call(this,!0,!1),this.onShow.dispose(),this.onShow=null,this.onHide.dispose(),this.onHide=null,this.onRewardedAdComplete.dispose(),this.onRewardedAdComplete=null},e}(Phaser.Group);s.ComplexPopup=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i)||this;o.name="headstart_popup",o.backdrop.name="headstart_popup_back";var a=o.game.texts.texts.headstart_popup_title;o.title.setText(a);var h=o.game.texts.texts.headstart_popup_message;return o.mainText.setText(h),o.content.frameName="Headstart_Popup_Content0000",o.alignContent(),o.yesButton.callback.addOnce(o.showRewardedVideo.bind(o,"HeadstartPopup")),o.checkbox.checked=o.game.store.getBoolean(s.GameStoreKey.HEADSTART_POPUP_DSIABLED),o.checkbox.onChange.add(o.onCheckboxChanged,o),o}return e.prototype.onCheckboxChanged=function(){this.game.store.saveValue(s.GameStoreKey.HEADSTART_POPUP_DSIABLED,this.checkbox.checked)},e}(s.ComplexPopup);s.HeadstartPopup=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i,"level_gui")||this;return a.level=o,a.grid=a.level.grid,a.onUndoSelected=new Phaser.Signal,a.onBoosterSelected=new Phaser.Signal,a.onBoosterCancelled=new Phaser.Signal,a.addTopPanel(),a.addFreeBoostersPopover(),a.addBoostersPanel(),a.addHighscoreToast(),a.addGameOver(),a.addBoosterHint(),a.addPauseScreen(),a.addRestartOverlay(),a}return e.prototype.addTopPanel=function(){this.topPanel=new s.LevelTopPanel(this.game,this),this.topPanel.boostersButton.callback.add(this.toggleFreeBoosters,this)},e.prototype.toggleFreeBoosters=function(){this.freeBoostersPopover.visible?this.hideFreeBoostersPopover():this.showFreeBoostersPopover()},e.prototype.hideFreeBoostersPopover=function(){this.level.pointerEnabled=!0,this.pauseButton.enabled=!0,this.pauseButton.alpha=1,this.boostersPanel.enableInput(),this.freeBoostersPopover.hide()},e.prototype.showFreeBoostersPopover=function(){this.level.pointerEnabled=!1,this.level.pointerDown=!1,this.pauseButton.enabled=!1,this.pauseButton.alpha=e.DISABLED_BUTTON_ALPHA,this.boostersPanel.disableInput(),this.freeBoostersPopover.x=this.topPanel.boostersButton.x,this.freeBoostersPopover.y=this.topPanel.boostersButton.bottom-4,this.freeBoostersPopover.show()},e.prototype.addFreeBoostersPopover=function(){this.freeBoostersPopover=new s.FreeBoostersPopover(this.game,this),this.freeBoostersPopover.onBoosterRewarded.add(this.onFreeBoosterEarned,this),this.freeBoostersPopover.kill()},e.prototype.onFreeBoosterEarned=function(t,i){var o=this.game.boosters.getBooster(t);if(!o)return;o.num+=i,this.boostersPanel.getButton(t).highlight(),this.boostersPanel.updateData(),this.hideFreeBoostersPopover(),this.topPanel.boostersButton.buttonState=s.ToggleButtonState.STATE_1,this.game.sound.play("booster_selected",.5),this.level.saveGameStateInStore()},e.prototype.addBoostersPanel=function(){this.boostersPanel=new s.BoostersPanel(this.game,this),this.boostersPanel.onBoosterSelected.add(this.onBoosterSelectedCallback,this),this.boostersPanel.onBoosterCanceled.add(this.onBoosterCancelledCallback,this),this.boostersPanel.updateData()},e.prototype.onBoosterSelectedCallback=function(t){var i=this.game.boosters.getBooster(t);if(t===s.BoosterType.UNDO){this.boostersPanel.deselectAllButtons(),this.onUndoSelected.dispatch();return}this.boostersPanel.disableInput(),this.boostersPanel.getButton(t).select(),this.boostersPanel.getButton(t).ignoreChildInput=!1,this.topPanel.disableInput(),this.boosterHint.onCancel.addOnce(this.onBoosterCancelledCallback,this),this.boosterHint.top=0,this.boosterHint.updateContent(i.hint),this.boosterHint.show(),this.gameOver.visible&&this.gameOver.onBoosterSelected(this.boosterHint),this.onBoosterSelected.dispatch(t)},e.prototype.onBoosterCancelledCallback=function(t){this.boostersPanel.deselectAllButtons(),this.boostersPanel.enableInput(),this.gameOver?this.boosterHint.hideInstant():this.boosterHint.hide(),this.topPanel.enableInput(),this.gameOver.visible&&this.gameOver.onBoosterCancelled(),this.onBoosterCancelled.dispatch()},e.prototype.onBoosterComplete=function(){this.boosterHint.hide(),this.boostersPanel.enableInput(),this.boostersPanel.deselectAllButtons(),this.boostersPanel.updateData(),this.topPanel.onBoosterHintHide(),this.topPanel.enableInput(),this.gameOver.visible&&(this.gameOver.hide(),this.boostersPanel.setNormalColors(),this.topPanel.enableButtons())},e.prototype.addHighscoreToast=function(){this.highscoreToast=new s.HighscoreToast(this.game,this),this.highscoreToast.kill()},e.prototype.addGameOver=function(){this.gameOver=new s.GameOverGUI(this.game,this),this.gameOver.kill()},e.prototype.addBoosterHint=function(){this.boosterHint=new s.BoosterHint(this.game,this)},e.prototype.addPauseScreen=function(){this.pauseScreen=new s.PauseScreen(this.game,this),this.pauseScreen.kill()},e.prototype.addRestartOverlay=function(){this.restartOverlay=this.game.add.image(0,0,"interface","white_rect0000",this),this.restartOverlay.anchor.set(.5,.5),this.restartOverlay.visible=!1,this.restartOverlay.name="restart_overlay"},e.prototype.addHeadstartPopup=function(){return this.headstartPopup=new s.HeadstartPopup(this.game,this),this.headstartPopup},e.prototype.addTutorial=function(){var t=new s.Tutorial(this.game,this,this.level);return t.initAllowedItems(),t.parent.bringToTop(t),t},e.prototype.showRestartOverlay=function(){var t=this;this.restartOverlay.bringToTop(),this.restartOverlay.visible=!0,this.restartOverlay.alpha=1,this.game.add.tween(this.restartOverlay).to({alpha:0},500,Phaser.Easing.Cubic.In,!0,100).onComplete.addOnce(function(){t.restartOverlay.visible=!1})},e.prototype.onPause=function(t){var i=this;this.game.time.events.add(100,this.pauseScreen.show,this.pauseScreen,t),this.game.add.tween(this.topPanel).to({alpha:0},200,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){i.topPanel.visible=!1}),this.game.add.tween(this.boostersPanel).to({alpha:0},200,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){i.boostersPanel.visible=!1}),this.highscoreToast.visible=!1},e.prototype.onResume=function(){this.pauseScreen.hide(),this.topPanel.visible=!0,this.game.tweens.removeFrom(this.topPanel),this.game.add.tween(this.topPanel).from({y:"-40"},200,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.topPanel).to({alpha:1},200,Phaser.Easing.Cubic.Out,!0),this.boostersPanel.visible=!0,this.game.tweens.removeFrom(this.boostersPanel),this.game.add.tween(this.boostersPanel).from({y:"+40"},200,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.boostersPanel).to({alpha:1},200,Phaser.Easing.Cubic.Out,!0)},e.prototype.onRestore=function(){this.showRestartOverlay(),this.gameOver.visible&&(this.gameOver.hide(),this.boostersPanel.setNormalColors(),this.topPanel.enableButtons())},e.prototype.onGameOver=function(){if(this.gameOver.visible!==!1)return;this.game.sound.play("no_moves_1",.66),this.topPanel.disableInput(),this.boostersPanel.enableInput(),this.boostersPanel.setGameOverColors(),this.gameOver.top=0,this.gameOver.show()},e.prototype.onGameOverTutorialComplete=function(){this.gameOver.enableInput(),this.boostersPanel.enableInput()},e.prototype.onContinueAfterGameOver=function(){this.topPanel.enableInput(),this.topPanel.enableButtons(),this.boostersPanel.setNormalColors(),this.gameOver.hide()},e.prototype.show=function(t){var i=60*s.Config.ASSETS_SCALE,o=400;this.game.add.tween(this.topPanel).from({y:"-"+i,alpha:0},o,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.boostersPanel).from({y:"+"+i,alpha:0},o,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.showHighscoreToast=function(t){this.highscoreToast.x=s.Config.HALF_GAME_WIDTH,this.highscoreToast.y=this.boostersPanel.y,this.highscoreToast.updateContent(t),this.highscoreToast.show()},e.prototype.initialResize=function(){this.topPanel.resize(s.Config.GAME_WIDTH,e.PANEL_HEIGHT,s.Config.GAME_WIDTH*.85),this.topPanel.top=0,this.topPanel.centerX=s.Config.HALF_GAME_WIDTH,this.boostersPanel.resize(s.LevelGUI.PANEL_HEIGHT),this.boostersPanel.centerX=s.Config.HALF_GAME_WIDTH,this.boostersPanel.bottom=s.Config.GAME_HEIGHT,this.highscoreToast.centerX=s.Config.HALF_GAME_WIDTH,this.highscoreToast.y=this.boostersPanel.top,this.highscoreToast.originalY=this.highscoreToast.y,this.gameOver.resize(s.Config.GAME_WIDTH),this.gameOver.top=0,this.gameOver.centerX=s.Config.HALF_GAME_WIDTH,this.headstartPopup&&this.headstartPopup.resize(),this.pauseScreen.resize(),this.resizeRestartOverlay()},e.prototype.resizeRestartOverlay=function(){this.restartOverlay.width=s.Config.GAME_WIDTH*1.2,this.restartOverlay.height=s.Config.GAME_HEIGHT*1.2,this.restartOverlay.centerX=s.Config.HALF_GAME_WIDTH,this.restartOverlay.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.finalResize=function(){var t=Math.max(s.Config.GAME_WIDTH*.8,this.level.grid.width);this.topPanel.resize(s.Config.GAME_WIDTH,e.PANEL_HEIGHT,t),this.topPanel.top=0,this.topPanel.centerX=s.Config.HALF_GAME_WIDTH,this.freeBoostersPopover.centerX=this.topPanel.boostersButton.centerX,this.freeBoostersPopover.top=this.topPanel.boostersButton.bottom+6,this.level.tutorial&&(this.level.tutorial.resize(e.PANEL_HEIGHT),this.level.tutorial.centerX=this.topPanel.centerX,this.level.tutorial.centerY=this.topPanel.centerY),this.boosterHint.resize(t,e.PANEL_HEIGHT),this.boosterHint.centerX=this.topPanel.centerX,this.boosterHint.centerY=this.topPanel.centerY},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.disposeSignals(),this.level=null},e.prototype.disposeSignals=function(){this.onBoosterSelected.dispose(),this.onBoosterSelected=null,this.onBoosterCancelled.dispose(),this.onBoosterCancelled=null,this.onUndoSelected.dispose(),this.onUndoSelected=null},Object.defineProperty(e.prototype,"coinsLabel",{get:function(){return this.topPanel.coinsLabel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pauseButton",{get:function(){return this.topPanel.pauseButton},enumerable:!1,configurable:!0}),e.NORMAL_COLOR=16758609,e.GAME_OVER_COLOR=15037299,e.DISABLED_BUTTON_ALPHA=.7,e.PANEL_HEIGHT=110,e}(Phaser.Group);s.LevelGUI=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t,0,0,"interface","Finger0000")||this;return i.visible=!1,i}return e.prototype.showTap=function(){var t=this;this.visible=!0,this.game.tweens.removeFrom(this),this.rotation=0,this.alpha=0,this.scale.set(1),this.game.add.tween(this).to({alpha:1},250,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.showTap2()})},e.prototype.showTap2=function(){var t=400;this.game.add.tween(this.scale).to({x:.8,y:.8},t,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this).to({angle:-17},t,Phaser.Easing.Cubic.Out,!0),this.delayedCall=this.game.time.events.add(900,this.hideTap,this)},e.prototype.hideTap=function(){var t=this;this.game.add.tween(this.scale).to({x:1,y:1},750,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this).to({angle:0},750,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this).to({alpha:0},250,Phaser.Easing.Cubic.Out,!0,500).onComplete.addOnce(function(){t.hideTap2()})},e.prototype.hideTap2=function(){this.delayedCall=this.game.time.events.add(660,this.showTap,this)},e.prototype.pointAt=function(t,i){this.removeTimers(),this.removeTweens(),this.frameName="Finger_20000",this.angle=0,this.scale.set(1),this.anchor.set(.5,1),this.visible=!0,this.alpha=0,this.x=t,this.y=i,this.game.add.tween(this).to({alpha:1},200,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this).to({y:"-66"},500,Phaser.Easing.Cubic.InOut,!0,0,-1,!0)},e.prototype.removeTweens=function(){this.game&&(this.game.tweens.removeFrom(this),this.game.tweens.removeFrom(this.scale))},e.prototype.followPath=function(t){this.path=t,this.visible=!0,this.show()},e.prototype.show=function(){var t=this;this.removeTweens(),this.currentPoint=this.path[0],this.x=this.currentPoint.x,this.y=this.currentPoint.y,this.alpha=0,this.rotation=0,this.scale.set(1),this.game.add.tween(this).to({alpha:1},250,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.show2()})},e.prototype.show2=function(){var t=400;this.game.add.tween(this.scale).to({x:.8,y:.8},t,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this).to({angle:-17},t,Phaser.Easing.Cubic.Out,!0),this.delayedCall=this.game.time.events.add(600,this.moveToNextPoint,this)},e.prototype.moveToNextPoint=function(){var t=this,i=this.getNextPoint(),o=this.currentPoint.distance(i),a=o*3.3;this.currentPoint=i,this.game.add.tween(this).to({x:i.x,y:i.y},a,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){t.onMoveComplete()})},e.prototype.getNextPoint=function(){var t=this.path.indexOf(this.currentPoint),i=t===this.path.length-1?0:t+1;return this.path[i]},e.prototype.onMoveComplete=function(){this.currentPoint===this.path[this.path.length-1]?this.hide():this.moveToNextPoint()},e.prototype.hide=function(){var t=this;this.game.add.tween(this).to({alpha:0},250,Phaser.Easing.Cubic.Out,!0,500).onComplete.addOnce(function(){t.hide2()})},e.prototype.hide2=function(){this.game.time.events.add(666,this.show,this)},e.prototype.stopAndHide=function(){this.removeTweens(),this.removeTimers(),this.visible=!1},e.prototype.removeTimers=function(){this.delayedCall&&(this.game.time.events.remove(this.delayedCall),this.delayedCall=null)},e.prototype.destroy=function(){this.stopAndHide(),this.removeTimers(),n.prototype.destroy.call(this,!0),this.path=null,this.currentPoint=null},e.OFFSET=new Phaser.Point(26,50),e}(Phaser.Image);s.Finger=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"tutorial_text")||this;return o.currentLine=0,o.tutorialLines=o.game.texts.texts.tutorial,o.addBack(),o.addTitle(),o.addSubtitle(),o.alignTexts(),o.game.add.tween(o.subtitle).to({alpha:.33},400,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Tutorial_Back0000",this)},e.prototype.addTitle=function(){var t=this.tutorialLines[0],i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:32,fill:"#ffffff",align:"center"};this.title=this.game.add.text(0,0,t,i,this),this.title.wordWrap=!0,this.title.wordWrapWidth=this.back.width*.85,this.title.lineSpacing=-10,this.title.align="center",this.title.anchor.set(.5,0),this.title.name="title"},e.prototype.addSubtitle=function(){var t=this.game.texts.texts.tutorial_hint;this.subtitle=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_BOLD_BMP,t,28,this),this.subtitle.anchor.set(.5,0),this.subtitle.centerX=this.title.centerX,this.subtitle.top=this.title.bottom+5,this.subtitle.name="subtitle"},e.prototype.showNextLine=function(){this.setTextLine(++this.currentLine),this.tweenText()},e.prototype.setTextLine=function(t){this.currentLine=Phaser.Math.clamp(t,0,this.tutorialLines.length-1);var i=this.tutorialLines[this.currentLine],o=this.back.height;this.title.setText(i,!0),this.title.scale.set(1),this.title.scale.set(Math.min(1,o/this.title.height)),this.title.centerY=this.back.centerY},e.prototype.tweenText=function(){this.game.tweens.removeFrom(this.title),this.game.tweens.removeFrom(this.title.scale);var t=this.title.scale.x;this.title.alpha=0,this.title.scale.set(t*.8),this.game.add.tween(this.title).to({alpha:1},200,Phaser.Easing.Cubic.Out,!0),this.game.add.tween(this.title.scale).to({x:t,y:t},360,Phaser.Easing.Back.Out,!0)},e.prototype.hide=function(){this.game.add.tween(this).to({alpha:0,y:"-66"},100,Phaser.Easing.Cubic.In,!0)},e.prototype.show=function(){this.alpha=0,this.game.add.tween(this).to({alpha:1},660,Phaser.Easing.Linear.None,!0,100)},e.prototype.resize=function(t){this.back.height=t,this.alignTexts()},e.prototype.alignTexts=function(){if(this.subtitle.centerX=this.back.centerX,this.subtitle.bottom=this.back.bottom-20,this.subtitle.visible)this.title.bottom=this.subtitle.top-5;else{var t=this.back.height*.7;this.title.scale.set(1),this.title.height>t&&this.title.scale.set(t/this.title.height),this.title.centerY=this.back.centerY}this.title.centerX=this.back.centerX},e.prototype.hideSubtitle=function(){this.game.tweens.removeFrom(this.subtitle),this.subtitle.visible=!1},e.prototype.destroy=function(){this.hideSubtitle(),n.prototype.destroy.call(this,!0,!1),this.tutorialLines=null},e}(Phaser.Group);s.TutorialTopPanel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i,"tutorial")||this;return a.clicks=0,a.isComplete=!1,a.onComplete=new Phaser.Signal,a.level=o,a.prepareGrid(),a.initAllowedItems(),a.addFinger(),a.addText(),a}return e.prototype.prepareGrid=function(){this.level.activeItems.forEach(function(t){t.setItemType(2)}),this.level.activeItems[0].setItemType(1),this.level.activeItems[this.level.activeItems.length-1].setItemType(1)},e.prototype.initAllowedItems=function(){var t=this.level.grid;this.allowedItems=[t.getCellAt(3,1).item,t.getCellAt(2,2).item,t.getCellAt(1,2).item],this.allowedItems.forEach(function(i){i.setItemType(1)})},e.prototype.addFinger=function(){this.finger=new s.Finger(this.game),this.add(this.finger)},e.prototype.addText=function(){this.topPanel=new s.TutorialTopPanel(this.game,this),this.topPanel.x=(s.Config.GAME_WIDTH-this.topPanel.width)*.5},e.prototype.show=function(){var t=this;this.parent.bringToTop(this),this.game.sound.play("tutorial",.5),this.level.pointerEnabled=!1,this.level.gui.topPanel.hideForTutorial(),this.topPanel.show(),this.topPanel.hideSubtitle(),this.level.onFirstComboComplete.addOnce(this.onFirstComboComplete,this),this.level.pointerEnabled=!0,this.game.time.events.add(100,function(){t.showCombineTutorial()})},e.prototype.onInputDown=function(t){switch(this.clicks){case 0:this.game.input.onDown.remove(this.onInputDown,this),this.topPanel.showNextLine(),this.showUndoTutorial(),this.level.gui.boostersPanel.onBoosterSelected.addOnce(this.onUndoComplete,this);break;case 1:this.game.input.onDown.remove(this.onInputDown,this),this.topPanel.showNextLine(),this.level.gui.boostersPanel.getButton(s.BoosterType.REMOVE).stopHighlightForTutorial(),this.level.onFirstBoosterComplete.addOnce(this.onRemoveBoosterComplete,this),this.finger.stopAndHide();break;case 2:this.game.input.onDown.remove(this.onInputDown,this),this.level.gui.topPanel.enableButtons(),this.hide();break;default:this.topPanel.showNextLine();break}this.clicks++},e.prototype.showCombineTutorial=function(){this.fadeOutItems(),this.moveFingerAlongPath()},e.prototype.fadeOutItems=function(){var t=this;this.level.activeItems.forEach(function(i){t.allowedItems.indexOf(i)===-1&&(i.alpha=.33)})},e.prototype.moveFingerAlongPath=function(){var t=this.createPath();this.finger.followPath(t)},e.prototype.createPath=function(){var t=this.level.grid,i=[t.getCellAt(3,1),t.getCellAt(2,2),t.getCellAt(1,2)],o=i.map(function(a){var h=a.parent.toGlobal(a.position).toPhaser();return h.add(s.Finger.OFFSET.x,s.Finger.OFFSET.y),h});return o},e.prototype.onFirstComboComplete=function(){this.fadeInAllItems(),this.level.pointerEnabled=!1,this.finger.stopAndHide(),this.topPanel.showNextLine(),this.game.input.onDown.add(this.onInputDown,this)},e.prototype.fadeInAllItems=function(){for(var t=this.level.activeItems.length,i=0;i<t;i++)this.level.activeItems[i].alpha=1},e.prototype.showUndoTutorial=function(){var t=s.Config.GAME_WIDTH/5,i=2,o=i*t-t*.5+6,a=s.Config.GAME_HEIGHT-88;this.finger.pointAt(o,a),this.game.boosters.boosters.forEach(function(h){h.num=0}),this.game.boosters.getBooster(s.BoosterType.UNDO).num=1,this.level.gui.boostersPanel.updateData(),this.level.gui.boostersPanel.enableInput(),this.level.gui.boostersPanel.getButton(s.BoosterType.UNDO).highlightForTutorial()},e.prototype.onUndoComplete=function(){this.level.gui.boostersPanel.onBoosterSelected.remove(this.onUndoComplete,this),this.level.gui.boostersPanel.getButton(s.BoosterType.UNDO).stopHighlightForTutorial(),this.allowedItems.length=0,this.finger.stopAndHide(),this.level.pointerEnabled=!1,this.topPanel.showNextLine(),this.showRemoveBoosterTutorial()},e.prototype.showRemoveBoosterTutorial=function(){var t=s.Config.GAME_WIDTH/5,i=3,o=i*t-t*.5+6,a=s.Config.GAME_HEIGHT-88*s.Config.ASSETS_SCALE;this.game.boosters.getBooster(s.BoosterType.REMOVE).num=1,this.finger.pointAt(o,a),this.level.gui.boostersPanel.getButton(s.BoosterType.REMOVE).updateData(),this.level.gui.boostersPanel.getButton(s.BoosterType.REMOVE).highlightForTutorial(),this.game.input.onDown.add(this.onInputDown,this)},e.prototype.onRemoveBoosterComplete=function(){this.level.onFirstBoosterComplete.remove(this.onRemoveBoosterComplete,this),this.level.pointerEnabled=!1,this.topPanel.showNextLine(),this.level.gui.topPanel.disableInput(),this.game.input.onDown.add(this.onInputDown,this),this.level.pointerEnabled=!0,this.isComplete=!0},e.prototype.hide=function(){var t=this;this.level.gui.topPanel.showAfterTutorial(),this.game.add.tween(this.topPanel).to({alpha:0},200,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.onHideComplete()})},e.prototype.onHideComplete=function(){this.visible=!1,this.onComplete.dispatch()},e.prototype.resize=function(t){this.topPanel.resize(t)},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.level=null,this.allowedItems=null,this.onComplete.dispose(),this.onComplete=null},e}(Phaser.Group);s.Tutorial=r})(game||(game={}));var game;(function(s){var r=function(){function n(e,t){this._game=e,this.itemsLayer=t,this.initItems()}return n.prototype.initItems=function(){var e=this,t=s.Grid.COLUMNS*s.Grid.ROWS;this.items=_.times(t,function(){return new s.Item(e._game,e.itemsLayer)}),this.itemsLayer.addMultiple(this.items,!0)},n.prototype.getItem=function(e){var t=_.find(this.items,{exists:!1});return t||(""+e,t=new s.Item(this._game),this.items.push(t),this.itemsLayer.add(t)),t.setItemType(e),t.onRemoveFromPool(),t},n.prototype.returnItem=function(e){e.onAddToPool()},n.prototype.doReset=function(){for(var e=this.items.length,t=0;t<e;t++){var i=this.items[t];i.exists&&this.returnItem(i)}},n.prototype.destroy=function(){this._game=null,this.itemsLayer=null,this.items.length=0,this.items=null},n}();s.ItemsPool=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i)||this;return o.addCirles(),o.visible=!1,o.exists=!1,o}return e.prototype.addCirles=function(){this.circles=this.createMultiple(3,"interface","Item_White0000"),this.circles.forEach(function(t){t.anchor.set(.5,.5)})},e.prototype.show=function(t){var i=this;this.item=t,this.visible=!0,this.exists=!0;var o=s.Item.getBackColor(t.itemType);this.circles.forEach(function(a,h){i.game.tweens.removeFrom(a),i.game.tweens.removeFrom(a.scale);var l=100+h*200,u=1.6,c=660;a.tint=o,i.game.add.tween(a.scale).to({x:u,y:u},c,Phaser.Easing.Linear.None,!0,l),i.game.add.tween(a).to({alpha:0},c,Phaser.Easing.Linear.None,!0,l).onComplete.addOnce(i.onTweenComplete,i,0,h)})},e.prototype.onTweenComplete=function(t){t===this.circles.length-1&&(this.visible=!1)},e.prototype.update=function(){this.visible&&this.item&&(this.x=this.item.x,this.y=this.item.y)},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.circles=null,this.item=null},e}(Phaser.Group);s.ItemRippleFX=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t,0,0,"interface","Item_Link0000")||this;return i.anchor.set(.5,.5),i.exists=!1,i.visible=!1,i}return e.prototype.show=function(){this.visible=!0,this.exists=!0,this.game.tweens.removeFrom(this.scale),this.scale.set(0,1),this.game.add.tween(this.scale).to({x:1,y:1},330,Phaser.Easing.Back.Out,!0)},e.prototype.hide=function(){this.exists=!1,this.visible=!1},e}(Phaser.Image);s.ChainLink=r})(game||(game={}));var game;(function(s){var r=function(){function n(e){this.itemRnd=new Phaser.RandomDataGenerator,this.difficulty=e,this.setNewSeed()}return n.prototype.setAllowedItemTypes=function(e){this.allowedItemTypes=e},n.prototype.getNewItemType=function(){var e=this.itemRnd.integerInRange(0,this.allowedItemTypes.length-1);return this.allowedItemTypes[e]},n.prototype.updateAllowedItemTypes=function(e){var t=this.getBestItemType(e),i=this.getWorstItemType(t),o=[];if(t<3)o.push(1,2);else{(t+1)%13===0&&t--;for(var a=i;a<t;a++)o.push(a)}this.setChances(o)},n.prototype.getBestItemType=function(e){return _.maxBy(e,"itemType").itemType},n.prototype.getWorstItemType=function(e){return Math.max(1,e-6)},n.prototype.setChances=function(e){this.allowedItemTypes.length=0;for(var t=e[e.length-1],i=this.getDifficulty(t),o=e.length,a=0;a<e.length;a++){var h=e[a],l=0;o>1?(l=(100-this.allowedItemTypes.length)/o,l=Math.floor(l*i)):l=100-this.allowedItemTypes.length;for(var u=0;u<l;u++)this.allowedItemTypes.push(h);o--}this.allowedItemTypes.length===100},n.prototype.getDifficulty=function(e){return this.difficulty},n.prototype.setNewSeed=function(){var e=[Date.now()];this.itemRnd.sow(e)},n.prototype.getSeed=function(){return this.itemRnd.state()},n.prototype.setSeed=function(e){this.itemRnd.state(e)},n.prototype.destroy=function(){this.itemRnd=null,this.allowedItemTypes=null},n}();s.ItemsGenerator=r})(game||(game={}));var game;(function(s){var r=function(){function n(e,t){this.stack=[],this.foundChain=[],this.game=e,this.grid=t}return n.prototype.hasChains=function(e){return this.getPossibleMove(e)!==null},n.prototype.getPossibleMove=function(e){for(var t=e.length,i=0;i<t;i++){var o=e[i],a=this.getPossibleChain(o);if(a&&a.length>=3)return a}return null},n.prototype.getPossibleChain=function(e){this.stack.length=0,this.stack.push(e),this.foundChain.length=0;for(var t=e.itemType,i=0;this.stack.length>0;){var o=this.stack.pop();if(this.foundChain.push(o),this.foundChain.length>2)return this.foundChain;this.putInStack(o,t,-1,-1),this.putInStack(o,t,-1,0),this.putInStack(o,t,-1,1),this.putInStack(o,t,0,1),this.putInStack(o,t,1,1),this.putInStack(o,t,1,0),this.putInStack(o,t,1,-1),this.putInStack(o,t,0,-1)}return null},n.prototype.putInStack=function(e,t,i,o){var a=this.getItem(e,i,o);a&&this.itemGoodForChain(a,t)&&this.stack.push(a)},n.prototype.getItem=function(e,t,i){var o=e.cell,a=o.row+t,h=o.column+i;if(a>=0&&a<this.grid.rows&&h>=0&&h<this.grid.columns)return this.grid.getCellAt(a,h).item},n.prototype.itemGoodForChain=function(e,t){return e.itemType===t&&this.foundChain.indexOf(e)===-1},n.prototype.destroy=function(){this.game=null,this.grid=null,this.stack=null,this.foundChain=null},n}();s.FindChainStrategy=r})(game||(game={}));var game;(function(s){var r=function(){function n(e,t){this.dropDuration=0,this.game=e,this.grid=t,this.onDropComplete=new Phaser.Signal}return n.prototype.dropItems=function(e){this.items=e,this.dropDuration=0,this.doDrop()},n.prototype.doDrop=function(){var e=this;this.items.sort(this.sortItemsBottomUp);for(var t=0;t<s.Grid.ROWS;t++)this.items.forEach(function(a){var h=e.findBottomFreeCell(a.cell);h&&(a.dropCell=h,a.linkCell(h))});var i=this.items.filter(function(a){return!!a.dropCell}),o=i.length;if(o===0){this.onDropCompleteCallback();return}i.forEach(function(a){a.dropToCell(a.dropCell).onComplete.addOnce(function(){--o===0&&e.onDropCompleteCallback()}),a.dropCell=null})},n.prototype.sortItemsBottomUp=function(e,t){var i=e.cell,o=t.cell;return i.row===o.row?o.column-i.column:o.row-i.row},n.prototype.findBottomFreeCell=function(e){var t=this.grid.getCellAt(e.row+1,e.column);return t&&t.isFree()?t:null},n.prototype.findDropCell=function(e){var t=this.grid.getCellAt(e.row+1,e.column);if(t&&t.isFree())return t;var i=this.grid.getCellAt(e.row,e.column+1),o=this.grid.getCellAt(e.row+1,e.column+1);if(i&&i.isFree()&&o&&o.isFree())return o;var a=this.grid.getCellAt(e.row,e.column-1),h=this.grid.getCellAt(e.row+1,e.column-1);return a&&a.isFree()&&h&&h.isFree()?h:null},n.prototype.onDropCompleteCallback=function(){this.onDropComplete.dispatch()},n.prototype.destroy=function(){this.game=null,this.grid=null,this.items=null,this.onDropComplete.dispose(),this.onDropComplete=null},n}();s.DropStrategy=r})(game||(game={}));var game;(function(s){var r=function(){function n(e,t){this.game=e,this.grid=t,this.dropStrategy=new s.DropStrategy(this.game,this.grid),this.freeCells=[],this.onAddItem=new Phaser.Signal,this.onAlignComplete=new Phaser.Signal}return n.prototype.alignAndRefill=function(e){this.items=e,this.dropItems()},n.prototype.dropItems=function(){this.dropStrategy.onDropComplete.add(this.refillGrid,this),this.dropStrategy.dropItems(this.items)},n.prototype.sortItemsForMoveUp=function(e,t){var i=e.cell,o=t.cell;return i.row===o.row?o.column-i.column:i.row-o.row},n.prototype.refillGrid=function(){var e=this.getCellsToRefill();e.sort(this.sortCellsBottomUp),e.length>0&&this.doRefillGrid(e),this.freeCells.length=0,this.onComplete()},n.prototype.getCellsToRefill=function(){this.freeCells.length=0;for(var e=this.grid.cells,t=e.length,i=0;i<t;i++){var o=e[i];o.isFree()&&this.freeCells.push(o)}return this.freeCells},n.prototype.sortCellsBottomUp=function(e,t){return e.row===t.row?t.column-e.column:t.row-e.row},n.prototype.doRefillGrid=function(e){for(var t=0,i=e.length,o=0;o<i;o++)this.onAddItem.dispatch(e[o],t),t+=33},n.prototype.onComplete=function(){this.onAlignComplete.dispatch()},n.prototype.destroy=function(){this.grid=null,this.items=null,this.freeCells.length=0,this.freeCells=null,this.dropStrategy.destroy(),this.dropStrategy=null},n}();s.ItemsAligner=r})(game||(game={}));var game;(function(s){var r=function(){function n(e,t,i){this.itemType=0,this.row=e,this.column=t,this.itemType=i}return n}();s.CellState=r})(game||(game={}));var game;(function(s){var r=function(){function n(e){this.cellStates=e}return n.fromGrid=function(e){var t=e.cells.map(function(i){var o=i.isFree()?0:i.item.itemType,a=new s.CellState(i.row,i.column,o);return a});return new n(t)},n.fromString=function(e){var t=_.attempt(JSON.parse,e);if(_.isError(t))return t.name,t.message,null;var i=t.map(function(o){return new s.CellState(o.row,o.column,o.itemType)});return new n(i)},n.prototype.toString=function(){var e=this.cellStates.map(function(t){return{row:t.row,column:t.column,itemType:t.itemType}});return JSON.stringify(e)},n.prototype.destroy=function(){this.cellStates=null},n}();s.GridState=r})(game||(game={}));var game;(function(s){var r=function(){function n(e,t,i,o,a,h,l,u){this._coins=e,this.levelStats=t,this.wasGameComplete=i,this.gameOverState=o,this.freeBoosters=a,this.gridState=h,this.boosters=l,this._seed=u}return n.fromString=function(e,t){var i,o=_.attempt(JSON.parse,e);if(_.isError(o))return null;var a=o.coins,h=s.LevelStats.fromString(o.levelStats,t),l=o.wasGameComplete,u=o.gameOverState,c=(i=o.freeBoosters)!==null&&i!==void 0?i:{},d=s.GridState.fromString(o.gridState),f=JSON.parse(o.boosters),p=o.seed;return new n(a,h,l,u,c,d,f,p)},n.prototype.toString=function(){var e={coins:this._coins,levelStats:this.levelStats.toString(),wasGameComplete:this.wasGameComplete,gameOverState:this.gameOverState,freeBoosters:this.freeBoosters,gridState:this.gridState.toString(),boosters:JSON.stringify(this.boosters),seed:this._seed};return JSON.stringify(e)},n.prototype.destroy=function(){this.levelStats=null,this.gridState.destroy(),this.gridState=null,this.boosters=null},Object.defineProperty(n.prototype,"coins",{get:function(){return this._coins},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"seed",{get:function(){return this._seed},enumerable:!1,configurable:!0}),n}();s.SavedGameState=r})(game||(game={}));var game;(function(s){var r=function(){function n(){this.maxSaveNum=3,this.gameStates=[]}return n.prototype.save=function(e){if(this.gameStates.push(e),this.gameStates.length>this.maxSaveNum){var t=this.gameStates.shift();t.destroy(),t=null}},n.prototype.getSave=function(e){e===void 0&&(e=0);var t=e<0?this.gameStates.length+e:e;return t>=0?this.gameStates[t]:null},n.prototype.getEarliestSave=function(){return this.gameStates.length>0?this.gameStates[0]:null},n.prototype.popLatestSave=function(){return this.gameStates.length>0?this.gameStates.pop():null},n.prototype.removeLatestSave=function(){if(this.gameStates.length>0){var e=this.gameStates.pop();e.destroy(),e=null}},n.prototype.savedStatesNum=function(){return this.gameStates.length},n.prototype.clearSavesAfter=function(e){var t=this.gameStates.indexOf(e);if(t>-1){for(var i=this.gameStates.length,o=t;o<i;o++)this.gameStates[o].destroy();this.gameStates.length=t}},n.prototype.clearAllSaves=function(){this.gameStates.forEach(function(e){e.destroy()}),this.gameStates.length=0},n.prototype.destroy=function(){this.clearAllSaves(),this.gameStates=null},n}();s.UndoHandler=r})(game||(game={}));var game;(function(s){var r=function(){function n(e,t,i,o){this.active=!1,this.game=e,this.grid=t,this.itemsLayer=i,this.itemsAligner=o,this.onAddItem=new Phaser.Signal,this.onBoosterComplete=new Phaser.Signal,this.onSave=new Phaser.Signal,this.initCallbacks()}return n.prototype.initCallbacks=function(){this.callbacks={},this.callbacks[s.BoosterType.REMOVE]=this.applyRemoveItem,this.callbacks[s.BoosterType.MAGNET]=this.applyMagnet,this.callbacks[s.BoosterType.SORT]=this.applySort,this.callbacks[s.BoosterType.UPGRADE]=this.applyUpgrade,this.preCallbacks={},this.preCallbacks[s.BoosterType.REMOVE]=this.dummyPrecallback,this.preCallbacks[s.BoosterType.SORT]=this.dummyPrecallback,this.preCallbacks[s.BoosterType.MAGNET]=this.canApplyMagnet,this.preCallbacks[s.BoosterType.UPGRADE]=this.canApplyUpgrade},n.prototype.dummyPrecallback=function(e){return e===void 0&&(e=null),!0},n.prototype.activate=function(e,t){this.active===!1,this.active=!0,this.activeItems=e,this.boosterType=t,this.game.input.onDown.add(this.onInputDown,this),this.startFloatItems()},n.prototype.startFloatItems=function(){var e=this;this.activeItems.sort(this.sortItemsUpBottom).reverse().forEach(function(t,i){var o=Phaser.Math.wrap(i*100,0,400);t.floatTween=e.game.add.tween(t).to({y:"-16"},550,Phaser.Easing.Sinusoidal.InOut,!0,o,-1,!0)})},n.prototype.sortItemsUpBottom=function(e,t){var i=e.cell,o=t.cell;return i.row===o.row?o.column-i.column:i.row-o.row},n.prototype.stopFloatItems=function(){this.activeItems.forEach(function(e){e.floatTween&&(e.floatTween.stop(!1),e.floatTween=null),e.alignToCellCenterSmooth(200)})},n.prototype.onInputDown=function(e){if(this.active===!1)return;var t=this.grid.getCellUnderPoint(e.x,e.y);if(t&&t.item){var i=this.preCallbacks[this.boosterType],o=i.call(this,t.item),a=this.callbacks[this.boosterType];a&&o&&(this.game.raven.addExtraContext({lastBooster:this.boosterType,lastBoosterCell:"[column: "+t.column+", row: "+t.row+"]",lastBoosterItem:t.item.itemType}),this.game.sound.play("pop_2",.5),this.active=!1,this.stopFloatItems(),this.beforeBoosterStart(),a.call(this,t.item))}},n.prototype.beforeBoosterStart=function(){this.onSave.dispatch(),this.game.boosters.getBooster(this.boosterType).num--},n.prototype.applyRemoveItem=function(e){e.parent.bringToTop(e),e.onRemoveBoosterComplete.addOnce(this.onRemoveItemComplete,this),e.applyRemoveBooster()},n.prototype.onRemoveItemComplete=function(e){this.removeItem(e),this.updateGridAfterBooster()},n.prototype.canApplyMagnet=function(e){var t=this,i=this.activeItems.filter(function(a){return a.itemType===e.itemType});if(i.length<3){var o=this.game.boosters.getBooster(s.BoosterType.MAGNET).warning;return this.game.toast.show(o),i.forEach(function(a,h){t.game.add.tween(a.scale).to({x:1.1,y:1.1},100,Phaser.Easing.Sinusoidal.InOut,!0,0,6,!0)}),!1}return!0},n.prototype.applyMagnet=function(e){this.attractItems(e),e.parent.bringToTop(e),e.animateAsMagnet()},n.prototype.attractItems=function(e){var t=this,i=100;_(this.activeItems).without(e).filter({itemType:e.itemType}).forEach(function(o,a){o.parent.bringToTop(o),t.applyMagnetToItem(e,o,i),i+=33}),this.game.time.events.add(i+300,this.onMagnetComplete,this,e)},n.prototype.applyMagnetToItem=function(e,t,i){var o=this;this.game.time.events.add(i,function(){o.game.tweens.removeFrom(t),o.game.add.tween(t).to({x:e.x,y:e.y},350,Phaser.Easing.Back.In,!0).onComplete.addOnce(function(){o.removeItem(t)})},this)},n.prototype.onMagnetComplete=function(e){this.game.audio.playSound("item_convert_2",.25);var t=e.itemType+1,i=e.cell;e.stopMagnetAnimation(),this.removeItem(e),this.onAddItem.dispatch(i,t),this.game.time.events.add(600,this.updateGridAfterBooster,this)},n.prototype.applySort=function(e){this.game.audio.playSound("shuffle",.66),this.shakeGrid(),this.sortItems()},n.prototype.shakeGrid=function(){this.game.add.tween(this.itemsLayer).to({x:"+10"},75,Phaser.Easing.Sinusoidal.InOut,!0,0,5,!0)},n.prototype.sortItems=function(){var e=this;this.activeItems.sort(this.sortItemsByType),this.activeItems.forEach(function(t){t.clearCell()}),this.activeItems.forEach(function(t,i){var o=e.grid.cells[i];t.linkCell(o),t.stopAlignTween(),t.alignToCellCenterInstant(),t.alpha=0,t.y-=20;var a=i*33+100,h=e.game.add.tween(t).to({y:"+20",alpha:1},330,Phaser.Easing.Cubic.Out,!0,a);i===e.activeItems.length-1&&h.onComplete.addOnce(e.onBoosterCompleteCallback,e)})},n.prototype.sortItemsByType=function(e,t){return e.itemType-t.itemType},n.prototype.removeItem=function(e){e.clearCell(),e.onAddToPool(),_.pull(this.activeItems,e)},n.prototype.updateGridAfterBooster=function(){this.itemsAligner.onAlignComplete.addOnce(this.onBoosterCompleteCallback,this),this.itemsAligner.alignAndRefill(this.activeItems)},n.prototype.canApplyUpgrade=function(e){if(e.itemType===12){var t=this.game.boosters.getBooster(s.BoosterType.UPGRADE).warning;return this.game.toast.show(t),this.game.add.tween(e).to({x:"+6"},80,Phaser.Easing.Sinusoidal.InOut,!0,0,3,!0),!1}return!0},n.prototype.applyUpgrade=function(e){var t=this;this.game.sound.play("new_item",.5);var i=33,o=_(this.activeItems).filter({itemType:e.itemType}).sort(this.sortItemsByGridPosition.bind(this)).value();o.forEach(function(h,l){t.game.time.events.add(l*i,h.upgrade,h)});var a=o.length*i+100;this.game.time.events.add(a,this.onBoosterCompleteCallback,this)},n.prototype.sortItemsByGridPosition=function(e,t){var i=e.cell.row*this.grid.columns+e.cell.column,o=t.cell.row*this.grid.columns+t.cell.column;return i-o},n.prototype.onBoosterCompleteCallback=function(){this.active=!1,this.game.input.onDown.remove(this.onInputDown,this),this.itemsAligner.onAlignComplete.remove(this.onBoosterCompleteCallback,this),this.onBoosterComplete.dispatch(this.boosterType)},n.prototype.dispatchNewItemEvent=function(e,t){this.onAddItem.dispatch(e,t)},n.prototype.cancel=function(){this.active=!1,this.game.input.onDown.remove(this.onInputDown,this),this.stopFloatItems()},n.prototype.destroy=function(){this.game.input.onDown.remove(this.onInputDown,this),this.itemsAligner.onAlignComplete.remove(this.onBoosterCompleteCallback,this),this.callbacks=null,this.activeItems=null,this.grid=null,this.game=null,this.itemsAligner=null,this.disposeSignals()},n.prototype.disposeSignals=function(){this.onAddItem.dispose(),this.onAddItem=null,this.onBoosterComplete.dispose(),this.onBoosterComplete=null,this.onSave.dispose(),this.onSave=null},n}();s.BoosterMode=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a){var h=n.call(this,t,i,"panel_stars")||this,l=[.44,.66,1];return h.createMultiple(l.length,o,a,!0),h.children.forEach(function(u,c){u.anchor.set(.5,.5),u.scale.set(l[c])}),h.align(h.numChildren,1,40,70,Phaser.CENTER),h.children[1].x-=5,h}return e.prototype.show=function(t){var i=this;this.children.reverse().forEach(function(o,a){var h=t+a*100,l=330+120*a;i.game.add.tween(o).from({x:o.x-66,alpha:0,angle:-50},l,Phaser.Easing.Cubic.Out,!0,h)})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.PanelStars=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"victory_panel")||this;return o.addBack(),o.addTitle(),o.addStars(),o.bringToTop(o.title),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"interface","Victory_Back0000",this)},e.prototype.addTitle=function(){var t=this.game.texts.texts.victory,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:60,fill:"#ffffff",align:"center"};this.title=this.game.add.text(0,0,t,i,this),this.title.anchor.set(.5,.5),this.title.centerX=this.back.centerX,this.title.centerY=this.back.centerY+3},e.prototype.addStars=function(){var t=26,i="interface",o="Little_Star0000";this.leftStars=new s.PanelStars(this.game,this,i,o),this.leftStars.right=this.title.left-t,this.leftStars.centerY=this.title.centerY,this.rightStars=new s.PanelStars(this.game,this,i,o),this.rightStars.scale.x=-1,this.rightStars.left=this.title.right+t,this.rightStars.centerY=this.title.centerY},e.prototype.show=function(t){this.visible=!0,this.showMain(t),this.showStars(t)},e.prototype.showMain=function(t){var i=40*s.Config.ASSETS_SCALE;this.y-=i,this.alpha=0,this.game.add.tween(this).to({alpha:1},100,Phaser.Easing.Linear.None,!0,t),this.game.add.tween(this).to({y:this.y+i},330,Phaser.Easing.Back.Out,!0,t)},e.prototype.showStars=function(t){var i=t+.1;this.leftStars.show(i),this.rightStars.show(i)},e}(Phaser.Group);s.VictoryTopPanel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"final_item")||this;return o.onAnimationComplete=new Phaser.Signal,o.addImage(),o.addWhite(),o}return e.prototype.addImage=function(){this.image=this.game.add.image(0,0,"interface","Tile0000",this),this.image.anchor.set(.5,.5),this.originalWidth=this.image.width},e.prototype.addWhite=function(){this.white=this.game.add.image(0,0,"interface","Tile_White0000",this),this.white.anchor.set(.5,.5),this.white.visible=!1},e.prototype.saveInitialPosition=function(t,i){this.initialPos=new Phaser.Point(t,i)},e.prototype.show=function(){var t=this,i=116/this.originalWidth;this.visible=!0,this.scale.set(0),this.game.add.tween(this.scale).to({x:i,y:i},400,Phaser.Easing.Back.Out,!0).onComplete.addOnce(function(){t.game.add.tween(t.scale).to({x:.8,y:.8},300,Phaser.Easing.Sinusoidal.InOut,!0,0,2,!0).onComplete.addOnce(function(){t.game.add.tween(t.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,33).onComplete.addOnce(function(){t.show3()})})}),this.showWhite()},e.prototype.showWhite=function(){this.white.visible=!0,this.white.alpha=.1,this.game.add.tween(this.white).to({alpha:.66},100,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(this.hideWhite,this)},e.prototype.hideWhite=function(){var t=this;this.game.add.tween(this.white).to({alpha:0},1500,Phaser.Easing.Cubic.In,!0).onComplete.addOnce(function(){t.white.visible=!1})},e.prototype.show2=function(){var t=this;this.game.add.tween(this).to({angle:-5},100,Phaser.Easing.Sinusoidal.InOut,!0,0,8,!0),this.game.add.tween(this.scale).to({x:1,y:1},1600,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){t.show3()})},e.prototype.show3=function(){var t=this,i=this.position.distance(this.initialPos),o=Phaser.Math.clamp(i,500,1500);this.game.add.tween(this).to({x:this.initialPos.x,y:this.initialPos.y,angle:0},o,Phaser.Easing.Back.InOut,!0).onComplete.addOnce(function(){t.onAnimationComplete.dispatch(t)})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.onAnimationComplete.dispose(),this.onAnimationComplete=null},e}(Phaser.Group);s.FinalItem=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i,"game_complete")||this;return a.levelStats=o,a.onBackFadeInComplete=new Phaser.Signal,a.onHideStarted=new Phaser.Signal,a.onHideComplete=new Phaser.Signal,a.escKey=a.game.input.keyboard.addKey(Phaser.Keyboard.ESC),a.sendGameCompleteEvent(),a.addBackground(),a.addVictoryPanel(),a.addCentralItem(),a.addCrown(),a.addShareButton(),a.addButtons(),a.addWhiteOverlay(),a.bringToTop(a.victoryPanel),a}return e.prototype.sendGameCompleteEvent=function(){},e.prototype.addBackground=function(){this.bg=new s.GameBackground(this.game),this.add(this.bg)},e.prototype.addVictoryPanel=function(){this.victoryPanel=new s.VictoryTopPanel(this.game,this)},e.prototype.addCentralItem=function(){this.centralItemBack=this.game.add.image(0,0,"interface","Cental_Item_Back0000",this),this.centralItemBack.anchor.set(.5,.5),this.centralItemBack.alpha=.8,this.centralItem=new s.FinalItem(this.game,this)},e.prototype.addCrown=function(){this.crown=this.game.add.image(0,0,"interface","Crown0000",this),this.crown.anchor.set(.5,1)},e.prototype.addShareButton=function(){this.shareButton=new s.SimpleButton(this.game,0,0,"interface","Button_Share0000",this),this.shareButton.events.onInputUp.add(this.onShareButtonClick,this)},e.prototype.onShareButtonClick=function(){var t=this.game.store.getNumber(s.GameStoreKey.BEST_ITEM),i=this.game.texts.texts.share_highscore.replace("#",t.toString());this.game.share.share(i).catch(function(o){})},e.prototype.getShareImage=function(){var t=this.game.make.image(0,0,"main_menu","Item_130000"),i=this.game.make.bitmapData(t.width,t.height).drawFull(t).canvas.toDataURL();return i},e.prototype.addButtons=function(){var t,i=this,o=["Button_Rate0000","Button_Continue0000","Button_Home0000"];this.bottomButtons=o.map(function(a){return new s.SimpleButton(i.game,0,0,"interface",a,i)}),t=this.bottomButtons,this.friendsButton=t[0],this.continueButton=t[1],this.menuButton=t[2],this.friendsButton.callback.add(this.onFriendsButtonClick,this),this.continueButton.callback.addOnce(this.hide,this),this.menuButton.callback.addOnce(this.onMenuButtonClick,this),this.buttonsGroup=this.game.add.group(this,"bottomButtons"),this.buttonsGroup.addMultiple(this.bottomButtons,!0),this.buttonsGroup.align(this.bottomButtons.length,1,150,155,Phaser.CENTER)},e.prototype.onFriendsButtonClick=function(){},e.prototype.onMenuButtonClick=function(){this.game.changeState("BoostersShop")},e.prototype.addWhiteOverlay=function(){this.whiteOverlay=this.game.add.image(0,0,"interface","white_rect0000",this),this.whiteOverlay.visible=!1},e.prototype.show=function(t){this.setVisibility(),this.showBackground(),this.showFinalItem(t)},e.prototype.setVisibility=function(){this.visible=!0,this.bg.visible=!1,this.victoryPanel.visible=!1,this.centralItemBack.visible=!1,this.crown.visible=!1,this.shareButton.visible=!1,this.bottomButtons.forEach(function(t){t.visible=!1})},e.prototype.showBackground=function(){var t=this;this.bg.visible=!0,this.bg.alpha=0,this.game.add.tween(this.bg).to({alpha:1},2800,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){t.onBackFadeInComplete.dispatch()})},e.prototype.showFinalItem=function(t){var i=t.parent.toGlobal(t.position);this.centralItem.x=i.x,this.centralItem.y=i.y,this.centralItem.onAnimationComplete.addOnce(this.show2,this),this.centralItem.show()},e.prototype.show2=function(){this.escKey.onDown.addOnce(this.hide,this),this.showCentralItemBack(330),this.showCrown(660),this.showWhiteOverlay(1700),this.victoryPanel.show(2700),this.showButtons(3500),this.game.time.events.add(1e3,this.shakeShareButton,this)},e.prototype.showCentralItemBack=function(t){this.centralItemBack.visible=!0,this.centralItemBack.scale.set(0),this.centralItemBack.angle=-20,this.game.add.tween(this.centralItemBack.scale).to({x:1,y:1},400,Phaser.Easing.Back.Out,!0,t),this.game.add.tween(this.centralItemBack).to({angle:0},1e3,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.showCrown=function(t){var i=50*s.Config.ASSETS_SCALE;this.crown.scale.set(2),this.crown.visible=!0,this.crown.alpha=0,this.crown.y-=i,this.game.add.tween(this.crown).to({alpha:1,y:this.crown.y+i},1500,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.crown.scale).to({x:1,y:1},1500,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.showWhiteOverlay=function(t){var i=this;this.game.time.events.add(t,function(){i.game.sound.play("game_complete_2",.66)},this),this.whiteOverlay.visible=!0,this.whiteOverlay.alpha=0,this.game.add.tween(this.whiteOverlay).to({alpha:1},66,Phaser.Easing.Cubic.Out,!0,t).onComplete.addOnce(function(){i.game.add.tween(i.whiteOverlay).to({alpha:0},1e3,Phaser.Easing.Exponential.In,!0).onComplete.addOnce(function(){i.whiteOverlay.visible=!1})})},e.prototype.showButtons=function(t){var i=this;__spreadArrays([this.shareButton],this.bottomButtons).forEach(function(o,a){o.visible=!0;var h=t+a*100;i.game.add.tween(o.scale).from({x:.5,y:.5},330,Phaser.Easing.Back.Out,!0,h),i.game.add.tween(o).from({y:"+40"},330,Phaser.Easing.Back.Out,!0,h),i.game.add.tween(o).from({alpha:0},150,Phaser.Easing.Cubic.Out,!0,h)})},e.prototype.shakeShareButton=function(){this.game.time.events.loop(4e3,this.doShakeShareButton,this)},e.prototype.doShakeShareButton=function(){var t=this;this.game.tweens.removeFrom(this.shareButton),this.game.tweens.removeFrom(this.shareButton.scale),this.shareButton.scale.set(1),this.game.add.tween(this.shareButton.scale).to({x:1.1,y:1.1},450,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0);var i=3;this.game.add.tween(this.shareButton).to({angle:i},100,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){t.game.add.tween(t.shareButton).to({angle:-i},100,Phaser.Easing.Sinusoidal.InOut,!0,0,3,!0).onComplete.addOnce(function(){t.game.add.tween(t.shareButton).to({angle:0},100,Phaser.Easing.Linear.None,!0)})})},e.prototype.hide=function(t){var i=this;t===void 0&&(t=null),this.escKey.onDown.remove(this.hide,this);var o=this.game.add.tween(this).to({alpha:0},330,Phaser.Easing.Cubic.Out,!0);o.onStart.addOnce(function(){i.onHideStarted.dispatch()}),o.onComplete.addOnce(function(){i.onHideCompleteCallback()})},e.prototype.onHideCompleteCallback=function(){this.onHideComplete.dispatch(),this.visible=!1,this.pendingDestroy=!0},e.prototype.resize=function(){this.bg.resize(),this.resizeWhiteOverlay(),this.victoryPanel.centerX=s.Config.HALF_GAME_WIDTH,this.victoryPanel.top=s.Config.GAME_HEIGHT*.07,this.centralItemBack.x=s.Config.HALF_GAME_WIDTH,this.centralItemBack.y=s.Config.GAME_HEIGHT*.48,this.centralItem.x=s.Config.HALF_GAME_WIDTH,this.centralItem.y=this.centralItemBack.y+4*s.Config.ASSETS_SCALE,this.centralItem.saveInitialPosition(this.centralItem.x,this.centralItem.y),this.crown.x=this.centralItem.x,this.crown.y=this.centralItem.top+17,this.shareButton.x=s.Config.HALF_GAME_WIDTH,this.shareButton.y=this.centralItemBack.bottom-10,this.alignBottomButtons()},e.prototype.resizeWhiteOverlay=function(){this.whiteOverlay.width=s.Config.GAME_WIDTH*1.25,this.whiteOverlay.height=s.Config.GAME_HEIGHT*1.25,this.whiteOverlay.centerX=s.Config.HALF_GAME_WIDTH,this.whiteOverlay.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.alignBottomButtons=function(){var t=this.shareButton.bottom,i=s.Config.GAME_HEIGHT,o=i-t;this.buttonsGroup.centerX=s.Config.HALF_GAME_WIDTH,this.buttonsGroup.centerY=t+o/2},e.prototype.destroy=function(){this.game.time.events.removeBy(this.shakeShareButton,this),this.game.time.events.removeBy(this.doShakeShareButton,this),this.escKey.onDown.remove(this.hide,this),this.escKey=null,n.prototype.destroy.call(this,!0,!1),this.disposeSignals()},e.prototype.disposeSignals=function(){this.onBackFadeInComplete.dispose(),this.onBackFadeInComplete=null,this.onHideStarted.dispose(),this.onHideStarted=null,this.onHideComplete.dispose(),this.onHideComplete=null},e}(Phaser.Group);s.GameCompleteScreen=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){i===void 0&&(i="interface"),o===void 0&&(o="white_rect0000");var a=n.call(this,t,0,0,i,o)||this;return a.game.world.add(a),a.tint=16774112,a}return e.prototype.resize=function(){var t=1.25;this.width=game.Config.GAME_WIDTH*t,this.height=game.Config.GAME_HEIGHT*t,this.centerX=game.Config.HALF_GAME_WIDTH,this.centerY=game.Config.HALF_GAME_HEIGHT},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0)},e}(Phaser.Image);s.GameBackground=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.init=function(t){this.loadedGameState=t,this.levelStats=new s.LevelStats(this.game),this.activeItems=[],this.chain=[],this.chainItemType=0,this.lastSelectedItem=null,this.pointerDown=!1,this.pointerEnabled=!1,this.isGameOver=!1,this.isGameComplete=!1,this.boostersUsed=!1,this.isPaused=!1,this.isGameplayStopped=!1,this.game.store.saveValue(s.GameStoreKey.FREE_COINS_DISABLED,!1),this.game.poki.sdk.gameplayStart()},e.prototype.create=function(){this.initItemsProgress(),this.setupLayers(),this.initItemsGenerator(),this.itemsPool=new s.ItemsPool(this.game,this._itemsLayer),this.findPossibleMovesStrategy=new s.FindChainStrategy(this.game,this.grid),this.initUndoHandler(),this.initItemsAligner(),this.initBoosterMode(),this.fillGridFirstTime(),this.addTutorial(),this.addHeadstartPopup(),this.addKeyboardCallbacks(),this.addPointerCallbacks(),this.resize(),this.loadGameState(),!this.tutorial&&!this.gui.headstartPopup&&!this.isGameOver&&(this.pointerEnabled=!0,this.show())},e.prototype.loadGameState=function(){if(!this.loadedGameState)return;this.clearActiveItems(),this.isGameComplete=this.loadedGameState.wasGameComplete,this.itemsProgress[this.loadedGameState.levelStats.currentBestItemType-1]=!0,this.restore(this.loadedGameState),this.game.boosters.loadFromSave(this.loadedGameState.boosters,!1),this.gui.gameOver.loadState(this.loadedGameState.gameOverState),this.gui.freeBoostersPopover.loadState(this.loadedGameState.freeBoosters),this.gui.boostersPanel.updateData();var t=!this.findPossibleMovesStrategy.hasChains(this.activeItems);t&&this.onGameOver(100),this.loadedGameState},e.prototype.testGameOver=function(t){var i=this;this.game.time.events.add(t,function(){i.onGameOver(0)},this)},e.prototype.testGameComplete=function(t){this.game.time.events.add(t,this.onGameComplete,this,this.game.rnd.pick(this.activeItems))},e.prototype.initItemsProgress=function(){this.itemsProgress=[],this.itemsProgress[0]=!0,this.itemsProgress[1]=!0},e.prototype.setupLayers=function(){this.addBackground(),this.addGrid(),this.addItemsLayer(),this.addChainLinks(),this.addItemsTopLayer(),this.addGUI(),this.addEffects()},e.prototype.addBackground=function(){this.background=new s.GameBackground(this.game),this.world.add(this.background)},e.prototype.addGrid=function(){this.grid=new s.Grid(this.game,this.world,s.Grid.ROWS,s.Grid.COLUMNS)},e.prototype.addItemsLayer=function(){this._itemsLayer=this.game.add.group(this.world,"items")},e.prototype.addChainLinks=function(){var t=this,i=this.grid.cells.length-1;this.chainLinks=_.times(i,function(o){return new s.ChainLink(t.game)}),this._itemsLayer.addMultiple(this.chainLinks,!0)},e.prototype.addItemsTopLayer=function(){this._itemsTopLayer=this.game.add.group(this.world,"items_top")},e.prototype.addEffects=function(){this.itemRippleFX=new s.ItemRippleFX(this.game,this._itemsLayer)},e.prototype.addGUI=function(){this.gui=new s.LevelGUI(this.game,this.world,this),this.gui.pauseButton.callback.add(this.pause,this),this.gui.pauseScreen.resumeButton.callback.add(this.onResumeButtonClick,this),this.gui.onBoosterSelected.add(this.onBoosterSelected,this),this.gui.onBoosterCancelled.add(this.onBoosterCancelled,this),this.gui.onUndoSelected.add(this.undoLastAction,this),this.gui.gameOver.onUndo.add(this.undoLastMoves,this),this.gui.gameOver.onShuffle.add(this.shuffleItems,this),this.gui.gameOver.endGameButton.callback.addOnce(this.onEndButtonClick,this)},e.prototype.onEndButtonClick=function(){this.endGame()},e.prototype.onResumeButtonClick=function(){var t=this;this.game.poki.commercialBreak("Gameplay:Resume").finally(function(){t.game.poki.sdk.gameplayStart(),t.resume()})},e.prototype.pause=function(){var t=this;this.isPaused=!0,this.pointerEnabled=!1,this.pointerDown=!1,this.game.tweens.removeFrom(this._itemsLayer),this.game.add.tween(this._itemsLayer).to({alpha:0},200,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t._itemsLayer.visible=!1}),this.gui.onPause(this.levelStats.moves),this.game.poki.sdk.gameplayStop()},e.prototype.resume=function(){this.isPaused=!1,this.pointerEnabled=!0,this._itemsLayer.visible=!0,this.game.tweens.removeFrom(this._itemsLayer),this.game.add.tween(this._itemsLayer).to({alpha:1},200,Phaser.Easing.Cubic.Out,!0),this.gui.onResume()},e.prototype.gotoBoostersShop=function(){this.game.changeState("BoostersShop")},e.prototype.shuffleItems=function(){var t=this;this.activeItems.sort(function(){return t.game.rnd.sign()}),this.activeItems.forEach(function(i){i.clearCell()}),this.activeItems.forEach(function(i,o){var a=Math.floor(o/s.Grid.COLUMNS),h=o%s.Grid.COLUMNS,l=t.grid.getCellAt(a,h);i.linkCell(l),i.alignToCellCenterInstant()}),this.findPossibleMovesStrategy.getPossibleMove(this.activeItems)===null?this.shuffleItems():(this.pointerEnabled=!0,this.isGameOver=!1,this.gui.onContinueAfterGameOver(),this.onShuffleComplete(),this.saveGameStateInStore())},e.prototype.onShuffleComplete=function(){this.game.sound.play("shuffle",.66),this.updateShuffleAchievement(),this.shakeGrid(),this.activeItems.reverse().forEach(function(t,i){var o=150+i*33;t.showOnGrid(!1,o)})},e.prototype.shakeGrid=function(){this.game.add.tween(this._itemsLayer).to({x:"+12"},80,Phaser.Easing.Sinusoidal.InOut,!0,0,5,!0)},e.prototype.updateShuffleAchievement=function(){var t=this.game.store.getNumber(s.GameStoreKey.SHUFFLE_TIMES)+1;this.game.store.saveValue(s.GameStoreKey.SHUFFLE_TIMES,t)},e.prototype.undoLastMoves=function(){var t=3,i=this.undoHandler.getSave(t*-1);if(i===null&&(i=this.undoHandler.getEarliestSave()),i){this.game.sound.play("restart_1",.75),this.clearActiveItems(),this.levelStats.coins=i.coins,this.gui.coinsLabel.updateContent(this.levelStats.coins,!0),this.restoreBoosters(i.boosters),this.restoreGrid(i.gridState),this.itemsGenerator.setSeed(i.seed),this.undoHandler.clearSavesAfter(i),this.isGameOver=!1,this.pointerEnabled=!0,this.gui.onRestore(),this.gui.onContinueAfterGameOver();var o=this.findPossibleMovesStrategy.getPossibleMove(this.activeItems)!==null;o===!1&&this.shuffleItems()}else{var a=this.game.boosters.getBooster(s.BoosterType.UNDO).warning;this.game.toast.show(a)}},e.prototype.endGame=function(){this.levelStats.onLevelEnd(this.activeItems);var t=this.getBestItemOnGrid();this.updateLeaderboards(t),this.game.changeState("GameOver",{levelStats:this.levelStats,skipStartAnimation:!1})},e.prototype.updateLeaderboards=function(t){},e.prototype.onBoosterSelected=function(t){this.pointerEnabled=!1,this.boosterMode.activate(this.activeItems,t)},e.prototype.onBoosterCancelled=function(){this.boosterMode.cancel(),this.gui.gameOver.visible===!1&&(this.pointerEnabled=!0)},e.prototype.initItemsGenerator=function(){var t=parseFloat(this.game.analytics.getRemoteConfigValue("difficulty","1.33")),i=[1,2];this.itemsGenerator=new s.ItemsGenerator(t),this.itemsGenerator.setAllowedItemTypes(i)},e.prototype.initUndoHandler=function(){this.undoHandler=new s.UndoHandler,this.undoHandler.maxSaveNum=20},e.prototype.initItemsAligner=function(){this.itemsAligner=new s.ItemsAligner(this.game,this.grid),this.itemsAligner.onAddItem.add(this.addItemOnRefill,this)},e.prototype.initBoosterMode=function(){this.boosterMode=new s.BoosterMode(this.game,this.grid,this._itemsLayer,this.itemsAligner),this.boosterMode.onSave.add(this.saveGameState,this),this.boosterMode.onAddItem.add(this.onMagnetApplied,this),this.boosterMode.onBoosterComplete.add(this.onBoosterComplete,this)},e.prototype.onMagnetApplied=function(t,i){var o=this.createAndAddItemToGrid(t,i);o.parent.bringToTop(o),o.onConverted(1.25),this.updateItemsProgress(o),this.isGameComplete===!1&&o.itemType===13&&this.onGameComplete(o),this.upgradeItems(),this.itemsGenerator.updateAllowedItemTypes(this.activeItems)},e.prototype.onBoosterComplete=function(t){this.boostersUsed=!0,this.levelStats.moves++,this.levelStats.updateTime(),this.gui.onBoosterComplete(),this.tutorial&&this.onFirstBoosterComplete&&this.onFirstBoosterComplete.dispatch();var i=this.findPossibleMovesStrategy.getPossibleMove(this.activeItems)!==null,o=!1;i===!1||o?this.onGameOver():this.tutorial||(this.pointerEnabled=!0,this.pointerDown=!1,this.isGameOver=!1)},e.prototype.addItemOnRefill=function(t,i){var o=this.createAndAddItemToGrid(t);o.showOnGrid(!1,i/1e3)},e.prototype.createAndAddItemToGrid=function(t,i){i===void 0&&(i=0);var o=i===0?this.itemsGenerator.getNewItemType():i,a=this.itemsPool.getItem(o);return a.x=t.column*s.Cell.WIDTH+s.Cell.WIDTH*.5,a.y=t.row*s.Cell.HEIGHT+s.Cell.HEIGHT*.5,a.linkCell(t),this.activeItems.push(a),a},e.prototype.fillGridFirstTime=function(){var t=this;this.grid.cells.forEach(function(i){t.createAndAddItemToGrid(i)})},e.prototype.addTutorial=function(){var t=utils.NetUtil.getParamBool("skipTutorial");if(t)return;var i=this.game.store.getBoolean(s.GameStoreKey.TUTORIAL_COMPLETE);if(i)return;this.onFirstComboComplete=new Phaser.Signal,this.onFirstBoosterComplete=new Phaser.Signal,this.tutorial=this.gui.addTutorial(),this.tutorial.onComplete.addOnce(this.onTutorialComplete,this),this.tutorial.show()},e.prototype.onTutorialComplete=function(t){this.game.store.saveValue(s.GameStoreKey.TUTORIAL_COMPLETE,!0),this.tutorial.pendingDestroy=!0,this.tutorial=null,this.pointerEnabled=!0},e.prototype.addHeadstartPopup=function(){if(this.tutorial)return;var t=!!this.loadedGameState,i=this.game.store.getBoolean(s.GameStoreKey.HEADSTART_POPUP_DSIABLED)===!1,o=this.game.store.getNumber(s.GameStoreKey.BEST_ITEM),a=utils.NetUtil.getParamBool("headstartPopup");(t===!1&&i&&o>=6||a)&&(this.gui.addHeadstartPopup(),this.gui.headstartPopup.onHide.addOnce(this.onHeadstartPopupHide,this),this.gui.headstartPopup.onRewardedAdComplete.addOnce(this.onHeadstartPopupVideoComplete,this),this.gui.headstartPopup.show())},e.prototype.onHeadstartPopupHide=function(){this.pointerEnabled=!0},e.prototype.onHeadstartPopupVideoComplete=function(){this.game.time.events.add(160,this.applyHeadstart,this)},e.prototype.applyHeadstart=function(){this.game.sound.play("fforward",.5),this.activeItems.forEach(function(t,i){t.upgrade(t.itemType+3,i*33)})},e.prototype.onPointerDown=function(t){if(this.gui.gameOver.visible&&this.boosterMode.active===!1){var i=this.grid.getBounds(this.world).toPhaser();i.contains(t.worldX,t.worldY)&&(this.game.sound.play("muted_error",.66),this.gui.gameOver.shake(),this.gui.boostersPanel.shakeButtons())}this.pointerEnabled&&(this.pointerDown=!0,this.chain.length=0,this.chainItemType=0,this.lastSelectedItem=null)},e.prototype.onPointerUp=function(t){if(!(this.pointerEnabled&&this.pointerDown))return;if(this.pointerDown=!1,this.hideAllChainLinks(),this.fadeInAllItems(),this.chain.length<=2){this.unhighlightChainItems();return}this.pointerEnabled=!1,this.saveGameState(),this.collectItems(),this.gui.topPanel.disableButtons(),this.gui.boostersPanel.disableInput()},e.prototype.hideAllChainLinks=function(){this.chainLinks.forEach(function(t){t.hide()})},e.prototype.fadeOutSomeItems=function(t){if(this.tutorial)return;for(var i=this.activeItems.length,o=0;o<i;o++){var a=this.activeItems[o];a.itemType!==t&&(a.alpha=.33)}},e.prototype.fadeInAllItems=function(){if(this.tutorial)return;for(var t=this.activeItems.length,i=0;i<t;i++)this.activeItems[i].alpha=1},e.prototype.unhighlightChainItems=function(){for(var t=this.chain.length,i=0;i<t;i++)this.chain[i].onDeselected()},e.prototype.collectItems=function(){var t=this,i=this.lastSelectedItem.cell.column,o=this.lastSelectedItem.cell.row;this.lastSelectedItem.onCollectComplete.addOnce(this.onChainCollected.bind(this,this.lastSelectedItem,this.lastSelectedItem.itemType,i,o)),this.chain.forEach(function(a){a.clearCell(),a.collect(t.lastSelectedItem.x,t.lastSelectedItem.y),a.parent.bringToTop(a),t.removeFromActiveItems(a)})},e.prototype.onChainCollected=function(t,i,o,a){this.tutorial&&this.onFirstComboComplete&&this.onFirstComboComplete.dispatch(),this.levelStats.moves++,this.levelStats.updateTime(),this.levelStats.currentBestItemType=this.getBestItemOnGrid(),this.calculateCoins();var h=i+1,l=this.convertChainToNewItem(h,o,a);this.updateHighscore(l),this.upgradeItems(),this.updateSkillAchievements(l);var u=utils.NetUtil.getParamBool("fastGameComplete");this.isGameComplete===!1&&l.itemType===13||u?(l.visible=!1,this.onGameComplete(l),this.game.poki.sdk.happyTime(1)):(this.itemsGenerator.updateAllowedItemTypes(this.activeItems),this.game.time.events.add(200,this.onCollectComplete,this))},e.prototype.updateHighscore=function(t){var i=t.itemType,o=this.game.store.getNumber(s.GameStoreKey.BEST_ITEM);if(i>o&&(this.game.store.saveValue(s.GameStoreKey.BEST_ITEM,i),this.updateLeaderboards(i),t.itemType>2)){this.gui.showHighscoreToast(t);var a=Math.min(.7,i/10-.2);this.game.poki.sdk.happyTime(a)}},e.prototype.onGameComplete=function(t){this.game.sound.play("game_complete_1"),this.isGameComplete=!0,this.gui.topPanel.disableInput(),this.gui.boostersPanel.disableInput(),this.levelStats.onLevelEnd(this.activeItems),this.saveGameStateInStore(),this.gameCompleteScreen=new s.GameCompleteScreen(this.game,this.world,this.levelStats),this.gameCompleteScreen.onBackFadeInComplete.addOnce(this.hideOnGameComplete,this),this.gameCompleteScreen.onHideStarted.addOnce(this.showAfterGameComplete,this),this.gameCompleteScreen.onHideComplete.addOnce(this.onGameCompleteHide,this),this.gameCompleteScreen.resize(),this.gameCompleteScreen.show(t)},e.prototype.hideOnGameComplete=function(){[this._itemsLayer,this._itemsTopLayer,this.gui].forEach(function(t){t.visible=!1})},e.prototype.showAfterGameComplete=function(){[this._itemsLayer,this._itemsTopLayer,this.gui].forEach(function(t){t.visible=!0}),this.activeItems.forEach(function(t){t.visible=!0})},e.prototype.onGameCompleteHide=function(){this.itemsGenerator.updateAllowedItemTypes(this.activeItems),this.onCollectComplete()},e.prototype.removeFromActiveItems=function(t){_.pull(this.activeItems,t)},e.prototype.calculateCoins=function(){var t=this.chainItemType,i=this.chain.length*t;this.levelStats.coins+=i,this.game.store.changeCoins(i),this.gui.coinsLabel.updateContent(this.game.store.getCoins())},e.prototype.convertChainToNewItem=function(t,i,o){var a=this._itemsLayer.toGlobal(this.lastSelectedItem.position),h=this.grid.getCellAt(o,i),l=this.createAndAddItemToGrid(h,t);return l.onConverted(),this.updateItemsProgress(l),l},e.prototype.updateItemsProgress=function(t){var i=this.itemsProgress[t.itemType-1];i?this.game.audio.playSound("item_convert_2",.22):(this.itemsProgress[t.itemType-1]=!0,this.showFadingCircles(t),this.game.audio.playSound("item_convert",.33))},e.prototype.showFadingCircles=function(t){this.itemRippleFX.x=t.x,this.itemRippleFX.y=t.y,this.itemRippleFX.show(t)},e.prototype.upgradeItems=function(){for(var t=this.itemsGenerator.getBestItemType(this.activeItems),i=this.itemsGenerator.getWorstItemType(t),o=this.activeItems.length,a=0;a<o;a++){var h=this.activeItems[a];h.itemType<i&&h.upgrade()}},e.prototype.updateSkillAchievements=function(t){var i=t.itemType},e.prototype.onCollectComplete=function(){this.itemsAligner.onAlignComplete.addOnce(this.saveGameStateInStore,this),this.itemsAligner.onAlignComplete.addOnce(this.checkGameOver,this),this.itemsAligner.alignAndRefill(this.activeItems)},e.prototype.checkGameOver=function(){var t=this.findPossibleMovesStrategy.getPossibleMove(this.activeItems)!==null,i=!1;t===!1||i?this.onGameOver():this.tutorial||(this.pointerEnabled=!0,this.gui.topPanel.enableButtons(),this.gui.topPanel.enableInput(),this.gui.boostersPanel.enableInput())},e.prototype.saveGameStateInStore=function(){var t=this.createSavedGameState();this.game.store.saveValue(s.GameStoreKey.SAVED_GAME_STATE,t.toString())},e.prototype.undoLastAction=function(){if(this.undoHandler.savedStatesNum()>0){this.boostersUsed=!0,this.game.sound.play("restart_1",.75),this.game.boosters.getBooster(s.BoosterType.UNDO).num-=1,this.gui.boostersPanel.updateData(),this.clearActiveItems(),this.hideAllChainLinks(),this.clearChain(),this.pointerDown=!1,this.pointerEnabled=!0;var t=this.undoHandler.popLatestSave();t&&(this.restore(t),t.destroy(),t=null),this.gui.onRestore()}else{var i=this.game.boosters.getBooster(s.BoosterType.UNDO).warning;this.game.toast.show(i),this.gui.boostersPanel.getButton(s.BoosterType.UNDO).shakeIcon()}},e.prototype.clearActiveItems=function(){for(var t=this.activeItems.length,i=0;i<t;i++)this.activeItems[i].removeFromGrid();this.activeItems.length=0},e.prototype.clearChain=function(){this.chain.length=0,this.chainItemType=0,this.lastSelectedItem=null},e.prototype.saveGameState=function(){var t=this.createSavedGameState();this.undoHandler.save(t)},e.prototype.createSavedGameState=function(){return new s.SavedGameState(this.game.store.getCoins(),this.levelStats.clone(),this.isGameComplete,this.gui.gameOver.getSaveState(),this.gui.freeBoostersPopover.getSaveState(),s.GridState.fromGrid(this.grid),this.game.boosters.createSave(),this.itemsGenerator.getSeed())},e.prototype.restore=function(t){this.game.store.saveValue(s.GameStoreKey.COINS,t.coins),this.levelStats=t.levelStats,this.gui.coinsLabel.updateContent(t.coins,!0),this.restoreBoosters(t.boosters),this.restoreGrid(t.gridState),this.itemsGenerator.setSeed(t.seed)},e.prototype.restoreBoosters=function(t){this.game.boosters.loadFromSave(t)},e.prototype.restoreGrid=function(t){var i=this;t.cellStates.forEach(function(o){var a=i.grid.getCellAt(o.row,o.column),h=o.itemType;h>0&&i.createAndAddItemToGrid(a,h)})},e.prototype.update=function(){this.selectItems()},e.prototype.selectItems=function(){if(!this.pointerEnabled||!this.pointerDown||!this._itemsLayer.visible)return;var t=this.game.input.activePointer.position,i=this.getItemUnderPoint(t.x,t.y);if(i){var o=!(this.tutorial&&this.tutorial.allowedItems.indexOf(i)===-1)||this.tutorial&&this.tutorial.isComplete,a=this.chainItemType===0||this.chainItemType===i.itemType,h=this.chain.indexOf(i)>-1,l=this.lastSelectedItem?this.isDistanceFits(this.lastSelectedItem,i):!0;if(a&&h){var u=this.chain.indexOf(i);if(u===this.chain.length-2){this.lastSelectedItem.onDeselected(),this.chain.splice(u+1,1),this.lastSelectedItem=i,this.hideLastUsedChainLink();return}}a&&h===!1&&l&&o&&(this.addItemToChain(i),this.chain.length>1&&this.showNewChainLink())}},e.prototype.getItemUnderPoint=function(t,i){for(var o=this.activeItems.length,a=0;a<o;a++){var h=this.activeItems[a],l=this._itemsLayer.toGlobal(h.position),u=Phaser.Math.distanceSq(l.x,l.y,t,i);if(u<s.Item.RADIUS_SQUARED)return h}return null},e.prototype.isDistanceFits=function(t,i){var o=Phaser.Math.distanceSq(t.x,t.y,i.x,i.y);return o<s.Item.CONTACT_RADIUS_SQUARED},e.prototype.hideLastUsedChainLink=function(){for(var t=this.chainLinks.length;--t>-1;)if(this.chainLinks[t].visible===!0){this.chainLinks[t].hide();return}},e.prototype.addItemToChain=function(t){this.game.audio.playSound("pop_1",.5),t.onSelected(),this.chain.push(t),this.lastSelectedItem=t,this.chain.length===1&&(this.chainItemType=t.itemType,this.fadeOutSomeItems(this.chainItemType))},e.prototype.showNewChainLink=function(){var t=this.getUnusedChainLink();if(t){var i=this.chain.length,o=this.chain[i-1],a=this.chain[i-2],h=o.cell.column*s.Cell.WIDTH+s.Cell.WIDTH*.5,l=o.cell.row*s.Cell.HEIGHT+s.Cell.HEIGHT*.5,u=a.cell.column*s.Cell.WIDTH+s.Cell.WIDTH*.5,c=a.cell.row*s.Cell.HEIGHT+s.Cell.HEIGHT*.5,d=Phaser.Math.linear(h,u,.5),f=Phaser.Math.linear(l,c,.5),p=Phaser.Math.angleBetween(u,c,h,l);t.x=d,t.y=f,t.rotation=p+Math.PI*.5,t.tint=s.Item.getBackColor(this.chainItemType),t.show()}},e.prototype.getUnusedChainLink=function(){return _.find(this.chainLinks,{visible:!1})},e.prototype.onGameOver=function(t){t===void 0&&(t=500),this.pointerEnabled=!1,this.isGameOver=!0,this.game.time.events.add(t,this.gui.onGameOver,this.gui)},e.prototype.continueAfterGameOver=function(){this.gui.onContinueAfterGameOver(),this.grid.visible=!0,this._itemsLayer.visible=!0,this.pointerEnabled=!0},e.prototype.addKeyboardCallbacks=function(){var t=this;this.game.input.keyboard.addKey(Phaser.Keyboard.ESC).onDown.add(this.onEscPressed,this),s.Main.development&&(this.game.input.keyboard.addKey(Phaser.Keyboard.DELETE).onDown.add(this.clearSavedData,this),this.game.input.keyboard.addKey(Phaser.Keyboard.G).onDown.add(function(){t.grid.visible=!t.grid.visible}),this.game.input.keyboard.addKey(Phaser.Keyboard.O).onDown.add(function(){t.onGameOver(100)}),this.game.input.keyboard.addKey(Phaser.Keyboard.C).onDown.add(function(){t.testGameComplete(100)}),this.game.input.keyboard.addKey(Phaser.Keyboard.BACKSPACE).onDown.add(this.refillGrid,this),this.game.input.keyboard.addKey(Phaser.Keyboard.R).onDown.add(this.restartState,this),this.game.input.keyboard.addKey(Phaser.Keyboard.D).onDown.add(this.logDisplayList,this),this.game.input.keyboard.addKey(Phaser.Keyboard.EQUALS).onDown.add(this.testUpgradeItems,this))},e.prototype.clearSavedData=function(){var t=window.confirm("Clear saved data?");t&&(this.game.store.clear(),this.game.changeState("Level"))},e.prototype.onEscPressed=function(){if(this.gui.headstartPopup&&this.gui.headstartPopup.visible){this.gui.headstartPopup.hide();return}if(this.gui.freeBoostersPopover.visible){this.gui.hideFreeBoostersPopover();return}if(this.boosterMode.active){this.boosterMode.cancel();return}this.gotoBoostersShop()},e.prototype.logDisplayList=function(){this.game.debug.isDisabled===!1&&this.game.debug.graph?this.game.debug.graph():this.game.debug.isDisabled},e.prototype.testUpgradeItems=function(){this.activeItems.forEach(function(t){t.setItemType(t.itemType+1)})},e.prototype.restartState=function(){this.game.changeState("Level")},e.prototype.refillGrid=function(){this.clearActiveItems(),this.fillGridFirstTime();var t=this.findPossibleMovesStrategy.getPossibleMove(this.activeItems);t===null&&this.refillGrid()},e.prototype.addPointerCallbacks=function(){this.game.input.onDown.add(this.onPointerDown,this),this.game.input.onUp.add(this.onPointerUp,this)},e.prototype.removePointerCallbacks=function(){this.game.input.onDown.remove(this.onPointerDown,this),this.game.input.onUp.remove(this.onPointerUp,this)},e.prototype.resize=function(){this.background.resize(),this.gui.initialResize(),this.resizeGrid(),this.resizeItems(),this.gui.finalResize(),this.gameCompleteScreen&&this.gameCompleteScreen.resize()},e.prototype.resizeGrid=function(){var t=this.gui.topPanel.bottom,i=this.gui.boostersPanel.top,o=i-t,a=o*.9;this.grid.scale.set(1),this.grid.height>a&&this.grid.scale.set(a/this.grid.height),this.grid.centerX=s.Config.HALF_GAME_WIDTH,this.grid.centerY=t+o/2},e.prototype.resizeItems=function(){this._itemsLayer.scale=this.grid.scale,this._itemsLayer.x=this.grid.x,this._itemsLayer.y=this.grid.y,this._itemsTopLayer.scale=this.grid.scale,this._itemsTopLayer.x=this.grid.x,this._itemsTopLayer.y=this.grid.y},e.prototype.show=function(){this.gui.show(100),this.game.add.tween(this._itemsLayer).from({y:"-14"},400,Phaser.Easing.Back.Out,!0,300),this.game.add.tween(this._itemsLayer).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,300)},e.prototype.getBestItemOnGrid=function(){this.activeItems=_.compact(this.activeItems);var t=_.maxBy(this.activeItems,"itemType");return t?t.itemType:2},e.prototype.handleBackButton=function(){if(this.gui.headstartPopup&&this.gui.headstartPopup.visible)return;if(this.gui.freeBoostersPopover.visible)return;if(this.gui.pauseScreen.visible)return;if(this.tutorial&&this.tutorial.visible)return;if(this.gui.gameOver.visible){this.game.sound.play("muted_error",.66),this.gui.gameOver.shake(),this.gui.boostersPanel.shakeButtons();return}if(this.gameCompleteScreen&&this.gameCompleteScreen.visible)return;this.pause()},e.prototype.shutdown=function(){this.game.store.saveValue(s.GameStoreKey.SAVED_GAME_STATE,""),this.game.input.onDown.remove(this.onPointerDown,this),this.game.input.onUp.remove(this.onPointerUp,this),this.itemsPool.destroy(),this.itemsGenerator.destroy(),this.findPossibleMovesStrategy.destroy(),this.itemsAligner.destroy(),this.undoHandler.destroy(),this.boosterMode.destroy(),this.loadedGameState&&(this.loadedGameState.destroy(),this.loadedGameState=null),this.disposeSignals(),this.isPaused===!1&&this.game.poki.sdk.gameplayStop()},e.prototype.disposeSignals=function(){this.onFirstBoosterComplete&&(this.onFirstBoosterComplete.dispose(),this.onFirstBoosterComplete=null),this.onFirstComboComplete&&(this.onFirstComboComplete.dispose(),this.onFirstComboComplete=null)},e}(Phaser.State);s.Level=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"game_over_top")||this;return o.addBack(),o.addTitle(),o.addRhombuses(),o.bringToTop(o.title),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"game_over","Top_Panel_Back0000",this)},e.prototype.addTitle=function(){var t=this.game.texts.texts.game_over,i={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.BOLD,fontSize:56,fill:"#ffffff",align:"center"};this.title=this.game.add.text(0,0,t,i,this),this.title.anchor.set(.5,.5)},e.prototype.addRhombuses=function(){var t=this.back.height*.5,i=this.back.width*.34,o=20;this.leftRhombs=this.game.add.image(0,0,"game_over","Top_Panel_Rhombuses0000",this),this.leftRhombs.anchor.set(1,.5),this.leftRhombs.x=this.title.left-o,this.leftRhombs.y=t,this.rightRhombs=this.game.add.image(0,0,"game_over","Top_Panel_Rhombuses0000",this),this.rightRhombs.scale.x=-1,this.rightRhombs.left=this.title.right+20,this.rightRhombs.x=Math.round(this.back.width*.5+i),this.rightRhombs.y=t,this.title.width>400&&(this.rightRhombs.kill(),this.leftRhombs.kill())},e.prototype.show=function(t){var i=60*s.Config.ASSETS_SCALE;this.alpha=0,this.y-=i,this.game.add.tween(this).to({y:this.y+i,alpha:1},400,Phaser.Easing.Cubic.Out,!0,t),this.showRhombuses(t)},e.prototype.showRhombuses=function(t){var i=66*s.Config.ASSETS_SCALE,o=660,a=t+200;this.game.add.tween(this.leftRhombs).from({x:this.leftRhombs.x-i,alpha:0},o,Phaser.Easing.Cubic.Out,!0,a),this.game.add.tween(this.rightRhombs).from({x:this.rightRhombs.x+i,alpha:0},o,Phaser.Easing.Cubic.Out,!0,a)},e.prototype.resize=function(){this.back.width=s.Config.GAME_WIDTH,this.title.centerX=this.back.centerX,this.title.centerY=this.back.centerY+2;var t=24;this.leftRhombs.right=this.title.left-t,this.leftRhombs.centerY=this.title.centerY,this.rightRhombs.right=this.title.right+t,this.rightRhombs.centerY=this.title.centerY},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.GameOverTopPanel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a,h,l){var u=n.call(this,t,i,"stat_circle")||this;return u.addCircle(o,a),u.addText(l,h),u}return e.prototype.addInnerCircle=function(){this.innerCircle=this.game.add.image(0,0,"game_over","Circle_Inner0000",this),this.innerCircle.anchor.set(.5,.5),this.innerCircle.alignIn(this.circle,Phaser.CENTER),this.innerCircle.sendToBack()},e.prototype.addCircle=function(t,i){this.circle=this.game.add.image(0,0,t,i,this),this.circle.anchor.set(.5,.5)},e.prototype.addText=function(t,i){var o={font:s.GameFonts.NUNITO_CSS,fontSize:44,fontWeight:s.FontWeight.BOLD,fill:"#"+i.toString(16),align:"center"};this._text=this.game.add.text(0,0,t,o,this),this._text.lineSpacing=-8,this._text.anchor.set(.5,.5),this._text.x=this.circle.centerX,this._text.y=this.circle.centerY},e.prototype.updateText=function(t){this._text.text=t},e.prototype.addIcon=function(t,i){this.icon||(this.icon=this.game.add.image(0,0,t,i,this),this.icon.anchor.set(.5,.5),this.icon.centerX=this.circle.centerX,this.icon.centerY=this.circle.top+3)},e.prototype.getCircleHeight=function(){return this.circle.height},Object.defineProperty(e.prototype,"text",{get:function(){return this._text},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.StatCircle=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a,h,l,u){var c=n.call(this,t,i,o,a,h,l)||this;return c.text.visible=!1,c.addInnerCircle(),c.addItem(u),c}return e.prototype.addItem=function(t){var i=this.game.add.image(0,0,"game_over","Item_Back0000");i.anchor.set(.5,.5),i.tint=s.Item.getBackColor(t);var o=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_BOLD_BMP,t.toString(),42);o.anchor.set(.5,.5),o.tint=s.Item.getTextColor(t),this.item=this.game.add.group(this,"item"),this.item.addMultiple([i,o],!0),this.item.scale.set(1.2),this.item.x=this.circle.centerX,this.item.y=this.circle.centerY},e.prototype.setItemFont=function(t){this.item&&this.item.getAt(1)&&this.item.getAt(1)instanceof Phaser.BitmapText&&(this.item.getAt(1).font=t)},e.prototype.animateIcon=function(){this.game.add.tween(this.icon).to({y:"-10"},330,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.prototype.animateItem=function(){this.game.add.tween(this.item.scale).to({x:1.33,y:1.33},900,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.prototype.addIcon=function(t,i){n.prototype.addIcon.call(this,t,i),this.icon.y-=10*s.Config.ASSETS_SCALE,this.bringToTop(this.item)},e.prototype.destroy=function(){this.game.tweens.removeFrom(this.item.scale),this.icon&&this.game.tweens.removeFrom(this.icon),n.prototype.destroy.call(this)},e}(s.StatCircle);s.BestItemCircle=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a,h,l){var u=n.call(this,t,i,o,a,h,l)||this;return u.coinsNum=0,u}return e.prototype.setCoinsNum=function(t){this.text.setText(t),this.coinsNum=t},e.prototype.updateCoins=function(t,i){i===void 0&&(i=0);var o=1300;this.tweenCoins(t,o,i),this.game.add.tween(this.scale).to({x:.66,y:.66},o,Phaser.Easing.Linear.None,!0,i)},e.prototype.tweenCoins=function(t,i,o){var a=this,h=this.game.add.tween(this).to({coinsNum:t},i,Phaser.Easing.Cubic.Out,!0,o);h.onStart.addOnce(function(){a.game.audio.playSound("score_count_2",.5)}),h.onUpdateCallback(function(){a.coinsNum=Math.round(a.coinsNum),a.text.setText(a.coinsNum)}),h.onComplete.addOnce(function(){a.onCoinsTweenComplete()})},e.prototype.onCoinsTweenComplete=function(){this.text.y=0,this.game.add.tween(this.scale).to({x:this.originalScale.x,y:this.originalScale.y},1e3,Phaser.Easing.Elastic.Out,!0)},e.prototype.destroy=function(){this.game.tweens.removeFrom(this),this.game.tweens.removeFrom(this.scale),n.prototype.destroy.call(this)},e}(s.StatCircle);s.CoinsCircle=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o,a,h,l){var u=n.call(this,t,i,o,a,h,l)||this;return u.addProgressBar(),u.addCropRect(),u}return e.prototype.addProgressBar=function(){this.progressBar=this.game.add.image(0,0,"game_over","Circle_Progress_Bar0000",this),this.progressBar.data.originalHeight=this.progressBar.height,this.progressBar.visible=!1,this.progressBar.sendToBack()},e.prototype.addCropRect=function(){this.progressBar.cropRect=new Phaser.Rectangle(0,0,this.progressBar.width,this.progressBar.height)},e.prototype.setPercent=function(t,i){i===void 0&&(i=!1);var o=this.progressBar.data.originalHeight/100*t;i?this.progressBar.cropRect.y=o:this.game.add.tween(this.progressBar.cropRect).to({y:0},330,Phaser.Easing.Cubic.Out,!0)},e}(s.StatCircle);s.LevelStatCircle=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"game_over","Share_Button_Back0000")||this;return o.bottomOffset=55,o.shareMessage="",o.addHint(),o.addShadow(),o.addWhite(),o}return e.prototype.addShadow=function(){var t=8*s.Config.ASSETS_SCALE;this.shadow=this.game.add.image(0,0,"game_over","Share_Shadow0000",this),this.shadow.centerX=this.back.centerX,this.shadow.bottom=this.back.bottom+t,this.shadow.tint=0,this.shadow.alpha=.08,this.sendToBack(this.shadow)},e.prototype.addWhite=function(){this.white=this.game.add.image(0,0,"game_over","Share_Button_Back0000",this),this.white.visible=!1},e.prototype.addTextContent=function(){},e.prototype.addHint=function(){var t=this.game.texts.texts.share_tap;this.hint=this.game.add.bitmapText(0,0,s.GameFonts.GAME_OVER_BARIOL_BOLD,t,30,this),this.hint.anchor.set(.5,.5),this.hint.centerX=this.back.centerX,this.hint.centerY=this.back.bottom-26},e.prototype.addHashtag=function(){this.hashtag=this.game.add.image(0,0,"game_over","Hashtag0000",this),this.hashtag.anchor.set(.5,.5),this.hashtag.centerX=this.back.centerX,this.hashtag.centerY=this.back.top+194,this.hashtag.alpha=.85,this.hashtag.visible=!1},e.prototype.destroy=function(){n.prototype.destroy.call(this),this._shareBitmapData&&(this._shareBitmapData.destroy(),this._shareBitmapData=null)},e}(s.ComplexButton);s.ShareButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i)||this;return a.itemType=o,a.mainColor=s.Item.getBackColor(o),a.darkColor=s.Item.getTextColor(o),a.addItemBack(),a.addGradient(),a.addCentralPart(),a.addTitle(),a.addItem(),a.addStars(),a.addHashtag(),a.hint.tint=a.mainColor,a}return e.prototype.addItemBack=function(){this.itemBack=this.game.add.image(0,0,"game_over","Item_Share_Back0000",this),this.itemBack.tint=this.darkColor,this.itemBack.centerX=this.back.centerX,this.itemBack.top=this.back.top},e.prototype.addGradient=function(){for(var t=.2,i=1.32,o=4,a=(i-1)/o,h=0;h<o;h++){var l=this.game.add.image(0,0,"game_over","Item_Share_Back_Central0000",this);l.anchor.set(.5,.5),l.scale.x=i,l.centerX=this.itemBack.centerX,l.centerY=this.itemBack.centerY,l.tint=this.mainColor,l.alpha=t,i-=a}},e.prototype.addCentralPart=function(){this.centralPart=this.game.add.image(0,0,"game_over","Item_Share_Back_Central0000",this),this.centralPart.tint=this.mainColor,this.centralPart.anchor.set(.5,.5),this.centralPart.centerX=this.itemBack.centerX,this.centralPart.centerY=this.itemBack.centerY},e.prototype.addTitle=function(){var t="BEAT THIS";this.titleText=this.game.add.bitmapText(0,0,s.GameFonts.GAME_OVER_BARIOL_BOLD,t,35,this),this.titleText.anchor.set(.5,.5),this.titleText.centerX=this.itemBack.centerX,this.titleText.centerY=this.itemBack.top+40},e.prototype.addItem=function(){var t=this.game.add.image(0,6,"game_over","White_Circle0000");t.anchor.set(.5,.5),t.tint=this.darkColor,t.alpha=.4;var i=this.game.add.image(0,0,"game_over","White_Circle0000");i.anchor.set(.5,.5);var o=this.game.add.bitmapText(0,0,s.GameFonts.GAME_OVER_BARIOL_BOLD,this.itemType.toString(),46);o.tint=this.mainColor,o.anchor.set(.5,.5),this.item=this.game.add.group(this,"item"),this.item.addMultiple([t,i,o],!0),this.alignItem()},e.prototype.alignItem=function(){var t=this.titleText.bottom,i=this.itemBack.bottom,o=i-t;this.item.centerX=this.itemBack.centerX,this.item.centerY=t+o/2},e.prototype.addStars=function(){var t=this.game.add.image(0,0,"game_over","Item_Share_Stars0000",this);t.anchor.set(.5,.5),t.x=this.item.centerX,t.y=this.item.centerY-6},e.prototype.animate=function(t){var i=this;this.game.add.tween(this.scale).to({x:this.scale.x*1.1,y:this.scale.y*1.1},500,Phaser.Easing.Sinusoidal.InOut,!0,t,2,!0).onComplete.addOnce(function(){i.game.time.events.add(3e3,i.animate,i)})},e.prototype.showHighscore=function(){this.addHighscore(),this.animateHighscore(),this.hint.visible=!1},e.prototype.addHighscore=function(){var t=this.game.texts.texts.highscore;this.highscoreText=this.game.add.bitmapText(0,0,s.GameFonts.GAME_OVER_BARIOL_BOLD,t,30,this),this.highscoreText.anchor.set(.5,.5),this.highscoreText.centerX=this.itemBack.centerX,this.highscoreText.centerY=this.hint.y,this.highscoreText.tint=this.mainColor},e.prototype.animateHighscore=function(){var t=this;this.highscoreText.alpha=0,this.highscoreText.visible=!0;var i=230;this.game.add.tween(this.highscoreText).to({alpha:1},i,Phaser.Easing.Cubic.Out,!0,200).onComplete.addOnce(function(){t.game.add.tween(t.highscoreText).to({alpha:.6},360,Phaser.Easing.Sinusoidal.InOut,!0,0,2,!0).onComplete.addOnce(function(){t.game.add.tween(t.highscoreText).to({alpha:0},i,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.highscoreText.visible=!1,t.animateHint()})})})},e.prototype.animateHint=function(){var t=this;this.hint.alpha=0,this.hint.visible=!0;var i=230;this.game.add.tween(this.hint).to({alpha:1},i,Phaser.Easing.Cubic.Out,!0,200).onComplete.addOnce(function(){t.game.add.tween(t.hint).to({alpha:.6},360,Phaser.Easing.Sinusoidal.InOut,!0,0,2,!0).onComplete.addOnce(function(){t.game.add.tween(t.hint).to({alpha:0},i,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){t.hint.visible=!1,t.animateHighscore()})})})},e.prototype.destroy=function(){this.highscoreText&&this.game.tweens.removeFrom(this.highscoreText),this.game.tweens.removeFrom(this.hint),this.game.tweens.removeFrom(this),n.prototype.destroy.call(this)},e}(s.ShareButton);s.ItemShareButton=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t,0,0,"game_over","Buy_Label0000")||this;return i.anchor.set(.5,.5),i.visible=!1,i}return e.prototype.show=function(t){var i=this;t===void 0&&(t=0),this.visible=!0,this.alpha=1,this.scale.set(1),this.game.add.tween(this).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.scale).from({x:.8,y:.8},400,Phaser.Easing.Back.Out,!0,t).onComplete.addOnce(function(){i.startShake()})},e.prototype.startShake=function(){var t=this,i=6;this.game.add.tween(this).to({angle:-i},50,Phaser.Easing.Linear.None,!0).onComplete.addOnce(function(){t.doShake()})},e.prototype.doShake=function(){var t=this;this.game.add.tween(this.scale).to({x:1.33,y:1.33},250,Phaser.Easing.Sinusoidal.InOut,!0,0,1,!0),this.game.add.tween(this).to({angle:Math.abs(this.angle)},100,Phaser.Easing.Sinusoidal.InOut,!0,0,3,!0).onComplete.addOnce(function(){t.onShakeComplete()})},e.prototype.onShakeComplete=function(){this.game.add.tween(this).to({angle:0},50,Phaser.Easing.Linear.None,!0),this.delayedCall=this.game.time.events.add(2e3,this.startShake,this)},e.prototype.destroy=function(){this.game.tweens.removeFrom(this),this.game.tweens.removeFrom(this.scale),this.delayedCall&&this.game.time.events.remove(this.delayedCall),n.prototype.destroy.call(this,!0)},e}(Phaser.Image);s.ShopLabel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i){var o=n.call(this,t,i,"rank_label")||this;return o.addBack(),o.addText(),o.alignText(),o.loadPlayerRank(),o}return e.prototype.addBack=function(){this.back=this.game.add.image(0,0,"game_over","Rank_Label0000",this),this.back.anchor.set(.5,.5)},e.prototype.addText=function(){var t="# 1 000 000";this.text=this.game.add.bitmapText(0,0,s.GameFonts.GAME_OVER_BARIOL_BOLD,t,22,this),this.text.anchor.set(.5,.5)},e.prototype.updateRank=function(t){this.text.setText("# "+this.formatNumber(t)),this.alignText()},e.prototype.formatNumber=function(t){return t.toLocaleString().split(",").join(" ")},e.prototype.alignText=function(){var t=this.back.width*.8;this.text.scale.set(1),this.text.width>t&&this.text.scale.set(t/this.text.width),this.text.centerX=this.back.centerX,this.text.centerY=this.back.centerY},e.prototype.loadPlayerRank=function(){var t=this,i=this.game.playfab,o=i.isLoggedIn;o&&i.getPlayerLeaderboardEntry().then(function(a){t.updateRank(a.Position+1),t.show()})},e.prototype.show=function(){this.revive(),this.alpha=0,this.game.add.tween(this).from({alpha:0,y:"+8"},800,Phaser.Easing.Cubic.Out,!0)},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1)},e}(Phaser.Group);s.LeaderboardRankLabel=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){var a=n.call(this,t,i)||this;a.name="double_coins_popup",a.backdrop.name="double_coins_popup_back";var h=a.game.texts.texts.coinsx2_popup_title;a.title.setText(h);var l=a.game.texts.texts.coinsx2_popup_message;return a.mainText.setText(l),a.content.frameName="DoubleCoins_Popup_Content0000",a.alignContent(),a.addCoins(o),a.checkbox.checked=a.game.store.getBoolean(s.GameStoreKey.COINSx2_POPUP_DSIABLED),a.checkbox.onChange.add(a.onCheckboxChanged,a),a.yesButton.callback.addOnce(a.showRewardedVideo.bind(a,"DoubleCoinsPopup")),a}return e.prototype.addCoins=function(t){var i="+"+t,o=this.game.add.bitmapText(0,0,s.GameFonts.BARIOL_BOLD_BMP,i,46,this.window);o.anchor.set(1,.5),o.x=this.content.right-90,o.centerY=this.content.centerY,o.tint=16292146},e.prototype.onCheckboxChanged=function(){this.game.store.saveValue(s.GameStoreKey.COINSx2_POPUP_DSIABLED,this.checkbox.checked)},e}(s.ComplexPopup);s.DoubleCoinsPopup=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(t,i,o){o===void 0&&(o=30);var a=n.call(this,t,i,"video_coins_fx")||this;return a.coinsNum=o,a.onCoinsCollectedSignal=new Phaser.Signal,a.playCoinSoundThrottled=_.throttle(a.playCoinSound.bind(a),50,{trailing:!0}),a.addBackground(),a.addCoins(),a.visible=!1,a.exists=!1,a}return e.prototype.setCoinTexture=function(t,i){this.coins.forEach(function(o){o.loadTexture(t,i)})},e.prototype.playCoinSound=function(){this.exists&&this.game&&this.game.audio.playSound("coin",.33)},e.prototype.addBackground=function(){this.background=this.game.add.image(0,0,"interface","white_rect0000",this),this.background.alpha=.33},e.prototype.addCoins=function(){this.coins=this.createMultiple(this.coinsNum,"interface","CoinsCounter_Coin0000",!0,function(t){t.anchor.set(.5,.5)})},e.prototype.show=function(t,i,o){o===void 0&&(o=0),this.revive(),this.doReset(),this.placeCoins(),this.parent.bringToTop(this),this.showWhite(),this.showCoins(),this.collectCoins(1300,i),this.game.audio.playSound("coins_prize",.66)},e.prototype.doReset=function(){var t=this;this.game.tweens.removeFrom(this),this.coins.forEach(function(i){t.game.tweens.removeFrom(i.scale),i.scale.set(1),i.alpha=1})},e.prototype.placeCoins=function(){var t=this,i=40,o=new Phaser.Rectangle(0,0,0,0);o.copyFrom(s.Config.GAME_BOUNDS),o.inflate(-i,-i),this.coins.forEach(function(a){t.placeCoinRandomly(a,o),a.angle=t.game.rnd.realInRange(-45,45),a.revive()})},e.prototype.placeCoinRandomly=function(t,i){t.centerX=i.randomX,t.centerY=i.randomY},e.prototype.showWhite=function(){this.background.alpha=0,this.game.add.tween(this.background).to({alpha:.77},66,Phaser.Easing.Cubic.Out).to({alpha:0},1500,Phaser.Easing.Cubic.In).start()},e.prototype.showCoins=function(){var t=this,i=s.Config.GAME_CENTER;this.coins.forEach(function(o){var a=0,h=450,l=Phaser.Point.interpolate(i,o.position,.8);t.game.add.tween(o).from({x:l.x,y:l.y},h,Phaser.Easing.Back.Out,!0,a),t.game.add.tween(o).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,a),t.game.add.tween(o).from({angle:"-30"},1800,Phaser.Easing.Cubic.Out,!0,a)})},e.prototype.collectCoins=function(t,i){var o=this;this.game.time.events.add(t,function(){o.coins.forEach(function(a,h){var l=o.game.rnd.realInRange(0,100);o.game.add.tween(a).to({x:i.x,y:i.y,angle:0},800,Phaser.Easing.Back.In,!0,l).onComplete.addOnce(o.onCoinCollected,o,0,a)})},this)},e.prototype.onCoinCollected=function(t){t.visible=!1,this.playCoinSoundThrottled(),this.coins.indexOf(t)===this.coins.length-1&&(this.visible=!1,this.exists=!1,this.onCoinsCollectedSignal.dispatch())},e.prototype.resize=function(){this.background.width=s.Config.GAME_WIDTH*1.2,this.background.height=s.Config.GAME_HEIGHT*1.2,this.background.centerX=s.Config.HALF_GAME_WIDTH,this.background.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0,!1),this.onCoinsCollectedSignal.dispose(),this.onCoinsCollectedSignal=null},e}(Phaser.Group);s.CoinsSpreadFX=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.skipStartAnimation=!1,t}return e.prototype.init=function(t){this.levelStats=t.levelStats,this.skipStartAnimation=t.skipStartAnimation},e.prototype.create=function(){this.updateAchievements(),this.addBackground(),this.addTopPanel(),this.addCircles(),this.addDoubleCoinsButton(),this.addShareButton(),this.addBottomButtons(),this.addShopLabel(),this.addRankLabel(),this.addCoinsFX(),this.addKeyCallbacks(),this.resize(),this.skipStartAnimation===!1&&this.show()},e.prototype.updateAchievements=function(){this.game.store.changeNumericValue(s.GameStoreKey.GAMES_PLAYED,1)},e.prototype.addBackground=function(){this.background=new s.GameBackground(this.game,"game_over","white_rect0000")},e.prototype.addTopPanel=function(){this.topPanel=new s.GameOverTopPanel(this.game,this.world)},e.prototype.addCircles=function(){var t=this.game.store.getCoins();this.coinsCircle=new s.CoinsCircle(this.game,this.world,"game_over","Circle0000",16750592,t.toString()),this.coinsCircle.originalScale=this.coinsCircle.scale.clone(),this.coinsCircle.addIcon("game_over","Icon_Coin0000"),this.coinsCircle.setCoinsNum(t);var i=this.levelStats.bestItemTypeAtEnd;this.bestItemCircle=new s.BestItemCircle(this.game,this.world,"game_over","Circle0000",16750592,i.toString(),i),this.bestItemCircle.scale.set(1.25),this.levelStats.isHighscore&&this.bestItemCircle.addIcon("game_over","Icon_Crown0000");var o=this.getTimeCircleContent();this.timeCircle=new s.StatCircle(this.game,this.world,"game_over","Circle0000",16750592,o),this.timeCircle.addIcon("game_over","Icon_Time0000"),this.circles=[this.coinsCircle,this.bestItemCircle,this.timeCircle]},e.prototype.getTimeCircleContent=function(){var t=Math.floor(this.levelStats.timeInSeconds/60),i=t<10?"0"+t:t.toString(),o=this.levelStats.timeInSeconds%60,a=o<10?"0"+o:o.toString();return i+":"+a},e.prototype.addDoubleCoinsButton=function(){this.doubleCoinsButton=new s.SimpleButton(this.game,0,0,"game_over","Button_Double_Coins0000"),this.doubleCoinsButton.callback.addOnce(this.showRewardedVideo,this,0,"double_coins_button")},e.prototype.showRewardedVideo=function(t){this.game.poki.rewardedBreak("GameOver:DoubleCoinsButton",{onSuccess:this.doubleEarnedCoins.bind(this)})},e.prototype.addShareButton=function(){var t=this.game.texts.texts.share_highscore,i=t.replace("#",this.levelStats.bestItemTypeAtEnd.toString());this.shareButton=new s.ItemShareButton(this.game,this.world,this.levelStats.bestItemTypeAtEnd),this.shareButton.shareMessage=i,this.shareButton.x=s.Config.HALF_GAME_WIDTH,this.shareButton.y=s.Config.GAME_HEIGHT*.59,this.shareButton.back.events.onInputUp.add(this.shareHighscore,this),this.levelStats.isHighscore&&this.shareButton.showHighscore(),this.shareButton.kill()},e.prototype.shareHighscore=function(){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(o){return t=this.game.store.getNumber(s.GameStoreKey.BEST_ITEM),i=this.game.texts.texts.share_highscore.replace("#",t.toString()),this.game.share.share(i).catch(function(a){}),[2]})})},e.prototype.getShareImage=function(){var t=this.game.make.image(0,0,"main_menu","Item_130000"),i=this.game.make.bitmapData(t.width,t.height).drawFull(t).canvas.toDataURL();return i},e.prototype.addBottomButtons=function(){var t=146*s.Config.ASSETS_SCALE,i=s.Config.GAME_HEIGHT*.87;this.restartButton=new s.SimpleButton(this.game,0,0,"game_over","Button_Restart0000"),this.restartButton.x=s.Config.HALF_GAME_WIDTH-t,this.restartButton.callback.addOnce(this.onRestartButtonClick,this),this.boostersShopButton=new s.SimpleButton(this.game,0,0,"game_over","Button_Shop0000"),this.boostersShopButton.x=s.Config.HALF_GAME_WIDTH,this.boostersShopButton.callback.addOnce(this.gotoBoostersShop,this),this.leaderboardButton=new s.SimpleButton(this.game,0,0,"game_over","Button_Stats0000"),this.leaderboardButton.x=s.Config.HALF_GAME_WIDTH+t,this.leaderboardButton.callback.add(this.gotoLeaderboards,this),this.buttons=[this.restartButton,this.boostersShopButton,this.leaderboardButton],this.bottomButtons=this.game.add.group(this.world,"bottom_buttons"),this.bottomButtons.addMultiple(this.buttons,!0),this.bottomButtons.align(this.buttons.length,1,146,140,Phaser.CENTER)},e.prototype.onRestartButtonClick=function(){var t=this;this.game.poki.commercialBreak("GameOver:RestartButton").finally(function(){t.gotoLevel()})},e.prototype.gotoLevel=function(){this.game.changeState("Level")},e.prototype.gotoBoostersShop=function(){this.game.changeState("BoostersShop")},e.prototype.gotoLeaderboards=function(){this.game.changeState(s.StateKey.LEADERBOARDS,{lastState:this.key,lastStateData:{levelStats:this.levelStats,skipStartAnimation:!0}})},e.prototype.addShopLabel=function(){var t=48*s.Config.ASSETS_SCALE;this.shopLabel=new s.ShopLabel(this.game),this.shopLabel.x=this.boostersShopButton.x+t,this.shopLabel.y=this.boostersShopButton.y-t,this.bottomButtons.add(this.shopLabel)},e.prototype.addRankLabel=function(){this.rankLabel=new s.LeaderboardRankLabel(this.game,this.bottomButtons),this.rankLabel.centerX=this.leaderboardButton.centerX,this.rankLabel.top=this.leaderboardButton.bottom+4,this.rankLabel.kill()},e.prototype.addCoinsFX=function(){this.coinsSpreadFX=new s.CoinsSpreadFX(this.game,this.world,30)},e.prototype.doubleEarnedCoins=function(){this.doubleCoinsButton&&(this.doubleCoinsButton.visible=!1),this.game.store.changeCoins(this.levelStats.coins),this.shopLabel.visible===!1&&this.game.boosters.canBuyAnyBooster()&&this.shopLabel.show(0),this.showCoinsFX()},e.prototype.showCoinsFX=function(){var t=this,i=new Phaser.Point(s.Config.HALF_GAME_WIDTH,s.Config.HALF_GAME_HEIGHT),o=this.coinsCircle.parent.toGlobal(this.coinsCircle.position).toPhaser();this.coinsSpreadFX.onCoinsCollectedSignal.addOnce(function(){t.coinsCircle.updateCoins(t.game.store.getCoins(),0),t.coinsSpreadFX.pendingDestroy=!0},this),this.coinsSpreadFX.show(i,o)},e.prototype.addKeyCallbacks=function(){this.game.input.keyboard.addKey(Phaser.Keyboard.ESC).onDown.add(this.onEscPressed,this),s.Main.development&&this.game.input.keyboard.addKey(Phaser.Keyboard.R).onDown.add(this.restart,this)},e.prototype.restart=function(){this.game.changeState("GameOver",{levelStats:this.levelStats,skipStartAnimation:!1})},e.prototype.onEscPressed=function(){this.game.changeState("BoostersShop")},e.prototype.resize=function(){this.background.resize(),this.topPanel.resize(),this.topPanel.centerX=s.Config.HALF_GAME_WIDTH,this.topPanel.top=0,this.alignBottomButtons(),this.alignTopCircles(),this.alignBestItemCircle(),this.alignDoubleCoinsButton(),this.alignShareButton(),this.coinsSpreadFX&&this.coinsSpreadFX.resize()},e.prototype.alignBottomButtons=function(){this.bottomButtons.centerX=s.Config.HALF_GAME_WIDTH,this.bottomButtons.centerY=s.Config.GAME_HEIGHT*.88},e.prototype.alignTopCircles=function(){var t=s.Config.GAME_WIDTH*.27,i=s.Config.GAME_HEIGHT*.3;this.coinsCircle.x=s.Config.HALF_GAME_WIDTH-t,this.coinsCircle.centerY=i,this.timeCircle.x=s.Config.HALF_GAME_WIDTH+t,this.timeCircle.centerY=i},e.prototype.alignBestItemCircle=function(){var t=this.timeCircle.bottom,i=this.bottomButtons.top,o=i-t;this.bestItemCircle.x=s.Config.HALF_GAME_WIDTH,this.bestItemCircle.y=t+o/2},e.prototype.alignDoubleCoinsButton=function(){this.doubleCoinsButton.centerX=this.coinsCircle.centerX,this.doubleCoinsButton.centerY=this.coinsCircle.bottom-12},e.prototype.alignShareButton=function(){var t=this.bestItemCircle.bottom,i=this.bottomButtons.top,o=i-t,a=o*.9;this.shareButton.height>a&&this.shareButton.scale.set(a/this.shareButton.height),this.shareButton.x=s.Config.HALF_GAME_WIDTH,this.shareButton.y=t+o/2-6},e.prototype.show=function(){this.topPanel.show(100),this.showCircles(330),this.showShareButton(700),this.showButtons(1100)},e.prototype.showCircles=function(t){var i=this;if(this.circles.forEach(function(a,h){var l=t+h*120;i.game.add.tween(a).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,l),i.game.add.tween(a).from({y:"+40"},750,Phaser.Easing.Cubic.Out,!0,l)}),this.doubleCoinsButton){var o=t+480;this.game.add.tween(this.doubleCoinsButton).from({alpha:0},150,Phaser.Easing.Cubic.Out,!0,o),this.game.add.tween(this.doubleCoinsButton.scale).from({x:.8,y:.8},400,Phaser.Easing.Back.Out,!0,o).onComplete.addOnce(function(){i.animateDoubleCoinsButton()})}},e.prototype.animateDoubleCoinsButton=function(){var t=this;this.doubleCoinsButton&&this.doubleCoinsButton.visible&&this.game.time.events.loop(3e3,function(){t.game.add.tween(t.doubleCoinsButton.scale).to({x:1.1,y:1.1},300,Phaser.Easing.Sinusoidal.InOut,!0,0,2,!0)})},e.prototype.showShareButton=function(t){this.game.add.tween(this.shareButton).from({alpha:0},200,Phaser.Easing.Cubic.Out,!0,t),this.game.add.tween(this.shareButton).from({y:"+40"},750,Phaser.Easing.Cubic.Out,!0,t)},e.prototype.showButtons=function(t){var i=this;this.buttons.forEach(function(o,a){var h=t+a*100;i.game.add.tween(o).from({alpha:0,y:"+20"},300,Phaser.Easing.Cubic.Out,!0,h)}),this.showShopLabel(t+500),this.game.time.events.add(t,this.loadLeaderboardRank,this)},e.prototype.showShopLabel=function(t){this.game.boosters.canBuyAnyBooster()&&this.shopLabel.show(t)},e.prototype.loadLeaderboardRank=function(){this.rankLabel.loadPlayerRank()},e.prototype.shutdown=function(){this.circles=null,this.buttons=null},e}(Phaser.State);s.GameOver=r})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.init=function(){},e.prototype.create=function(){this.addBackground(),this.addImages(),this.resize()},e.prototype.addBackground=function(){this.background=new s.GameBackground(this.game)},e.prototype.addImages=function(){var t=this,i=[{width:10,height:10},{width:100,height:40},{width:200,height:32},{width:400,height:100},{width:600,height:100}],o=i.map(function(a){var h=t.game.add.image(0,0,"interface","white_rect0000");return h.width=a.width,h.height=a.height,h.tint=s.LevelGUI.NORMAL_COLOR,h.smoothed=!1,h});this.container=this.game.add.group(),this.container.addMultiple(o,!0),this.container.align(1,o.length,s.Config.GAME_WIDTH,120,Phaser.LEFT_CENTER)},e.prototype.resize=function(){this.background.resize(),this.container.centerX=s.Config.HALF_GAME_WIDTH,this.container.centerY=s.Config.HALF_GAME_HEIGHT},e.prototype.shutdown=function(){},e}(Phaser.State);s.TestState=r})(game||(game={}));var game;(function(s){var r=function(){function n(){}return n.getAllTypes=function(){return Object.keys(s.BoosterType).map(function(e){return s.BoosterType[e]})},n.fromString=function(e){var t=_.entries(s.BoosterType),i=_.find(t,function(o){return o[1]===e});return i?s.BoosterType[i[0]]:null},n}();s.BoosterTypeUtil=r})(game||(game={}));var game;(function(s){var r;(function(n){n.UNDO="Undo",n.MAGNET="Magnet",n.SORT="Sort",n.REMOVE="Remove",n.UPGRADE="Upgrade"})(r=s.BoosterType||(s.BoosterType={}))})(game||(game={}));var game;(function(s){var r=function(){function n(e,t){this.game=e,this._type=t,this.onChange=new Phaser.Signal,this.updateTexts(),this.initValuesFromConfig(),this._num=this.game.store.getNumber(this._type),this._price=this.calculatePrice()}return n.prototype.updateTexts=function(){var e=this.game.texts.texts.boosters[this._type.toString()];this._title=e.title,this._description=e.description,this._hint=e.hint,this.warning=e.warning},n.prototype.initValuesFromConfig=function(){var e=this.game.cache.getJSON("boosters")[this._type];this._maxNum=e.max,this.basePrice=e.price},n.prototype.calculatePrice=function(){return this.basePrice},Object.defineProperty(n.prototype,"description",{get:function(){return this._description},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this._title},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"price",{get:function(){return this._price},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"num",{get:function(){return this._num},set:function(e){if(e>=0&&e<=this._maxNum){var t=this._num,i=e;this._num=e,this._price=this.calculatePrice(),this.game.store.saveValue(this._type,e),this.onChange.dispatch(this,t,i)}e>this._maxNum&&""+this._type+this._maxNum+e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hint",{get:function(){return this._hint},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"maxNum",{get:function(){return this._maxNum},enumerable:!1,configurable:!0}),n}();s.Booster=r})(game||(game={}));var game;(function(s){var r=function(){function n(e){this.game=e,this.createBoosters(),this.game.texts.onLanguageChange.add(this.onLanguageChange,this)}return n.prototype.onLanguageChange=function(){this.boosters.forEach(function(e){return e.updateTexts()})},n.prototype.createBoosters=function(){var e=this;this.boosters=s.BoosterTypeUtil.getAllTypes().map(function(t){return new s.Booster(e.game,t)}),this.boosters.forEach(function(t){t.onChange.add(e.onBoosterChange,e)})},n.prototype.onBoosterChange=function(e,t,i){},n.prototype.getBooster=function(e){return _.find(this.boosters,{type:e})},n.prototype.createSave=function(){var e={};return this.boosters.forEach(function(t){e[t.type]=t.num}),e},n.prototype.loadFromSave=function(e,t){var i=this;t===void 0&&(t=!0),Object.keys(e).forEach(function(o){var a=s.BoosterTypeUtil.fromString(o),h=i.getBooster(a);if(!h)return;a===s.BoosterType.UNDO?h.num=t?h.num:e[o]:h.num=e[o]})},n.prototype.canBuyAnyBooster=function(){var e=this.game.store.getCoins();return this.boosters.some(function(t){return e>=t.price})},n}();s.BoostersManager=r})(game||(game={}));var utils;(function(s){var r=function(){function n(){}return n.extend=function(){var e=Object.keys(n);e.forEach(function(t){t!=="extend"&&n[t]()})},n.extendTimer=function(){Phaser.Timer.prototype.removeBy=function(e,t){var i=this;_(this.events).filter({callback:e,callbackContext:t}).forEach(function(o){i.remove(o)})}},n.extendGameObjectFactory=function(){},n.extendLoader=function(){Phaser.Loader.prototype.bitmapFontFromAtlas=function(e,t,i,o,a,h){var l=this;return this.xml(e+"_data",o),this.onLoadComplete.addOnce(function(){l.game.cache.addBitmapFontFromAtlas(e,t,i,e+"_data","xml",a,h)}),this}},n.extendBitmapText=function(){Phaser.BitmapText.prototype.setTextOld=Phaser.BitmapText.prototype.setText,Phaser.BitmapText.prototype.setText=function(e){return typeof e=="number"&&(e=e.toString()),this.setTextOld(e)}},n.extendText=function(){Phaser.Text.prototype.setTextOld=Phaser.Text.prototype.setText,Phaser.Text.prototype.setText=function(e,t){return typeof e=="number"&&(e=e.toString()),this.setTextOld(e,t)}},n.addWiggleEasing=function(){Phaser.Easing.Wiggle=function(t,i,o){i===void 0&&(i=6.5),o===void 0&&(o=6.5);var a=t*Math.PI*2*i,h=t*Math.PI*2*o;return Math.sin(a)*Math.cos(h)}},n.addLightBackEasing=function(){var e=1;Phaser.Easing.LightBack={In:function(t){var i=1.70158*e;return t*t*((i+1)*t-i)},Out:function(t){var i=1.70158*e;return--t*t*((i+1)*t+i)+1},InOut:function(t){var i=1.70158*1.525*e;return(t*=2)<1?.5*(t*t*((i+1)*t-i)):.5*((t-=2)*t*((i+1)*t+i)+2)}}},n.extendCache=function(){Phaser.Cache.prototype.cloneBitmapFont=function(e,t){if(this.checkBitmapFontKey(t))return""+t,null;var i=this.getBitmapFont(e),o={url:null,data:_.cloneDeep(i.data),font:_.cloneDeep(i.font),base:i.base};return this.game.cache._cache.bitmapFont[t]=o,o}},n}();s.PhaserExtensions=r})(utils||(utils={}));var utils;(function(s){var r=function(){function n(){}return n.extend=function(){PIXI.Rectangle.prototype.toPhaser=function(){return new Phaser.Rectangle(this.x,this.y,this.width,this.height)},PIXI.Point.prototype.toPhaser=function(){return new Phaser.Point(this.x,this.y)},PIXI.DisplayObjectContainer.prototype.bringToTop=function(e){this.setChildIndex(e,this.children.length-1)},Object.defineProperty(PIXI.DisplayObjectContainer.prototype,"numChildren",{get:function(){return this.children.length}})},n}();s.PIXIExtensions=r})(utils||(utils={}));var utils;(function(s){var r=function(){function n(){}return n.extend=function(){var e=Object.keys(n);e.forEach(function(t){t!=="extend"&&n[t]()})},n.numberIsFinite=function(){Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)}},n.numberIsInteger=function(){Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&Number.isFinite(e)&&!(e%1)}},n.nodeRemove=function(){var e=[Element,CharacterData,DocumentType],t=[];e.forEach(function(i){i&&t.push(i.prototype)}),function(i){i.forEach(function(o){if(o.hasOwnProperty("remove"))return;Object.defineProperty(o,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})}(t)},n}();s.Polyfills=r})(utils||(utils={}));var game;(function(s){var r=utils.DrawUtil,n=function(e){__extends(t,e);function t(i,o){var a=e.call(this,i,o,"toast")||this;return a.addBack(),a.addText(),a.resizeBack(500,120),a.game.state.onStateChange.add(a.hide,a),a}return t.prototype.addBack=function(){var i=r.createRectTexture(this.game,200,100);this.back=this.game.add.image(0,0,i,null,this),this.back.anchor.set(.5,.5),this.back.alpha=.8},t.prototype.addText=function(){var i="Toast",o={font:s.GameFonts.DEFAULT,fontWeight:s.FontWeight.NORMAL,fontSize:32,fill:"#ffffff",align:"center"};this.text=this.game.add.text(0,0,i,o,this),this.text.align="center",this.text.wordWrap=!0,this.text.wordWrapWidth=this.back.width*.85,this.text.lineSpacing=-5,this.text.anchor.set(.5,.5)},t.prototype.alignText=function(){var i=this.back.height*.8;this.text.scale.set(1),this.text.height>i&&this.text.scale.set(i/this.text.height),this.text.centerX=this.back.centerX,this.text.centerY=this.back.centerY},t.prototype.resizeBack=function(i,o){this.back.width=i,this.back.height=o,this.text.wordWrapWidth=this.back.width*.85,this.alignText()},t.prototype.updateText=function(i){this.text.setText(i),this.alignText()},t.prototype.show=function(i,o,a){o===void 0&&(o=0),a===void 0&&(a=3e3),this.visible=!0,this.exists=!0,this.updateText(i),this.alpha=1,this.scale.set(1),this.centerX=s.Config.HALF_GAME_WIDTH,this.centerY=s.Config.GAME_HEIGHT*.9,this.game.tweens.removeFrom(this),this.game.tweens.removeFrom(this.scale),this.game.add.tween(this).from({alpha:0,y:"+10"},230,Phaser.Easing.Cubic.Out,!0,o),this.game.time.events.removeBy(this.hide,this),this.game.time.events.add(a,this.hide,this)},t.prototype.hide=function(){var i=this;this.game.time.events.removeBy(this.hide,this),this.game.tweens.removeFrom(this),this.game.add.tween(this).to({alpha:0},150,Phaser.Easing.Cubic.Out,!0).onComplete.addOnce(function(){i.visible=!1,i.exists=!1})},t.prototype.showRewardedVideoWarning=function(){var i=this.game.texts.texts.videos_warning;this.show(i,0,2500)},t.prototype.showShareMessage=function(i){i===void 0&&(i=0);var o=this.game.texts.texts.share_complete;i>0&&(o+="\n"+this.game.texts.texts.coins_reward.replace("#",i.toString())),this.show(o,0,3e3)},t.prototype.showShareWarningMessage=function(){var i="Sharing is not available in your browser";this.show(i,0,2500)},t.prototype.destroy=function(){e.prototype.destroy.call(this,!0,!1)},t}(Phaser.Group);s.Toast=n})(game||(game={}));var game;(function(s){var r=function(){function n(e){this._enabled=!1,this.game=e,this._enabled=typeof Raven!="undefined"&&Raven.isSetup()}return Object.defineProperty(n.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),n.prototype.trackStateChanges=function(){if(this._enabled===!1)return;this.game.state.onStateChange.add(function(e,t){Raven.setTagsContext({game_state_previous:t,game_state_current:e})})},n.prototype.setTagsOnStart=function(){if(this._enabled===!1)return;Raven.setTagsContext({renderer:this.game.getRendererString(),avif:this.game.avif})},n.prototype.trackInputDown=function(){var e=this;if(this._enabled===!1)return;this.game.state.onStateChange.add(function(){e.game.input.onDown.add(e.doTrackInputDown,e)})},n.prototype.doTrackInputDown=function(e){if(e.interactiveCandidates.length>0){var t=e.interactiveCandidates.map(function(i){return i.sprite.name});Raven.setExtraContext({last_click:t.join(", ")})}},n.prototype.saveFacebookTags=function(e,t,i,o){if(this._enabled===!1)return;Raven.setTagsContext({fb_platform:e,fb_locale:t,fb_sdk_version:i}),Raven.setExtraContext({"Supported APIs":o.join(", ")})},n.prototype.addExtraContext=function(e){if(this._enabled===!1)return;Raven.setExtraContext(e)},n.prototype.addTagsContext=function(e){if(this._enabled===!1)return;Raven.setTagsContext(e)},n.prototype.captureException=function(e,t){if(this._enabled===!1)return;Raven.captureException(e,t)},n}();s.RavenWrapper=r})(game||(game={}));var game;(function(s){var r=function(){function n(e){this.savedSoundMute=!1,this.savedMusicMute=!1,this.game=e,this.fixIFrameSoundIssue()}return Object.defineProperty(n.prototype,"musicLoop",{get:function(){return this._musicLoop},enumerable:!1,configurable:!0}),n.prototype.fixIFrameSoundIssue=function(){var e=this;this.game.input.touch.touchEndCallback=function(){e.game.sound.context.state==="suspended"&&e.game.sound.context.resume()}},n.prototype.initMusicLoop=function(e){e===void 0&&(e=!1),this.musicVolume=1,this._musicLoop=this.game.sound.add("main_loop",this.musicVolume,!0,!e),this._musicLoop.mute=this.savedMusicMute,e&&(this._musicLoop.gainNode=this.createMusicLoopNode())},n.prototype.createMusicLoopNode=function(){var e=this.game.sound.context.createGain();return e.gain.setTargetAtTime(0,e.context.currentTime,.1),e.connect(this.game.sound.context.destination),e},n.prototype.loadMute=function(){this.soundMute=this.game.store.getBoolean(s.GameStoreKey.SOUND_MUTED),this.musicMute=this.game.store.getBoolean(s.GameStoreKey.MUSIC_MUTED)},n.prototype.playMusicLoop=function(){return this._musicLoop&&this._musicLoop.isPlaying===!1&&this._musicLoop.play(),this._musicLoop},n.prototype.playSound=function(e,t){return t===void 0&&(t=1),this.game.cache.checkSoundKey(e)?this.game.sound.play(e,t):null},n.prototype.stopSound=function(e){this.game.sound._sounds.forEach(function(t){t.key===e&&t.stop()})},n.prototype.playClickSound=function(e){e===void 0&&(e=1),this.game.cache.checkSoundKey("click")&&this.game.sound.play("click",e)},n.prototype.trackFocusChange=function(){if(this.game.device.desktop)return;this.game.onBlur.add(this.onGameFocusLost,this),this.game.onFocus.add(this.onGameFocus,this)},n.prototype.onGameFocusLost=function(e){this.game.sound.mute=!0,this._musicLoop&&(this._musicLoop.mute=!0)},n.prototype.onGameFocus=function(e){this.game.sound.mute=this.savedSoundMute,this._musicLoop&&(this._musicLoop.mute=this.savedMusicMute)},n.prototype.handleMusicOnStart=function(){if(this.game.sound.touchLocked){var e=this.game.device.iOSVersion>8?"touchend":"touchstart";this.firstTouchListener=this.onFirstTouch.bind(this),this.game.canvas.addEventListener(e,this.firstTouchListener)}else this.playMusicLoop()},n.prototype.onFirstTouch=function(e){this.game.canvas.removeEventListener(e.type,this.firstTouchListener),this.playMusicLoopFirstTime(1500)},n.prototype.playMusicLoopFirstTime=function(e){e===void 0&&(e=1e3),this._musicLoop&&(this._musicLoop.play(null,0,0,!0),this._musicLoop.fadeTo(e,this.musicVolume))},Object.defineProperty(n.prototype,"soundMute",{get:function(){return this.game.sound.mute},set:function(e){this.savedSoundMute=e,this.game.sound.mute=e,this.game.store.saveValue(s.GameStoreKey.SOUND_MUTED,e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"musicMute",{get:function(){return this.savedMusicMute},set:function(e){this.savedMusicMute=e,this.game.store.saveValue(s.GameStoreKey.MUSIC_MUTED,e),this._musicLoop&&(this._musicLoop.mute=e)},enumerable:!1,configurable:!0}),n.prototype.recreateAudioContext=function(){if(this.game.device.iOS===!1)return;if(this.game.sound.usingWebAudio===!1)return;var e=typeof AudioContext!="undefined";if(e===!1)return;this.doRecreateAudioContext()},n.prototype.doRecreateAudioContext=function(){var e,t,i=this.game.sound,o=this.game.store.getBoolean(s.GameStoreKey.SOUND_MUTED),a=i.volume;(e=i.context)===null||e===void 0||e.close(),(t=i.masterGain)===null||t===void 0||t.disconnect(),i.context=new AudioContext,i.masterGain=i.context.createGain(),i.masterGain.connect(i.context.destination),i.masterGain.gain.value=o?0:a,i._sounds.forEach(function(h){var l=h.volume,u=h.mute;h.context=i.context,h.masterGainNode=i.masterGain,h.gainNode=h.context.createGain(),h.connect&&h.gainNode.connect(h.masterGainNode),h.volume=l,h.mute=u})},n.prototype.suspendAudioContext=function(){var e,t;return((e=this.game.sound.context)===null||e===void 0?void 0:e.state)==="running"?(t=this.game.sound.context)===null||t===void 0?void 0:t.suspend():Promise.resolve()},n.prototype.resumeAudioContext=function(){var e,t;return((e=this.game.sound.context)===null||e===void 0?void 0:e.state)==="suspended"?(t=this.game.sound.context)===null||t===void 0?void 0:t.resume():Promise.resolve()},n}();s.GameAudio=r})(game||(game={}));var game;(function(s){var r;(function(e){e[e.NORMAL=400]="NORMAL",e[e.BOLD=700]="BOLD"})(r=s.FontWeight||(s.FontWeight={}));var n=function(){function e(t){this.game=t}return e.NUNITO_CSS="Nunito",e.DEFAULT=e.NUNITO_CSS,e.BARIOL_BOLD_BMP="bariol_bold_bmp",e.BARIOL_REGULAR_BMP="bariol_regular_bmp",e.BOOSTERS_SHOP_BARIOL_BOLD="boosters_shop_bariol_bold",e.GAME_OVER_BARIOL_BOLD="game_over_bariol_bold",e}();s.GameFonts=n})(game||(game={}));var game;(function(s){var r=function(){function n(){}return n.getLanguageTitle=function(e){return this.LANGUAGES_MAP[e]},n.convertLanguageCodeToGameLanguage=function(e){switch(e){case"pt-BR":return"br";case"ja":return"jp";case"uk-UA":case"uk-ua":case"uk":return"ru";default:return e.split("-")[0].toLowerCase()}},n.LANGUAGES_MAP={ru:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",en:"English",fr:"Fran\xE7ais",it:"Italiano",de:"Deutsch",es:"Espa\xF1ol",nl:"Nederlands",no:"Norsk",fi:"Suomi",br:"Brasileiro",pt:"Portugu\xEAs",jp:"\u65E5\u672C\u8A9E",ar:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629",tr:"T\xFCrk\xE7e",se:"Svenska",pl:"Polski"},n}();s.LanguageUtil=r})(game||(game={}));var game;(function(s){var r=function(){function n(e){this.game=e,this.allTexts=this.game.cache.getJSON("texts"),this._allLanguages=Object.keys(this.allTexts),this._language=this.detectLanguage(),this.texts=this.allTexts[this._language],this.onLanguageChange=new Phaser.Signal,""+this._language,this.texts}return Object.defineProperty(n.prototype,"allLanguages",{get:function(){return this._allLanguages},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"language",{get:function(){return this._language},enumerable:!1,configurable:!0}),n.prototype.detectLanguage=function(){return this.getLanguageFromUrlParam()||this.getSavedLanguage()||this.getLanguageFromBrowser()||"en"},n.prototype.getLanguageFromUrlParam=function(){var e=utils.NetUtil.getParam("lang")||utils.NetUtil.getParam("language");return e&&this.isLanguageSupported(e)?e:null},n.prototype.getSavedLanguage=function(){return this.game.store.getValue(s.GameStoreKey.LANGUAGE)},n.prototype.getLanguageFromBrowser=function(){var e=this,t=s.LanguageUtil.convertLanguageCodeToGameLanguage(navigator.language);if(t&&this.isLanguageSupported(t))return t;if(typeof navigator.languages!="undefined"){var i=navigator.languages.map(function(a){return s.LanguageUtil.convertLanguageCodeToGameLanguage(a)}),o=i.find(function(a){return e.isLanguageSupported(a)});if(o)return o}return null},n.prototype.isLanguageSupported=function(e){return this._allLanguages.includes(e)},n.prototype.setLanguage=function(e){return this.isLanguageSupported(e)?(this._language=e,this.texts=this.allTexts[e],this.onLanguageChange.dispatch(e),this._language,!0):(""+e,!1)},n}();s.GameTexts=r})(game||(game={}));var game;(function(s){var r=function(){function n(e){this._isLoggedIn=!1,this.loginResult=null,this.game=e,this.sdk=PlayFabClientSDK,this.leaderboardName=window.game.config.publisher,PlayFab.settings.titleId="A0553"}return Object.defineProperty(n.prototype,"isLoggedIn",{get:function(){return this._isLoggedIn},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"id",{get:function(){var e;return(e=this.loginResult)===null||e===void 0?void 0:e.PlayFabId},enumerable:!1,configurable:!0}),n.prototype.login=function(e){var t=this;return new Promise(function(i,o){PlayFabClientSDK.LoginWithCustomID({CreateAccount:!0,CustomId:e,TitleId:"A0553"},function(a,h){h?o(h):(t._isLoggedIn=!0,t.loginResult=a.data,i(a.data))})})},n.prototype.getTopLeaderboard=function(e){var t=this;return new Promise(function(i,o){t.sdk.GetLeaderboard({MaxResultsCount:e,StartPosition:0,StatisticName:t.leaderboardName},function(a,h){h?o(h):i(a.data.Leaderboard)})})},n.prototype.getAroundPlayerLeaderboard=function(e){var t=this;return new Promise(function(i,o){t.sdk.GetLeaderboardAroundPlayer({PlayFabId:t.id,MaxResultsCount:e,StatisticName:t.leaderboardName},function(a,h){h?o(h):i(a.data.Leaderboard)})})},n.prototype.getPlayerLeaderboardEntry=function(){var e=this;return new Promise(function(t,i){e.sdk.GetLeaderboardAroundPlayer({PlayFabId:e.id,MaxResultsCount:1,StatisticName:e.leaderboardName},function(o,a){a?i(a):t(o.data.Leaderboard[0])})})},n.prototype.getPlayerScore=function(){var e=this;return new Promise(function(t,i){e.sdk.GetPlayerStatistics({StatisticNames:[e.leaderboardName]},function(o,a){a?i(a):t(o.data.Statistics[0])})})},n.prototype.updatePlayerScore=function(e){var t=this;return new Promise(function(i,o){t.sdk.UpdatePlayerStatistics({Statistics:[{StatisticName:t.leaderboardName,Value:e}]},function(a,h){h?o(h):i(a)})})},n.prototype.updatePlayerName=function(e){var t=this;return new Promise(function(i,o){t.sdk.UpdateUserTitleDisplayName({DisplayName:e},function(a,h){h?o(h):i(a.data.DisplayName)})})},n.generatePlayfabId=function(e){return e.uuid().split("-").join("").slice(0,16).toUpperCase()},n.prototype.fillLeaderboard=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(i){return e=this.game.cache.getJSON("leaderboard"),e.slice(50).forEach(function(o,a){setTimeout(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(h){switch(h.label){case 0:return[4,this.login(o.PlayFabId)];case 1:return h.sent(),[4,this.updatePlayerName(o.DisplayName)];case 2:return h.sent(),[4,this.updatePlayerScore(o.StatValue)];case 3:return h.sent(),[2]}})})},a*1e3)}),[2]})})},n}();s.PlayfabWrapper=r})(game||(game={}));var game;(function(s){var r=function(){function n(e){this.isEnabled=!1,this.game=e,this.isEnabled=typeof navigator.share=="function",this.isEnabled&&(this._share=navigator.share.bind(navigator))}return n.prototype.share=function(e,t,i){if(this.isEnabled===!1)return this.game.toast.showShareWarningMessage(),Promise.reject("WebShare API isn't available");var o={url:location.href,title:window.game.config.game_title};return this._share(__assign(__assign({},o),{title:i,text:e,url:t}))},n}();s.WebShare=r})(game||(game={}));var game;(function(s){var r=gameanalytics.EGAAdAction,n=gameanalytics.EGAAdType,e=function(){function i(){}return i.prototype.init=function(){return Promise.resolve()},i.prototype.setDebug=function(o){},i.prototype.gameLoadingStart=function(){},i.prototype.gameLoadingProgress=function(o){},i.prototype.gameLoadingFinished=function(){},i.prototype.gameplayStart=function(){},i.prototype.gameplayStop=function(){},i.prototype.commercialBreak=function(){return Promise.resolve(void 0)},i.prototype.rewardedBreak=function(){return Promise.resolve(void 0)},i.prototype.happyTime=function(o){},i}();s.PokiDummySdk=e;var t=function(){function i(o){this.isEnabled=!1,this.wasMuted=!1,this.isAdBlockEnabled=!1,this.game=o,this.isEnabled=typeof PokiSDK!="undefined",this.sdk=this.isEnabled?PokiSDK:new e,this.sdk.setDebug(utils.NetUtil.getParamBool("pokiDev"))}return i.prototype.init=function(){var o=this;return this.sdk.init().catch(function(){o.isAdBlockEnabled=!0})},i.prototype.commercialBreak=function(o){var a=this,h;return this.isAdBlockEnabled?Promise.reject("AdBlock"):((h=this.game.analytics)===null||h===void 0||h.sendAdEvent(r.Clicked,n.Interstitial,o,"poki"),this.onBreakStart().finally(function(){a.sdk.commercialBreak().then(function(){var l;(l=a.game.analytics)===null||l===void 0||l.sendAdEvent(r.Show,n.Interstitial,o,"poki")}).catch(function(){var l;(l=a.game.analytics)===null||l===void 0||l.sendAdEvent(r.FailedShow,n.Interstitial,o,"poki")}).finally(function(){a.onBreakComplete()})}))},i.prototype.rewardedBreak=function(o,a){var h=this,l;return this.isAdBlockEnabled?(this.game.toast.showRewardedVideoWarning(),Promise.reject("AdBlock")):((l=this.game.analytics)===null||l===void 0||l.sendAdEvent(r.Clicked,n.RewardedVideo,o,"poki"),this.onBreakStart().finally(function(){h.sdk.rewardedBreak().then(function(u){var c,d;u?((c=h.game.analytics)===null||c===void 0||c.sendAdEvent(r.Show,n.RewardedVideo,o,"poki"),a.onSuccess()):((d=h.game.analytics)===null||d===void 0||d.sendAdEvent(r.FailedShow,n.RewardedVideo,o,"poki"),a.onCancel&&a.onCancel())}).catch(function(){var u;a.onFail&&a.onFail(),h.game.toast.showRewardedVideoWarning(),(u=h.game.analytics)===null||u===void 0||u.sendAdEvent(r.FailedShow,n.RewardedVideo,o,"poki")}).finally(function(){h.onBreakComplete()})}))},i.prototype.onBreakStart=function(){return this.wasMuted=this.game.sound.mute,this.game.sound.mute=!0,this.game.canvas.style.pointerEvents="none",this.game.input.keyboard.enabled=!1,this.game.audio.suspendAudioContext()},i.prototype.onBreakComplete=function(){this.game.sound.mute=this.wasMuted,this.game.canvas.style.pointerEvents="auto",this.game.input.keyboard.enabled=!0,this.game.audio.resumeAudioContext()},i.prototype.recreateAudioContext=function(o){var a=this;this.game.time.events.add(o,function(){a.game.audio.recreateAudioContext()})},i}();s.PokiSdkWrapper=t})(game||(game={}));var game;(function(s){var r=gameanalytics.GameAnalytics,n=gameanalytics.EGAProgressionStatus,e=gameanalytics.EGAErrorSeverity,t;(function(o){o.CANVAS="CANVAS",o.WEBGL="WEBGL"})(t=s.RendererType||(s.RendererType={}));var i=function(){function o(a){this.isEnabled=!1;var h=this.disableAnalytics();if(h){this.isEnabled=!1;return}this.game=a,this.isEnabled=!0,this.loadingTimes={},this.setLog(),this.setCustomDimensions(),r.configureBuild(window.game.config.build_version.toString()),r.initialize("c29379c894f89732844718be51e26549","4b19931335469b6791305dad754d3dc1caf03a44"),r.addDesignEvent("Startup")}return o.prototype.disableAnalytics=function(){var a=utils.NetUtil.getParamBool("analytics");return a?!1:s.Main.development||typeof r=="undefined"||this.isRobowhale()},o.prototype.isRobowhale=function(){var a;return(a=location.hostname)===null||a===void 0?void 0:a.includes("robowhale")},o.prototype.setLog=function(){var a=utils.NetUtil.getParamInt("analyticsLog");a===1?r.setEnabledInfoLog(!0):a===2&&r.setEnabledVerboseLog(!0)},o.prototype.setCustomDimensions=function(){r.configureAvailableCustomDimensions01(["poki","yandex","game-distribution"]),r.setCustomDimension01("poki"),r.configureAvailableCustomDimensions02([t.CANVAS,t.WEBGL]),r.setCustomDimension02(this.getRendererType());var a=["chrome","firefox","ie","mobileSafari","opera","safari","silk","trident","other"],h=this.getCurrentBrowser(a);r.configureAvailableCustomDimensions03(a),r.setCustomDimension03(h)},o.prototype.getRendererType=function(){return this.game.renderer instanceof PIXI.CanvasRenderer?t.CANVAS:t.WEBGL},o.prototype.getCurrentBrowser=function(a){var h=this,l=a.find(function(u){return h.game.device[u]===!0});return l!=null?l:"other"},o.prototype.sendLevelStart=function(a){this.sendProgressionEvent(n.Start,a)},o.prototype.sendLevelComplete=function(a,h){this.sendProgressionEvent(n.Complete,a,h)},o.prototype.sendLevelFail=function(a){this.sendProgressionEvent(n.Fail,a)},o.prototype.sendProgressionEvent=function(a,h,l){if(this.isEnabled===!1)return;var u="level_"+_.padStart(h.toString(),3,"0");r.addProgressionEvent(a,u,"","",l)},o.prototype.sendBoosterUseEvent=function(a,h){if(this.isEnabled===!1)return;var l="Level_"+_.padStart(a.toString(),3,"0");r.addDesignEvent(l+":Booster:"+h)},o.prototype.sendAdEvent=function(a,h,l,u){if(this.isEnabled===!1)return;r.addAdEvent(a,h,u,l)},o.prototype.sendRewardedAd=function(a,h,l){if(this.isEnabled===!1)return;r.addDesignEvent("Rewarded_Ad:"+a+":"+h+":"+l)},o.prototype.sendLoadingEvent=function(a,h){if(this.isEnabled===!1)return;if(h==="start"&&(this.loadingTimes[a]=Date.now(),r.addDesignEvent("Loading:"+a+":"+h)),h==="complete"){var l=Date.now()-this.loadingTimes[a],u=Phaser.Math.roundTo(l/1e3,-1);r.addDesignEvent("Loading:"+a+":"+h,u)}},o.prototype.sendDesignEvent=function(a,h){if(this.isEnabled===!1)return;r.addDesignEvent(a,h)},o.prototype.sendErrorEvent=function(a,h){if(h===void 0&&(h=e.Error),this.isEnabled===!1)return;r.addErrorEvent(h,a)},o.prototype.getRemoteConfigValue=function(a,h){return this.isEnabled===!1?h:r.getRemoteConfigsValueAsString(a,h)},o}();s.GameAnalyticsWrapper=i})(game||(game={}));var game;(function(s){var r=function(n){__extends(e,n);function e(){var t=this;return utils.Polyfills.extend(),utils.PIXIExtensions.extend(),utils.PhaserExtensions.extend(),t=n.call(this,{width:s.Config.SOURCE_GAME_WIDTH,height:s.Config.SOURCE_GAME_HEIGHT,renderer:e.getRendererType(),transparent:!1,antialias:!0,enableDebug:utils.NetUtil.getParamBool("debug"),failIfMajorPerformanceCaveat:!0,disableVisibilityChange:!0,clearBeforeRender:!1,parent:document.getElementById("canvas-container")})||this,t.detectDevMode(),t.detectLocalhost(),t.avif=!1,t.webp=!1,t.raven=new s.RavenWrapper(t),t.store=new s.GameStore(t,"Impossible13"),t.fonts=new s.GameFonts(t),t.share=new s.WebShare(t),t.addStates(),t}return e.getRendererType=function(){var t=utils.NetUtil.getParamBool("canvas");return t?Phaser.CANVAS:Phaser.AUTO},e.prototype.detectDevMode=function(){e.development=utils.NetUtil.getParamBool("dev"),e.development},e.prototype.detectLocalhost=function(){var t=["localhost","192.168"];this.isLocalhost=t.some(function(i){return location.hostname.indexOf(i)>-1})},e.prototype.addStates=function(){this.state.add("Boot",s.Boot,!0),this.state.add("Preloader",s.WebPreloader,!1),this.state.add("MainMenu",s.MainMenu,!1),this.state.add("BoostersShop",s.BoostersShop,!1),this.state.add("Level",s.Level,!1),this.state.add("GameOver",s.GameOver,!1),this.state.add(s.StateKey.LEADERBOARDS,s.LeaderboardScreen,!1)},e.prototype.changeState=function(t,i){this.stateTransitionPlugin.changeState(t,i)},e.prototype.getRendererString=function(){return this.renderer?this.renderer.type===Phaser.WEBGL?"webgl":"canvas":"no-renderer"},e.modernDevice=!1,e.development=!1,e}(Phaser.Game);s.Main=r})(game||(game={}));var GameEnvironment;(function(s){s.DEVELOP="develop",s.DEPLOY_WEB="deploy-web"})(GameEnvironment||(GameEnvironment={}));var game;(function(s){function r(){if(window.environment!==GameEnvironment.DEPLOY_WEB)return;var n=utils.NetUtil.getParamBool("sitelock","0");if(n)return;var e=["top","indexOf","aHR0cHM6Ly9wb2tpLmNvbS9zaXRlbG9jaw==","hostname","length","location","LnBva2ktZ2RuLmNvbQ==","href"];(function(i,o){var a=function(h){for(;--h;)i.push(i.shift())};a(++o)})(e,430);var t=function(i,o){i-=0;var a=e[i];return a};(function(){/*for(var o=["bG9jYWxob3N0","LnBva2kuY29t",t("0x0")],a=![],h=window[t("0x7")][t("0x5")],l=0;l<o[t("0x6")];l++){var u=atob(o[l]);if(h[t("0x3")](u,h.length-u.length)!==-1){a=!![];break}}if(!a){var c=t("0x4"),d=atob(c);window.location[t("0x1")]=d,window[t("0x2")][t("0x7")]!==window[t("0x7")]&&(window[t("0x2")][t("0x7")]=window[t("0x7")])}*/})()}s.sitelock=r})(game||(game={})),window.addEventListener("load",function(){game.sitelock(),game.loadErudaConsole(),game.startPhaser()});var game;(function(s){function r(){var l=utils.NetUtil.getParamInt("console");if(l<=0){n();return}e(l)}s.loadErudaConsole=r;function n(){""+window.game.config.build_version,window.game.config.build_time}function e(l){var u=document.getElementsByTagName("body")[0],c=document.createElement("script");c.src="//cdn.jsdelivr.net/npm/eruda",c.type="text/javascript",c.onload=t.bind(this,l),u.appendChild(c)}function t(l){eruda.init({tool:["console","elements","info"]}),n(),l===2&&eruda.show()}function i(){var l=window.environment,u=utils.NetUtil.getParamBool("raven");u||l!==GameEnvironment.DEVELOP?o(l,u):a()}s.startPhaser=i;function o(l,u){var c={environment:l.toString(),release:window.game.config.build_version,captureUnhandledRejections:!1,whitelistUrls:["poki-gdn.com","robowhale.com"],ignoreErrors:["freed script","out of memory","InvalidStateError: Failed to execute 'appendBuffer' on 'SourceBuffer'","EncodingError"],tags:{publisher:window.game.config.publisher}};u&&c.whitelistUrls.push(location.hostname),Raven.config("https://893cb3b443434e15870f088030cff4c4@o122971.ingest.sentry.io/1467242",c).install(),Raven.context(function(){a()})}function a(){window.gameInstance=new s.Main}function h(){var l=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);if(l===!1)return;var u=typeof AudioContext!="undefined";if(!u)return;PhaserGlobal={audioContext:new AudioContext}}})(game||(game={}));
//# sourceMappingURL=game.min.js.map
