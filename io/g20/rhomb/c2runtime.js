// Generated by Construct 3, the game and app creator :: https://www.construct.net
'use strict';var cr=window.cr={};cr.plugins_={};cr.behaviors={};"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(b){return b.__proto__}:function(b){return b.constructor.prototype});
(function(){function b(e,u){this.x=e;this.y=u;cr.seal(this)}function m(e,u,J,M){this.set(e,u,J,M);cr.seal(this)}function w(){this.bly=this.blx=this.bry=this.brx=this.try_=this.trx=this.tly=this.tlx=0;cr.seal(this)}function E(e,u,J,M){e<u?J<M?(B=e<J?e:J,A=u>M?u:M):(B=e<M?e:M,A=u>J?u:J):J<M?(B=u<J?u:J,A=e>M?e:M):(B=u<M?u:M,A=e>J?e:J)}function N(){this.items=this.s=null;this.item_count=0;z&&(this.s=new Set);this.values_cache=[];this.cache_valid=!0;cr.seal(this)}function D(e){P[V++]=e}function f(){this.sum=
this.t=this.y=this.c=0;cr.seal(this)}function a(e,u){e||(e=[0,0,1,0,1,1,0,1]);this.pts_cache=[];this.bboxBottom=this.bboxRight=this.bboxTop=this.bboxLeft=0;this.convexpolys=null;this.enabled="undefined"===typeof u?!0:u;this.set_pts(e);cr.seal(this)}function c(e,u){this.cellwidth=e;this.cellheight=u;this.cells={}}function l(e,u){this.cellwidth=e;this.cellheight=u;this.cells={}}function v(e,u,J){c.prototype.totalCellCount++;if(d.length){var M=d.pop();M.grid=e;M.x=u;M.y=J;return M}return new cr.GridCell(e,
u,J)}function t(e,u,J){this.grid=e;this.x=u;this.y=J;this.objects=new cr.ObjectSet}function y(e,u,J){l.prototype.totalCellCount++;if(k.length){var M=k.pop();M.grid=e;M.x=u;M.y=J;return M}return new cr.RenderCell(e,u,J)}function L(e,u,J){this.grid=e;this.x=u;this.y=J;this.objects=[];this.is_sorted=!0;this.pending_removal=new cr.ObjectSet;this.any_pending_removal=!1}function q(e,u){return e.zindex-u.zindex}cr.logexport=function(e){window.console&&window.console.log&&window.console.log(e)};cr.logerror=
function(e){window.console&&window.console.error&&window.console.error(e)};cr.seal=function(e){return e};cr.freeze=function(e){return e};cr.is_undefined=function(e){return"undefined"===typeof e};cr.is_number=function(e){return"number"===typeof e};cr.is_string=function(e){return"string"===typeof e};cr.isPOT=function(e){return 0<e&&0===(e-1&e)};cr.nextHighestPowerOfTwo=function(e){--e;for(var u=1;32>u;u<<=1)e|=e>>u;return e+1};cr.abs=function(e){return 0>e?-e:e};cr.max=function(e,u){return e>u?e:u};
cr.min=function(e,u){return e<u?e:u};cr.PI=Math.PI;cr.round=function(e){return e+.5|0};cr.floor=function(e){return 0<=e?e|0:(e|0)-1};cr.ceil=function(e){var u=e|0;return u===e?u:u+1};b.prototype.offset=function(e,u){this.x+=e;this.y+=u;return this};b.prototype.mul=function(e,u){this.x*=e;this.y*=u;return this};cr.vector2=b;cr.segments_intersect=function(e,u,J,M,U,W,X,Y){if(e<J){var ea=e;var ha=J}else ea=J,ha=e;if(U<X){var g=U;var p=X}else g=X,p=U;if(ha<g||ea>p)return!1;u<M?(ea=u,ha=M):(ea=M,ha=u);
W<Y?(g=W,p=Y):(g=Y,p=W);if(ha<g||ea>p)return!1;ha=U-e+X-J;ea=W-u+Y-M;e=J-e;u=M-u;U=X-U;W=Y-W;Y=cr.abs(u*U-W*e);return cr.abs(U*ea-W*ha)>Y?!1:cr.abs(e*ea-u*ha)<=Y};m.prototype.set=function(e,u,J,M){this.left=e;this.top=u;this.right=J;this.bottom=M};m.prototype.copy=function(e){this.left=e.left;this.top=e.top;this.right=e.right;this.bottom=e.bottom};m.prototype.width=function(){return this.right-this.left};m.prototype.height=function(){return this.bottom-this.top};m.prototype.offset=function(e,u){this.left+=
e;this.top+=u;this.right+=e;this.bottom+=u;return this};m.prototype.normalize=function(){if(this.left>this.right){var e=this.left;this.left=this.right;this.right=e}this.top>this.bottom&&(e=this.top,this.top=this.bottom,this.bottom=e)};m.prototype.intersects_rect=function(e){return!(e.right<this.left||e.bottom<this.top||e.left>this.right||e.top>this.bottom)};m.prototype.intersects_rect_off=function(e,u,J){return!(e.right+u<this.left||e.bottom+J<this.top||e.left+u>this.right||e.top+J>this.bottom)};
m.prototype.contains_pt=function(e,u){return e>=this.left&&e<=this.right&&u>=this.top&&u<=this.bottom};m.prototype.equals=function(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom};cr.rect=m;w.prototype.set_from_rect=function(e){this.tlx=e.left;this.tly=e.top;this.trx=e.right;this.try_=e.top;this.brx=e.right;this.bry=e.bottom;this.blx=e.left;this.bly=e.bottom};w.prototype.set_from_rotated_rect=function(e,u){if(0===u)this.set_from_rect(e);else{var J=Math.sin(u),
M=Math.cos(u);u=e.left*J;var U=e.top*J,W=e.right*J;J*=e.bottom;var X=e.left*M,Y=e.top*M,ea=e.right*M;e=e.bottom*M;this.tlx=X-U;this.tly=Y+u;this.trx=ea-U;this.try_=Y+W;this.brx=ea-J;this.bry=e+W;this.blx=X-J;this.bly=e+u}};w.prototype.offset=function(e,u){this.tlx+=e;this.tly+=u;this.trx+=e;this.try_+=u;this.brx+=e;this.bry+=u;this.blx+=e;this.bly+=u;return this};var B=0,A=0;w.prototype.bounding_box=function(e){E(this.tlx,this.trx,this.brx,this.blx);e.left=B;e.right=A;E(this.tly,this.try_,this.bry,
this.bly);e.top=B;e.bottom=A};w.prototype.contains_pt=function(e,u){var J=this.tlx,M=this.tly,U=this.trx-J,W=this.try_-M,X=this.brx-J,Y=this.bry-M;e-=J;u-=M;var ea=U*U+W*W,ha=U*X+W*Y;W=U*e+W*u;var g=X*X+Y*Y,p=X*e+Y*u,C=1/(ea*g-ha*ha);U=(g*W-ha*p)*C;ea=(ea*p-ha*W)*C;if(0<=U&&0<ea&&1>U+ea)return!0;U=this.blx-J;W=this.bly-M;ea=U*U+W*W;ha=U*X+W*Y;W=U*e+W*u;C=1/(ea*g-ha*ha);U=(g*W-ha*p)*C;ea=(ea*p-ha*W)*C;return 0<=U&&0<ea&&1>U+ea};w.prototype.at=function(e,u){if(u)switch(e){case 0:return this.tlx;case 1:return this.trx;
case 2:return this.brx;case 3:return this.blx;case 4:return this.tlx;default:return this.tlx}else switch(e){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:return this.tly;default:return this.tly}};w.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4};w.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4};w.prototype.intersects_segment=function(e,u,J,M){if(this.contains_pt(e,u)||this.contains_pt(J,M))return!0;
var U;for(U=0;4>U;U++){var W=this.at(U,!0);var X=this.at(U,!1);var Y=this.at(U+1,!0);var ea=this.at(U+1,!1);if(cr.segments_intersect(e,u,J,M,W,X,Y,ea))return!0}return!1};w.prototype.intersects_quad=function(e){var u=e.midX(),J=e.midY();if(this.contains_pt(u,J))return!0;u=this.midX();J=this.midY();if(e.contains_pt(u,J))return!0;var M,U;for(M=0;4>M;M++)for(U=0;4>U;U++){u=this.at(M,!0);J=this.at(M,!1);var W=this.at(M+1,!0);var X=this.at(M+1,!1);var Y=e.at(U,!0);var ea=e.at(U,!1);var ha=e.at(U+1,!0);
var g=e.at(U+1,!1);if(cr.segments_intersect(u,J,W,X,Y,ea,ha,g))return!0}return!1};cr.quad=w;cr.RGB=function(e,u,J){return Math.max(Math.min(e,255),0)|Math.max(Math.min(u,255),0)<<8|Math.max(Math.min(J,255),0)<<16};cr.RGBAEx=function(e,u,J,M){e=cr.clamp(Math.floor(1024*e),-8192,8191);u=cr.clamp(Math.floor(1024*u),-8192,8191);J=cr.clamp(Math.floor(1024*J),-8192,8191);M=cr.clamp(Math.floor(1024*M),0,1024);0>e&&(e+=16384);0>u&&(u+=16384);0>J&&(J+=16384);return-(274877906944*e+16777216*u+1024*J+M)};cr.RGBEx=
function(e,u,J){return cr.RGBAEx(e,u,J,1)};cr.GetRValue=function(e){if(0<=e)return(e&255)/255;e=Math.floor(-e/274877906944);8191<e&&(e-=16384);return e/1024};cr.GetGValue=function(e){if(0<=e)return((e&65280)>>8)/255;e=Math.floor(-e%274877906944/16777216);8191<e&&(e-=16384);return e/1024};cr.GetBValue=function(e){if(0<=e)return((e&16711680)>>16)/255;e=Math.floor(-e%16777216/1024);8191<e&&(e-=16384);return e/1024};cr.GetAValue=function(e){return 0===e&&0>1/e?0:0<=e?1:Math.floor(-e%1024)/1024};cr.shallowCopy=
function(e,u,J){for(var M in u)u.hasOwnProperty(M)&&(e[M]=u[M]);return e};cr.arrayRemove=function(e,u){var J;u=cr.floor(u);if(!(0>u||u>=e.length)){for(J=e.length-1;u<J;u++)e[u]=e[u+1];cr.truncateArray(e,J)}};cr.truncateArray=function(e,u){e.length=u};cr.clearArray=function(e){cr.truncateArray(e,0)};cr.shallowAssignArray=function(e,u){cr.clearArray(e);var J;var M=0;for(J=u.length;M<J;++M)e[M]=u[M]};cr.appendArray=function(e,u){e.push.apply(e,u)};cr.fastIndexOf=function(e,u){var J;var M=0;for(J=e.length;M<
J;++M)if(e[M]===u)return M;return-1};cr.arrayFindRemove=function(e,u){u=cr.fastIndexOf(e,u);-1!==u&&cr.arrayRemove(e,u)};cr.clamp=function(e,u,J){return e<u?u:e>J?J:e};cr.to_radians=function(e){return e/(180/cr.PI)};cr.to_degrees=function(e){return 180/cr.PI*e};cr.clamp_angle_degrees=function(e){e%=360;0>e&&(e+=360);return e};cr.clamp_angle=function(e){e%=2*cr.PI;0>e&&(e+=2*cr.PI);return e};cr.to_clamped_degrees=function(e){return cr.clamp_angle_degrees(cr.to_degrees(e))};cr.to_clamped_radians=function(e){return cr.clamp_angle(cr.to_radians(e))};
cr.angleTo=function(e,u,J,M){return Math.atan2(M-u,J-e)};cr.angleDiff=function(e,u){if(e===u)return 0;e=Math.sin(e)*Math.sin(u)+Math.cos(e)*Math.cos(u);return 1<=e?0:-1>=e?cr.PI:Math.acos(e)};cr.angleRotate=function(e,u,J){var M=Math.sin(e),U=Math.cos(e),W=Math.sin(u),X=Math.cos(u);return Math.acos(M*W+U*X)>J?0<U*W-M*X?cr.clamp_angle(e+J):cr.clamp_angle(e-J):cr.clamp_angle(u)};cr.angleClockwise=function(e,u){return 0>=Math.cos(e)*Math.sin(u)-Math.sin(e)*Math.cos(u)};cr.rotatePtAround=function(e,u,
J,M,U,W){if(0===J)return W?e:u;var X=Math.sin(J);J=Math.cos(J);e-=M;u-=U;var Y=e*X;e=e*J-u*X;return W?e+M:u*J+Y+U};cr.distanceTo=function(e,u,J,M){e=J-e;u=M-u;return Math.sqrt(e*e+u*u)};cr.xor=function(e,u){return!e!==!u};cr.lerp=function(e,u,J){return e+(u-e)*J};cr.unlerp=function(e,u,J){return e===u?0:(J-e)/(u-e)};cr.anglelerp=function(e,u,J){var M=cr.angleDiff(e,u);return cr.angleClockwise(u,e)?e+M*J:e-M*J};cr.qarp=function(e,u,J,M){return cr.lerp(cr.lerp(e,u,M),cr.lerp(u,J,M),M)};cr.cubic=function(e,
u,J,M,U){return cr.lerp(cr.qarp(e,u,J,U),cr.qarp(u,J,M,U),U)};cr.cosp=function(e,u,J){return(e+u+(e-u)*Math.cos(J*Math.PI))/2};cr.hasAnyOwnProperty=function(e){for(var u in e)if(e.hasOwnProperty(u))return!0;return!1};cr.wipe=function(e){for(var u in e)e.hasOwnProperty(u)&&delete e[u]};var h=+new Date;cr.performance_now=function(){if("undefined"!==typeof window.performance){var e=window.performance;if("undefined"!==typeof e.now)return e.now();if("undefined"!==typeof e.webkitNow)return e.webkitNow();
if("undefined"!==typeof e.mozNow)return e.mozNow();if("undefined"!==typeof e.msNow)return e.msNow()}return Date.now()-h};var n=!1;"undefined"!==typeof window&&(n=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent),!n&&/safari/i.test(navigator.userAgent),/(iphone|ipod|ipad)/i.test(navigator.userAgent));var z="undefined"!==typeof Set&&"undefined"!==typeof Set.prototype.forEach;N.prototype.contains=function(e){return this.isEmpty()?!1:z?this.s.has(e):this.items&&this.items.hasOwnProperty(e)};
N.prototype.add=function(e){if(z)this.s.has(e)||(this.s.add(e),this.cache_valid=!1);else{var u=e.toString(),J=this.items;J?J.hasOwnProperty(u)||(J[u]=e,this.item_count++,this.cache_valid=!1):(this.items={},this.items[u]=e,this.item_count=1,this.cache_valid=!1)}};N.prototype.remove=function(e){if(!this.isEmpty())if(z)this.s.has(e)&&(this.s["delete"](e),this.cache_valid=!1);else if(this.items){e=e.toString();var u=this.items;u.hasOwnProperty(e)&&(delete u[e],this.item_count--,this.cache_valid=!1)}};
N.prototype.clear=function(){this.isEmpty()||(z?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)};N.prototype.isEmpty=function(){return 0===this.count()};N.prototype.count=function(){return z?this.s.size:this.item_count};var P=null,V=0;N.prototype.update_cache=function(){if(!this.cache_valid){if(z)cr.clearArray(this.values_cache),P=this.values_cache,V=0,this.s.forEach(D),P=null,V=0;else{var e=this.values_cache;cr.clearArray(e);var u,J=0,M=this.items;
if(M)for(u in M)M.hasOwnProperty(u)&&(e[J++]=M[u])}this.cache_valid=!0}};N.prototype.valuesRef=function(){this.update_cache();return this.values_cache};cr.ObjectSet=N;var H=new cr.ObjectSet;cr.removeArrayDuplicates=function(e){var u;var J=0;for(u=e.length;J<u;++J)H.add(e[J]);cr.shallowAssignArray(e,H.valuesRef());H.clear()};cr.arrayRemoveAllFromObjectSet=function(e,u){z?cr.arrayRemoveAll_set(e,u.s):cr.arrayRemoveAll_arr(e,u.valuesRef())};cr.arrayRemoveAll_set=function(e,u){var J,M;var U=J=0;for(M=
e.length;J<M;++J){var W=e[J];u.has(W)||(e[U++]=W)}cr.truncateArray(e,U)};cr.arrayRemoveAll_arr=function(e,u){var J,M;var U=J=0;for(M=e.length;J<M;++J){var W=e[J];-1===cr.fastIndexOf(u,W)&&(e[U++]=W)}cr.truncateArray(e,U)};f.prototype.add=function(e){this.y=e-this.c;this.t=this.sum+this.y;this.c=this.t-this.sum-this.y;this.sum=this.t};f.prototype.reset=function(){this.sum=this.t=this.y=this.c=0};cr.KahanAdder=f;cr.regexp_escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};a.prototype.set_pts=
function(e){this.pts_array=e;this.pts_count=e.length/2;this.pts_cache.length=e.length;this.cache_height=this.cache_width=-1;this.cache_angle=0};a.prototype.is_empty=function(){return!this.pts_array.length};a.prototype.update_bbox=function(){for(var e=this.pts_cache,u=e[0],J=u,M=e[1],U=M,W,X,Y=1,ea=this.pts_count;Y<ea;++Y)X=2*Y,W=e[X],X=e[X+1],W<u&&(u=W),W>J&&(J=W),X<M&&(M=X),X>U&&(U=X);this.bboxLeft=u;this.bboxRight=J;this.bboxTop=M;this.bboxBottom=U};a.prototype.set_from_rect=function(e,u,J){this.pts_cache.length=
8;this.pts_count=4;var M=this.pts_cache;M[0]=e.left-u;M[1]=e.top-J;M[2]=e.right-u;M[3]=e.top-J;M[4]=e.right-u;M[5]=e.bottom-J;M[6]=e.left-u;M[7]=e.bottom-J;this.cache_width=e.right-e.left;this.cache_height=e.bottom-e.top;this.update_bbox()};a.prototype.set_from_quad=function(e,u,J,M,U){this.pts_cache.length=8;this.pts_count=4;var W=this.pts_cache;W[0]=e.tlx-u;W[1]=e.tly-J;W[2]=e.trx-u;W[3]=e.try_-J;W[4]=e.brx-u;W[5]=e.bry-J;W[6]=e.blx-u;W[7]=e.bly-J;this.cache_width=M;this.cache_height=U;this.update_bbox()};
a.prototype.set_from_poly=function(e){this.pts_count=e.pts_count;cr.shallowAssignArray(this.pts_cache,e.pts_cache);this.bboxLeft=e.bboxLeft;this.bboxTop-e.bboxTop;this.bboxRight=e.bboxRight;this.bboxBottom=e.bboxBottom};a.prototype.cache_poly=function(e,u,J){if(this.cache_width!==e||this.cache_height!==u||this.cache_angle!==J){this.cache_width=e;this.cache_height=u;this.cache_angle=J;var M,U=0,W=1,X=this.pts_array,Y=this.pts_cache;0!==J&&(U=Math.sin(J),W=Math.cos(J));J=0;for(M=this.pts_count;J<M;J++){var ea=
2*J;var ha=ea+1;var g=X[ea]*e;var p=X[ha]*u;Y[ea]=g*W-p*U;Y[ha]=p*W+g*U}this.update_bbox()}};a.prototype.contains_pt=function(e,u){var J=this.pts_cache;if(e===J[0]&&u===J[1])return!0;var M,U=this.pts_count,W=this.bboxLeft-110,X=this.bboxTop-101,Y=this.bboxRight+131,ea=this.bboxBottom+120,ha=0,g=0;for(M=0;M<U;M++){var p=2*M;var C=(M+1)%U*2;var G=J[p];p=J[p+1];var x=J[C];C=J[C+1];cr.segments_intersect(W,X,e,u,G,p,x,C)&&ha++;cr.segments_intersect(Y,ea,e,u,G,p,x,C)&&g++}return 1===ha%2||1===g%2};a.prototype.intersects_poly=
function(e,u,J){var M=e.pts_cache,U=this.pts_cache;if(this.contains_pt(M[0]+u,M[1]+J)||e.contains_pt(U[0]-u,U[1]-J))return!0;var W,X;var Y=0;for(W=this.pts_count;Y<W;Y++){var ea=2*Y;var ha=(Y+1)%W*2;var g=U[ea];ea=U[ea+1];var p=U[ha];var C=U[ha+1];ha=0;for(X=e.pts_count;ha<X;ha++){var G=2*ha;var x=(ha+1)%X*2;var K=M[G]+u;G=M[G+1]+J;var R=M[x]+u;x=M[x+1]+J;if(cr.segments_intersect(g,ea,p,C,K,G,R,x))return!0}}return!1};a.prototype.intersects_segment=function(e,u,J,M,U,W){var X=this.pts_cache;if(this.contains_pt(J-
e,M-u))return!0;var Y;var ea=0;for(Y=this.pts_count;ea<Y;ea++){var ha=2*ea;var g=(ea+1)%Y*2;var p=X[ha]+e;ha=X[ha+1]+u;var C=X[g]+e;g=X[g+1]+u;if(cr.segments_intersect(J,M,U,W,p,ha,C,g))return!0}return!1};a.prototype.mirror=function(e){var u;var J=0;for(u=this.pts_count;J<u;++J){var M=2*J;this.pts_cache[M]=2*e-this.pts_cache[M]}};a.prototype.flip=function(e){var u;var J=0;for(u=this.pts_count;J<u;++J){var M=2*J+1;this.pts_cache[M]=2*e-this.pts_cache[M]}};a.prototype.diag=function(){var e;var u=0;
for(e=this.pts_count;u<e;++u){var J=2*u;var M=J+1;var U=this.pts_cache[J];this.pts_cache[J]=this.pts_cache[M];this.pts_cache[M]=U}};a.prototype.is_enabled=function(){return this.enabled};cr.CollisionPoly=a;c.prototype.totalCellCount=0;c.prototype.getCell=function(e,u,J){var M=this.cells[e];return M?(M=M[u])?M:J?(M=v(this,e,u),this.cells[e][u]=M):null:J?(M=v(this,e,u),this.cells[e]={},this.cells[e][u]=M):null};c.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)};c.prototype.YToCell=function(e){return cr.floor(e/
this.cellheight)};c.prototype.update=function(e,u,J){var M,U,W;if(u){var X=u.left;for(M=u.right;X<=M;++X){var Y=u.top;for(U=u.bottom;Y<=U;++Y)if(!J||!J.contains_pt(X,Y))if(W=this.getCell(X,Y,!1))W.remove(e),W.isEmpty()&&(c.prototype.totalCellCount--,W.objects.clear(),1E3>d.length&&d.push(W),this.cells[X][Y]=null)}}if(J)for(X=J.left,M=J.right;X<=M;++X)for(Y=J.top,U=J.bottom;Y<=U;++Y)u&&u.contains_pt(X,Y)||this.getCell(X,Y,!0).insert(e)};c.prototype.queryRange=function(e,u){var J,M;var U=this.XToCell(e.left);
var W=this.YToCell(e.top);var X=this.XToCell(e.right);for(J=this.YToCell(e.bottom);U<=X;++U)for(e=W;e<=J;++e)(M=this.getCell(U,e,!1))&&M.dump(u)};cr.SparseGrid=c;l.prototype.totalCellCount=0;l.prototype.getCell=function(e,u,J){var M=this.cells[e];return M?(M=M[u])?M:J?(M=y(this,e,u),this.cells[e][u]=M):null:J?(M=y(this,e,u),this.cells[e]={},this.cells[e][u]=M):null};l.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)};l.prototype.YToCell=function(e){return cr.floor(e/this.cellheight)};
l.prototype.update=function(e,u,J){var M,U,W;if(u){var X=u.left;for(M=u.right;X<=M;++X){var Y=u.top;for(U=u.bottom;Y<=U;++Y)if(!J||!J.contains_pt(X,Y))if(W=this.getCell(X,Y,!1))W.remove(e),W.isEmpty()&&(l.prototype.totalCellCount--,W.reset(),1E3>k.length&&k.push(W),this.cells[X][Y]=null)}}if(J)for(X=J.left,M=J.right;X<=M;++X)for(Y=J.top,U=J.bottom;Y<=U;++Y)u&&u.contains_pt(X,Y)||this.getCell(X,Y,!0).insert(e)};l.prototype.queryRange=function(e,u,J,M,U){var W,X;e=this.XToCell(e);u=this.YToCell(u);
J=this.XToCell(J);for(W=this.YToCell(M);e<=J;++e)for(M=u;M<=W;++M)(X=this.getCell(e,M,!1))&&X.dump(U)};l.prototype.markRangeChanged=function(e){var u,J;var M=e.left;var U=e.top;var W=e.right;for(u=e.bottom;M<=W;++M)for(e=U;e<=u;++e)if(J=this.getCell(M,e,!1))J.is_sorted=!1};cr.RenderGrid=l;var d=[];t.prototype.isEmpty=function(){return this.objects.isEmpty()};t.prototype.insert=function(e){this.objects.add(e)};t.prototype.remove=function(e){this.objects.remove(e)};t.prototype.dump=function(e){cr.appendArray(e,
this.objects.valuesRef())};cr.GridCell=t;var k=[];L.prototype.isEmpty=function(){if(!this.objects.length)return!0;if(this.objects.length>this.pending_removal.count())return!1;this.flush_pending();return!0};L.prototype.insert=function(e){this.pending_removal.contains(e)?(this.pending_removal.remove(e),this.pending_removal.isEmpty()&&(this.any_pending_removal=!1)):this.objects.length?(this.objects[this.objects.length-1].get_zindex()>e.get_zindex()&&(this.is_sorted=!1),this.objects.push(e)):(this.objects.push(e),
this.is_sorted=!0)};L.prototype.remove=function(e){this.pending_removal.add(e);this.any_pending_removal=!0;30<=this.pending_removal.count()&&this.flush_pending()};L.prototype.flush_pending=function(){this.any_pending_removal&&(this.pending_removal.count()===this.objects.length?this.reset():(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1))};L.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(q),this.is_sorted=
!0)};L.prototype.reset=function(){cr.clearArray(this.objects);this.is_sorted=!0;this.pending_removal.clear();this.any_pending_removal=!1};L.prototype.dump=function(e){this.flush_pending();this.ensure_sorted();this.objects.length&&e.push(this.objects)};cr.RenderCell=L;var F="lighter xor copy destination-over source-in destination-in source-out destination-out source-atop destination-atop".split(" ");cr.effectToCompositeOp=function(e){return 0>=e||11<=e?"source-over":F[e-1]};cr.setGLBlend=function(e,
u,J){if(J)switch(e.srcBlend=J.ONE,e.destBlend=J.ONE_MINUS_SRC_ALPHA,u){case 1:e.srcBlend=J.ONE;e.destBlend=J.ONE;break;case 3:e.srcBlend=J.ONE;e.destBlend=J.ZERO;break;case 4:e.srcBlend=J.ONE_MINUS_DST_ALPHA;e.destBlend=J.ONE;break;case 5:e.srcBlend=J.DST_ALPHA;e.destBlend=J.ZERO;break;case 6:e.srcBlend=J.ZERO;e.destBlend=J.SRC_ALPHA;break;case 7:e.srcBlend=J.ONE_MINUS_DST_ALPHA;e.destBlend=J.ZERO;break;case 8:e.srcBlend=J.ZERO;e.destBlend=J.ONE_MINUS_SRC_ALPHA;break;case 9:e.srcBlend=J.DST_ALPHA;
e.destBlend=J.ONE_MINUS_SRC_ALPHA;break;case 10:e.srcBlend=J.ONE_MINUS_DST_ALPHA,e.destBlend=J.SRC_ALPHA}};cr.round6dp=function(e){return Math.round(1E6*e)/1E6};cr.equals_nocase=function(e,u){return"string"!==typeof e||"string"!==typeof u||e.length!==u.length?!1:e===u?!0:e.toLowerCase()===u.toLowerCase()};cr.cssToCamelCase=function(e){var u="",J,M=!1;var U=0;for(J=e.length;U<J;++U){var W=e.charAt(U);"-"===W?M=!0:M?(u+=W.toUpperCase(),M=!1):u+=W}return u};cr.isCanvasInputEvent=function(e){e=e.target;
return!e||e===document||e===window||document&&document.body&&e===document.body||cr.equals_nocase(e.tagName,"canvas")?!0:!1}})();var MatrixArray="undefined"!==typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(b){var m=new MatrixArray(3);b&&(m[0]=b[0],m[1]=b[1],m[2]=b[2]);return m};vec3.set=function(b,m){m[0]=b[0];m[1]=b[1];m[2]=b[2];return m};
vec3.add=function(b,m,w){if(!w||b===w)return b[0]+=m[0],b[1]+=m[1],b[2]+=m[2],b;w[0]=b[0]+m[0];w[1]=b[1]+m[1];w[2]=b[2]+m[2];return w};vec3.subtract=function(b,m,w){if(!w||b===w)return b[0]-=m[0],b[1]-=m[1],b[2]-=m[2],b;w[0]=b[0]-m[0];w[1]=b[1]-m[1];w[2]=b[2]-m[2];return w};vec3.negate=function(b,m){m||(m=b);m[0]=-b[0];m[1]=-b[1];m[2]=-b[2];return m};vec3.scale=function(b,m,w){if(!w||b===w)return b[0]*=m,b[1]*=m,b[2]*=m,b;w[0]=b[0]*m;w[1]=b[1]*m;w[2]=b[2]*m;return w};
vec3.normalize=function(b,m){m||(m=b);var w=b[0],E=b[1];b=b[2];var N=Math.sqrt(w*w+E*E+b*b);if(N){if(1===N)return m[0]=w,m[1]=E,m[2]=b,m}else return m[0]=0,m[1]=0,m[2]=0,m;N=1/N;m[0]=w*N;m[1]=E*N;m[2]=b*N;return m};vec3.cross=function(b,m,w){w||(w=b);var E=b[0],N=b[1];b=b[2];var D=m[0],f=m[1];m=m[2];w[0]=N*m-b*f;w[1]=b*D-E*m;w[2]=E*f-N*D;return w};vec3.length=function(b){var m=b[0],w=b[1];b=b[2];return Math.sqrt(m*m+w*w+b*b)};vec3.dot=function(b,m){return b[0]*m[0]+b[1]*m[1]+b[2]*m[2]};
vec3.direction=function(b,m,w){w||(w=b);var E=b[0]-m[0],N=b[1]-m[1];b=b[2]-m[2];m=Math.sqrt(E*E+N*N+b*b);if(!m)return w[0]=0,w[1]=0,w[2]=0,w;m=1/m;w[0]=E*m;w[1]=N*m;w[2]=b*m;return w};vec3.lerp=function(b,m,w,E){E||(E=b);E[0]=b[0]+w*(m[0]-b[0]);E[1]=b[1]+w*(m[1]-b[1]);E[2]=b[2]+w*(m[2]-b[2]);return E};vec3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+"]"};
mat3.create=function(b){var m=new MatrixArray(9);b&&(m[0]=b[0],m[1]=b[1],m[2]=b[2],m[3]=b[3],m[4]=b[4],m[5]=b[5],m[6]=b[6],m[7]=b[7],m[8]=b[8]);return m};mat3.set=function(b,m){m[0]=b[0];m[1]=b[1];m[2]=b[2];m[3]=b[3];m[4]=b[4];m[5]=b[5];m[6]=b[6];m[7]=b[7];m[8]=b[8];return m};mat3.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};
mat3.transpose=function(b,m){if(!m||b===m){m=b[1];var w=b[2],E=b[5];b[1]=b[3];b[2]=b[6];b[3]=m;b[5]=b[7];b[6]=w;b[7]=E;return b}m[0]=b[0];m[1]=b[3];m[2]=b[6];m[3]=b[1];m[4]=b[4];m[5]=b[7];m[6]=b[2];m[7]=b[5];m[8]=b[8];return m};mat3.toMat4=function(b,m){m||(m=mat4.create());m[15]=1;m[14]=0;m[13]=0;m[12]=0;m[11]=0;m[10]=b[8];m[9]=b[7];m[8]=b[6];m[7]=0;m[6]=b[5];m[5]=b[4];m[4]=b[3];m[3]=0;m[2]=b[2];m[1]=b[1];m[0]=b[0];return m};
mat3.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+"]"};mat4.create=function(b){var m=new MatrixArray(16);b&&(m[0]=b[0],m[1]=b[1],m[2]=b[2],m[3]=b[3],m[4]=b[4],m[5]=b[5],m[6]=b[6],m[7]=b[7],m[8]=b[8],m[9]=b[9],m[10]=b[10],m[11]=b[11],m[12]=b[12],m[13]=b[13],m[14]=b[14],m[15]=b[15]);return m};
mat4.set=function(b,m){m[0]=b[0];m[1]=b[1];m[2]=b[2];m[3]=b[3];m[4]=b[4];m[5]=b[5];m[6]=b[6];m[7]=b[7];m[8]=b[8];m[9]=b[9];m[10]=b[10];m[11]=b[11];m[12]=b[12];m[13]=b[13];m[14]=b[14];m[15]=b[15];return m};mat4.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};
mat4.transpose=function(b,m){if(!m||b===m){m=b[1];var w=b[2],E=b[3],N=b[6],D=b[7],f=b[11];b[1]=b[4];b[2]=b[8];b[3]=b[12];b[4]=m;b[6]=b[9];b[7]=b[13];b[8]=w;b[9]=N;b[11]=b[14];b[12]=E;b[13]=D;b[14]=f;return b}m[0]=b[0];m[1]=b[4];m[2]=b[8];m[3]=b[12];m[4]=b[1];m[5]=b[5];m[6]=b[9];m[7]=b[13];m[8]=b[2];m[9]=b[6];m[10]=b[10];m[11]=b[14];m[12]=b[3];m[13]=b[7];m[14]=b[11];m[15]=b[15];return m};
mat4.determinant=function(b){var m=b[0],w=b[1],E=b[2],N=b[3],D=b[4],f=b[5],a=b[6],c=b[7],l=b[8],v=b[9],t=b[10],y=b[11],L=b[12],q=b[13],B=b[14];b=b[15];return L*v*a*N-l*q*a*N-L*f*t*N+D*q*t*N+l*f*B*N-D*v*B*N-L*v*E*c+l*q*E*c+L*w*t*c-m*q*t*c-l*w*B*c+m*v*B*c+L*f*E*y-D*q*E*y-L*w*a*y+m*q*a*y+D*w*B*y-m*f*B*y-l*f*E*b+D*v*E*b+l*w*a*b-m*v*a*b-D*w*t*b+m*f*t*b};
mat4.inverse=function(b,m){m||(m=b);var w=b[0],E=b[1],N=b[2],D=b[3],f=b[4],a=b[5],c=b[6],l=b[7],v=b[8],t=b[9],y=b[10],L=b[11],q=b[12],B=b[13],A=b[14];b=b[15];var h=w*a-E*f,n=w*c-N*f,z=w*l-D*f,P=E*c-N*a,V=E*l-D*a,H=N*l-D*c,d=v*B-t*q,k=v*A-y*q,F=v*b-L*q,e=t*A-y*B,u=t*b-L*B,J=y*b-L*A,M=1/(h*J-n*u+z*e+P*F-V*k+H*d);m[0]=(a*J-c*u+l*e)*M;m[1]=(-E*J+N*u-D*e)*M;m[2]=(B*H-A*V+b*P)*M;m[3]=(-t*H+y*V-L*P)*M;m[4]=(-f*J+c*F-l*k)*M;m[5]=(w*J-N*F+D*k)*M;m[6]=(-q*H+A*z-b*n)*M;m[7]=(v*H-y*z+L*n)*M;m[8]=(f*u-a*F+l*d)*
M;m[9]=(-w*u+E*F-D*d)*M;m[10]=(q*V-B*z+b*h)*M;m[11]=(-v*V+t*z-L*h)*M;m[12]=(-f*e+a*k-c*d)*M;m[13]=(w*e-E*k+N*d)*M;m[14]=(-q*P+B*n-A*h)*M;m[15]=(v*P-t*n+y*h)*M;return m};mat4.toRotationMat=function(b,m){m||(m=mat4.create());m[0]=b[0];m[1]=b[1];m[2]=b[2];m[3]=b[3];m[4]=b[4];m[5]=b[5];m[6]=b[6];m[7]=b[7];m[8]=b[8];m[9]=b[9];m[10]=b[10];m[11]=b[11];m[12]=0;m[13]=0;m[14]=0;m[15]=1;return m};
mat4.toMat3=function(b,m){m||(m=mat3.create());m[0]=b[0];m[1]=b[1];m[2]=b[2];m[3]=b[4];m[4]=b[5];m[5]=b[6];m[6]=b[8];m[7]=b[9];m[8]=b[10];return m};mat4.toInverseMat3=function(b,m){var w=b[0],E=b[1],N=b[2],D=b[4],f=b[5],a=b[6],c=b[8],l=b[9];b=b[10];var v=b*f-a*l,t=-b*D+a*c,y=l*D-f*c,L=w*v+E*t+N*y;if(!L)return null;L=1/L;m||(m=mat3.create());m[0]=v*L;m[1]=(-b*E+N*l)*L;m[2]=(a*E-N*f)*L;m[3]=t*L;m[4]=(b*w-N*c)*L;m[5]=(-a*w+N*D)*L;m[6]=y*L;m[7]=(-l*w+E*c)*L;m[8]=(f*w-E*D)*L;return m};
mat4.multiply=function(b,m,w){w||(w=b);var E=b[0],N=b[1],D=b[2],f=b[3],a=b[4],c=b[5],l=b[6],v=b[7],t=b[8],y=b[9],L=b[10],q=b[11],B=b[12],A=b[13],h=b[14];b=b[15];var n=m[0],z=m[1],P=m[2],V=m[3],H=m[4],d=m[5],k=m[6],F=m[7],e=m[8],u=m[9],J=m[10],M=m[11],U=m[12],W=m[13],X=m[14];m=m[15];w[0]=n*E+z*a+P*t+V*B;w[1]=n*N+z*c+P*y+V*A;w[2]=n*D+z*l+P*L+V*h;w[3]=n*f+z*v+P*q+V*b;w[4]=H*E+d*a+k*t+F*B;w[5]=H*N+d*c+k*y+F*A;w[6]=H*D+d*l+k*L+F*h;w[7]=H*f+d*v+k*q+F*b;w[8]=e*E+u*a+J*t+M*B;w[9]=e*N+u*c+J*y+M*A;w[10]=e*
D+u*l+J*L+M*h;w[11]=e*f+u*v+J*q+M*b;w[12]=U*E+W*a+X*t+m*B;w[13]=U*N+W*c+X*y+m*A;w[14]=U*D+W*l+X*L+m*h;w[15]=U*f+W*v+X*q+m*b;return w};mat4.multiplyVec3=function(b,m,w){w||(w=m);var E=m[0],N=m[1];m=m[2];w[0]=b[0]*E+b[4]*N+b[8]*m+b[12];w[1]=b[1]*E+b[5]*N+b[9]*m+b[13];w[2]=b[2]*E+b[6]*N+b[10]*m+b[14];return w};
mat4.multiplyVec4=function(b,m,w){w||(w=m);var E=m[0],N=m[1],D=m[2];m=m[3];w[0]=b[0]*E+b[4]*N+b[8]*D+b[12]*m;w[1]=b[1]*E+b[5]*N+b[9]*D+b[13]*m;w[2]=b[2]*E+b[6]*N+b[10]*D+b[14]*m;w[3]=b[3]*E+b[7]*N+b[11]*D+b[15]*m;return w};
mat4.translate=function(b,m,w){var E=m[0],N=m[1];m=m[2];if(!w||b===w)return b[12]=b[0]*E+b[4]*N+b[8]*m+b[12],b[13]=b[1]*E+b[5]*N+b[9]*m+b[13],b[14]=b[2]*E+b[6]*N+b[10]*m+b[14],b[15]=b[3]*E+b[7]*N+b[11]*m+b[15],b;var D=b[0];var f=b[1];var a=b[2];var c=b[3];var l=b[4];var v=b[5];var t=b[6];var y=b[7];var L=b[8];var q=b[9];var B=b[10];var A=b[11];w[0]=D;w[1]=f;w[2]=a;w[3]=c;w[4]=l;w[5]=v;w[6]=t;w[7]=y;w[8]=L;w[9]=q;w[10]=B;w[11]=A;w[12]=D*E+l*N+L*m+b[12];w[13]=f*E+v*N+q*m+b[13];w[14]=a*E+t*N+B*m+b[14];
w[15]=c*E+y*N+A*m+b[15];return w};mat4.scale=function(b,m,w){var E=m[0],N=m[1];m=m[2];if(!w||b===w)return b[0]*=E,b[1]*=E,b[2]*=E,b[3]*=E,b[4]*=N,b[5]*=N,b[6]*=N,b[7]*=N,b[8]*=m,b[9]*=m,b[10]*=m,b[11]*=m,b;w[0]=b[0]*E;w[1]=b[1]*E;w[2]=b[2]*E;w[3]=b[3]*E;w[4]=b[4]*N;w[5]=b[5]*N;w[6]=b[6]*N;w[7]=b[7]*N;w[8]=b[8]*m;w[9]=b[9]*m;w[10]=b[10]*m;w[11]=b[11]*m;w[12]=b[12];w[13]=b[13];w[14]=b[14];w[15]=b[15];return w};
mat4.rotate=function(b,m,w,E){var N=w[0],D=w[1];w=w[2];var f=Math.sqrt(N*N+D*D+w*w);if(!f)return null;1!==f&&(f=1/f,N*=f,D*=f,w*=f);var a=Math.sin(m);var c=Math.cos(m);var l=1-c;m=b[0];f=b[1];var v=b[2];var t=b[3];var y=b[4];var L=b[5];var q=b[6];var B=b[7];var A=b[8];var h=b[9];var n=b[10];var z=b[11];var P=N*N*l+c;var V=D*N*l+w*a;var H=w*N*l-D*a;var d=N*D*l-w*a;var k=D*D*l+c;var F=w*D*l+N*a;var e=N*w*l+D*a;N=D*w*l-N*a;D=w*w*l+c;E?b!==E&&(E[12]=b[12],E[13]=b[13],E[14]=b[14],E[15]=b[15]):E=b;E[0]=
m*P+y*V+A*H;E[1]=f*P+L*V+h*H;E[2]=v*P+q*V+n*H;E[3]=t*P+B*V+z*H;E[4]=m*d+y*k+A*F;E[5]=f*d+L*k+h*F;E[6]=v*d+q*k+n*F;E[7]=t*d+B*k+z*F;E[8]=m*e+y*N+A*D;E[9]=f*e+L*N+h*D;E[10]=v*e+q*N+n*D;E[11]=t*e+B*N+z*D;return E};
mat4.rotateX=function(b,m,w){var E=Math.sin(m);m=Math.cos(m);var N=b[4],D=b[5],f=b[6],a=b[7],c=b[8],l=b[9],v=b[10],t=b[11];w?b!==w&&(w[0]=b[0],w[1]=b[1],w[2]=b[2],w[3]=b[3],w[12]=b[12],w[13]=b[13],w[14]=b[14],w[15]=b[15]):w=b;w[4]=N*m+c*E;w[5]=D*m+l*E;w[6]=f*m+v*E;w[7]=a*m+t*E;w[8]=N*-E+c*m;w[9]=D*-E+l*m;w[10]=f*-E+v*m;w[11]=a*-E+t*m;return w};
mat4.rotateY=function(b,m,w){var E=Math.sin(m);m=Math.cos(m);var N=b[0],D=b[1],f=b[2],a=b[3],c=b[8],l=b[9],v=b[10],t=b[11];w?b!==w&&(w[4]=b[4],w[5]=b[5],w[6]=b[6],w[7]=b[7],w[12]=b[12],w[13]=b[13],w[14]=b[14],w[15]=b[15]):w=b;w[0]=N*m+c*-E;w[1]=D*m+l*-E;w[2]=f*m+v*-E;w[3]=a*m+t*-E;w[8]=N*E+c*m;w[9]=D*E+l*m;w[10]=f*E+v*m;w[11]=a*E+t*m;return w};
mat4.rotateZ=function(b,m,w){var E=Math.sin(m);m=Math.cos(m);var N=b[0],D=b[1],f=b[2],a=b[3],c=b[4],l=b[5],v=b[6],t=b[7];w?b!==w&&(w[8]=b[8],w[9]=b[9],w[10]=b[10],w[11]=b[11],w[12]=b[12],w[13]=b[13],w[14]=b[14],w[15]=b[15]):w=b;w[0]=N*m+c*E;w[1]=D*m+l*E;w[2]=f*m+v*E;w[3]=a*m+t*E;w[4]=N*-E+c*m;w[5]=D*-E+l*m;w[6]=f*-E+v*m;w[7]=a*-E+t*m;return w};
mat4.frustum=function(b,m,w,E,N,D,f){f||(f=mat4.create());var a=m-b,c=E-w,l=D-N;f[0]=2*N/a;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*N/c;f[6]=0;f[7]=0;f[8]=(m+b)/a;f[9]=(E+w)/c;f[10]=-(D+N)/l;f[11]=-1;f[12]=0;f[13]=0;f[14]=-(D*N*2)/l;f[15]=0;return f};mat4.perspective=function(b,m,w,E,N){b=w*Math.tan(b*Math.PI/360);m*=b;return mat4.frustum(-m,m,-b,b,w,E,N)};
mat4.ortho=function(b,m,w,E,N,D,f){f||(f=mat4.create());var a=m-b,c=E-w,l=D-N;f[0]=2/a;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2/c;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=-2/l;f[11]=0;f[12]=-(b+m)/a;f[13]=-(E+w)/c;f[14]=-(D+N)/l;f[15]=1;return f};
mat4.lookAt=function(b,m,w,E){E||(E=mat4.create());var N=b[0],D=b[1];b=b[2];var f=w[0];var a=w[1];var c=w[2];w=m[1];var l=m[2];if(N===m[0]&&D===w&&b===l)return mat4.identity(E);w=N-m[0];l=D-m[1];var v=b-m[2];var t=1/Math.sqrt(w*w+l*l+v*v);w*=t;l*=t;v*=t;m=a*v-c*l;c=c*w-f*v;f=f*l-a*w;(t=Math.sqrt(m*m+c*c+f*f))?(t=1/t,m*=t,c*=t,f*=t):f=c=m=0;a=l*f-v*c;var y=v*m-w*f;var L=w*c-l*m;(t=Math.sqrt(a*a+y*y+L*L))?(t=1/t,a*=t,y*=t,L*=t):L=y=a=0;E[0]=m;E[1]=a;E[2]=w;E[3]=0;E[4]=c;E[5]=y;E[6]=l;E[7]=0;E[8]=f;
E[9]=L;E[10]=v;E[11]=0;E[12]=-(m*N+c*D+f*b);E[13]=-(a*N+y*D+L*b);E[14]=-(w*N+l*D+v*b);E[15]=1;return E};mat4.fromRotationTranslation=function(b,m,w){w||(w=mat4.create());var E=b[0],N=b[1],D=b[2],f=b[3],a=E+E,c=N+N,l=D+D;b=E*a;var v=E*c;E*=l;var t=N*c;N*=l;D*=l;a*=f;c*=f;f*=l;w[0]=1-(t+D);w[1]=v+f;w[2]=E-c;w[3]=0;w[4]=v-f;w[5]=1-(b+D);w[6]=N+a;w[7]=0;w[8]=E+c;w[9]=N-a;w[10]=1-(b+t);w[11]=0;w[12]=m[0];w[13]=m[1];w[14]=m[2];w[15]=1;return w};
mat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+", "+b[9]+", "+b[10]+", "+b[11]+", "+b[12]+", "+b[13]+", "+b[14]+", "+b[15]+"]"};quat4.create=function(b){var m=new MatrixArray(4);b&&(m[0]=b[0],m[1]=b[1],m[2]=b[2],m[3]=b[3]);return m};quat4.set=function(b,m){m[0]=b[0];m[1]=b[1];m[2]=b[2];m[3]=b[3];return m};
quat4.calculateW=function(b,m){var w=b[0],E=b[1],N=b[2];if(!m||b===m)return b[3]=-Math.sqrt(Math.abs(1-w*w-E*E-N*N)),b;m[0]=w;m[1]=E;m[2]=N;m[3]=-Math.sqrt(Math.abs(1-w*w-E*E-N*N));return m};quat4.inverse=function(b,m){if(!m||b===m)return b[0]*=-1,b[1]*=-1,b[2]*=-1,b;m[0]=-b[0];m[1]=-b[1];m[2]=-b[2];m[3]=b[3];return m};quat4.length=function(b){var m=b[0],w=b[1],E=b[2];b=b[3];return Math.sqrt(m*m+w*w+E*E+b*b)};
quat4.normalize=function(b,m){m||(m=b);var w=b[0],E=b[1],N=b[2];b=b[3];var D=Math.sqrt(w*w+E*E+N*N+b*b);if(0===D)return m[0]=0,m[1]=0,m[2]=0,m[3]=0,m;D=1/D;m[0]=w*D;m[1]=E*D;m[2]=N*D;m[3]=b*D;return m};quat4.multiply=function(b,m,w){w||(w=b);var E=b[0],N=b[1],D=b[2];b=b[3];var f=m[0],a=m[1],c=m[2];m=m[3];w[0]=E*m+b*f+N*c-D*a;w[1]=N*m+b*a+D*f-E*c;w[2]=D*m+b*c+E*a-N*f;w[3]=b*m-E*f-N*a-D*c;return w};
quat4.multiplyVec3=function(b,m,w){w||(w=m);var E=m[0],N=m[1],D=m[2];m=b[0];var f=b[1],a=b[2];b=b[3];var c=b*E+f*D-a*N,l=b*N+a*E-m*D,v=b*D+m*N-f*E;E=-m*E-f*N-a*D;w[0]=c*b+E*-m+l*-a-v*-f;w[1]=l*b+E*-f+v*-m-c*-a;w[2]=v*b+E*-a+c*-f-l*-m;return w};quat4.toMat3=function(b,m){m||(m=mat3.create());var w=b[0],E=b[1],N=b[2];b=b[3];var D=w+w,f=E+E,a=N+N,c=w*D,l=w*f;w*=a;var v=E*f;E*=a;N*=a;D*=b;f*=b;b*=a;m[0]=1-(v+N);m[1]=l+b;m[2]=w-f;m[3]=l-b;m[4]=1-(c+N);m[5]=E+D;m[6]=w+f;m[7]=E-D;m[8]=1-(c+v);return m};
quat4.toMat4=function(b,m){m||(m=mat4.create());var w=b[0],E=b[1],N=b[2];b=b[3];var D=w+w,f=E+E,a=N+N,c=w*D,l=w*f;w*=a;var v=E*f;E*=a;N*=a;D*=b;f*=b;b*=a;m[0]=1-(v+N);m[1]=l+b;m[2]=w-f;m[3]=0;m[4]=l-b;m[5]=1-(c+N);m[6]=E+D;m[7]=0;m[8]=w+f;m[9]=E-D;m[10]=1-(c+v);m[11]=0;m[12]=0;m[13]=0;m[14]=0;m[15]=1;return m};
quat4.slerp=function(b,m,w,E){E||(E=b);var N=b[0]*m[0]+b[1]*m[1]+b[2]*m[2]+b[3]*m[3];if(1<=Math.abs(N))return E!==b&&(E[0]=b[0],E[1]=b[1],E[2]=b[2],E[3]=b[3]),E;var D=Math.acos(N);var f=Math.sqrt(1-N*N);if(.001>Math.abs(f))return E[0]=.5*b[0]+.5*m[0],E[1]=.5*b[1]+.5*m[1],E[2]=.5*b[2]+.5*m[2],E[3]=.5*b[3]+.5*m[3],E;N=Math.sin((1-w)*D)/f;w=Math.sin(w*D)/f;E[0]=b[0]*N+m[0]*w;E[1]=b[1]*N+m[1]*w;E[2]=b[2]*N+m[2]*w;E[3]=b[3]*N+m[3]*w;return E};
quat4.str=function(b){return"["+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+"]"};
(function(){function b(a,c,l){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent);this.height=this.width=0;this.enableFrontToBack=!!l;this.isBatchInEarlyZPass=this.isEarlyZPass=!1;this.currentZ=0;this.zNear=1;this.zFar=1E3;this.zIncrement=(this.zFar-this.zNear)/32768;this.zA=this.zFar/(this.zFar-this.zNear);this.zB=this.zFar*this.zNear/(this.zNear-this.zFar);this.kzA=65536*this.zA;this.kzB=65536*this.zB;this.cam=vec3.create([0,0,100]);this.look=vec3.create([0,0,0]);this.up=
vec3.create([0,1,0]);this.worldScale=vec3.create([1,1,1]);this.enable_mipmaps=!0;this.matP=mat4.create();this.matMV=mat4.create();this.lastMV=mat4.create();this.currentMV=mat4.create();this.gl=a;this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1;this.timerExt=null;this.isTiming=!1;this.timerExt=2===this.version?this.gl.getExtension("EXT_disjoint_timer_query_webgl2")||this.gl.getExtension("EXT_disjoint_timer_query"):this.gl.getExtension("EXT_disjoint_timer_query");this.frameNumber=
0;this.timerResults=[];this.initState()}function m(a,c,l){this.gl=a;this.shaderProgram=c;this.name=l;this.locAPos=a.getAttribLocation(c,"aPos");this.locATex=a.getAttribLocation(c,"aTex");this.locMatP=a.getUniformLocation(c,"matP");this.locMatMV=a.getUniformLocation(c,"matMV");this.locOpacity=a.getUniformLocation(c,"opacity");this.locColorFill=a.getUniformLocation(c,"colorFill");this.locSamplerFront=a.getUniformLocation(c,"samplerFront");this.locSamplerBack=a.getUniformLocation(c,"samplerBack");this.locSrcStart=
a.getUniformLocation(c,"srcStart");this.locSrcEnd=a.getUniformLocation(c,"srcEnd");this.locSrcOriginStart=a.getUniformLocation(c,"srcOriginStart");this.locSrcOriginEnd=a.getUniformLocation(c,"srcOriginEnd");this.locLayoutStart=a.getUniformLocation(c,"layoutStart");this.locLayoutEnd=a.getUniformLocation(c,"layoutEnd");this.locDestStart=a.getUniformLocation(c,"destStart");this.locDestEnd=a.getUniformLocation(c,"destEnd");this.locSeconds=a.getUniformLocation(c,"seconds");this.locPixelSize=a.getUniformLocation(c,
"pixelSize");this.locLayerScale=a.getUniformLocation(c,"layerScale");this.locLayerAngle=a.getUniformLocation(c,"layerAngle");this.hasAnyOptionalUniforms=!!(this.locPixelSize||this.locSeconds||this.locSamplerBack||this.locSrcStart||this.locSrcEnd||this.locSrcOriginStart||this.locSrcOriginEnd||this.locLayoutStart||this.locLayoutEnd||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle);this.lpPixelHeight=this.lpPixelWidth=-999;this.lpOpacity=1;this.lpDestStartY=this.lpDestStartX=
this.lpLayoutEndY=this.lpLayoutEndX=this.lpLayoutStartY=this.lpLayoutStartX=this.lpSrcOriginEndY=this.lpSrcOriginEndX=this.lpSrcOriginStartY=this.lpSrcOriginStartX=this.lpSrcEndY=this.lpSrcEndX=this.lpSrcStartY=this.lpSrcStartX=0;this.lpLayerScale=this.lpDestEndY=this.lpDestEndX=1;this.lpSeconds=this.lpLayerAngle=0;this.lastCustomParams=[];this.lpMatMV=mat4.create();this.locOpacity&&a.uniform1f(this.locOpacity,1);this.locColorFill&&a.uniform4f(this.locColorFill,1,1,1,1);this.locSamplerFront&&a.uniform1i(this.locSamplerFront,
0);this.locSamplerBack&&a.uniform1i(this.locSamplerBack,1);this.locSrcStart&&a.uniform2f(this.locSrcStart,0,0);this.locSrcEnd&&a.uniform2f(this.locSrcEnd,1,1);this.locSrcOriginStart&&a.uniform2f(this.locSrcOriginStart,0,0);this.locSrcOriginEnd&&a.uniform2f(this.locSrcOriginEnd,0,0);this.locLayoutStart&&a.uniform2f(this.locLayoutStart,0,0);this.locLayoutEnd&&a.uniform2f(this.locLayoutEnd,0,0);this.locDestStart&&a.uniform2f(this.locDestStart,0,0);this.locDestEnd&&a.uniform2f(this.locDestEnd,1,1);this.locLayerScale&&
a.uniform1f(this.locLayerScale,1);this.locLayerAngle&&a.uniform1f(this.locLayerAngle,0);this.locSeconds&&a.uniform1f(this.locSeconds,0);this.hasCurrentMatMV=!1}function w(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]}function E(a,c){this.type=a;this.glwrap=c;this.gl=c.gl;this.indexCount=this.startIndex=this.opacityParam=
0;this.mat4param=this.texParam=null;this.layoutRect=quat4.create();this.srcOriginRect=quat4.create();this.shaderParams=[];cr.seal(this)}var N=mat4.create();b.prototype.initState=function(){var a=this.gl,c;this.lastOpacity=1;this.lastTexture1=this.lastTexture0=null;this.currentOpacity=1;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);a.disable(a.CULL_FACE);a.disable(a.STENCIL_TEST);a.disable(a.DITHER);this.enableFrontToBack?(a.enable(a.DEPTH_TEST),
a.depthFunc(a.LEQUAL)):a.disable(a.DEPTH_TEST);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.lastSrcBlend=a.ONE;this.lastDestBlend=a.ONE_MINUS_SRC_ALPHA;this.vertexData=new Float32Array(8E3*(this.enableFrontToBack?3:2));this.texcoordData=new Float32Array(16E3);this.pointData=new Float32Array(32E3);this.pointBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer);a.bufferData(a.ARRAY_BUFFER,this.pointData.byteLength,a.DYNAMIC_DRAW);this.vertexBuffers=Array(4);this.texcoordBuffers=
Array(4);for(c=0;4>c;c++)this.vertexBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[c]),a.bufferData(a.ARRAY_BUFFER,this.vertexData.byteLength,a.DYNAMIC_DRAW),this.texcoordBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[c]),a.bufferData(a.ARRAY_BUFFER,this.texcoordData.byteLength,a.DYNAMIC_DRAW);this.curBuffer=0;this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var l=new Uint16Array(12E3),v=c=0;12E3>
c;)l[c++]=v,l[c++]=v+1,l[c++]=v+2,l[c++]=v,l[c++]=v+2,l[c++]=v+3,v+=4;a.bufferData(a.ELEMENT_ARRAY_BUFFER,l,a.STATIC_DRAW);this.pointPtr=this.texPtr=this.vertexPtr=0;this.shaderPrograms=[];c=this.enableFrontToBack?"attribute highp vec3 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);\n\tvTex = aTex;\n}":"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}";
l=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp float opacity;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex);\n\tgl_FragColor *= opacity;\n}"},c,"<default>");this.shaderPrograms.push(l);l=this.createShaderProgram({src:"uniform mediump sampler2D samplerFront;\nvarying lowp float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);\n\tgl_FragColor *= opacity;\n}"},"attribute vec4 aPos;\nvarying float opacity;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tgl_PointSize = aPos.z;\n\topacity = aPos.w;\n}",
"<point>");this.shaderPrograms.push(l);l=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tif (texture2D(samplerFront, vTex).a < 1.0)\n\t\tdiscard;\n}"},c,"<earlyz>");this.shaderPrograms.push(l);l=this.createShaderProgram({src:"uniform lowp vec4 colorFill;\nvoid main(void) {\n\tgl_FragColor = colorFill;\n}"},c,"<fill>");this.shaderPrograms.push(l);for(var t in cr.shaders)cr.shaders.hasOwnProperty(t)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[t],
c,t));a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,null);this.batch=[];this.batchPtr=0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.currentProgram=this.lastProgram=-1;this.currentShader=null;this.fbo=a.createFramebuffer();this.depthBuffer=this.renderToTex=null;this.attachedDepthBuffer=!1;this.enableFrontToBack&&(this.depthBuffer=a.createRenderbuffer());this.tmpVec3=vec3.create([0,0,0]);a=a.getParameter(a.ALIASED_POINT_SIZE_RANGE);this.minPointSize=a[0];this.maxPointSize=a[1];2048<
this.maxPointSize&&(this.maxPointSize=2048);this.switchProgram(0);cr.seal(this)};m.prototype.updateMatMV=function(a){w(this.lpMatMV,a)||(mat4.set(a,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,a))};b.prototype.createShaderProgram=function(a,c,l){var v=this.gl,t=v.createShader(v.FRAGMENT_SHADER);v.shaderSource(t,a.src);v.compileShader(t);if(!v.getShaderParameter(t,v.COMPILE_STATUS))throw a=v.getShaderInfoLog(t),v.deleteShader(t),Error("error compiling fragment shader: "+a);var y=v.createShader(v.VERTEX_SHADER);
v.shaderSource(y,c);v.compileShader(y);if(!v.getShaderParameter(y,v.COMPILE_STATUS))throw a=v.getShaderInfoLog(y),v.deleteShader(t),v.deleteShader(y),Error("error compiling vertex shader: "+a);c=v.createProgram();v.attachShader(c,t);v.attachShader(c,y);v.linkProgram(c);if(!v.getProgramParameter(c,v.LINK_STATUS))throw a=v.getProgramInfoLog(c),v.deleteShader(t),v.deleteShader(y),v.deleteProgram(c),Error("error linking shader program: "+a);v.useProgram(c);v.deleteShader(t);v.deleteShader(y);t=new m(v,
c,l);t.extendBoxHorizontal=a.extendBoxHorizontal||0;t.extendBoxVertical=a.extendBoxVertical||0;t.crossSampling=!!a.crossSampling;t.preservesOpaqueness=!!a.preservesOpaqueness;t.animated=!!a.animated;t.parameters=a.parameters||[];a=0;for(y=t.parameters.length;a<y;a++)t.parameters[a][1]=v.getUniformLocation(c,t.parameters[a][0]),t.lastCustomParams.push(0);cr.seal(t);return t};b.prototype.getShaderIndex=function(a){var c;var l=0;for(c=this.shaderPrograms.length;l<c;l++)if(this.shaderPrograms[l].name===
a)return l;return-1};b.prototype.project=function(a,c,l){var v=this.matMV,t=this.matP,y=[0,0,0,0,0,0,0,0];y[0]=v[0]*a+v[4]*c+v[12];y[1]=v[1]*a+v[5]*c+v[13];y[2]=v[2]*a+v[6]*c+v[14];y[3]=v[3]*a+v[7]*c+v[15];y[4]=t[0]*y[0]+t[4]*y[1]+t[8]*y[2]+t[12]*y[3];y[5]=t[1]*y[0]+t[5]*y[1]+t[9]*y[2]+t[13]*y[3];y[6]=t[2]*y[0]+t[6]*y[1]+t[10]*y[2]+t[14]*y[3];y[7]=-y[2];0!==y[7]&&(y[7]=1/y[7],y[4]*=y[7],y[5]*=y[7],y[6]*=y[7],l[0]=(.5*y[4]+.5)*this.width,l[1]=(.5*y[5]+.5)*this.height)};b.prototype.setSize=function(a,
c,l){if(this.width!==a||this.height!==c||l){this.endBatch();l=this.gl;this.width=a;this.height=c;l.viewport(0,0,a,c);mat4.lookAt(this.cam,this.look,this.up,this.matMV);this.enableFrontToBack?(mat4.ortho(-a/2,a/2,c/2,-c/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1):(mat4.perspective(45,a/c,this.zNear,this.zFar,this.matP),a=[0,0],c=[0,0],this.project(0,0,a),this.project(1,1,c),this.worldScale[0]=1/(c[0]-a[0]),this.worldScale[1]=-1/(c[1]-a[1]));a=0;for(c=this.shaderPrograms.length;a<
c;a++){var v=this.shaderPrograms[a];v.hasCurrentMatMV=!1;v.locMatP&&(l.useProgram(v.shaderProgram),l.uniformMatrix4fv(v.locMatP,!1,this.matP))}l.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram);l.bindTexture(l.TEXTURE_2D,null);l.activeTexture(l.TEXTURE1);l.bindTexture(l.TEXTURE_2D,null);l.activeTexture(l.TEXTURE0);this.lastTexture1=this.lastTexture0=null;this.depthBuffer&&(l.bindFramebuffer(l.FRAMEBUFFER,this.fbo),l.bindRenderbuffer(l.RENDERBUFFER,this.depthBuffer),l.renderbufferStorage(l.RENDERBUFFER,
l.DEPTH_COMPONENT16,this.width,this.height),this.attachedDepthBuffer||(l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_ATTACHMENT,l.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),l.bindRenderbuffer(l.RENDERBUFFER,null),l.bindFramebuffer(l.FRAMEBUFFER,null),this.renderToTex=null)}};b.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV);mat4.scale(this.matMV,this.worldScale)};b.prototype.translate=function(a,c){if(0!==a||0!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=
c,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3)};b.prototype.scale=function(a,c){if(1!==a||1!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=c,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3)};b.prototype.rotateZ=function(a){0!==a&&mat4.rotateZ(this.matMV,a)};b.prototype.updateModelView=function(){if(!w(this.lastMV,this.matMV)){var a=this.pushBatch();a.type=5;a.mat4param?mat4.set(this.matMV,a.mat4param):a.mat4param=mat4.create(this.matMV);mat4.set(this.matMV,this.lastMV);this.hasPointBatchTop=
this.hasQuadBatchTop=!1}};b.prototype.setEarlyZIndex=function(a){this.enableFrontToBack&&(32760<a&&(a=32760),this.currentZ=this.cam[2]-this.zNear-a*this.zIncrement)};E.prototype.doSetEarlyZPass=function(){var a=this.gl,c=this.glwrap;0!==this.startIndex?(a.depthMask(!0),a.colorMask(!1,!1,!1,!1),a.disable(a.BLEND),a.bindFramebuffer(a.FRAMEBUFFER,c.fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.clear(a.DEPTH_BUFFER_BIT),a.bindFramebuffer(a.FRAMEBUFFER,null),c.isBatchInEarlyZPass=
!0):(a.depthMask(!1),a.colorMask(!0,!0,!0,!0),a.enable(a.BLEND),c.isBatchInEarlyZPass=!1)};E.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)};E.prototype.doSetTexture1=function(){var a=this.gl;a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,this.texParam);a.activeTexture(a.TEXTURE0)};E.prototype.doSetOpacity=function(){var a=this.opacityParam,c=this.glwrap;c.currentOpacity=a;c=c.currentShader;c.locOpacity&&c.lpOpacity!==a&&(c.lpOpacity=a,this.gl.uniform1f(c.locOpacity,
a))};E.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)};E.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)};E.prototype.doUpdateModelView=function(){var a,c=this.glwrap.shaderPrograms,l=this.glwrap.currentProgram;var v=0;for(a=c.length;v<a;v++){var t=c[v];v===l&&t.locMatMV?(t.updateMatMV(this.mat4param),t.hasCurrentMatMV=!0):t.hasCurrentMatMV=!1}mat4.set(this.mat4param,this.glwrap.currentMV)};
E.prototype.doRenderToTexture=function(){var a=this.gl,c=this.glwrap;this.texParam?(c.lastTexture1===this.texParam&&(a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,null),c.lastTexture1=null,a.activeTexture(a.TEXTURE0)),a.bindFramebuffer(a.FRAMEBUFFER,c.fbo),c.isBatchInEarlyZPass||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texParam,0)):(c.enableFrontToBack||a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.bindFramebuffer(a.FRAMEBUFFER,
null))};E.prototype.doClear=function(){var a=this.gl,c=this.startIndex;0===c?(a.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clear(a.COLOR_BUFFER_BIT)):1===c?(a.enable(a.SCISSOR_TEST),a.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.SCISSOR_TEST)):a.clear(a.DEPTH_BUFFER_BIT)};E.prototype.doSetDepthTestEnabled=function(){var a=this.gl;0!==this.startIndex?a.enable(a.DEPTH_TEST):
a.disable(a.DEPTH_TEST)};E.prototype.doPoints=function(){var a=this.gl,c=this.glwrap;c.enableFrontToBack&&a.disable(a.DEPTH_TEST);var l=c.shaderPrograms[1];a.useProgram(l.shaderProgram);!l.hasCurrentMatMV&&l.locMatMV&&(l.updateMatMV(c.currentMV),l.hasCurrentMatMV=!0);a.enableVertexAttribArray(l.locAPos);a.bindBuffer(a.ARRAY_BUFFER,c.pointBuffer);a.vertexAttribPointer(l.locAPos,4,a.FLOAT,!1,0,0);a.drawArrays(a.POINTS,this.startIndex/4,this.indexCount);l=c.currentShader;a.useProgram(l.shaderProgram);
0<=l.locAPos&&(a.enableVertexAttribArray(l.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(l.locAPos,c.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=l.locATex&&(a.enableVertexAttribArray(l.locATex),a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(l.locATex,2,a.FLOAT,!1,0,0));c.enableFrontToBack&&a.enable(a.DEPTH_TEST)};E.prototype.doSetProgram=function(){var a=this.gl,c=this.glwrap,l=c.shaderPrograms[this.startIndex];c.currentProgram=
this.startIndex;c.currentShader=l;a.useProgram(l.shaderProgram);!l.hasCurrentMatMV&&l.locMatMV&&(l.updateMatMV(c.currentMV),l.hasCurrentMatMV=!0);l.locOpacity&&l.lpOpacity!==c.currentOpacity&&(l.lpOpacity=c.currentOpacity,a.uniform1f(l.locOpacity,c.currentOpacity));0<=l.locAPos&&(a.enableVertexAttribArray(l.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(l.locAPos,c.enableFrontToBack?3:2,a.FLOAT,!1,0,0));0<=l.locATex&&(a.enableVertexAttribArray(l.locATex),
a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(l.locATex,2,a.FLOAT,!1,0,0))};E.prototype.doSetColor=function(){var a=this.mat4param;this.gl.uniform4f(this.glwrap.currentShader.locColorFill,a[0],a[1],a[2],a[3])};E.prototype.doSetProgramParameters=function(){var a=this.glwrap.currentShader,c=this.gl;var l=this.mat4param;var v=this.layoutRect;var t=this.srcOriginRect;a.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,
this.texParam),this.glwrap.lastTexture1=this.texParam,c.activeTexture(c.TEXTURE0));var y=l[0],L=l[1];!a.locPixelSize||y===a.lpPixelWidth&&L===a.lpPixelHeight||(a.lpPixelWidth=y,a.lpPixelHeight=L,c.uniform2f(a.locPixelSize,y,L));y=l[2];L=l[3];!a.locDestStart||y===a.lpDestStartX&&L===a.lpDestStartY||(a.lpDestStartX=y,a.lpDestStartY=L,c.uniform2f(a.locDestStart,y,L));y=l[4];L=l[5];!a.locDestEnd||y===a.lpDestEndX&&L===a.lpDestEndY||(a.lpDestEndX=y,a.lpDestEndY=L,c.uniform2f(a.locDestEnd,y,L));y=l[6];
a.locLayerScale&&y!==a.lpLayerScale&&(a.lpLayerScale=y,c.uniform1f(a.locLayerScale,y));y=l[7];a.locLayerAngle&&y!==a.lpLayerAngle&&(a.lpLayerAngle=y,c.uniform1f(a.locLayerAngle,y));y=l[12];L=l[13];!a.locSrcStart||y===a.lpSrcStartX&&L===a.lpSrcStartY||(a.lpSrcStartX=y,a.lpSrcStartY=L,c.uniform2f(a.locSrcStart,y,L));y=l[14];L=l[15];!a.locSrcEnd||y===a.lpSrcEndX&&L===a.lpSrcEndY||(a.lpSrcEndX=y,a.lpSrcEndY=L,c.uniform2f(a.locSrcEnd,y,L));y=t[0];L=t[1];!a.locSrcOriginStart||y===a.lpSrcOriginStartX&&L===
a.lpSrcOriginStartY||(a.lpSrcOriginStartX=y,a.lpSrcOriginStartY=L,c.uniform2f(a.locSrcOriginStart,y,L));y=t[2];L=t[3];!a.locSrcOriginEnd||y===a.lpSrcOriginEndX&&L===a.lpSrcOriginEndY||(a.lpSrcOriginEndX=y,a.lpSrcOriginEndY=L,c.uniform2f(a.locSrcOriginEnd,y,L));y=v[0];L=v[1];!a.locLayoutStart||y===a.lpLayoutStartX&&L===a.lpLayoutStartY||(a.lpLayoutStartX=y,a.lpLayoutStartY=L,c.uniform2f(a.locLayoutStart,y,L));y=v[2];L=v[3];!a.locLayoutEnd||y===a.lpLayoutEndX&&L===a.lpLayoutEndY||(a.lpLayoutEndX=y,
a.lpLayoutEndY=L,c.uniform2f(a.locLayoutEnd,y,L));y=this.startIndex;a.locSeconds&&y!==a.lpSeconds&&(a.lpSeconds=y,c.uniform1f(a.locSeconds,y));if(a.parameters.length)for(l=0,v=a.parameters.length;l<v;l++)y=this.shaderParams[l],Array.isArray(y)?c.uniform3fv(a.parameters[l][1],y):y!==a.lastCustomParams[l]&&(a.lastCustomParams[l]=y,c.uniform1f(a.parameters[l][1],y))};b.prototype.pushBatch=function(){this.batchPtr===this.batch.length&&this.batch.push(new E(0,this));return this.batch[this.batchPtr++]};
b.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){this.maybeStartTiming();var a=this.gl;0<this.pointPtr&&(a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer),a.bufferSubData(a.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),c&&0<=c.locAPos&&"<point>"===c.name&&a.vertexAttribPointer(c.locAPos,4,a.FLOAT,!1,0,0));if(0<this.vertexPtr){var c=this.currentShader;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexData.subarray(0,
this.vertexPtr));c&&0<=c.locAPos&&"<point>"!==c.name&&a.vertexAttribPointer(c.locAPos,this.enableFrontToBack?3:2,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]);a.bufferSubData(a.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr));c&&0<=c.locATex&&"<point>"!==c.name&&a.vertexAttribPointer(c.locATex,2,a.FLOAT,!1,0,0)}a=0;for(c=this.batchPtr;a<c;a++){var l=this.batch[a];switch(l.type){case 1:l.doQuad();break;case 2:l.doSetTexture();break;case 3:l.doSetOpacity();
break;case 4:l.doSetBlend();break;case 5:l.doUpdateModelView();break;case 6:l.doRenderToTexture();break;case 7:l.doClear();break;case 8:l.doPoints();break;case 9:l.doSetProgram();break;case 10:l.doSetProgramParameters();break;case 11:l.doSetTexture1();break;case 12:l.doSetColor();break;case 13:l.doSetDepthTestEnabled();break;case 14:l.doSetEarlyZPass()}}this.pointPtr=this.texPtr=this.vertexPtr=this.batchPtr=0;this.isBatchInEarlyZPass=this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.curBuffer++;
4<=this.curBuffer&&(this.curBuffer=0)}};b.prototype.maybeStartTiming=function(){if(!this.isTiming&&this.timerExt){this.isTiming=!0;var a={frameNumber:this.frameNumber,query:null,result:0};2===this.version?(a.query=this.gl.createQuery(),this.gl.beginQuery(this.timerExt.TIME_ELAPSED_EXT,a.query)):(a.query=this.timerExt.createQueryEXT(),this.timerExt.beginQueryEXT(this.timerExt.TIME_ELAPSED_EXT,a.query));this.timerResults.push(a);1E3<this.timerResults.length&&(a=this.timerResults.shift(),a.query&&(2===
this.version?this.gl.deleteQuery(a.query):this.timerExt.deleteQueryEXT(a.query)))}};b.prototype.maybeFinishTiming=function(){this.isTiming&&this.timerResults.length&&(2===this.version?this.gl.endQuery(this.timerExt.TIME_ELAPSED_EXT):this.timerExt.endQueryEXT(this.timerExt.TIME_ELAPSED_EXT),this.isTiming=!1)};b.prototype.checkForTimerResults=function(a){var c;var l=0;for(c=this.timerResults.length;l<c;++l){var v=this.timerResults[l];if(v.frameNumber>=a)break;if(v.query){var t=2===this.version?this.gl.getQueryParameter(v.query,
this.gl.QUERY_RESULT_AVAILABLE):this.timerExt.getQueryObjectEXT(v.query,this.timerExt.QUERY_RESULT_AVAILABLE_EXT);var y=this.gl.getParameter(this.timerExt.GPU_DISJOINT_EXT);t&&!y&&(v.result=2===this.version?this.gl.getQueryParameter(v.query,this.gl.QUERY_RESULT):this.timerExt.getQueryObjectEXT(v.query,this.timerExt.QUERY_RESULT_EXT),v.result/=1E9);if(t||y)2===this.version?this.gl.deleteQuery(v.query):this.timerExt.deleteQueryEXT(v.query),v.query=null}}};b.prototype.getFrameRangeTimerResults=function(a,
c){if(c<=a)return-1;var l,v=0,t=0;var y=0;for(l=this.timerResults.length;y<l;++y){var L=this.timerResults[y];if(L.frameNumber>=c)break;if(L.frameNumber>=a){if(L.query)return-1;v+=L.result;t++}}return t<c-a?-1:v};b.prototype.deleteTimerResultsToFrame=function(a){var c;var l=0;for(c=this.timerResults.length;l<c;++l){var v=this.timerResults[l];if(v.frameNumber>=a){0<l&&this.timerResults.splice(0,l);break}}};b.prototype.setOpacity=function(a){if(a!==this.lastOpacity&&!this.isEarlyZPass){var c=this.pushBatch();
c.type=3;this.lastOpacity=c.opacityParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setTexture=function(a){if(a!==this.lastTexture0){var c=this.pushBatch();c.type=2;this.lastTexture0=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.setBlend=function(a,c){if((a!==this.lastSrcBlend||c!==this.lastDestBlend)&&!this.isEarlyZPass){var l=this.pushBatch();l.type=4;l.startIndex=a;l.indexCount=c;this.lastSrcBlend=a;this.lastDestBlend=c;this.hasPointBatchTop=this.hasQuadBatchTop=
!1}};b.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA};b.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};b.prototype.quad=function(a,c,l,v,t,y,L,q){15992<=this.vertexPtr&&this.endBatch();var B=this.vertexPtr,A=this.texPtr,h=this.vertexData,n=this.texcoordData,
z=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var P=this.pushBatch();P.type=1;P.startIndex=this.enableFrontToBack?B:B/2*3;P.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(h[B++]=a,h[B++]=c,h[B++]=z,h[B++]=l,h[B++]=v,h[B++]=z,h[B++]=t,h[B++]=y,h[B++]=z,h[B++]=L,h[B++]=q,h[B++]=z):(h[B++]=a,h[B++]=c,h[B++]=l,h[B++]=v,h[B++]=t,h[B++]=y,h[B++]=L,h[B++]=q);n[A++]=0;n[A++]=0;n[A++]=1;n[A++]=0;n[A++]=1;n[A++]=1;n[A++]=0;n[A++]=
1;this.vertexPtr=B;this.texPtr=A};b.prototype.quadTex=function(a,c,l,v,t,y,L,q,B){15992<=this.vertexPtr&&this.endBatch();var A=this.vertexPtr,h=this.texPtr,n=this.vertexData,z=this.texcoordData,P=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var V=this.pushBatch();V.type=1;V.startIndex=this.enableFrontToBack?A:A/2*3;V.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}V=B.left;var H=B.top,d=B.right;B=B.bottom;this.enableFrontToBack?(n[A++]=a,n[A++]=
c,n[A++]=P,n[A++]=l,n[A++]=v,n[A++]=P,n[A++]=t,n[A++]=y,n[A++]=P,n[A++]=L,n[A++]=q,n[A++]=P):(n[A++]=a,n[A++]=c,n[A++]=l,n[A++]=v,n[A++]=t,n[A++]=y,n[A++]=L,n[A++]=q);z[h++]=V;z[h++]=H;z[h++]=d;z[h++]=H;z[h++]=d;z[h++]=B;z[h++]=V;z[h++]=B;this.vertexPtr=A;this.texPtr=h};b.prototype.quadTexUV=function(a,c,l,v,t,y,L,q,B,A,h,n,z,P,V,H){15992<=this.vertexPtr&&this.endBatch();var d=this.vertexPtr,k=this.texPtr,F=this.vertexData,e=this.texcoordData,u=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-
1].indexCount+=6;else{var J=this.pushBatch();J.type=1;J.startIndex=this.enableFrontToBack?d:d/2*3;J.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}this.enableFrontToBack?(F[d++]=a,F[d++]=c,F[d++]=u,F[d++]=l,F[d++]=v,F[d++]=u,F[d++]=t,F[d++]=y,F[d++]=u,F[d++]=L,F[d++]=q,F[d++]=u):(F[d++]=a,F[d++]=c,F[d++]=l,F[d++]=v,F[d++]=t,F[d++]=y,F[d++]=L,F[d++]=q);e[k++]=B;e[k++]=A;e[k++]=h;e[k++]=n;e[k++]=z;e[k++]=P;e[k++]=V;e[k++]=H;this.vertexPtr=d;this.texPtr=k};b.prototype.convexPoly=function(a){var c=
a.length/2-2,l=c-1,v=a[0],t=a[1],y;for(y=0;y<c;y+=2){var L=2*y;var q=a[L+2];var B=a[L+3];var A=a[L+4];var h=a[L+5];if(y===l)this.quad(v,t,q,B,A,h,A,h);else{var n=a[L+6];L=a[L+7];this.quad(v,t,q,B,A,h,n,L)}}};b.prototype.point=function(a,c,l,v){7996<=this.pointPtr&&this.endBatch();var t=this.pointPtr,y=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var L=this.pushBatch();L.type=8;L.startIndex=t;L.indexCount=1;this.hasPointBatchTop=!0;this.hasQuadBatchTop=!1}y[t++]=
a;y[t++]=c;y[t++]=l;y[t++]=v;this.pointPtr=t};b.prototype.switchProgram=function(a){if(this.lastProgram!==a){if(!this.shaderPrograms[a]){if(0===this.lastProgram)return;a=0}var c=this.pushBatch();c.type=9;this.lastProgram=c.startIndex=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.programUsesDest=function(a){a=this.shaderPrograms[a];return!(!a.locDestStart&&!a.locDestEnd)};b.prototype.programUsesCrossSampling=function(a){a=this.shaderPrograms[a];return!!(a.locDestStart||a.locDestEnd||
a.crossSampling)};b.prototype.programPreservesOpaqueness=function(a){return this.shaderPrograms[a].preservesOpaqueness};b.prototype.programExtendsBox=function(a){a=this.shaderPrograms[a];return 0!==a.extendBoxHorizontal||0!==a.extendBoxVertical};b.prototype.getProgramBoxExtendHorizontal=function(a){return this.shaderPrograms[a].extendBoxHorizontal};b.prototype.getProgramBoxExtendVertical=function(a){return this.shaderPrograms[a].extendBoxVertical};b.prototype.getProgramParameterType=function(a,c){return this.shaderPrograms[a].parameters[c][2]};
b.prototype.programIsAnimated=function(a){return this.shaderPrograms[a].animated};b.prototype.setProgramParameters=function(a,c,l,v,t,y,L,q,B,A,h,n,z,P,V,H,d,k,F,e,u,J,M){var U=this.shaderPrograms[this.lastProgram];if(U.hasAnyOptionalUniforms||M.length){var W=this.pushBatch();W.type=10;W.mat4param?mat4.set(this.matMV,W.mat4param):W.mat4param=mat4.create();var X=W.mat4param;X[0]=c;X[1]=l;X[2]=H;X[3]=d;X[4]=k;X[5]=F;X[6]=e;X[7]=u;X[12]=v;X[13]=t;X[14]=y;X[15]=L;c=W.srcOriginRect;c[0]=q;c[1]=B;c[2]=
A;c[3]=h;q=W.layoutRect;q[0]=n;q[1]=V;q[2]=P;q[3]=z;W.startIndex=J;W.texParam=U.locSamplerBack?a:null;if(M.length)for(z=W.shaderParams,z.length=M.length,a=0,n=M.length;a<n;a++)z[a]=M[a];this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clear=function(a,c,l,v){var t=this.pushBatch();t.type=7;t.startIndex=0;t.mat4param||(t.mat4param=mat4.create());t.mat4param[0]=a;t.mat4param[1]=c;t.mat4param[2]=l;t.mat4param[3]=v;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.clearRect=function(a,
c,l,v){if(!(0>l||0>v)){var t=this.pushBatch();t.type=7;t.startIndex=1;t.mat4param||(t.mat4param=mat4.create());t.mat4param[0]=a;t.mat4param[1]=c;t.mat4param[2]=l;t.mat4param[3]=v;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.clearDepth=function(){var a=this.pushBatch();a.type=7;a.startIndex=2;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setEarlyZPass=function(a){if(this.enableFrontToBack&&(a=!!a,this.isEarlyZPass!==a)){var c=this.pushBatch();c.type=14;c.startIndex=a?1:
0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.isEarlyZPass=a;this.renderToTex=null;this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}};b.prototype.setDepthTestEnabled=function(a){if(this.enableFrontToBack){var c=this.pushBatch();c.type=13;c.startIndex=a?1:0;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};b.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,N);this.resetModelView();this.updateModelView();var a=this.width/2,c=this.height/2;this.quad(-a,c,a,c,a,-c,-a,-c);mat4.set(N,
this.matMV);this.updateModelView()};b.prototype.setColorFillMode=function(a,c,l,v){this.switchProgram(3);var t=this.pushBatch();t.type=12;t.mat4param||(t.mat4param=mat4.create());t.mat4param[0]=a;t.mat4param[1]=c;t.mat4param[2]=l;t.mat4param[3]=v;this.hasPointBatchTop=this.hasQuadBatchTop=!1};b.prototype.setTextureFillMode=function(){this.switchProgram(0)};b.prototype.restoreEarlyZMode=function(){this.switchProgram(2)};b.prototype.getFrameNumber=function(){return this.frameNumber};b.prototype.present=
function(){this.endBatch();this.maybeFinishTiming();this.gl.flush();this.checkForTimerResults(this.frameNumber);this.frameNumber++};b.prototype.supportsGpuProfiling=function(){return!!this.timerExt};var D=[],f={};b.prototype.contextLost=function(){cr.clearArray(D);f={}};b.prototype.loadTexture=function(a,c,l,v,t,y){c=!!c;l=!!l;var L=a.src+","+c+","+l+(c?","+t:"");if("undefined"!==typeof a.src&&f.hasOwnProperty(L)){var q=f[L];q.c2refcount++;return q}this.endBatch();var B=this.gl,A=cr.isPOT(a.width)&&
cr.isPOT(a.height);q=B.createTexture();B.bindTexture(B.TEXTURE_2D,q);B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var h=B.RGBA,n=B.RGBA,z=B.UNSIGNED_BYTE;if(v&&!this.isIE)switch(v){case 1:n=h=B.RGB;break;case 2:z=B.UNSIGNED_SHORT_4_4_4_4;break;case 3:z=B.UNSIGNED_SHORT_5_5_5_1;break;case 4:n=h=B.RGB,z=B.UNSIGNED_SHORT_5_6_5}if(1===this.version&&!A&&c){v=document.createElement("canvas");v.width=cr.nextHighestPowerOfTwo(a.width);v.height=cr.nextHighestPowerOfTwo(a.height);var P=v.getContext("2d");
P.imageSmoothingEnabled=l;P.drawImage(a,0,0,a.width,a.height,0,0,v.width,v.height);B.texImage2D(B.TEXTURE_2D,0,h,n,z,v)}else B.texImage2D(B.TEXTURE_2D,0,h,n,z,a);c?"repeat-x"===t?(B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.REPEAT),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE)):("repeat-y"===t?B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE):B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.REPEAT),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.REPEAT)):(B.texParameteri(B.TEXTURE_2D,
B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE));l?(B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),(A||2<=this.version)&&this.enable_mipmaps&&!y?(B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR_MIPMAP_LINEAR),B.generateMipmap(B.TEXTURE_2D)):B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR)):(B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.NEAREST),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.NEAREST));B.bindTexture(B.TEXTURE_2D,
null);this.lastTexture0=null;q.c2width=a.width;q.c2height=a.height;q.c2refcount=1;q.c2texkey=L;D.push(q);return f[L]=q};b.prototype.createEmptyTexture=function(a,c,l,v,t){this.endBatch();var y=this.gl;this.isIE&&(v=!1);var L=y.createTexture();y.bindTexture(y.TEXTURE_2D,L);y.texImage2D(y.TEXTURE_2D,0,y.RGBA,a,c,0,y.RGBA,v?y.UNSIGNED_SHORT_4_4_4_4:y.UNSIGNED_BYTE,null);t?(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.REPEAT),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.REPEAT)):(y.texParameteri(y.TEXTURE_2D,
y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE));y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,l?y.LINEAR:y.NEAREST);y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,l?y.LINEAR:y.NEAREST);y.bindTexture(y.TEXTURE_2D,null);this.lastTexture0=null;L.c2width=a;L.c2height=c;D.push(L);return L};b.prototype.videoToTexture=function(a,c,l){this.endBatch();var v=this.gl;this.isIE&&(l=!1);v.bindTexture(v.TEXTURE_2D,c);v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!0);try{v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,l?v.UNSIGNED_SHORT_4_4_4_4:v.UNSIGNED_BYTE,a)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}v.bindTexture(v.TEXTURE_2D,null);this.lastTexture0=null};b.prototype.deleteTexture=function(a){a&&("undefined"!==typeof a.c2refcount&&1<a.c2refcount?a.c2refcount--:(this.endBatch(),a===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),a===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),
this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(D,a),"undefined"!==typeof a.c2texkey&&delete f[a.c2texkey],this.gl.deleteTexture(a)))};b.prototype.estimateVRAM=function(){var a=this.width*this.height*8,c;var l=0;for(c=D.length;l<c;l++){var v=D[l];a+=v.c2width*v.c2height*4}return a};b.prototype.textureCount=function(){return D.length};b.prototype.setRenderingToTexture=function(a){if(a!==this.renderToTex){var c=this.pushBatch();
c.type=6;this.renderToTex=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};cr.GLWrap=b})();
(function(){function b(g){var p=g.canvas,C=g.projectDataUrl;p||(p=document.createElement("canvas"),document.body.appendChild(p));if(p&&p.getContext){window.c3runtime=this;window.c3canvas=p;var G=this;this.exportType=g.exportType;this.isPreview="preview"===this.exportType;this.isRemotePreview=!!g.isRemotePreview;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!("undefined"===typeof window.c2isCrosswalk||!window.c2isCrosswalk);this.isPhoneGap=this.isCordova=
"cordova"===this.exportType;this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent);this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge;this.isTizen=/tizen/i.test(navigator.userAgent);this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge;this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;
this.isiPad=/ipad/i.test(navigator.userAgent);this.isiOS=this.isiPhone||this.isiPad;this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent);this.isFirefox=/firefox/i.test(navigator.userAgent);this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge;this.isWindows=/windows/i.test(navigator.userAgent);this.isNodeWebkit=
this.isNWjs="nwjs"===this.exportType||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent);this.isArcade="scirra-arcade"===this.exportType;this.isWindows8App=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.isWindowsPhone8=!("undefined"===typeof window.c2isWindowsPhone8||!window.c2isWindowsPhone8);this.isWindowsPhone81=!("undefined"===typeof window.c2isWindowsPhone81||!window.c2isWindowsPhone81);this.isWindows10="windows-uwp"===this.exportType;this.isWinJS=
this.isWindows8App||this.isWindowsPhone81||this.isWindows10;this.isBlackberry10=!("undefined"===typeof window.c2isBlackberry10||!window.c2isBlackberry10);this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp;this.devicePixelRatio=1;this.isMobile=this.isCordova||this.isCrosswalk||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen;this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent));
this.isWKWebView=!(!this.isiOS||!this.isCordova);this.isPreview&&!this.isNWjs&&("?nw"===window.location.search||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0);this.isDebug=this.isPreview&&-1<window.location.search.indexOf("debug");this.useFbInstant="undefined"!==typeof FBInstant&&!this.isPreview&&!this.isCordova;this.hasInitialized=!1;this.canvas=p;this.glwrap=this.gl=null;this.glUnmaskedRenderer="(unavailable)";this.enableFrontToBack=!1;this.earlyz_index=
0;this.ctx=null;this.firstInFullscreen=!1;this.oldHeight=this.oldWidth=0;this.canvas.oncontextmenu=function(x){x.preventDefault&&x.preventDefault();return!1};this.canvas.onselectstart=function(x){x.preventDefault&&x.preventDefault();return!1};this.canvas.ontouchstart=function(x){x.preventDefault&&x.preventDefault();return!1};this.isNWjs&&(window.ondragover=function(x){x.preventDefault();return!1},window.ondrop=function(x){x.preventDefault();return!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache());
if(this.isCordova&&this.isiOS){function x(){var K=document.activeElement;if(!K)return!1;var R=K.tagName.toLowerCase(),S="email number password search tel text url".split(" ");if("textarea"===R)return!0;if("input"===R)return-1<S.indexOf(K.type.toLowerCase()||"text");a:{do{if(K.parentNode&&K.hasAttribute("contenteditable")){K=!0;break a}K=K.parentNode}while(K);K=!1}return K}window.addEventListener("focusout",function(){x()||(document.scrollingElement.scrollTop=0)})}this.projectDataUrl=C||"";this.width=
p.width;this.height=p.height;this.draw_width=this.width;this.draw_height=this.height;this.cssWidth=this.width;this.cssHeight=this.height;this.lastWindowWidth=window.innerWidth;this.lastWindowHeight=window.innerHeight;this.forceCanvasAlpha=!1;this.redraw=!0;this.isSuspended=!1;Date.now||(Date.now=function(){return+new Date});this.plugins=[];this.types={};this.types_lowercase={};this.types_by_index=[];this.behaviors=[];this.layouts={};this.layouts_by_index=[];this.eventsheets={};this.eventsheets_by_index=
[];this.wait_for_textures=[];this.triggers_to_postinit=[];this.all_global_vars=[];this.all_local_vars=[];this.shadowcasterBehavior=this.jumpthruBehavior=this.solidBehavior=null;this.deathRow={};this.isInClearDeathRow=this.hasPendingInstances=!1;this.isInOnDestroy=0;this.isEndingLayout=this.isRunningEvents=!1;this.createRow=[];this.isLoadingState=!1;this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null;this.lastSaveJson="";this.suspendDrawing=this.signalledContinuousPreview=!1;this.fireOnCreateAfterLoad=
[];this.dt1=this.dt=0;this.minimumFramerate=30;this.cpuutilisation=this.logictime=0;this.timescale=1;this.kahanTime=new cr.KahanAdder;this.wallTime=new cr.KahanAdder;this.gpuTimeEndFrame=this.gpuTimeStartFrame=this.objectcount=this.framecount=this.execcount=this.tickcount_nosave=this.tickcount=this.last_fps_time=this.fps=this.last_tick_time=0;this.gpuCurUtilisation=-1;this.gpuLastUtilisation=0;this.changelayout=null;this.destroycallbacks=[];this.event_stack=[];this.event_stack_index=-1;this.localvar_stack=
[[]];this.trigger_depth=this.localvar_stack_index=0;this.pushEventStack(null);this.loop_stack=[];this.loop_stack_index=-1;this.next_puid=this.next_uid=0;this.layout_first_tick=!0;this.family_count=0;this.suspend_events=[];this.timeout_id=this.raf_id=-1;this.isloading=!0;this.stackLocalCount=this.loadingprogress=0;this.audioInstance=null;this.isInUserInputEvent=this.had_a_click=!1;this.objects_to_pretick=new cr.ObjectSet;this.objects_to_tick=new cr.ObjectSet;this.objects_to_tick2=new cr.ObjectSet;
this.registered_collisions=[];this.temp_poly=new cr.CollisionPoly([]);this.temp_poly2=new cr.CollisionPoly([]);this.allGroups=[];this.groups_by_name={};this.cndsBySid={};this.actsBySid={};this.varsBySid={};this.blocksBySid={};this.layout_ctx=this.layout_canvas=this.layout_tex=this.layer_tex=this.layer_ctx=this.layer_canvas=this.running_layout=null;this.uses_background_blending=this.is_WebGL_context_lost=!1;this.fx_tex=[null,null];this.fullscreen_scaling=0;this.files_subfolder="";this.objectsByUid=
{};this.webFontNames=this.loaderlogos=null;this.enhancedAccelerationPrecision=!0;this.snapshotCanvas=null;this.snapshotData="";this.objectRefTable=[];"html5"===this.exportType&&"file"===location.protocol.substr(0,4)&&alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");this.useFbInstant?(FBInstant.initializeAsync().then(function(){G.requestProjectData()}).catch(function(x){console.warn("[Instant Games] Unable to load: ",
x);G.requestProjectData()}),window.setTimeout(function(){G.hasInitialized||(console.warn("[Instant Games] Initialization timed out after 4 seconds. Continuing with Instant Games disabled."),G.useFbInstant=!1,G.requestProjectData())},4E3)):this.requestProjectData()}}function m(){var g=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;"object"!==typeof g&&Promise.reject("Permission API is not loaded");return Promise.resolve(g)}function w(g){return m().then(function(p){return new Promise(function(C,
G){p.requestPermission(p[g],function(x){C(x.hasPermission)},G)})})}function E(g){return m().then(function(p){return new Promise(function(C,G){p.checkPermission(p[g],function(x){C(x.hasPermission)},G)})})}function N(){try{return!!window.indexedDB}catch(g){return!1}}function D(g){g.target.result.createObjectStore("saves",{keyPath:"slot"})}function f(g,p,C,G){try{var x=indexedDB.open("_C2SaveStates");x.onupgradeneeded=D;x.onerror=G;x.onsuccess=function(K){K=K.target.result;K.onerror=G;K.transaction(["saves"],
"readwrite").objectStore("saves").put({slot:g,data:p}).onsuccess=C}}catch(K){G(K)}}function a(g,p,C){try{var G=indexedDB.open("_C2SaveStates");G.onupgradeneeded=D;G.onerror=C;G.onsuccess=function(x){x=x.target.result;x.onerror=C;var K=x.transaction(["saves"]).objectStore("saves").get(g);K.onsuccess=function(R){K.result?p(K.result.data):p(null)}}}catch(x){C(x)}}function c(){cr.logexport("Reloading for continuous preview");-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location+=
"?continuous"}function l(g){var p,C={};for(p in g)!g.hasOwnProperty(p)||g[p]instanceof cr.ObjectSet||g[p]&&"undefined"!==typeof g[p].c2userdata||"spriteCreatedDestroyCallback"!==p&&(C[p]=g[p]);return C}var v=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,t=new Audio,y={"audio/webm; codecs=opus":!!t.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!t.canPlayType("audio/ogg; codecs=opus"),
"audio/webm; codecs=vorbis":!!t.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!t.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!t.canPlayType("audio/mp4"),"audio/mpeg":!!t.canPlayType("audio/mpeg")};t=null;b.prototype.requestProjectData=function(){if(!this.hasInitialized){this.hasInitialized=!0;var g=this;if(this.isWKWebView)this.fetchLocalFileViaCordovaAsText("data.js",function(x){g.loadProject(JSON.parse(x))},function(x){alert("Error fetching data.js")});else{var p=
this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var C=this.projectDataUrl||"data.js";if(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)C="data.json";p.open("GET",C,!0);var G=!1;if("response"in p&&"responseType"in p)try{p.responseType="json",G="json"===p.responseType}catch(x){G=!1}if(!G&&"responseType"in p)try{p.responseType="text"}catch(x){}if("overrideMimeType"in p)try{p.overrideMimeType("application/json; charset=utf-8")}catch(x){}this.isWindowsPhone8?
p.onreadystatechange=function(){4===p.readyState&&g.loadProject(JSON.parse(p.responseText))}:(p.onload=function(){G?g.loadProject(p.response):g.loadProject(JSON.parse(p.responseText))},p.onerror=function(x){cr.logerror("Error requesting "+C+":");cr.logerror(x)});p.send()}}};b.prototype.initRendererAndLoader=function(){var g=this,p,C;this.isRetina=this.useHighDpi&&!this.isAndroidStockBrowser;0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1);var G=window.devicePixelRatio||window.webkitDevicePixelRatio||
window.mozDevicePixelRatio||window.msDevicePixelRatio||1;this.devicePixelRatio=this.isRetina?G:1;"object"===typeof window.StatusBar&&window.StatusBar.hide();"object"===typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode();this.ClearDeathRow();0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0);try{if(this.enableWebGL){var x={alpha:!0,depth:!1,antialias:!1,failIfMajorPerformanceCaveat:!0};this.isAndroid||(this.gl=this.canvas.getContext("webgl2",x));this.gl||
(this.gl=this.canvas.getContext("webgl",x)||this.canvas.getContext("experimental-webgl",x))}}catch(ba){}if(this.gl){this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2");if(G=this.gl.getExtension("WEBGL_debug_renderer_info"))x=this.gl.getParameter(G.UNMASKED_VENDOR_WEBGL),this.glUnmaskedRenderer=this.gl.getParameter(G.UNMASKED_RENDERER_WEBGL)+" ["+x+"]";this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]");this.overlay_canvas=document.createElement("canvas");this.canvas.parentNode.appendChild(this.overlay_canvas);
this.overlay_canvas.oncontextmenu=function(ba){return!1};this.overlay_canvas.onselectstart=function(ba){return!1};this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio);this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio);this.overlay_canvas.style.width=this.cssWidth+"px";this.overlay_canvas.style.height=this.cssHeight+"px";this.overlay_canvas.style.position="absolute";this.overlay_ctx=this.overlay_canvas.getContext("2d");this.glwrap=new cr.GLWrap(this.gl,
this.isMobile,this.enableFrontToBack);this.glwrap.setSize(this.canvas.width,this.canvas.height);this.glwrap.enable_mipmaps=0!==this.downscalingQuality;this.ctx=null;this.canvas.addEventListener("webglcontextlost",function(ba){ba.preventDefault();g.onContextLost();cr.logexport("[Construct 2] WebGL context lost");window.cr_setSuspended(!0)},!1);this.canvas.addEventListener("webglcontextrestored",function(ba){g.glwrap.initState();g.glwrap.setSize(g.glwrap.width,g.glwrap.height,!0);g.layer_tex=null;g.layout_tex=
null;g.fx_tex[0]=null;g.fx_tex[1]=null;g.onContextRestored();g.redraw=!0;cr.logexport("[Construct 2] WebGL context restored");window.cr_setSuspended(!1)},!1);this.glwrap.supportsGpuProfiling()||(this.gpuLastUtilisation=NaN);G=0;for(x=this.types_by_index.length;G<x;G++){var K=this.types_by_index[G];var R=0;for(p=K.effect_types.length;R<p;R++){var S=K.effect_types[R];S.shaderindex=this.glwrap.getShaderIndex(S.id);S.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(S.shaderindex);this.uses_background_blending=
this.uses_background_blending||this.glwrap.programUsesDest(S.shaderindex)}}G=0;for(x=this.layouts_by_index.length;G<x;G++){var T=this.layouts_by_index[G];R=0;for(p=T.effect_types.length;R<p;R++)S=T.effect_types[R],S.shaderindex=this.glwrap.getShaderIndex(S.id),S.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(S.shaderindex);T.updateActiveEffects();R=0;for(p=T.layers.length;R<p;R++){var fa=T.layers[R];K=0;for(C=fa.effect_types.length;K<C;K++)S=fa.effect_types[K],S.shaderindex=this.glwrap.getShaderIndex(S.id),
S.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(S.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(S.shaderindex);fa.updateActiveEffects()}}}else x={alpha:!0},this.ctx=this.canvas.getContext("2d",x),this.ctx.imageSmoothingEnabled=this.linearSampling,this.overlay_ctx=this.overlay_canvas=null,this.gpuLastUtilisation=NaN,this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=!0;this.tickFunc=function(ba){g.tick(!1,ba)};window==
window.top||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0));this.isPreview&&(-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(window.addEventListener("focus",function(){g.setSuspended(!1)}),window.addEventListener("blur",
function(){var ba=window.parent;ba&&ba.document.hasFocus()||g.setSuspended(!0)})));window.addEventListener("blur",function(){g.onWindowBlur()});G=function(ba){"mousedown"===ba.type&&1===ba.button&&ba.preventDefault();if(cr.isCanvasInputEvent(ba)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(Z){}};"undefined"!==typeof PointerEvent?document.addEventListener("pointerdown",G):window.navigator.msPointerEnabled?
document.addEventListener("MSPointerDown",G):document.addEventListener("touchstart",G);document.addEventListener("mousedown",G);0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio?this.setSize(this.original_width,this.original_height,!0):this.setSize(window.innerWidth,window.innerHeight,!0);this.tryLockOrientation();this.getready();this.go();this.extra={};cr.seal(this)};b.prototype.setSize=function(g,p,C){var G=0,x=0;if(this.lastWindowWidth!==g||this.lastWindowHeight!==p||C){if(this.isiPhone&&
this.isCordova&&window.screen){var K=document.documentElement.style;var R=document.body.style;var S=window.innerWidth<window.innerHeight;var T=S?window.screen.height:window.screen.width;S=S?window.screen.width:window.screen.height;T&&S&&(R.height=K.height=T+"px",R.width=K.width=S+"px")}this.lastWindowWidth=g;this.lastWindowHeight=p;K=this.fullscreen_mode;if((R=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen)&&!this.isCordova)||0!==this.fullscreen_mode||
C)R&&(K=this.fullscreen_scaling),C=this.devicePixelRatio,4<=K?(5===K&&1!==C&&(g+=1,p+=1),R=this.original_width/this.original_height,g/p>R?(R*=p,5===K?(G=R*C/this.original_width,1<G?G=Math.floor(G):1>G&&(G=1/Math.ceil(1/G)),R=this.original_width*G/C,T=this.original_height*G/C,G=(g-R)/2,x=(p-T)/2,g=R,p=T):(G=(g-R)/2,g=R)):(T=g/R,5===K?(G=T*C/this.original_height,1<G?G=Math.floor(G):1>G&&(G=1/Math.ceil(1/G)),R=this.original_width*G/C,T=this.original_height*G/C,G=(g-R)/2,x=(p-T)/2,g=R):x=(p-T)/2,p=T)):
R&&0===K&&(G=Math.floor((g-this.original_width)/2),x=Math.floor((p-this.original_height)/2),g=this.original_width,p=this.original_height),2>K&&(this.aspect_scale=C),this.cssWidth=Math.round(g),this.cssHeight=Math.round(p),this.width=Math.round(g*C),this.height=Math.round(p*C),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===K?(this.draw_width=
this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===K?(R=this.original_width/this.original_height,K=this.lastWindowWidth/this.lastWindowHeight,K<R?this.draw_width=this.draw_height*K:K>R&&(this.draw_height=this.draw_width/K)):3===K&&(R=this.original_width/this.original_height,K=this.lastWindowWidth/this.lastWindowHeight,K>R?this.draw_width=this.draw_height*K:K<R&&(this.draw_height=
this.draw_width/K))),this.canvas&&(this.canvas.width=Math.round(g*C),this.canvas.height=Math.round(p*C),this.isRetina&&(this.canvas.style.width=Math.round(g)+"px",this.canvas.style.height=Math.round(p)+"px"),this.canvas.style.marginLeft=Math.floor(G)+"px",this.canvas.style.marginTop=Math.floor(x)+"px"),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(g*C),this.overlay_canvas.height=Math.round(p*C),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+
"px",this.overlay_canvas.style.left=Math.floor(G)+"px",this.overlay_canvas.style.top=Math.floor(x)+"px"),this.glwrap&&this.glwrap.setSize(Math.round(g*C),Math.round(p*C)),this.ctx&&(this.ctx.imageSmoothingEnabled=this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}};b.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var g="portrait";2===this.orientations&&(g="landscape");try{screen.orientation&&screen.orientation.lock?
screen.orientation.lock(g).catch(function(){}):screen.lockOrientation?screen.lockOrientation(g):screen.webkitLockOrientation?screen.webkitLockOrientation(g):screen.mozLockOrientation?screen.mozLockOrientation(g):screen.msLockOrientation&&screen.msLockOrientation(g)}catch(p){console&&console.warn&&console.warn("Failed to lock orientation: ",p)}}};b.prototype.onContextLost=function(){this.glwrap.contextLost();this.is_WebGL_context_lost=!0;var g;var p=0;for(g=this.types_by_index.length;p<g;p++){var C=
this.types_by_index[p];if(C.onLostWebGLContext)C.onLostWebGLContext()}};b.prototype.onContextRestored=function(){this.is_WebGL_context_lost=!1;var g;var p=0;for(g=this.types_by_index.length;p<g;p++){var C=this.types_by_index[p];if(C.onRestoreWebGLContext)C.onRestoreWebGLContext()}};var L=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;b.prototype.setSuspended=function(g){var p;if(g&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),
this.isSuspended=!0,-1!==this.raf_id&&L(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),g=0,p=this.suspend_events.length;g<p;g++)this.suspend_events[g](!0);else if(!g&&this.isSuspended){cr.logexport("[Construct 2] Resuming");this.isSuspended=!1;this.last_tick_time=cr.performance_now();this.last_fps_time=cr.performance_now();g=this.logictime=this.framecount=0;for(p=this.suspend_events.length;g<p;g++)this.suspend_events[g](!1);this.tick(!1)}};b.prototype.addSuspendCallback=function(g){this.suspend_events.push(g)};
b.prototype.GetObjectReference=function(g){return this.objectRefTable[g]};b.prototype.loadProject=function(g){g&&g.project||cr.logerror("Project model unavailable");g=g.project;this.name=g[0];this.first_layout=g[1];this.fullscreen_mode=g[12];this.fullscreen_mode_set=g[12];this.original_width=g[10];this.original_height=g[11];this.parallax_x_origin=this.original_width/2;this.parallax_y_origin=this.original_height/2;this.uses_loader_layout=g[18];this.loaderstyle=g[19];this.iconsFolder=g[28];this.webFontNames=
g[29].map(function(ka){return ka[0]});if(0===this.loaderstyle){var p=new Image;p.crossOrigin="anonymous";var C=this.loaderlogos={logo:p};p.addEventListener("error",function(){C.logo=null});var G=g[39];G=this.isPreview?this.getProjectFileUrl(G):this.iconsFolder+G;this.setImageSrc(p,G)}else if(4===this.loaderstyle){p=new Image;p.src="splash-images/splash-logo.svg";G=new Image;G.src="splash-images/splash-poweredby-512.png";var x=new Image;x.src="splash-images/splash-poweredby-256.png";var K=new Image;
K.src="splash-images/splash-poweredby-128.png";var R=new Image;R.src="splash-images/splash-website-512.png";var S=new Image;S.src="splash-images/splash-website-256.png";var T=new Image;T.src="splash-images/splash-website-128.png";this.loaderlogos={logo:p,powered:[G,x,K],website:[R,S,T]}}this.next_uid=g[21];this.objectRefTable=cr.getObjectRefTable();this.system=new cr.system_object(this);p=0;for(G=g[2].length;p<G;p++){T=g[2][p];x=this.GetObjectReference(T[0]);cr.add_common_aces(T,x.prototype);var fa=
new x(this);fa.singleglobal=T[1];fa.is_world=T[2];fa.is_rotatable=T[5];fa.must_predraw=T[9];if(fa.onCreate)fa.onCreate();cr.seal(fa);this.plugins.push(fa)}this.objectRefTable=cr.getObjectRefTable();p=0;for(G=g[3].length;p<G;p++){T=g[3][p];R=this.GetObjectReference(T[1]);fa=null;x=0;for(K=this.plugins.length;x<K;x++)if(this.plugins[x]instanceof R){fa=this.plugins[x];break}var ba=new fa.Type(fa);ba.name=T[0];ba.is_family=T[2];ba.instvar_sids=T[3].slice(0);ba.vars_count=T[3].length;ba.behs_count=T[4];
ba.fx_count=T[5];ba.sid=T[11];ba.is_family?(ba.members=[],ba.family_index=this.family_count++,ba.families=null):(ba.members=null,ba.family_index=-1,ba.families=[]);ba.family_var_map=null;ba.family_beh_map=null;ba.family_fx_map=null;ba.is_contained=!1;ba.container=null;T[6]?(ba.texture_file=T[6][0],ba.texture_filesize=T[6][1],ba.texture_pixelformat=T[6][2],ba.texture_data=T[6]):(ba.texture_file=null,ba.texture_filesize=0,ba.texture_pixelformat=0,ba.texture_data=null);ba.animations=T[7]?T[7]:null;ba.index=
p;ba.instances=[];ba.deadCache=[];ba.solstack=[new cr.selection(ba)];ba.cur_sol=0;ba.default_instance=null;ba.default_layerindex=0;ba.stale_iids=!0;ba.updateIIDs=cr.type_updateIIDs;ba.getFirstPicked=cr.type_getFirstPicked;ba.getPairedInstance=cr.type_getPairedInstance;ba.getCurrentSol=cr.type_getCurrentSol;ba.pushCleanSol=cr.type_pushCleanSol;ba.pushCopySol=cr.type_pushCopySol;ba.popSol=cr.type_popSol;ba.getBehaviorByName=cr.type_getBehaviorByName;ba.getBehaviorIndexByName=cr.type_getBehaviorIndexByName;
ba.getEffectIndexByName=cr.type_getEffectIndexByName;ba.applySolToContainer=cr.type_applySolToContainer;ba.getInstanceByIID=cr.type_getInstanceByIID;ba.collision_grid=new cr.SparseGrid(this.original_width,this.original_height);ba.any_cell_changed=!0;ba.any_instance_parallaxed=!1;ba.extra={};ba.toString=cr.type_toString;ba.behaviors=[];x=0;for(K=T[8].length;x<K;x++){var Z=T[8][x];var da=this.GetObjectReference(Z[1]),ia=null;R=0;for(S=this.behaviors.length;R<S;R++)if(this.behaviors[R]instanceof da){ia=
this.behaviors[R];break}if(!ia){ia=new da(this);ia.my_types=[];ia.my_instances=new cr.ObjectSet;if(ia.onCreate)ia.onCreate();cr.seal(ia);this.behaviors.push(ia);cr.behaviors.solid&&ia instanceof cr.behaviors.solid&&(this.solidBehavior=ia);cr.behaviors.jumpthru&&ia instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=ia);cr.behaviors.shadowcaster&&ia instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=ia)}-1===ia.my_types.indexOf(ba)&&ia.my_types.push(ba);R=new ia.Type(ia,ba);R.name=
Z[0];R.sid=Z[2];R.onCreate();cr.seal(R);ba.behaviors.push(R)}ba.global=T[9];ba.isOnLoaderLayout=T[10];ba.effect_types=[];x=0;for(K=T[12].length;x<K;x++)ba.effect_types.push({id:T[12][x][0],name:T[12][x][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:x});x=T[13];ba.tile_poly_data=x?x[0]:null;if(!this.uses_loader_layout||ba.is_family||ba.isOnLoaderLayout||!fa.is_world)ba.onCreate(),cr.seal(ba);ba.name&&(this.types[ba.name]=ba,this.types_lowercase[ba.name.toLowerCase()]=ba);this.types_by_index.push(ba);
fa.singleglobal&&(x=new fa.Instance(ba),x.uid=this.next_uid++,x.puid=this.next_puid++,x.iid=0,x.get_iid=cr.inst_get_iid,x.toString=cr.inst_toString,x.properties=T[16],x.onCreate(),cr.seal(x),ba.instances.push(x),this.objectsByUid[x.uid.toString()]=x)}p=0;for(G=g[4].length;p<G;p++)for(R=g[4][p],S=this.types_by_index[R[0]],x=1,K=R.length;x<K;x++)T=this.types_by_index[R[x]],T.families.push(S),S.members.push(T);p=0;for(G=g[27].length;p<G;p++){R=g[27][p];S=[];x=0;for(K=R.length;x<K;x++)S.push(this.types_by_index[R[x]]);
x=0;for(K=S.length;x<K;x++)S[x].is_contained=!0,S[x].container=S}if(0<this.family_count)for(p=0,G=this.types_by_index.length;p<G;p++)if(T=this.types_by_index[p],!T.is_family&&T.families.length){T.family_var_map=Array(this.family_count);T.family_beh_map=Array(this.family_count);T.family_fx_map=Array(this.family_count);ba=[];x=ia=da=Z=0;for(K=T.families.length;x<K;x++)for(fa=T.families[x],T.family_var_map[fa.family_index]=Z,Z+=fa.vars_count,T.family_beh_map[fa.family_index]=da,da+=fa.behs_count,T.family_fx_map[fa.family_index]=
ia,ia+=fa.fx_count,R=0,S=fa.effect_types.length;R<S;R++)ba.push(cr.shallowCopy({},fa.effect_types[R]));T.effect_types=ba.concat(T.effect_types);x=0;for(K=T.effect_types.length;x<K;x++)T.effect_types[x].index=x}p=0;for(G=g[5].length;p<G;p++)T=g[5][p],x=new cr.layout(this,T),cr.seal(x),this.layouts[x.name]=x,this.layouts_by_index.push(x);p=0;for(G=g[6].length;p<G;p++)T=g[6][p],x=new cr.eventsheet(this,T),cr.seal(x),this.eventsheets[x.name]=x,this.eventsheets_by_index.push(x);p=0;for(G=this.eventsheets_by_index.length;p<
G;p++)this.eventsheets_by_index[p].postInit();p=0;for(G=this.eventsheets_by_index.length;p<G;p++)this.eventsheets_by_index[p].updateDeepIncludes();p=0;for(G=this.triggers_to_postinit.length;p<G;p++)this.triggers_to_postinit[p].postInit();cr.clearArray(this.triggers_to_postinit);this.audio_files_info=g[7];this.audio_files_map={};p=0;for(G=this.audio_files_info.length;p<G;++p)x=this.audio_files_info[p],this.audio_files_map[x[0]]=x[1];this.files_subfolder=g[8];this.pixel_rounding=g[9];this.aspect_scale=
1;this.enableWebGL=g[13];this.linearSampling=g[14];this.clearBackground=g[15];this.versionstr=g[16];this.useHighDpi=g[17];this.orientations=g[20];this.autoLockOrientation=0<this.orientations;this.pauseOnBlur=g[22];this.fullscreenScalingQuality=this.wantFullscreenScalingQuality=g[23];this.downscalingQuality=g[24];this.preloadSounds=g[25];this.enableFrontToBack=g[26]&&!this.isIE;this.enhancedAccelerationPrecision=g[30];this.start_time=Date.now();cr.clearArray(this.objectRefTable);this.preloadSounds||
y["audio/webm; codecs=opus"]||!window.OpusDecoder||window.OpusDecoder.Initialise();this.initRendererAndLoader()};var q=!1;b.prototype.waitForImageLoad=function(g,p){window.cr_remotePreviewImageFiles&&p&&"blob:"!==p.substr(0,5)&&(p=window.cr_remotePreviewImageFiles[p]);g.onerror=function(C){q=g.c2error=!0;console&&console.error&&console.error("Error loading image '"+g.src+"': ",C)};g.src||("undefined"!==typeof XAPKReader?XAPKReader.get(p,function(C){g.src=C},function(C){q=g.c2error=!0;console&&console.error&&
console.error("Error extracting image '"+p+"' from expansion file: ",C)}):(g.crossOrigin="anonymous",this.setImageSrc(g,p)));this.wait_for_textures.push(g)};b.prototype.findWaitingTexture=function(g){var p;var C=0;for(p=this.wait_for_textures.length;C<p;C++)if(this.wait_for_textures[C].cr_src===g)return this.wait_for_textures[C];return null};var B=0,A=!1;b.prototype.getready=function(){if(this.audioInstance&&this.preloadSounds){var g=[],p;var C=0;for(p=this.audio_files_info.length;C<p;++C){var G=
this.audio_files_info[C];var x=G[0];var K=G[2];(G=this.getPreferredAudioFile(x))&&!K&&g.push({filename:x+G[1],size:G[2],type:G[0]})}B=this.audioInstance.setPreloadList(g)}};b.prototype.areAllTexturesAndSoundsLoaded=function(){var g=B,p=0,C=!0,G;var x=0;for(G=this.wait_for_textures.length;x<G;x++){var K=this.wait_for_textures[x];var R=K.cr_filesize;if(!R||0>=R)R=5E4;g+=R;K.src&&K.complete&&!K.c2error?p+=R:C=!1}C&&this.preloadSounds&&this.audioInstance&&(A||(this.audioInstance.startPreloads(),A=!0),
x=this.audioInstance.getPreloadedSize(),p+=x,x<B&&(C=!1));this.progress=0==g?1:p/g;return C};var h=!1;b.prototype.go=function(){if(this.ctx||this.glwrap){var g=this.ctx||this.overlay_ctx;if(0<this.fullscreen_mode){var p=window.innerWidth,C=window.innerHeight;this.lastWindowWidth===p&&this.lastWindowHeight===C||this.setSize(p,C)}this.progress=0;this.last_progress=-1;var G=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||h))this.useFbInstant?FBInstant.startGameAsync().then(function(){G.go_loading_finished()}):
this.go_loading_finished();else{this.useFbInstant&&FBInstant.setLoadingProgress(100*this.progress);C=Date.now()-this.start_time;if(g){var x=this.width,K=this.height;p=this.devicePixelRatio;if(3>this.loaderstyle&&500<=C&&this.last_progress!=this.progress){g.clearRect(0,0,x,K);C=x/2;K/=2;x=0===this.loaderstyle&&this.loaderlogos.logo&&this.loaderlogos.logo.complete;var R=40*p,S=0,T=80*p;if(x){var fa=this.loaderlogos.logo;T=fa.width*p;var ba=fa.height*p;R=T/2;S=ba/2;g.drawImage(fa,cr.floor(C-R),cr.floor(K-
S),T,ba)}1>=this.loaderstyle?(K+=S+(x?12*p:0),C=cr.floor(C-R)+.5,K=cr.floor(K)+.5,g.fillStyle=q?"red":"DodgerBlue",g.fillRect(C,K,Math.floor(T*this.progress),6*p),g.strokeStyle="black",g.strokeRect(C,K,T,6*p),g.strokeStyle="white",g.strokeRect(C-1*p,K-1*p,T+2*p,8*p)):2===this.loaderstyle&&(g.font="12pt Arial",g.fillStyle=q?"#f00":"#999",g.textBaseLine="middle",p=Math.round(100*this.progress)+"%",x=g.measureText?g.measureText(p):null,g.fillText(p,C-(x?x.width:0)/2,K));this.last_progress=this.progress}else if(4===
this.loaderstyle){this.draw_c3_splash_loader(g);v?v(function(){G.go()}):setTimeout(function(){G.go()},16);return}}setTimeout(function(){G.go()},100)}}};var n=-1,z=!0,P=!1,V=0,H=0,d=null,k=null,F=0;b.prototype.draw_c3_splash_loader=function(g){if(!h){var p=this.isPreview||this.useFbInstant,C=p?0:200,G=p?0:3E3,x=Math.ceil(this.width),K=Math.ceil(this.height),R=this.loaderlogos.logo,S=this.loaderlogos.powered,T=this.loaderlogos.website;if(R.complete){for(var fa=0;3>fa;++fa)if(!S[fa].complete||!T[fa].complete)return;
0===F&&(n=Date.now());fa=Date.now();var ba=!1,Z=g;z||P?(g.clearRect(0,0,x,K),d&&d.width===x&&d.height===K||(d=document.createElement("canvas"),d.width=x,d.height=K,k=d.getContext("2d")),Z=k,ba=!0,z&&1===F&&(n=Date.now())):g.globalAlpha=1;Z.fillStyle="#3B4045";Z.fillRect(0,0,x,K);try{if(256<this.cssHeight){var da=1.5*cr.clamp(.22*K,105,.6*x);var ia=da/8;Z.drawImage(128>=da?S[2]:256>=da?S[1]:S[0],.5*x-da/2,.2*K-ia/2,da,ia);ia=da=Math.min(.395*K,.95*x);Z.drawImage(R,.5*x-da/2,.485*K-ia/2,da,ia);da=1.5*
cr.clamp(.22*K,105,.6*x);ia=da/8;Z.drawImage(128>=da?T[2]:256>=da?T[1]:T[0],.5*x-da/2,.868*K-ia/2,da,ia);Z.fillStyle="#4D565D";da=x;ia=Math.max(.005*K,2);Z.fillRect(0,.8*K-ia/2,da,ia);Z.fillStyle=q?"red":"#29F3D0";da=x*this.progress;Z.fillRect(.5*x-da/2,.8*K-ia/2,da,ia)}else ia=da=.55*K,Z.drawImage(R,.5*x-da/2,.45*K-ia/2,da,ia),Z.fillStyle="#4D565D",da=x,ia=Math.max(.005*K,2),Z.fillRect(0,.85*K-ia/2,da,ia),Z.fillStyle=q?"red":"#29F3D0",da=x*this.progress,Z.fillRect(.5*x-da/2,.85*K-ia/2,da,ia);ba&&
(z?g.globalAlpha=0===F?0:Math.min((fa-n)/300,1):P&&(g.globalAlpha=Math.max(1-(fa-H)/300,0)),g.drawImage(d,0,0,x,K))}catch(ka){}z&&300<=fa-n&&2<=F&&(z=!1,V=fa);!z&&fa-V>=G&&!P&&1<=this.progress&&(P=!0,H=fa);if(P&&fa-H>=300+C||p&&1<=this.progress&&500>Date.now()-n)h=!0,P=z=!1,this.loaderlogos=k=d=null;++F}}};b.prototype.go_loading_finished=function(){if(this.webFontNames.length&&document.fonts&&document.fonts.load){var g=this;Promise.all(this.webFontNames.map(function(p){return document.fonts.load("1em '"+
p+"'")})).then(function(){g.start_first_layout()})}else this.start_first_layout()};b.prototype.start_first_layout=function(){this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_canvas=this.overlay_ctx=null);this.start_time=Date.now();this.last_fps_time=cr.performance_now();var g;if(this.uses_loader_layout){var p=0;for(g=this.types_by_index.length;p<g;p++){var C=this.types_by_index[p];C.is_family||C.isOnLoaderLayout||!C.plugin.is_world||(C.onCreate(),cr.seal(C))}}else this.isloading=
!1;p=0;for(g=this.layouts_by_index.length;p<g;p++)this.layouts_by_index[p].createGlobalNonWorlds();2<=this.fullscreen_mode&&(p=this.original_width/this.original_height,g=this.width/this.height,this.aspect_scale=2!==this.fullscreen_mode&&g>p||2===this.fullscreen_mode&&g<p?this.height/this.original_height:this.width/this.original_width);p=0;for(g=this.types_by_index.length;p<g;p++)if(C=this.types_by_index[p],C.onBeforeAppBegin)C.onBeforeAppBegin();this.first_layout?this.layouts[this.first_layout].startRunning():
this.layouts_by_index[0].startRunning();this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C3_RegisterSW&&window.C3_RegisterSW());navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide();p=0;for(g=this.types_by_index.length;p<g;p++)if(C=this.types_by_index[p],C.onAppBegin)C.onAppBegin();p=function(){document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):
window.cr_setSuspended(!1)};document.addEventListener("visibilitychange",p,!1);document.addEventListener("mozvisibilitychange",p,!1);document.addEventListener("webkitvisibilitychange",p,!1);document.addEventListener("msvisibilitychange",p,!1);this.isCordova&&(document.addEventListener("pause",function(){window.cr_setSuspended(!0)}),document.addEventListener("resume",function(){window.cr_setSuspended(!1)}));document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):
this.tick(!1)};b.prototype.tick=function(g,p,C){if(this.running_layout){var G=cr.performance_now();if(C||!this.isSuspended||g){g||(v?this.raf_id=v(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));p=p||G;var x=this.fullscreen_mode;(C=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova)&&0<this.fullscreen_scaling&&(x=this.fullscreen_scaling);if(0<x){x=window.innerWidth;var K=window.innerHeight;this.lastWindowWidth===
x&&this.lastWindowHeight===K||this.setSize(x,K)}C?this.firstInFullscreen||(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height);this.isloading&&(C=this.areAllTexturesAndSoundsLoaded(),this.loadingprogress=this.progress,C&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,
null),window.C3_RegisterSW&&window.C3_RegisterSW()));this.logic(p);!this.redraw||this.is_WebGL_context_lost||this.suspendDrawing||g||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null));this.hit_breakpoint||
(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++);this.logictime+=cr.performance_now()-G}}};b.prototype.logic=function(g){var p;1E3<=g-this.last_fps_time&&(this.last_fps_time+=1E3,1E3<=g-this.last_fps_time&&(this.last_fps_time=g),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=Math.min(this.logictime,1E3),this.logictime=0,this.glwrap&&0===this.gpuTimeEndFrame&&(this.gpuTimeEndFrame=this.glwrap.getFrameNumber(),this.gpuCurUtilisation=-1));this.glwrap&&-1===
this.gpuCurUtilisation&&this.glwrap.supportsGpuProfiling()&&(this.gpuCurUtilisation=this.glwrap.getFrameRangeTimerResults(this.gpuTimeStartFrame,this.gpuTimeEndFrame),-1!==this.gpuCurUtilisation&&(this.glwrap.deleteTimerResultsToFrame(this.gpuTimeEndFrame),this.gpuLastUtilisation=Math.min(this.gpuCurUtilisation,1),this.gpuTimeStartFrame=this.gpuTimeEndFrame,this.gpuTimeEndFrame=0));if(0!==this.last_tick_time){var C=g-this.last_tick_time;0>C&&(C=0);this.dt1=C/1E3;.5<this.dt1?this.dt1=0:this.dt1>1/
this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=g;this.dt=this.dt1*this.timescale;this.kahanTime.add(this.dt);this.wallTime.add(this.dt1);g=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if(2<=this.fullscreen_mode||g&&0<this.fullscreen_scaling){C=this.original_width/this.original_height;var G=this.width/this.height;var x=this.fullscreen_mode;g&&0<this.fullscreen_scaling&&(x=this.fullscreen_scaling);
this.aspect_scale=2!==x&&G>C||2===x&&G<C?this.height/this.original_height:this.width/this.original_width;this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow();this.isInOnDestroy++;this.system.runWaits();this.isInOnDestroy--;this.ClearDeathRow();this.isInOnDestroy++;G=this.objects_to_pretick.valuesRef();g=0;for(C=G.length;g<C;g++)G[g].pretick();
g=0;for(C=this.types_by_index.length;g<C;g++){var K=this.types_by_index[g];if(!K.is_family&&(K.behaviors.length||K.families.length))for(G=0,x=K.instances.length;G<x;G++){var R=K.instances[G];var S=0;for(p=R.behavior_insts.length;S<p;S++)R.behavior_insts[S].tick()}}g=0;for(C=this.types_by_index.length;g<C;g++)if(K=this.types_by_index[g],!K.is_family&&(K.behaviors.length||K.families.length))for(G=0,x=K.instances.length;G<x;G++)for(R=K.instances[G],S=0,p=R.behavior_insts.length;S<p;S++){var T=R.behavior_insts[S];
T.posttick&&T.posttick()}G=this.objects_to_tick.valuesRef();g=0;for(C=G.length;g<C;g++)G[g].tick();this.isInOnDestroy--;this.handleSaveLoad();for(g=0;this.changelayout&&10>g++;)this.doChangeLayout(this.changelayout);g=0;for(C=this.eventsheets_by_index.length;g<C;g++)this.eventsheets_by_index[g].hasRun=!1;this.running_layout.event_sheet&&this.running_layout.event_sheet.run();cr.clearArray(this.registered_collisions);this.layout_first_tick=!1;this.isInOnDestroy++;g=0;for(C=this.types_by_index.length;g<
C;g++)if(K=this.types_by_index[g],!K.is_family&&(K.behaviors.length||K.families.length))for(G=0,x=K.instances.length;G<x;G++)for(R=K.instances[G],S=0,p=R.behavior_insts.length;S<p;S++)T=R.behavior_insts[S],T.tick2&&T.tick2();G=this.objects_to_tick2.valuesRef();g=0;for(C=G.length;g<C;g++)G[g].tick2();this.isInOnDestroy--};b.prototype.onWindowBlur=function(){var g,p,C;var G=0;for(g=this.types_by_index.length;G<g;G++){var x=this.types_by_index[G];if(!x.is_family){var K=0;for(p=x.instances.length;K<p;K++){var R=
x.instances[K];if(R.onWindowBlur)R.onWindowBlur();if(R.behavior_insts){var S=0;for(C=R.behavior_insts.length;S<C;S++){var T=R.behavior_insts[S];if(T.onWindowBlur)T.onWindowBlur()}}}}}};b.prototype.doChangeLayout=function(g){var p=this.running_layout;this.running_layout.stopRunning();var C;if(this.glwrap){var G=0;for(C=this.types_by_index.length;G<C;G++){var x=this.types_by_index[G];x.is_family||!x.unloadTextures||x.global&&0!==x.instances.length||-1!==g.initial_types.indexOf(x)||x.unloadTextures()}}p==
g&&cr.clearArray(this.system.waits);cr.clearArray(this.registered_collisions);this.runLayoutChangeMethods(!0);g.startRunning();this.runLayoutChangeMethods(!1);this.layout_first_tick=this.redraw=!0;this.ClearDeathRow()};b.prototype.runLayoutChangeMethods=function(g){var p,C,G;var x=0;for(p=this.behaviors.length;x<p;x++){var K=this.behaviors[x];if(g){if(K.onBeforeLayoutChange)K.onBeforeLayoutChange()}else if(K.onLayoutChange)K.onLayoutChange()}x=0;for(p=this.types_by_index.length;x<p;x++)if(K=this.types_by_index[x],
K.global||K.plugin.singleglobal){var R=0;for(C=K.instances.length;R<C;R++){var S=K.instances[R];if(g){if(S.onBeforeLayoutChange)S.onBeforeLayoutChange()}else if(S.onLayoutChange)S.onLayoutChange();if(S.behavior_insts){var T=0;for(G=S.behavior_insts.length;T<G;T++){var fa=S.behavior_insts[T];if(g){if(fa.onBeforeLayoutChange)fa.onBeforeLayoutChange()}else if(fa.onLayoutChange)fa.onLayoutChange()}}}}};b.prototype.pretickMe=function(g){this.objects_to_pretick.add(g)};b.prototype.unpretickMe=function(g){this.objects_to_pretick.remove(g)};
b.prototype.tickMe=function(g){this.objects_to_tick.add(g)};b.prototype.untickMe=function(g){this.objects_to_tick.remove(g)};b.prototype.tick2Me=function(g){this.objects_to_tick2.add(g)};b.prototype.untick2Me=function(g){this.objects_to_tick2.remove(g)};b.prototype.getDt=function(g){return g&&-1!==g.my_timescale?this.dt1*g.my_timescale:this.dt};b.prototype.draw=function(){this.running_layout.draw(this.ctx)};b.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap));
this.running_layout.drawGL(this.glwrap);this.glwrap.present()};b.prototype.addDestroyCallback=function(g){g&&this.destroycallbacks.push(g)};b.prototype.removeDestroyCallback=function(g){cr.arrayFindRemove(this.destroycallbacks,g)};b.prototype.getObjectByUID=function(g){g=g.toString();return this.objectsByUid.hasOwnProperty(g)?this.objectsByUid[g]:null};var e=[];b.prototype.DestroyInstance=function(g){var p;var C=g.type.name;if(this.deathRow.hasOwnProperty(C)){var G=this.deathRow[C];if(G.contains(g))return}else G=
e.length?e.pop():new cr.ObjectSet,this.deathRow[C]=G;g.isDestroyed=!0;G.add(g);this.hasPendingInstances=!0;if(g.is_contained)for(C=0,p=g.siblings.length;C<p;C++)this.DestroyInstance(g.siblings[C]);this.isInClearDeathRow&&G.values_cache.push(g);this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(g.type.plugin).cnds.OnDestroyed,g),this.isInOnDestroy--)};b.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var g,p;this.isInClearDeathRow=!0;var C=0;for(g=this.createRow.length;C<
g;++C){var G=this.createRow[C];var x=G.type;x.instances.push(G);var K=0;for(p=x.families.length;K<p;++K)x.families[K].instances.push(G),x.families[K].stale_iids=!0}cr.clearArray(this.createRow);this.IterateDeathRow();cr.wipe(this.deathRow);this.hasPendingInstances=this.isInClearDeathRow=!1}};b.prototype.IterateDeathRow=function(){for(var g in this.deathRow)this.deathRow.hasOwnProperty(g)&&this.ClearDeathRowForType(this.deathRow[g])};b.prototype.ClearDeathRowForType=function(g){var p=g.valuesRef(),
C=p[0].type,G,x;cr.arrayRemoveAllFromObjectSet(C.instances,g);C.stale_iids=!0;0===C.instances.length&&(C.any_instance_parallaxed=!1);var K=0;for(G=C.families.length;K<G;++K){var R=C.families[K];cr.arrayRemoveAllFromObjectSet(R.instances,g);R.stale_iids=!0}K=0;for(G=this.system.waits.length;K<G;++K){var S=this.system.waits[K];S.sols.hasOwnProperty(C.index)&&cr.arrayRemoveAllFromObjectSet(S.sols[C.index].insts,g);if(!C.is_family){var T=0;for(x=C.families.length;T<x;++T)R=C.families[T],S.sols.hasOwnProperty(R.index)&&
cr.arrayRemoveAllFromObjectSet(S.sols[R.index].insts,g)}}if(S=p[0].layer){if(S.useRenderCells)for(T=S.instances,K=0,G=T.length;K<G;++K)x=T[K],g.contains(x)&&(x.update_bbox(),S.render_grid.update(x,x.rendercells,null),x.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(S.instances,g);S.setZIndicesStaleFrom(0)}for(K=0;K<p.length;++K)this.ClearDeathRowForSingleInstance(p[K],C);g.clear();e.push(g);this.redraw=!0};b.prototype.ClearDeathRowForSingleInstance=function(g,p){var C;var G=0;for(C=this.destroycallbacks.length;G<
C;++G)this.destroycallbacks[G](g);g.collcells&&p.collision_grid.update(g,g.collcells,null);(G=g.layer)&&G.removeFromInstanceList(g,!0);if(g.behavior_insts)for(G=0,C=g.behavior_insts.length;G<C;++G){var x=g.behavior_insts[G];if(x.onDestroy)x.onDestroy();x.behavior.my_instances.remove(g)}this.objects_to_pretick.remove(g);this.objects_to_tick.remove(g);this.objects_to_tick2.remove(g);if(g.onDestroy)g.onDestroy();this.objectsByUid.hasOwnProperty(g.uid.toString())&&delete this.objectsByUid[g.uid.toString()];
this.objectcount--;100>p.deadCache.length&&p.deadCache.push(g)};b.prototype.createInstance=function(g,p,C,G){if(g.is_family){var x=cr.floor(Math.random()*g.members.length);return this.createInstance(g.members[x],p,C,G)}return g.default_instance?this.createInstanceFromInit(g.default_instance,p,!1,C,G,!1):null};var u=[];b.prototype.createInstanceFromInit=function(g,p,C,G,x,K){var R,S;if(!g)return null;var T=this.types_by_index[g[1]],fa=T.plugin.is_world;if(this.isloading&&fa&&!T.isOnLoaderLayout||fa&&
!this.glwrap&&11===g[0][11])return null;var ba=p;fa||(p=null);if(T.deadCache.length){var Z=T.deadCache.pop();Z.recycled=!0;T.plugin.Instance.call(Z,T)}else Z=new T.plugin.Instance(T),Z.recycled=!1;!C||K||this.objectsByUid.hasOwnProperty(g[2].toString())?Z.uid=this.next_uid++:Z.uid=g[2];this.objectsByUid[Z.uid.toString()]=Z;Z.puid=this.next_puid++;Z.iid=T.instances.length;var da=0;for(R=this.createRow.length;da<R;++da)this.createRow[da].type===T&&Z.iid++;Z.get_iid=cr.inst_get_iid;Z.toString=cr.inst_toString;
Z.isDestroyed=!1;var ia=g[3];if(Z.recycled)cr.wipe(Z.extra);else{Z.extra={};if(this.isPreview)for(Z.instance_var_names=[],Z.instance_var_names.length=ia.length,da=0,R=ia.length;da<R;da++)Z.instance_var_names[da]=ia[da][1];Z.instance_vars=[];Z.instance_vars.length=ia.length}da=0;for(R=ia.length;da<R;da++)Z.instance_vars[da]=ia[da][0];if(fa){var ka=g[0];Z.x=cr.is_undefined(G)?ka[0]:G;Z.y=cr.is_undefined(x)?ka[1]:x;Z.z=ka[2];Z.width=ka[3];Z.height=ka[4];Z.depth=ka[5];Z.angle=ka[6];Z.opacity=ka[7];Z.hotspotX=
ka[8];Z.hotspotY=ka[9];Z.blend_mode=ka[10];da=ka[11];!this.glwrap&&T.effect_types.length&&(Z.blend_mode=da);Z.compositeOp=cr.effectToCompositeOp(Z.blend_mode);this.gl&&cr.setGLBlend(Z,Z.blend_mode,this.gl);if(Z.recycled){da=0;for(R=ka[12].length;da<R;da++)for(ia=0,S=ka[12][da].length;ia<S;ia++)Z.effect_params[da][ia]=ka[12][da][ia],Array.isArray(Z.effect_params[da][ia])&&(Z.effect_params[da][ia]=Z.effect_params[da][ia].slice(0));Z.bbox.set(0,0,0,0);Z.collcells.set(0,0,-1,-1);Z.rendercells.set(0,0,
-1,-1);Z.bquad.set_from_rect(Z.bbox);cr.clearArray(Z.bbox_changed_callbacks)}else{Z.effect_params=ka[12].slice(0);da=0;for(R=Z.effect_params.length;da<R;da++)for(Z.effect_params[da]=ka[12][da].slice(0),ia=0,S=Z.effect_params[da].length;ia<S;++ia)Array.isArray(Z.effect_params[da][ia])&&(Z.effect_params[da][ia]=Z.effect_params[da][ia].slice(0));Z.active_effect_types=[];Z.active_effect_flags=[];Z.active_effect_flags.length=T.effect_types.length;Z.bbox=new cr.rect(0,0,0,0);Z.collcells=new cr.rect(0,0,
-1,-1);Z.rendercells=new cr.rect(0,0,-1,-1);Z.bquad=new cr.quad;Z.bbox_changed_callbacks=[];Z.set_bbox_changed=cr.set_bbox_changed;Z.add_bbox_changed_callback=cr.add_bbox_changed_callback;Z.contains_pt=cr.inst_contains_pt;Z.update_bbox=cr.update_bbox;Z.update_render_cell=cr.update_render_cell;Z.update_collision_cell=cr.update_collision_cell;Z.get_zindex=cr.inst_get_zindex}Z.tilemap_exists=!1;Z.tilemap_width=0;Z.tilemap_height=0;Z.tilemap_data=null;ka[13]&&(Z.tilemap_exists=!0,Z.tilemap_width=ka[13][0],
Z.tilemap_height=ka[13][1],Z.tilemap_data=ka[13][2]);da=0;for(R=T.effect_types.length;da<R;da++)Z.active_effect_flags[da]=!0;Z.shaders_preserve_opaqueness=!0;Z.updateActiveEffects=cr.inst_updateActiveEffects;Z.updateActiveEffects();Z.uses_shaders=!!Z.active_effect_types.length;Z.bbox_changed=!0;Z.cell_changed=!0;T.any_cell_changed=!0;Z.visible=!0;Z.my_timescale=-1;Z.layer=p;Z.zindex=p.instances.length;Z.earlyz_index=0;"undefined"===typeof Z.collision_poly&&(Z.collision_poly=null);this.redraw=Z.collisionsEnabled=
!0}cr.clearArray(u);da=0;for(R=T.families.length;da<R;da++)u.push.apply(u,T.families[da].behaviors);u.push.apply(u,T.behaviors);if(Z.recycled)for(da=0,R=u.length;da<R;da++){var ta=u[da];var qa=Z.behavior_insts[da];qa.recycled=!0;ta.behavior.Instance.call(qa,ta,Z);ka=g[4][da];ia=0;for(S=ka.length;ia<S;ia++)qa.properties[ia]=ka[ia];qa.onCreate();ta.behavior.my_instances.add(Z)}else for(Z.behavior_insts=[],da=0,R=u.length;da<R;da++)ta=u[da],qa=new ta.behavior.Instance(ta,Z),qa.recycled=!1,qa.properties=
g[4][da].slice(0),qa.onCreate(),cr.seal(qa),Z.behavior_insts.push(qa),ta.behavior.my_instances.add(Z);ka=g[5];if(Z.recycled)for(da=0,R=ka.length;da<R;da++)Z.properties[da]=ka[da];else Z.properties=ka.slice(0);this.createRow.push(Z);this.hasPendingInstances=!0;p&&(p.appendToInstanceList(Z,!0),1!==p.parallaxX||1!==p.parallaxY)&&(T.any_instance_parallaxed=!0);this.objectcount++;if(T.is_contained){if(Z.is_contained=!0,Z.recycled?cr.clearArray(Z.siblings):Z.siblings=[],!C&&!K){da=0;for(R=T.container.length;da<
R;da++)if(T.container[da]!==T){if(!T.container[da].default_instance)return null;Z.siblings.push(this.createInstanceFromInit(T.container[da].default_instance,ba,!1,fa?Z.x:G,fa?Z.y:x,!0))}da=0;for(R=Z.siblings.length;da<R;da++)for(Z.siblings[da].siblings.push(Z),ia=0;ia<R;ia++)da!==ia&&Z.siblings[da].siblings.push(Z.siblings[ia])}}else Z.is_contained=!1,Z.siblings=null;Z.onCreate();Z.recycled||cr.seal(Z);da=0;for(R=Z.behavior_insts.length;da<R;da++)Z.behavior_insts[da].postCreate&&Z.behavior_insts[da].postCreate();
return Z};b.prototype.getLayerByName=function(g){var p;var C=0;for(p=this.running_layout.layers.length;C<p;C++){var G=this.running_layout.layers[C];if(cr.equals_nocase(G.name,g))return G}return null};b.prototype.getLayerByNumber=function(g){g=cr.floor(g);0>g&&(g=0);g>=this.running_layout.layers.length&&(g=this.running_layout.layers.length-1);return this.running_layout.layers[g]};b.prototype.getLayer=function(g){return cr.is_number(g)?this.getLayerByNumber(g):this.getLayerByName(g.toString())};b.prototype.clearSol=
function(g){var p;var C=0;for(p=g.length;C<p;C++)g[C].getCurrentSol().select_all=!0};b.prototype.pushCleanSol=function(g){var p;var C=0;for(p=g.length;C<p;C++)g[C].pushCleanSol()};b.prototype.pushCopySol=function(g){var p;var C=0;for(p=g.length;C<p;C++)g[C].pushCopySol()};b.prototype.popSol=function(g){var p;var C=0;for(p=g.length;C<p;C++)g[C].popSol()};b.prototype.updateAllCells=function(g){if(g.any_cell_changed){var p,C=g.instances;var G=0;for(p=C.length;G<p;++G)C[G].update_collision_cell();C=this.createRow;
G=0;for(p=C.length;G<p;++G)C[G].type===g&&C[G].update_collision_cell();g.any_cell_changed=!1}};b.prototype.getCollisionCandidates=function(g,p,C,G){var x,K=g?1!==g.parallaxX||1!==g.parallaxY:!1;if(p.is_family)for(g=0,x=p.members.length;g<x;++g){var R=p.members[g];K||R.any_instance_parallaxed?cr.appendArray(G,R.instances):(this.updateAllCells(R),R.collision_grid.queryRange(C,G))}else K||p.any_instance_parallaxed?cr.appendArray(G,p.instances):(this.updateAllCells(p),p.collision_grid.queryRange(C,G))};
b.prototype.getTypesCollisionCandidates=function(g,p,C,G){var x;var K=0;for(x=p.length;K<x;++K)this.getCollisionCandidates(g,p[K],C,G)};b.prototype.getSolidCollisionCandidates=function(g,p,C){var G=this.getSolidBehavior();if(!G)return null;this.getTypesCollisionCandidates(g,G.my_types,p,C)};b.prototype.getJumpthruCollisionCandidates=function(g,p,C){var G=this.getJumpthruBehavior();if(!G)return null;this.getTypesCollisionCandidates(g,G.my_types,p,C)};b.prototype.testAndSelectCanvasPointOverlap=function(g,
p,C,G){var x=g.getCurrentSol(),K,R=this.getCurrentEventStack().current_event.orblock;if(x.select_all){G||(x.select_all=!1,cr.clearArray(x.instances));var S=0;for(K=g.instances.length;S<K;S++){var T=g.instances[S];T.update_bbox();var fa=T.layer.canvasToLayer(p,C,!0);var ba=T.layer.canvasToLayer(p,C,!1);if(T.contains_pt(fa,ba)){if(G)return!1;x.instances.push(T)}else R&&x.else_instances.push(T)}}else{var Z=0;var da=R?x.else_instances:x.instances;S=0;for(K=da.length;S<K;S++)if(T=da[S],T.update_bbox(),
fa=T.layer.canvasToLayer(p,C,!0),ba=T.layer.canvasToLayer(p,C,!1),T.contains_pt(fa,ba)){if(G)return!1;R?x.instances.push(T):(x.instances[Z]=x.instances[S],Z++)}G||(da.length=Z)}g.applySolToContainer();return G?!0:x.hasObjects()};b.prototype.testOverlap=function(g,p){if(!(g&&p&&g!==p&&g.collisionsEnabled&&p.collisionsEnabled))return!1;g.update_bbox();p.update_bbox();var C=g.layer,G=p.layer,x;if(C===G||C.parallaxX===G.parallaxX&&G.parallaxY===G.parallaxY&&C.scale===G.scale&&C.angle===G.angle&&C.zoomRate===
G.zoomRate){if(!g.bbox.intersects_rect(p.bbox)||!g.bquad.intersects_quad(p.bquad)||g.tilemap_exists&&p.tilemap_exists)return!1;if(g.tilemap_exists)return this.testTilemapOverlap(g,p);if(p.tilemap_exists)return this.testTilemapOverlap(p,g);var K=g.collision_poly&&!g.collision_poly.is_empty();var R=p.collision_poly&&!p.collision_poly.is_empty();if(!K&&!R)return!0;K?(g.collision_poly.cache_poly(g.width,g.height,g.angle),K=g.collision_poly):(this.temp_poly.set_from_quad(g.bquad,g.x,g.y,g.width,g.height),
K=this.temp_poly);if(R){p.collision_poly.cache_poly(p.width,p.height,p.angle);var S=p.collision_poly}else this.temp_poly.set_from_quad(p.bquad,p.x,p.y,p.width,p.height),S=this.temp_poly;return K.intersects_poly(S,p.x-g.x,p.y-g.y)}K=g.collision_poly&&!g.collision_poly.is_empty();R=p.collision_poly&&!p.collision_poly.is_empty();K?(g.collision_poly.cache_poly(g.width,g.height,g.angle),this.temp_poly.set_from_poly(g.collision_poly)):this.temp_poly.set_from_quad(g.bquad,g.x,g.y,g.width,g.height);K=this.temp_poly;
R?(p.collision_poly.cache_poly(p.width,p.height,p.angle),this.temp_poly2.set_from_poly(p.collision_poly)):this.temp_poly2.set_from_quad(p.bquad,p.x,p.y,p.width,p.height);S=this.temp_poly2;R=0;for(x=K.pts_count;R<x;R++){var T=2*R;var fa=T+1;var ba=K.pts_cache[T];var Z=K.pts_cache[fa];K.pts_cache[T]=C.layerToCanvas(ba+g.x,Z+g.y,!0);K.pts_cache[fa]=C.layerToCanvas(ba+g.x,Z+g.y,!1)}K.update_bbox();R=0;for(x=S.pts_count;R<x;R++)T=2*R,fa=T+1,ba=S.pts_cache[T],Z=S.pts_cache[fa],S.pts_cache[T]=G.layerToCanvas(ba+
p.x,Z+p.y,!0),S.pts_cache[fa]=G.layerToCanvas(ba+p.x,Z+p.y,!1);S.update_bbox();return K.intersects_poly(S,0,0)};var J=new cr.quad,M=new cr.rect(0,0,0,0),U=[];b.prototype.testTilemapOverlap=function(g,p){var C,G=p.bbox,x=g.x,K=g.y;g.getCollisionRectCandidates(G,U);var R=p.collision_poly&&!p.collision_poly.is_empty();g=0;for(C=U.length;g<C;++g){var S=U[g];var T=S.rc;if(G.intersects_rect_off(T,x,K)&&(J.set_from_rect(T),J.offset(x,K),J.intersects_quad(p.bquad)))if(R)if(p.collision_poly.cache_poly(p.width,
p.height,p.angle),S.poly){if(S.poly.intersects_poly(p.collision_poly,p.x-(x+T.left),p.y-(K+T.top)))return cr.clearArray(U),!0}else{if(this.temp_poly.set_from_quad(J,0,0,T.right-T.left,T.bottom-T.top),this.temp_poly.intersects_poly(p.collision_poly,p.x,p.y))return cr.clearArray(U),!0}else if(S.poly){if(this.temp_poly.set_from_quad(p.bquad,0,0,p.width,p.height),S.poly.intersects_poly(this.temp_poly,-(x+T.left),-(K+T.top)))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1};
b.prototype.testRectOverlap=function(g,p){if(!p||!p.collisionsEnabled)return!1;p.update_bbox();if(!p.bbox.intersects_rect(g))return!1;if(p.tilemap_exists){p.getCollisionRectCandidates(g,U);var C,G=p.x,x=p.y;p=0;for(C=U.length;p<C;++p){var K=U[p];var R=K.rc;if(g.intersects_rect_off(R,G,x))if(K.poly){if(this.temp_poly.set_from_rect(g,0,0),K.poly.intersects_poly(this.temp_poly,-(G+R.left),-(x+R.top)))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1}J.set_from_rect(g);
if(!p.bquad.intersects_quad(J))return!1;if(!p.collision_poly||p.collision_poly.is_empty())return!0;p.collision_poly.cache_poly(p.width,p.height,p.angle);J.offset(-g.left,-g.top);this.temp_poly.set_from_quad(J,0,0,1,1);return p.collision_poly.intersects_poly(this.temp_poly,g.left-p.x,g.top-p.y)};b.prototype.testSegmentOverlap=function(g,p,C,G,x){if(!x||!x.collisionsEnabled)return!1;x.update_bbox();M.set(cr.min(g,C),cr.min(p,G),cr.max(g,C),cr.max(p,G));if(!x.bbox.intersects_rect(M))return!1;if(x.tilemap_exists){x.getCollisionRectCandidates(M,
U);var K,R=x.x,S=x.y;x=0;for(K=U.length;x<K;++x){var T=U[x];var fa=T.rc;if(M.intersects_rect_off(fa,R,S)&&(J.set_from_rect(fa),J.offset(R,S),J.intersects_segment(g,p,C,G)))if(T.poly){if(T.poly.intersects_segment(R+fa.left,S+fa.top,g,p,C,G))return cr.clearArray(U),!0}else return cr.clearArray(U),!0}cr.clearArray(U);return!1}if(!x.bquad.intersects_segment(g,p,C,G))return!1;if(!x.collision_poly||x.collision_poly.is_empty())return!0;x.collision_poly.cache_poly(x.width,x.height,x.angle);return x.collision_poly.intersects_segment(x.x,
x.y,g,p,C,G)};b.prototype.typeHasBehavior=function(g,p){if(!p)return!1;var C,G;var x=0;for(C=g.behaviors.length;x<C;x++)if(g.behaviors[x].behavior instanceof p)return!0;if(!g.is_family)for(x=0,C=g.families.length;x<C;x++){var K=g.families[x];var R=0;for(G=K.behaviors.length;R<G;R++)if(K.behaviors[R].behavior instanceof p)return!0}return!1};b.prototype.typeHasNoSaveBehavior=function(g){return this.typeHasBehavior(g,cr.behaviors.NoSave)};b.prototype.typeHasPersistBehavior=function(g){return this.typeHasBehavior(g,
cr.behaviors.Persist)};b.prototype.getSolidBehavior=function(){return this.solidBehavior};b.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var W=[];b.prototype.testOverlapSolid=function(g){var p;g.update_bbox();this.getSolidCollisionCandidates(g.layer,g.bbox,W);var C=0;for(p=W.length;C<p;++C){var G=W[C];if(G.extra.solidEnabled&&this.testOverlap(g,G))return cr.clearArray(W),G}cr.clearArray(W);return null};b.prototype.testRectOverlapSolid=function(g){var p;this.getSolidCollisionCandidates(null,
g,W);var C=0;for(p=W.length;C<p;++C){var G=W[C];if(G.extra.solidEnabled&&this.testRectOverlap(g,G))return cr.clearArray(W),G}cr.clearArray(W);return null};var X=[];b.prototype.testOverlapJumpThru=function(g,p){var C=null;p&&(C=X,cr.clearArray(C));g.update_bbox();this.getJumpthruCollisionCandidates(g.layer,g.bbox,W);var G;var x=0;for(G=W.length;x<G;++x){var K=W[x];if(K.extra.jumpthruEnabled&&this.testOverlap(g,K))if(p)C.push(K);else return cr.clearArray(W),K}cr.clearArray(W);return C};b.prototype.pushOutSolid=
function(g,p,C,G,x,K){G=G||50;var R=g.x,S=g.y,T,fa=null,ba=null;for(T=0;T<G;T++)if(g.x=R+p*T,g.y=S+C*T,g.set_bbox_changed(),!this.testOverlap(g,fa)&&((fa=this.testOverlapSolid(g))&&(ba=fa),!fa&&(x&&(fa=K?this.testOverlap(g,K)?K:null:this.testOverlapJumpThru(g))&&(ba=fa),!fa)))return ba&&this.pushInFractional(g,p,C,ba,16),!0;g.x=R;g.y=S;g.set_bbox_changed();return!1};b.prototype.pushOutSolidAxis=function(g,p,C,G){G=G||50;var x=g.x,K=g.y,R=null,S=null,T,fa;for(T=0;T<G;++T)for(fa=0;2>fa;++fa){var ba=
2*fa-1;g.x=x+p*T*ba;g.y=K+C*T*ba;g.set_bbox_changed();if(!this.testOverlap(g,R))if(R=this.testOverlapSolid(g))S=R;else return S&&this.pushInFractional(g,p*ba,C*ba,S,16),!0}g.x=x;g.y=K;g.set_bbox_changed();return!1};b.prototype.pushOut=function(g,p,C,G,x){G=G||50;var K=g.x,R=g.y,S;for(S=0;S<G;S++)if(g.x=K+p*S,g.y=R+C*S,g.set_bbox_changed(),!this.testOverlap(g,x))return!0;g.x=K;g.y=R;g.set_bbox_changed();return!1};b.prototype.pushInFractional=function(g,p,C,G,x){var K=2,R=!1;var S=!1;for(var T=g.x,
fa=g.y;K<=x;)S=1/K,K*=2,g.x+=p*S*(R?1:-1),g.y+=C*S*(R?1:-1),g.set_bbox_changed(),this.testOverlap(g,G)?S=R=!0:(S=R=!1,T=g.x,fa=g.y);S&&(g.x=T,g.y=fa,g.set_bbox_changed())};b.prototype.pushOutSolidNearest=function(g,p){p=cr.is_undefined(p)?100:p;var C=0,G=g.x,x=g.y,K=0,R=0,S=0,T=this.testOverlapSolid(g);if(!T)return!0;for(;C<=p;){switch(K){case 0:R=0;S=-1;C++;break;case 1:R=1;S=-1;break;case 2:R=1;S=0;break;case 3:S=R=1;break;case 4:R=0;S=1;break;case 5:R=-1;S=1;break;case 6:R=-1;S=0;break;case 7:S=
R=-1}K=(K+1)%8;g.x=cr.floor(G+R*C);g.y=cr.floor(x+S*C);g.set_bbox_changed();if(!this.testOverlap(g,T)&&(T=this.testOverlapSolid(g),!T))return!0}g.x=G;g.y=x;g.set_bbox_changed();return!1};b.prototype.registerCollision=function(g,p){g.collisionsEnabled&&p.collisionsEnabled&&this.registered_collisions.push([g,p])};b.prototype.addRegisteredCollisionCandidates=function(g,p,C){var G;var x=0;for(G=this.registered_collisions.length;x<G;++x){var K=this.registered_collisions[x];if(K[0]===g)K=K[1];else if(K[1]===
g)K=K[0];else continue;if(p.is_family){if(-1===p.members.indexOf(p))continue}else if(K.type!==p)continue;-1===C.indexOf(K)&&C.push(K)}};b.prototype.checkRegisteredCollision=function(g,p){var C;var G=0;for(C=this.registered_collisions.length;G<C;G++){var x=this.registered_collisions[G];if(x[0]===g&&x[1]===p||x[0]===p&&x[1]===g)return!0}return!1};b.prototype.calculateSolidBounceAngle=function(g,p,C,G){var x=g.x,K=g.y,R=cr.max(10,cr.distanceTo(p,C,x,K)),S=cr.angleTo(p,C,x,K),T=G||this.testOverlapSolid(g);
if(!T)return cr.clamp_angle(S+cr.PI);var fa=T,ba,Z=cr.to_radians(5);for(ba=1;36>ba;ba++){var da=S-ba*Z;g.x=p+Math.cos(da)*R;g.y=C+Math.sin(da)*R;g.set_bbox_changed();if(!this.testOverlap(g,fa)&&(fa=G?null:this.testOverlapSolid(g),!fa)){var ia=da;break}}36===ba&&(ia=cr.clamp_angle(S+cr.PI));fa=T;for(ba=1;36>ba;ba++)if(da=S+ba*Z,g.x=p+Math.cos(da)*R,g.y=C+Math.sin(da)*R,g.set_bbox_changed(),!this.testOverlap(g,fa)&&(fa=G?null:this.testOverlapSolid(g),!fa)){var ka=da;break}36===ba&&(ka=cr.clamp_angle(S+
cr.PI));g.x=x;g.y=K;g.set_bbox_changed();if(ka===ia)return ka;g=cr.angleDiff(ka,ia)/2;g=cr.angleClockwise(ka,ia)?cr.clamp_angle(ia+g+cr.PI):cr.clamp_angle(ka+g);ia=Math.cos(S);S=Math.sin(S);ka=Math.cos(g);g=Math.sin(g);p=ia*ka+S*g;return cr.angleTo(0,0,ia-2*p*ka,S-2*p*g)};var Y=-1;b.prototype.trigger=function(g,p,C){if(!this.running_layout)return!1;var G=this.running_layout.event_sheet;if(!G)return!1;var x=!1,K;Y++;var R=G.deep_includes;var S=0;for(K=R.length;S<K;++S){var T=this.triggerOnSheet(g,
p,R[S],C);x=x||T}T=this.triggerOnSheet(g,p,G,C);Y--;return x||T};b.prototype.triggerOnSheet=function(g,p,C,G){var x=!1,K;if(p){var R=this.triggerOnSheetForTypeName(g,p,p.type.name,C,G);x=x||R;var S=p.type.families;var T=0;for(K=S.length;T<K;++T)R=this.triggerOnSheetForTypeName(g,p,S[T].name,C,G),x=x||R}else R=this.triggerOnSheetForTypeName(g,p,"system",C,G),x=x||R;return x};b.prototype.triggerOnSheetForTypeName=function(g,p,C,G,x){var K,R=!1;var S="undefined"!==typeof x;var T=(S?G.fasttriggers:G.triggers)[C];
if(!T)return R;var fa=null;G=0;for(K=T.length;G<K;++G)if(T[G].method==g){fa=T[G].evs;break}if(!fa)return R;g=S?fa[x]:fa;if(!g)return null;G=0;for(K=g.length;G<K;G++)x=g[G][0],S=g[G][1],x=this.executeSingleTrigger(p,C,x,S),R=R||x;return R};b.prototype.executeSingleTrigger=function(g,p,C,G){var x,K=!1;this.trigger_depth++;var R=this.getCurrentEventStack().current_event;R&&this.pushCleanSol(R.solModifiersIncludingParents);var S=1<this.trigger_depth;this.pushCleanSol(C.solModifiersIncludingParents);S&&
this.pushLocalVarStack();var T=this.pushEventStack(C);T.current_event=C;if(g){var fa=this.types[p].getCurrentSol();fa.select_all=!1;cr.clearArray(fa.instances);fa.instances[0]=g;this.types[p].applySolToContainer()}g=!0;if(C.parent){p=T.temp_parents_arr;for(fa=C.parent;fa;)p.push(fa),fa=fa.parent;p.reverse();fa=0;for(x=p.length;fa<x;fa++)if(!p[fa].run_pretrigger()){g=!1;break}}g&&(this.execcount++,C.orblock?C.run_orblocktrigger(G):C.run(),K=K||T.last_event_true);this.popEventStack();S&&this.popLocalVarStack();
this.popSol(C.solModifiersIncludingParents);R&&this.popSol(R.solModifiersIncludingParents);this.hasPendingInstances&&0===this.isInOnDestroy&&0===Y&&!this.isRunningEvents&&this.ClearDeathRow();this.trigger_depth--;return K};b.prototype.getCurrentCondition=function(){var g=this.getCurrentEventStack();return g.current_event.conditions[g.cndindex]};b.prototype.getCurrentConditionObjectType=function(){return this.getCurrentCondition().type};b.prototype.isCurrentConditionFirst=function(){return 0===this.getCurrentEventStack().cndindex};
b.prototype.getCurrentAction=function(){var g=this.getCurrentEventStack();return g.current_event.actions[g.actindex]};b.prototype.pushLocalVarStack=function(){this.localvar_stack_index++;this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])};b.prototype.popLocalVarStack=function(){this.localvar_stack_index--};b.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]};b.prototype.pushEventStack=function(g){this.event_stack_index++;
this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var p=this.getCurrentEventStack();p.reset(g);return p};b.prototype.popEventStack=function(){this.event_stack_index--};b.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]};b.prototype.pushLoopStack=function(g){this.loop_stack_index++;this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:g,index:0,stopped:!1}));var p=this.getCurrentLoop();
p.name=g;p.index=0;p.stopped=!1;return p};b.prototype.popLoopStack=function(){this.loop_stack_index--};b.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]};b.prototype.getEventVariableByName=function(g,p){for(var C,G,x,K,R;p;){C=0;for(G=p.subevents.length;C<G;C++)if(R=p.subevents[C],R instanceof cr.eventvariable&&cr.equals_nocase(g,R.name))return R;p=p.parent}C=0;for(G=this.eventsheets_by_index.length;C<G;C++)for(K=this.eventsheets_by_index[C],p=0,x=K.events.length;p<
x;p++)if(R=K.events[p],R instanceof cr.eventvariable&&cr.equals_nocase(g,R.name))return R;return null};b.prototype.getLayoutBySid=function(g){var p;var C=0;for(p=this.layouts_by_index.length;C<p;C++)if(this.layouts_by_index[C].sid===g)return this.layouts_by_index[C];return null};b.prototype.getObjectTypeBySid=function(g){var p;var C=0;for(p=this.types_by_index.length;C<p;C++)if(this.types_by_index[C].sid===g)return this.types_by_index[C];return null};b.prototype.getGroupBySid=function(g){var p;var C=
0;for(p=this.allGroups.length;C<p;C++)if(this.allGroups[C].sid===g)return this.allGroups[C];return null};b.prototype.requirePermissions=function(g){return this.getPermissions(g).then(function(p){if(!1===p)return Promise.reject("Permission not granted")})};b.prototype.getPermissions=function(g){return this.isCordova&&this.isAndroid?g.reduce(function(p,C){return p.then(function(G){return!1===G?!1:E(C).then(function(x){return x?!0:w(C)})})},Promise.resolve(!0)):Promise.resolve(!0)};b.prototype.doCanvasSnapshot=
function(g,p){this.snapshotCanvas=[g,p];this.redraw=!0};b.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0};b.prototype.handleSaveLoad=function(){var g=this,p=this.saveToSlot,C=this.lastSaveJson,G=this.loadFromSlot,x=!1;this.signalledContinuousPreview&&(x=!0,p="__c2_continuouspreview",this.signalledContinuousPreview=!1);if(p.length){this.ClearDeathRow();C=this.saveToJSONString();if(N())f(p,C,function(){cr.logexport("Saved state to IndexedDB storage ("+C.length+" bytes)");
g.lastSaveJson=C;g.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);C=g.lastSaveJson="";x&&c()},function(K){try{localStorage.setItem("__c2save_"+p,C),cr.logexport("Saved state to WebStorage ("+C.length+" bytes)"),g.lastSaveJson=C,g.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),C=g.lastSaveJson="",x&&c()}catch(R){cr.logexport("Failed to save game state: "+K+"; "+R),g.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+p,
C),cr.logexport("Saved state to WebStorage ("+C.length+" bytes)"),g.lastSaveJson=C,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),C=g.lastSaveJson="",x&&c()}catch(K){cr.logexport("Error saving to WebStorage: "+K),g.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.loadFromSlot=this.saveToSlot="";this.loadFromJson=null}if(G.length){if(N())a(G,function(K){K?(g.loadFromJson=K,cr.logexport("Loaded state from IndexedDB storage ("+g.loadFromJson.length+" bytes)")):(g.loadFromJson=
localStorage.getItem("__c2save_"+G)||"",cr.logexport("Loaded state from WebStorage ("+g.loadFromJson.length+" bytes)"));g.suspendDrawing=!1;g.loadFromJson||(g.loadFromJson=null,g.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(K){g.loadFromJson=localStorage.getItem("__c2save_"+G)||"";cr.logexport("Loaded state from WebStorage ("+g.loadFromJson.length+" bytes)");g.suspendDrawing=!1;g.loadFromJson||(g.loadFromJson=null,g.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});
else{try{this.loadFromJson=localStorage.getItem("__c2save_"+G)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(K){this.loadFromJson=null}this.suspendDrawing=!1;g.loadFromJson||(g.loadFromJson=null,g.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.saveToSlot=this.loadFromSlot=""}null!==this.loadFromJson&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson)?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,
null),this.lastSaveJson=""):g.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null)};b.prototype.saveToJSONString=function(){var g,p,C,G={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};var x=0;for(g=
this.types_by_index.length;x<g;x++){var K=this.types_by_index[x];if(!K.is_family&&!this.typeHasNoSaveBehavior(K)){var R={instances:[]};cr.hasAnyOwnProperty(K.extra)&&(R.ex=l(K.extra));var S=0;for(p=K.instances.length;S<p;S++)R.instances.push(this.saveInstanceToJSON(K.instances[S]));G.types[K.sid.toString()]=R}}x=0;for(g=this.layouts_by_index.length;x<g;x++)S=this.layouts_by_index[x],G.layouts[S.sid.toString()]=S.saveToJSON();p=G.events.groups;x=0;for(g=this.allGroups.length;x<g;x++)S=this.allGroups[x],
p[S.sid.toString()]=this.groups_by_name[S.group_name].group_active;g=G.events.cnds;for(C in this.cndsBySid)this.cndsBySid.hasOwnProperty(C)&&(x=this.cndsBySid[C],cr.hasAnyOwnProperty(x.extra)&&(g[C]={ex:l(x.extra)}));g=G.events.acts;for(C in this.actsBySid)this.actsBySid.hasOwnProperty(C)&&(x=this.actsBySid[C],cr.hasAnyOwnProperty(x.extra)&&(g[C]={ex:l(x.extra)}));g=G.events.vars;for(C in this.varsBySid)this.varsBySid.hasOwnProperty(C)&&(x=this.varsBySid[C],x.is_constant||x.parent&&!x.is_static||
(g[C]=x.data));G.system=this.system.saveToJSON();return JSON.stringify(G)};b.prototype.refreshUidMap=function(){var g,p;this.objectsByUid={};var C=0;for(g=this.types_by_index.length;C<g;C++){var G=this.types_by_index[C];if(!G.is_family){var x=0;for(p=G.instances.length;x<p;x++){var K=G.instances[x];this.objectsByUid[K.uid.toString()]=K}}}};b.prototype.loadFromJSONString=function(g){try{var p=JSON.parse(g)}catch(ba){return!1}if(!p.c2save||1<p.version)return!1;this.isLoadingState=!0;g=p.rt;this.kahanTime.reset();
this.kahanTime.sum=g.time;this.wallTime.reset();this.wallTime.sum=g.walltime||0;this.timescale=g.timescale;this.tickcount=g.tickcount;this.execcount=g.execcount;this.start_time=Date.now()-g.start_time_offset;var C=g.running_layout;if(C!==this.running_layout.sid)if(C=this.getLayoutBySid(C))this.doChangeLayout(C);else return;var G,x,K;var R=p.types;for(x in R)if(R.hasOwnProperty(x)&&(K=this.getObjectTypeBySid(parseInt(x,10)))&&!K.is_family&&!this.typeHasNoSaveBehavior(K)){R[x].ex?K.extra=R[x].ex:cr.wipe(K.extra);
var S=K.instances;var T=R[x].instances;C=0;for(G=cr.min(S.length,T.length);C<G;C++)this.loadInstanceFromJSON(S[C],T[C]);C=T.length;for(G=S.length;C<G;C++)this.DestroyInstance(S[C]);C=S.length;for(G=T.length;C<G;C++){S=null;if(K.plugin.is_world&&(S=this.running_layout.getLayerBySid(T[C].w.l),!S))continue;S=this.createInstanceFromInit(K.default_instance,S,!1,0,0,!0);this.loadInstanceFromJSON(S,T[C])}K.stale_iids=!0}this.ClearDeathRow();this.refreshUidMap();G=p.layouts;for(x in G)G.hasOwnProperty(x)&&
(C=this.getLayoutBySid(parseInt(x,10)))&&C.loadFromJSON(G[x]);G=p.events.groups;for(x in G)G.hasOwnProperty(x)&&(C=this.getGroupBySid(parseInt(x,10)))&&this.groups_by_name[C.group_name]&&this.groups_by_name[C.group_name].setGroupActive(G[x]);C=p.events.cnds;for(x in this.cndsBySid)this.cndsBySid.hasOwnProperty(x)&&(C.hasOwnProperty(x)?this.cndsBySid[x].extra=C[x].ex:this.cndsBySid[x].extra={});C=p.events.acts;for(x in this.actsBySid)this.actsBySid.hasOwnProperty(x)&&(C.hasOwnProperty(x)?this.actsBySid[x].extra=
C[x].ex:this.actsBySid[x].extra={});C=p.events.vars;for(x in C)C.hasOwnProperty(x)&&this.varsBySid.hasOwnProperty(x)&&(this.varsBySid[x].data=C[x]);this.next_uid=g.next_uid;this.isLoadingState=!1;C=0;for(G=this.fireOnCreateAfterLoad.length;C<G;++C)S=this.fireOnCreateAfterLoad[C],this.trigger(Object.getPrototypeOf(S.type.plugin).cnds.OnCreated,S);cr.clearArray(this.fireOnCreateAfterLoad);this.system.loadFromJSON(p.system);C=0;for(G=this.types_by_index.length;C<G;C++)if(K=this.types_by_index[C],!K.is_family&&
!this.typeHasNoSaveBehavior(K))for(p=0,x=K.instances.length;p<x;p++){S=K.instances[p];if(K.is_contained)for(R=S.get_iid(),cr.clearArray(S.siblings),g=0,T=K.container.length;g<T;g++){var fa=K.container[g];K!==fa&&S.siblings.push(fa.instances[R])}S.afterLoad&&S.afterLoad();if(S.behavior_insts)for(g=0,T=S.behavior_insts.length;g<T;g++)R=S.behavior_insts[g],R.afterLoad&&R.afterLoad()}return this.redraw=!0};b.prototype.saveInstanceToJSON=function(g,p){var C;var G=g.type;var x=G.plugin;var K={};p?K.c2=
!0:K.uid=g.uid;cr.hasAnyOwnProperty(g.extra)&&(K.ex=l(g.extra));if(g.instance_vars&&g.instance_vars.length)for(K.ivs={},p=0,C=g.instance_vars.length;p<C;p++)K.ivs[g.type.instvar_sids[p].toString()]=g.instance_vars[p];if(x.is_world){x={x:g.x,y:g.y,w:g.width,h:g.height,l:g.layer.sid,zi:g.get_zindex()};0!==g.angle&&(x.a=g.angle);1!==g.opacity&&(x.o=g.opacity);.5!==g.hotspotX&&(x.hX=g.hotspotX);.5!==g.hotspotY&&(x.hY=g.hotspotY);0!==g.blend_mode&&(x.bm=g.blend_mode);g.visible||(x.v=g.visible);g.collisionsEnabled||
(x.ce=g.collisionsEnabled);-1!==g.my_timescale&&(x.mts=g.my_timescale);if(G.effect_types.length)for(x.fx=[],p=0,C=G.effect_types.length;p<C;p++){var R=G.effect_types[p];x.fx.push({name:R.name,active:g.active_effect_flags[R.index],params:g.effect_params[R.index]})}K.w=x}if(g.behavior_insts&&g.behavior_insts.length)for(K.behs={},p=0,C=g.behavior_insts.length;p<C;p++)G=g.behavior_insts[p],G.saveToJSON&&(K.behs[G.type.sid.toString()]=G.saveToJSON());g.saveToJSON&&(K.data=g.saveToJSON());return K};b.prototype.getInstanceVarIndexBySid=
function(g,p){var C;var G=0;for(C=g.instvar_sids.length;G<C;G++)if(g.instvar_sids[G]===p)return G;return-1};b.prototype.getBehaviorIndexBySid=function(g,p){var C;var G=0;for(C=g.behavior_insts.length;G<C;G++)if(g.behavior_insts[G].type.sid===p)return G;return-1};b.prototype.loadInstanceFromJSON=function(g,p,C){var G,x;var K=g.type;var R=K.plugin;if(C){if(!p.c2)return}else g.uid=p.uid;p.ex?g.extra=p.ex:cr.wipe(g.extra);if(x=p.ivs)for(G in x)if(x.hasOwnProperty(G)){var S=this.getInstanceVarIndexBySid(K,
parseInt(G,10));if(!(0>S||S>=g.instance_vars.length)){var T=x[G];null===T&&(T=NaN);g.instance_vars[S]=T}}if(R.is_world){S=p.w;g.layer.sid!==S.l&&(x=g.layer,g.layer=this.running_layout.getLayerBySid(S.l),g.layer?(x.removeFromInstanceList(g,!0),g.layer.appendToInstanceList(g,!0),g.set_bbox_changed(),g.layer.setZIndicesStaleFrom(0)):(g.layer=x,C||this.DestroyInstance(g)));g.x=S.x;g.y=S.y;g.width=S.w;g.height=S.h;g.zindex=S.zi;g.angle=S.hasOwnProperty("a")?S.a:0;g.opacity=S.hasOwnProperty("o")?S.o:1;
g.hotspotX=S.hasOwnProperty("hX")?S.hX:.5;g.hotspotY=S.hasOwnProperty("hY")?S.hY:.5;g.visible=S.hasOwnProperty("v")?S.v:!0;g.collisionsEnabled=S.hasOwnProperty("ce")?S.ce:!0;g.my_timescale=S.hasOwnProperty("mts")?S.mts:-1;g.blend_mode=S.hasOwnProperty("bm")?S.bm:0;g.compositeOp=cr.effectToCompositeOp(g.blend_mode);this.gl&&cr.setGLBlend(g,g.blend_mode,this.gl);g.set_bbox_changed();if(S.hasOwnProperty("fx"))for(C=0,x=S.fx.length;C<x;C++)T=K.getEffectIndexByName(S.fx[C].name),0>T||(g.active_effect_flags[T]=
S.fx[C].active,g.effect_params[T]=S.fx[C].params);g.updateActiveEffects()}if(K=p.behs)for(G in K)K.hasOwnProperty(G)&&(C=this.getBehaviorIndexBySid(g,parseInt(G,10)),0>C||g.behavior_insts[C].loadFromJSON(K[G]));p.data&&g.loadFromJSON(p.data)};b.prototype.getProjectFileUrl=function(g){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(g.toLowerCase())?window.cr_previewProjectFiles[g.toLowerCase()]:g:this.files_subfolder+g};b.prototype.getProjectFileBlob=function(g){return this.isPreview?
window.cr_previewProjectFileBlobs&&window.cr_previewProjectFiles.hasOwnProperty(g.toLowerCase())?window.cr_previewProjectFileBlobs[g.toLowerCase()]:null:null};b.prototype.getLocalFileUrl=function(g){return this.isPreview?window.cr_previewProjectFiles.hasOwnProperty(g.toLowerCase())?window.cr_previewProjectFiles[g.toLowerCase()]:g:g};b.prototype.fetchLocalFileViaCordova=function(g,p,C){window.resolveLocalFileSystemURL(window.cordova.file.applicationDirectory+"www/"+g,function(G){G.file(p,C)},C)};b.prototype.fetchLocalFileViaCordovaAsText=
function(g,p,C){this.fetchLocalFileViaCordova(g,function(G){var x=new FileReader;x.onload=function(K){p(K.target.result)};x.onerror=C;x.readAsText(G)},C)};var ea=[],ha=0;b.prototype.maybeStartNextArrayBufferRead=function(){if(ea.length&&!(8<=ha)){ha++;var g=ea.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(g.filename,g.successCallback,g.errorCallback)}};b.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(g,p,C){var G=this;ea.push({filename:g,successCallback:function(x){ha--;G.maybeStartNextArrayBufferRead();
p(x)},errorCallback:function(x){ha--;G.maybeStartNextArrayBufferRead();C(x)}});this.maybeStartNextArrayBufferRead()};b.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(g,p,C){this.fetchLocalFileViaCordova(g,function(G){var x=new FileReader;x.onload=function(K){p(K.target.result)};x.readAsArrayBuffer(G)},C)};b.prototype.fetchLocalFileViaCordovaAsURL=function(g,p,C){var G="",x=g.toLowerCase(),K=x.substr(x.length-4);x=x.substr(x.length-5);".mp4"===K?G="video/mp4":".webm"===x?G="video/webm":
".m4a"===K?G="audio/mp4":".mp3"===K&&(G="audio/mpeg");this.fetchLocalFileViaCordovaAsArrayBuffer(g,function(R){R=new Blob([R],{type:G});R=URL.createObjectURL(R);p(R)},C)};b.prototype.isAbsoluteUrl=function(g){return/^(?:[a-z]+:)?\/\//.test(g)||"data:"===g.substr(0,5)||"blob:"===g.substr(0,5)};b.prototype.setImageSrc=function(g,p){this.isWKWebView&&!this.isAbsoluteUrl(p)?this.fetchLocalFileViaCordovaAsURL(p,function(C){g.src=C},function(C){alert("Failed to load image: "+C)}):this.isPreview&&!this.isAbsoluteUrl(p)?
g.src=this.getLocalFileUrl(p):(this.isAbsoluteUrl(p)||(p=p.toLowerCase()),g.src=p)};b.prototype.getPreferredAudioFile=function(g){g=g.toLowerCase();if(!this.audio_files_map.hasOwnProperty(g))return null;g=this.audio_files_map[g];var p=null,C;var G=0;for(C=g.length;G<C;++G){var x=g[G];var K=x[0];p||"audio/webm; codecs=opus"!==K||(p=x);if(y[K])return x}return p};b.prototype.getProjectAudioFileUrl=function(g){var p=g.toLowerCase();return(g=this.getPreferredAudioFile(g))?{url:this.getProjectFileUrl(p+
g[1]),type:g[0]}:null};b.prototype.getStatusInfo=function(){return{fps:this.fps,cpu:this.cpuutilisation/1E3,gpu:this.gpuLastUtilisation,layout:this.running_layout?this.running_layout.name:"",renderer:this.glUnmaskedRenderer}};b.prototype.accelerate=function(g,p,C,G,x){return this.enhancedAccelerationPrecision?cr.clamp(g*x+.5*G*x*x,p*x,C*x):g*x};cr.runtime=b;cr.createRuntime=function(g){return new b(g)};window.cr_createRuntime=cr.createRuntime})();
window.cr_getSnapshot=function(b,m){var w=window.c3runtime;w&&w.doCanvasSnapshot(b,m)};window.cr_sizeCanvas=function(b,m){if(0!==b&&0!==m){var w=window.c3runtime;w&&w.setSize(b,m)}};window.cr_setSuspended=function(b){var m=window.c3runtime;m&&m.setSuspended(b)};
(function(){function b(a,c){return a.zindex-c.zindex}function m(a,c){this.layout=a;this.runtime=a.runtime;this.instances=[];this.scale=1;this.angle=0;this.disableAngle=!1;this.tmprect=new cr.rect(0,0,0,0);this.tmpquad=new cr.quad;this.viewBottom=this.viewTop=this.viewRight=this.viewLeft=0;this.zindices_stale=!1;this.zindices_stale_from=-1;this.clear_earlyz_index=0;this.name=c[0];this.index=c[1];this.sid=c[2];this.visible=c[3];this.background_color=c[4];this.transparent=c[5];this.parallaxX=c[6];this.parallaxY=
c[7];this.opacity=c[8];this.forceOwnTexture=c[9];this.useRenderCells=c[10];this.zoomRate=c[11];this.blend_mode=c[12];this.effect_fallback=c[13];this.compositeOp="source-over";this.destBlend=this.srcBlend=0;this.render_grid=null;this.last_render_list=w();this.render_list_stale=!0;this.last_render_cells=new cr.rect(0,0,-1,-1);this.cur_render_cells=new cr.rect(0,0,-1,-1);this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height));this.render_offscreen=
!1;a=c[14];var l;this.startup_initial_instances=[];this.initial_instances=[];this.created_globals=[];var v=0;for(l=a.length;v<l;v++){var t=a[v],y=this.runtime.types_by_index[t[1]];y.default_instance||(y.default_instance=t,y.default_layerindex=this.index);this.initial_instances.push(t);-1===this.layout.initial_types.indexOf(y)&&this.layout.initial_types.push(y)}cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances);this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=
!0;this.effect_params=[];v=0;for(l=c[15].length;v<l;v++)this.effect_types.push({id:c[15][v][0],name:c[15][v][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:v}),this.effect_params.push(c[15][v][2].slice(0));this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1)}function w(){return N.length?N.pop():[]}function E(a){cr.clearArray(a);N.push(a)}m.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
this.shaders_preserve_opaqueness=!0;var a;var c=0;for(a=this.effect_types.length;c<a;c++){var l=this.effect_types[c];l.active&&(this.active_effect_types.push(l),l.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};m.prototype.getEffectByName=function(a){var c;var l=0;for(c=this.effect_types.length;l<c;l++){var v=this.effect_types[l];if(v.name===a)return v}return null};m.prototype.createInitialInstances=function(a){var c,l;var v=c=0;for(l=this.initial_instances.length;c<l;c++){var t=this.initial_instances[c];
var y=this.runtime.types_by_index[t[1]];var L=this.runtime.typeHasPersistBehavior(y);y=!0;if(!L||this.layout.first_visit){t=this.runtime.createInstanceFromInit(t,this,!0);if(!t)continue;a.push(t);t.type.global&&(y=!1,this.created_globals.push(t.uid))}y&&(this.initial_instances[v]=this.initial_instances[c],v++)}this.initial_instances.length=v;this.runtime.ClearDeathRow();!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback);this.compositeOp=cr.effectToCompositeOp(this.blend_mode);
this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl);this.render_list_stale=!0};m.prototype.recreateInitialObjects=function(a,c){var l,v=this.runtime.types_by_index,t=a.is_family,y=a.members;var L=0;for(l=this.initial_instances.length;L<l;++L){var q=this.initial_instances[L];var B=q[0];var A=B[0];B=B[1];if(c.contains_pt(A,B)){A=v[q[1]];if(A!==a)if(t){if(0>y.indexOf(A))continue}else continue;q=this.runtime.createInstanceFromInit(q,this,!1);this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(A.plugin).cnds.OnCreated,
q);if(q.is_contained)for(A=0,B=q.siblings.length;A<B;A++){var h=q.siblings[L];this.runtime.trigger(Object.getPrototypeOf(h.type.plugin).cnds.OnCreated,h)}this.runtime.isInOnDestroy--}}};m.prototype.removeFromInstanceList=function(a,c){var l=cr.fastIndexOf(this.instances,a);0>l||(c&&this.useRenderCells&&a.rendercells&&a.rendercells.right>=a.rendercells.left&&(a.update_bbox(),this.render_grid.update(a,a.rendercells,null),a.rendercells.set(0,0,-1,-1)),l===this.instances.length-1?this.instances.pop():
(cr.arrayRemove(this.instances,l),this.setZIndicesStaleFrom(l)),this.render_list_stale=!0)};m.prototype.appendToInstanceList=function(a,c){a.zindex=this.instances.length;this.instances.push(a);c&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed();this.render_list_stale=!0};m.prototype.prependToInstanceList=function(a,c){this.instances.unshift(a);this.setZIndicesStaleFrom(0);c&&this.useRenderCells&&a.rendercells&&a.set_bbox_changed()};m.prototype.moveInstanceAdjacent=function(a,c,l){var v=a.get_zindex();
c=c.get_zindex();cr.arrayRemove(this.instances,v);v<c&&c--;l&&c++;c===this.instances.length?this.instances.push(a):this.instances.splice(c,0,a);this.setZIndicesStaleFrom(v<c?v:c)};m.prototype.setZIndicesStaleFrom=function(a){-1===this.zindices_stale_from?this.zindices_stale_from=a:a<this.zindices_stale_from&&(this.zindices_stale_from=a);this.render_list_stale=this.zindices_stale=!0};m.prototype.updateZIndices=function(){if(this.zindices_stale){-1===this.zindices_stale_from&&(this.zindices_stale_from=
0);var a;if(this.useRenderCells){var c=this.zindices_stale_from;for(a=this.instances.length;c<a;++c){var l=this.instances[c];l.zindex=c;this.render_grid.markRangeChanged(l.rendercells)}}else for(c=this.zindices_stale_from,a=this.instances.length;c<a;++c)this.instances[c].zindex=c;this.zindices_stale=!1;this.zindices_stale_from=-1}};m.prototype.getScale=function(a){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||a?this.runtime.aspect_scale:1)};m.prototype.getNormalScale=function(){return(this.scale*
this.layout.scale-1)*this.zoomRate+1};m.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var N=[],D=[],f=[];m.prototype.getRenderCellInstancesToDraw=function(){this.updateZIndices();this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,f);if(!f.length)return w();if(1===f.length){var a=w();cr.shallowAssignArray(a,f[0]);cr.clearArray(f);return a}for(var c=!0;1<f.length;){var l;a=f;var v=c;var t=0;for(l=a.length;t<
l-1;t+=2){var y=a[t];var L=a[t+1];c=w();var q=y,B=L,A=c,h=0,n=0,z=0,P=q.length,V=B.length;for(A.length=P+V;h<P&&n<V;++z){var H=q[h];var d=B[n];H.zindex<d.zindex?(A[z]=H,++h):(A[z]=d,++n)}for(;h<P;++h,++z)A[z]=q[h];for(;n<V;++n,++z)A[z]=B[n];v||(E(y),E(L));D.push(c)}1===l%2&&(v?(y=w(),cr.shallowAssignArray(y,a[l-1]),D.push(y)):D.push(a[l-1]));cr.shallowAssignArray(a,D);cr.clearArray(D);c=!1}a=f[0];cr.clearArray(f);return a};m.prototype.draw=function(a){this.render_offscreen=this.forceOwnTexture||1!==
this.opacity||0!==this.blend_mode;var c=this.runtime.canvas,l=a,v=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),c=this.runtime.layer_canvas,c.width=this.runtime.draw_width,c.height=this.runtime.draw_height,this.runtime.layer_ctx=c.getContext("2d"),v=!0),c=this.runtime.layer_canvas,l=this.runtime.layer_ctx,c.width!==this.runtime.draw_width&&(c.width=this.runtime.draw_width,v=!0),c.height!==this.runtime.draw_height&&(c.height=this.runtime.draw_height,
v=!0),v&&(l.imageSmoothingEnabled=this.runtime.linearSampling),this.transparent&&l.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height));l.globalAlpha=1;l.globalCompositeOperation="source-over";this.transparent||(l.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",l.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height));l.save();this.disableAngle=!0;v=this.canvasToLayer(0,0,!0,!0);var t=this.canvasToLayer(0,0,!1,!0);this.disableAngle=
!1;this.runtime.pixel_rounding&&(v=Math.round(v),t=Math.round(t));this.rotateViewport(v,t,l);var y=this.getScale();l.scale(y,y);l.translate(-v,-t);this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?
(E(this.last_render_list),v=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):v=this.last_render_list):v=this.instances;var L=null;t=0;for(y=v.length;t<y;++t){var q=v[t];q!==L&&(this.drawInstance(q,l),L=q)}this.useRenderCells&&(this.last_render_list=v);l.restore();this.render_offscreen&&(a.globalCompositeOperation=this.compositeOp,a.globalAlpha=this.opacity,a.drawImage(c,0,0))};m.prototype.drawInstance=function(a,c){if(a.visible&&0!==
a.width&&0!==a.height){a.update_bbox();var l=a.bbox;l.right<this.viewLeft||l.bottom<this.viewTop||l.left>this.viewRight||l.top>this.viewBottom||(c.globalCompositeOperation=a.compositeOp,a.draw(c))}};m.prototype.updateViewport=function(a){this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0),l=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),l=Math.round(l));this.rotateViewport(c,l,a)};m.prototype.rotateViewport=function(a,c,l){var v=this.getScale();
this.viewLeft=a;this.viewTop=c;this.viewRight=a+1/v*this.runtime.draw_width;this.viewBottom=c+1/v*this.runtime.draw_height;a=this.getAngle();0!==a&&(l&&(l.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),l.rotate(-a),l.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,
a),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)};m.prototype.drawGL_earlyZPass=function(a){if(this.render_offscreen=this.forceOwnTexture){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));
if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex)}this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0),l=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),l=Math.round(l));
this.rotateViewport(c,l,null);c=this.getScale();a.resetModelView();a.scale(c,c);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),
this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(E(this.last_render_list),c=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):c=this.last_render_list):c=this.instances;var v=null;for(l=c.length-1;0<=l;--l){var t=c[l];t!==v&&(this.drawInstanceGL_earlyZPass(c[l],a),v=t)}this.useRenderCells&&(this.last_render_list=c);this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,a.setEarlyZIndex(this.clear_earlyz_index),
a.setColorFillMode(1,1,1,1),a.fullscreenQuad(),a.restoreEarlyZMode())};m.prototype.drawGL=function(a){if(this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)a.deleteTexture(this.runtime.layer_tex),
this.runtime.layer_tex=a.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex);this.transparent&&a.clear(0,0,0,0)}this.transparent||(this.runtime.enableFrontToBack?(a.setEarlyZIndex(this.clear_earlyz_index),a.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),a.fullscreenQuad(),a.setTextureFillMode()):a.clear(this.background_color[0]/255,this.background_color[1]/
255,this.background_color[2]/255,1));this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0,!0);var l=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=Math.round(c),l=Math.round(l));this.rotateViewport(c,l,null);c=this.getScale();a.resetModelView();a.scale(c,c);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),
this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(E(this.last_render_list),l=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):l=this.last_render_list):l=this.instances;var v,t=null;if(2.220446049250313E-16<
this.getNormalScale()){var y=0;for(v=l.length;y<v;++y){var L=l[y];L!==t&&(this.drawInstanceGL(l[y],a),t=L)}}this.useRenderCells&&(this.last_render_list=l);this.render_offscreen&&(l=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,y=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!a.programUsesCrossSampling(l)&&1===this.opacity?(1===this.active_effect_types.length?(a.switchProgram(l),
a.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,0,0,1,1,c,this.getAngle(),this.runtime.kahanTime.sum,this.effect_params[y]),a.programIsAnimated(l)&&(this.runtime.redraw=!0)):a.switchProgram(0),a.setRenderingToTexture(this.layout.getRenderTarget()),a.setOpacity(this.opacity),a.setTexture(this.runtime.layer_tex),a.setBlend(this.srcBlend,this.destBlend),a.resetModelView(),
a.updateModelView(),c=this.runtime.draw_width/2,l=this.runtime.draw_height/2,a.quad(-c,l,c,l,c,-l,-c,-l),a.setTexture(null)):this.layout.renderEffectChain(a,this,null,this.layout.getRenderTarget()))};m.prototype.drawInstanceGL=function(a,c){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var l=a.bbox;l.right<this.viewLeft||l.bottom<this.viewTop||l.left>this.viewRight||l.top>this.viewBottom||(c.setEarlyZIndex(a.earlyz_index),a.uses_shaders?this.drawInstanceWithShadersGL(a,c):(c.switchProgram(0),
c.setBlend(a.srcBlend,a.destBlend),a.drawGL(c)))}};m.prototype.drawInstanceGL_earlyZPass=function(a,c){if(a.visible&&0!==a.width&&0!==a.height){a.update_bbox();var l=a.bbox;l.right<this.viewLeft||l.bottom<this.viewTop||l.left>this.viewRight||l.top>this.viewBottom||(a.earlyz_index=this.runtime.earlyz_index++,0===a.blend_mode&&1===a.opacity&&a.shaders_preserve_opaqueness&&a.drawGL_earlyZPass&&(c.setEarlyZIndex(a.earlyz_index),a.drawGL_earlyZPass(c)))}};m.prototype.drawInstanceWithShadersGL=function(a,
c){var l=a.active_effect_types[0].shaderindex,v=a.active_effect_types[0].index,t=this.getScale(),y=this.runtime.draw_width,L=this.runtime.draw_height;if(1!==a.active_effect_types.length||c.programUsesCrossSampling(l)||c.programExtendsBox(l)||(a.angle||a.layer.getAngle())&&c.programUsesDest(l)||1!==a.opacity||a.type.plugin.must_predraw)this.layout.renderEffectChain(c,this,a,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),c.resetModelView(),c.scale(t,t),c.rotateZ(-this.getAngle()),
c.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),c.updateModelView();else{c.switchProgram(l);c.setBlend(a.srcBlend,a.destBlend);c.programIsAnimated(l)&&(this.runtime.redraw=!0);var q=0,B=0,A=0,h=0;c.programUsesDest(l)&&(h=a.bbox,q=this.layerToCanvas(h.left,h.top,!0,!0),B=this.layerToCanvas(h.left,h.top,!1,!0),A=this.layerToCanvas(h.right,h.bottom,!0,!0),h=this.layerToCanvas(h.right,h.bottom,!1,!0),q/=y,B=1-B/L,A/=y,h=1-h/L);L=y=0;var n=l=1,z=1/a.width,P=1/a.height;
a.curFrame&&a.curFrame.sheetTex&&(y=a.curFrame.sheetTex.left,L=a.curFrame.sheetTex.top,l=a.curFrame.sheetTex.right,n=a.curFrame.sheetTex.bottom,a.curFrame.texture_img&&(z=1/a.curFrame.texture_img.width,P=1/a.curFrame.texture_img.height));c.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),z,P,y,L,l,n,y,L,l,n,a.bbox.left,a.bbox.top,a.bbox.right,a.bbox.bottom,q,B,A,h,t,this.getAngle(),this.runtime.kahanTime.sum,a.effect_params[v]);a.drawGL(c)}};m.prototype.canvasToLayer=
function(a,c,l,v){var t=this.runtime.devicePixelRatio;this.runtime.isRetina&&(a*=t,c*=t);t=this.runtime.parallax_x_origin;var y=this.runtime.parallax_y_origin;t=(this.layout.scrollX-t)*this.parallaxX+t;y=(this.layout.scrollY-y)*this.parallaxY+y;var L=t,q=y,B=1/this.getScale(!v);v?(L-=this.runtime.draw_width*B/2,q-=this.runtime.draw_height*B/2):(L-=this.runtime.width*B/2,q-=this.runtime.height*B/2);L+=a*B;q+=c*B;c=this.getAngle();0!==c&&(L-=t,q-=y,a=Math.cos(c),c=Math.sin(c),v=L*a-q*c,q=q*a+L*c,L=
v+t,q+=y);return l?L:q};m.prototype.layerToCanvas=function(a,c,l,v){var t=this.runtime.parallax_x_origin,y=this.runtime.parallax_y_origin,L=(this.layout.scrollX-t)*this.parallaxX+t,q=(this.layout.scrollY-y)*this.parallaxY+y;y=L;t=q;var B=this.getAngle();if(0!==B){a-=L;c-=q;var A=Math.cos(-B);B=Math.sin(-B);var h=a*A-c*B;c=c*A+a*B;a=h+L;c+=q}L=1/this.getScale(!v);v?(y-=this.runtime.draw_width*L/2,t-=this.runtime.draw_height*L/2):(y-=this.runtime.width*L/2,t-=this.runtime.height*L/2);y=(a-y)/L;t=(c-
t)/L;a=this.runtime.devicePixelRatio;this.runtime.isRetina&&!v&&(y/=a,t/=a);return l?y:t};m.prototype.rotatePt=function(a,c,l){if(0===this.getAngle())return l?a:c;var v=this.layerToCanvas(a,c,!0);c=this.layerToCanvas(a,c,!1);this.disableAngle=!0;a=this.canvasToLayer(v,c,!0);v=this.canvasToLayer(v,c,!0);this.disableAngle=!1;return l?a:v};m.prototype.saveToJSON=function(){var a,c={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,
t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]};var l=0;for(a=this.effect_types.length;l<a;l++){var v=this.effect_types[l];c.fx.push({name:v.name,active:v.active,params:this.effect_params[v.index]})}return c};m.prototype.loadFromJSON=function(a){var c;this.scale=a.s;this.angle=a.a;this.viewLeft=a.vl;this.viewTop=a.vt;this.viewRight=a.vr;this.viewBottom=a.vb;this.visible=a.v;this.background_color=a.bc;this.transparent=
a.t;this.parallaxX=a.px;this.parallaxY=a.py;this.opacity=a.o;this.zoomRate=a.zr;this.created_globals=a.cg||[];cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var l=new cr.ObjectSet;var v=0;for(c=this.created_globals.length;v<c;++v)l.add(this.created_globals[v]);var t=v=0;for(c=this.initial_instances.length;v<c;++v)l.contains(this.initial_instances[v][2])||(this.initial_instances[t]=this.initial_instances[v],++t);cr.truncateArray(this.initial_instances,t);t=a.fx;v=0;for(c=
t.length;v<c;v++)if(a=this.getEffectByName(t[v].name))a.active=t[v].active,this.effect_params[a.index]=t[v].params;this.updateActiveEffects();this.instances.sort(b);this.zindices_stale=!0};cr.layer=m})();
(function(){function b(f,a){this.runtime=f;this.event_sheet=null;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;this.scale=1;this.angle=0;this.first_visit=!0;this.name=a[0];this.originalWidth=a[1];this.originalHeight=a[2];this.width=a[1];this.height=a[2];this.unbounded_scrolling=a[3];this.sheetname=a[4];this.sid=a[5];var c=a[6],l;this.layers=[];this.initial_types=[];f=0;for(l=c.length;f<l;f++){var v=new cr.layer(this,c[f]);v.number=f;cr.seal(v);this.layers.push(v)}c=
a[7];this.initial_nonworld=[];f=0;for(l=c.length;f<l;f++){v=c[f];var t=this.runtime.types_by_index[v[1]];t.default_instance||(t.default_instance=v);this.initial_nonworld.push(v);-1===this.initial_types.indexOf(t)&&this.initial_types.push(t)}this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=!0;this.effect_params=[];f=0;for(l=a[8].length;f<l;f++)this.effect_types.push({id:a[8][f][0],name:a[8][f][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:f}),this.effect_params.push(a[8][f][2].slice(0));
this.updateActiveEffects();this.rcTexBounce=new cr.rect(0,0,1,1);this.rcTexDest=new cr.rect(0,0,1,1);this.rcTexOrigin=new cr.rect(0,0,1,1);this.viewRect=new cr.rect(0,0,0,0);this.persist_data={}}function m(f,a){return f.zindex-a.zindex}function w(f){return f.some(function(a){return a.plugin.is_world})}b.prototype.saveObjectToPersist=function(f){var a=f.type.sid.toString();this.persist_data.hasOwnProperty(a)||(this.persist_data[a]=[]);this.persist_data[a].push(this.runtime.saveInstanceToJSON(f))};
b.prototype.hasOpaqueBottomLayer=function(){var f=this.layers[0];return!f.transparent&&1===f.opacity&&!f.forceOwnTexture&&f.visible};b.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);this.shaders_preserve_opaqueness=!0;var f;var a=0;for(f=this.effect_types.length;a<f;a++){var c=this.effect_types[a];c.active&&(this.active_effect_types.push(c),c.preservesOpaqueness||(this.shaders_preserve_opaqueness=!1))}};b.prototype.getEffectByName=function(f){var a;var c=0;for(a=
this.effect_types.length;c<a;c++){var l=this.effect_types[c];if(l.name===f)return l}return null};var E=[],N=!0;b.prototype.startRunning=function(){this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes());this.runtime.running_layout=this;this.width=this.originalWidth;this.height=this.originalHeight;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;var f,a;var c=0;for(f=this.runtime.types_by_index.length;c<
f;c++){var l=this.runtime.types_by_index[c];if(!l.is_family){var v=l.instances;l=0;for(a=v.length;l<a;l++){var t=v[l];if(t.layer){var y=t.layer.number;y>=this.layers.length&&(y=this.layers.length-1);t.layer=this.layers[y];-1===t.layer.instances.indexOf(t)&&t.layer.instances.push(t);t.layer.zindices_stale=!0}}}}if(!N)for(c=0,f=this.layers.length;c<f;++c)this.layers[c].instances.sort(m);cr.clearArray(E);this.boundScrolling();c=0;for(f=this.layers.length;c<f;c++)t=this.layers[c],t.createInitialInstances(E),
t.updateViewport(null);v=!1;if(!this.first_visit){for(L in this.persist_data)if(this.persist_data.hasOwnProperty(L)&&(l=this.runtime.getObjectTypeBySid(parseInt(L,10)))&&!l.is_family&&this.runtime.typeHasPersistBehavior(l)){a=this.persist_data[L];c=0;for(f=a.length;c<f;c++){t=null;if(l.plugin.is_world&&(t=this.getLayerBySid(a[c].w.l),!t))continue;t=this.runtime.createInstanceFromInit(l.default_instance,t,!1,0,0,!0);this.runtime.loadInstanceFromJSON(t,a[c]);v=!0;E.push(t)}cr.clearArray(a)}c=0;for(f=
this.layers.length;c<f;c++)this.layers[c].instances.sort(m),this.layers[c].zindices_stale=!0}v&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap());this.createAndLinkContainerInstances(E);c=0;for(f=this.initial_nonworld.length;c<f;c++){var L=this.initial_nonworld[c];l=this.runtime.types_by_index[L[1]];l.is_contained||this.runtime.createInstanceFromInit(this.initial_nonworld[c],null,!0)}this.runtime.changelayout=null;this.runtime.ClearDeathRow();if(this.runtime.ctx)for(c=0,f=this.runtime.types_by_index.length;c<
f;c++)L=this.runtime.types_by_index[c],!L.is_family&&L.instances.length&&L.preloadCanvas2D&&L.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,E);else for(c=0,f=E.length;c<f;c++)t=E[c],this.runtime.trigger(Object.getPrototypeOf(t.type.plugin).cnds.OnCreated,t);cr.clearArray(E);this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null);this.first_visit=!1};b.prototype.createAndLinkContainerInstances=
function(f){var a,c;for(a=0;a<f.length;a++){var l=f[a];if(l.type.is_contained){var v=l.get_iid();var t=0;for(c=l.type.container.length;t<c;t++){var y=l.type.container[t];if(l.type!==y)if(y.instances.length>v)l.siblings.push(y.instances[v]);else if(y.default_instance){var L=this.runtime.createInstanceFromInit(y.default_instance,l.layer,!0,l.x,l.y,!0);this.runtime.ClearDeathRow();y.updateIIDs();l.siblings.push(L);f.push(L)}}}}};b.prototype.createGlobalNonWorlds=function(){var f,a,c=[];var l=f=0;for(a=
this.initial_nonworld.length;f<a;f++){var v=this.initial_nonworld[f];var t=this.runtime.types_by_index[v[1]];t.global?t.is_contained&&w(t.container)||c.push(this.runtime.createInstanceFromInit(v,null,!0)):(this.initial_nonworld[l]=v,l++)}cr.truncateArray(this.initial_nonworld,l);this.runtime.ClearDeathRow();this.createAndLinkContainerInstances(c)};b.prototype.stopRunning=function(){this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null);this.runtime.isEndingLayout=
!0;cr.clearArray(this.runtime.system.waits);var f,a;if(!this.first_visit){var c=0;for(f=this.layers.length;c<f;c++){this.layers[c].updateZIndices();var l=this.layers[c].instances;var v=0;for(a=l.length;v<a;v++){var t=l[v];t.type.global||this.runtime.typeHasPersistBehavior(t.type)&&this.saveObjectToPersist(t)}}}c=0;for(f=this.layers.length;c<f;c++){l=this.layers[c].instances;v=0;for(a=l.length;v<a;v++)t=l[v],t.type.global||this.runtime.DestroyInstance(t);this.runtime.ClearDeathRow();cr.clearArray(l);
this.layers[c].zindices_stale=!0}c=0;for(f=this.runtime.types_by_index.length;c<f;c++)if(l=this.runtime.types_by_index[c],!(l.global||l.plugin.is_world||l.plugin.singleglobal||l.is_family)){v=0;for(a=l.instances.length;v<a;v++)this.runtime.DestroyInstance(l.instances[v]);this.runtime.ClearDeathRow()}N=!1;this.runtime.isEndingLayout=!1};var D=new cr.rect(0,0,0,0);b.prototype.recreateInitialObjects=function(f,a,c,l,v){D.set(a,c,l,v);a=0;for(c=this.layers.length;a<c;a++)this.layers[a].recreateInitialObjects(f,
D)};b.prototype.draw=function(f){var a=f,c=!1,l=!this.runtime.fullscreenScalingQuality;if(l){if(!this.runtime.layout_canvas){this.runtime.layout_canvas=document.createElement("canvas");var v=this.runtime.layout_canvas;v.width=this.runtime.draw_width;v.height=this.runtime.draw_height;this.runtime.layout_ctx=v.getContext("2d");c=!0}v=this.runtime.layout_canvas;a=this.runtime.layout_ctx;v.width!==this.runtime.draw_width&&(v.width=this.runtime.draw_width,c=!0);v.height!==this.runtime.draw_height&&(v.height=
this.runtime.draw_height,c=!0);c&&(a.imageSmoothingEnabled=this.runtime.linearSampling)}a.globalAlpha=1;a.globalCompositeOperation="source-over";this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&a.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height);var t;c=0;for(t=this.layers.length;c<t;c++){var y=this.layers[c];y.visible&&0<y.opacity&&11!==y.blend_mode&&(y.instances.length||!y.transparent)?y.draw(a):y.updateViewport(null)}l&&f.drawImage(v,0,0,this.runtime.width,this.runtime.height)};
b.prototype.drawGL_earlyZPass=function(f){f.setEarlyZPass(!0);this.runtime.layout_tex||(this.runtime.layout_tex=f.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)f.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=f.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);f.setRenderingToTexture(this.runtime.layout_tex);
this.runtime.fullscreenScalingQuality||f.setSize(this.runtime.draw_width,this.runtime.draw_height);var a;for(a=this.layers.length-1;0<=a;--a){var c=this.layers[a];c.visible&&1===c.opacity&&c.shaders_preserve_opaqueness&&0===c.blend_mode&&(c.instances.length||!c.transparent)?c.drawGL_earlyZPass(f):c.updateViewport(null)}f.setEarlyZPass(!1)};b.prototype.drawGL=function(f){var a=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;
if(a){this.runtime.layout_tex||(this.runtime.layout_tex=f.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)f.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=f.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling);f.setRenderingToTexture(this.runtime.layout_tex);this.runtime.fullscreenScalingQuality||
f.setSize(this.runtime.draw_width,this.runtime.draw_height)}else this.runtime.layout_tex&&(f.setRenderingToTexture(null),f.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null);this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&f.clear(0,0,0,0);var c;var l=0;for(c=this.layers.length;l<c;l++){var v=this.layers[l];v.visible&&0<v.opacity&&(v.instances.length||!v.transparent)?v.drawGL(f):v.updateViewport(null)}a&&(0===this.active_effect_types.length||1===this.active_effect_types.length&&
this.runtime.fullscreenScalingQuality?(1===this.active_effect_types.length?(a=this.active_effect_types[0].index,l=this.calculateViewRect(),f.switchProgram(this.active_effect_types[0].shaderindex),f.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,0,0,1,1,l.left,l.top,l.right,l.bottom,0,0,1,1,this.scale,this.angle,this.runtime.kahanTime.sum,this.effect_params[a]),f.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):f.switchProgram(0),
this.runtime.fullscreenScalingQuality||f.setSize(this.runtime.width,this.runtime.height),f.setRenderingToTexture(null),f.setDepthTestEnabled(!1),f.setOpacity(1),f.setTexture(this.runtime.layout_tex),f.setAlphaBlend(),f.resetModelView(),f.updateModelView(),a=this.runtime.width/2,l=this.runtime.height/2,f.quad(-a,l,a,l,a,-l,-a,-l),f.setTexture(null),f.setDepthTestEnabled(!0)):this.renderEffectChain(f,null,null,null))};b.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||
this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null};b.prototype.getMinLayerScale=function(){var f=this.layers[0].getScale(),a;var c=1;for(a=this.layers.length;c<a;c++){var l=this.layers[c];(0!==l.parallaxX||0!==l.parallaxY)&&l.getScale()<f&&(f=l.getScale())}return f};b.prototype.scrollToX=function(f){if(!this.unbounded_scrolling){var a=this.runtime.draw_width*(1/this.getMinLayerScale())/2;f>this.width-a&&(f=this.width-
a);f<a&&(f=a)}this.scrollX!==f&&(this.scrollX=f,this.runtime.redraw=!0)};b.prototype.scrollToY=function(f){if(!this.unbounded_scrolling){var a=this.runtime.draw_height*(1/this.getMinLayerScale())/2;f>this.height-a&&(f=this.height-a);f<a&&(f=a)}this.scrollY!==f&&(this.scrollY=f,this.runtime.redraw=!0)};b.prototype.boundScrolling=function(){this.scrollToX(this.scrollX);this.scrollToY(this.scrollY)};b.prototype.calculateViewRect=function(){var f=this.scrollX,a=this.scrollY,c=1/(this.scale*this.runtime.aspect_scale);
f-=this.runtime.width*c/2;a-=this.runtime.height*c/2;this.viewRect.set(f,a,f+this.runtime.draw_width*c,a+this.runtime.draw_height*c);return this.viewRect};b.prototype.renderEffectChain=function(f,a,c,l){var v=c?c.active_effect_types:a?a.active_effect_types:this.active_effect_types;if(c){var t=c.layer.getScale();var y=c.layer.getAngle();var L=c.layer.viewLeft;var q=c.layer.viewTop;var B=c.layer.viewRight;var A=c.layer.viewBottom}else a?(t=a.getScale(),y=a.getAngle(),L=a.viewLeft,q=a.viewTop,B=a.viewRight,
A=a.viewBottom):(t=this.scale,y=this.angle,A=this.calculateViewRect(),L=A.left,q=A.top,B=A.right,A=A.bottom);var h=this.runtime.fx_tex,n,z,P=0,V=1,H=this.runtime.draw_width,d=this.runtime.draw_height,k=H/2,F=d/2,e=a?a.rcTexBounce:this.rcTexBounce,u=a?a.rcTexDest:this.rcTexDest,J=a?a.rcTexOrigin:this.rcTexOrigin,M=0,U=0,W=0,X=0,Y=H,ea=H,ha=d,g=d,p=z=0,C=c?c.layer.getAngle():0;if(c){var G=0;for(n=v.length;G<n;G++)z+=f.getProgramBoxExtendHorizontal(v[G].shaderindex),p+=f.getProgramBoxExtendVertical(v[G].shaderindex);
X=c.bbox;M=a.layerToCanvas(X.left,X.top,!0,!0);W=a.layerToCanvas(X.left,X.top,!1,!0);Y=a.layerToCanvas(X.right,X.bottom,!0,!0);ha=a.layerToCanvas(X.right,X.bottom,!1,!0);if(0!==C){G=a.layerToCanvas(X.right,X.top,!0,!0);n=a.layerToCanvas(X.right,X.top,!1,!0);U=a.layerToCanvas(X.left,X.bottom,!0,!0);X=a.layerToCanvas(X.left,X.bottom,!1,!0);var x=Math.min(M,Y,G,U);Y=Math.max(M,Y,G,U);M=x;x=Math.min(W,ha,n,X);ha=Math.max(W,ha,n,X);W=x}J.left=M/H;J.top=1-W/d;J.right=Y/H;J.bottom=1-ha/d;M-=z;W-=p;Y+=z;
ha+=p;u.left=M/H;u.top=1-W/d;u.right=Y/H;u.bottom=1-ha/d;U=M=cr.floor(M);X=W=cr.floor(W);ea=Y=cr.ceil(Y);g=ha=cr.ceil(ha);U-=z;X-=p;ea+=z;g+=p;0>M&&(M=0);0>W&&(W=0);Y>H&&(Y=H);ha>d&&(ha=d);0>U&&(U=0);0>X&&(X=0);ea>H&&(ea=H);g>d&&(g=d);e.left=M/H;e.top=1-W/d;e.right=Y/H;e.bottom=1-ha/d}else e.left=u.left=J.left=0,e.top=u.top=J.top=0,e.right=u.right=J.right=1,e.bottom=u.bottom=1;p=c&&(f.programUsesDest(v[0].shaderindex)||0!==z||0!==p||1!==c.opacity||c.type.plugin.must_predraw)||a&&!c&&1!==a.opacity;
f.setAlphaBlend();if(p){h[P]||(h[P]=f.createEmptyTexture(H,d,this.runtime.linearSampling));if(h[P].c2width!==H||h[P].c2height!==d)f.deleteTexture(h[P]),h[P]=f.createEmptyTexture(H,d,this.runtime.linearSampling);f.switchProgram(0);f.setRenderingToTexture(h[P]);var K=g-X;f.clearRect(U,d-X-K,ea-U,K);c?c.drawGL(f):(f.setTexture(this.runtime.layer_tex),f.setOpacity(a.opacity),f.resetModelView(),f.translate(-k,-F),f.updateModelView(),f.quadTex(M,ha,Y,ha,Y,W,M,W,e));u.left=u.top=0;u.right=u.bottom=1;c&&
(x=e.top,e.top=e.bottom,e.bottom=x);P=1;V=0}f.setOpacity(1);z=v.length-1;C=f.programUsesCrossSampling(v[z].shaderindex)||!a&&!c&&!this.runtime.fullscreenScalingQuality;G=0;for(n=v.length;G<n;G++){h[P]||(h[P]=f.createEmptyTexture(H,d,this.runtime.linearSampling));if(h[P].c2width!==H||h[P].c2height!==d)f.deleteTexture(h[P]),h[P]=f.createEmptyTexture(H,d,this.runtime.linearSampling);f.switchProgram(v[G].shaderindex);x=v[G].index;f.programIsAnimated(v[G].shaderindex)&&(this.runtime.redraw=!0);if(0!=G||
p){f.setProgramParameters(l,1/H,1/d,0,0,1,1,J.left,J.top,J.right,J.bottom,L,q,B,A,u.left,u.top,u.right,u.bottom,t,y,this.runtime.kahanTime.sum,c?c.effect_params[x]:a?a.effect_params[x]:this.effect_params[x]);f.setTexture(null);if(G!==z||C){f.setRenderingToTexture(h[P]);K=g-X;var R=d-X-K;f.clearRect(U,R,ea-U,K)}else c?f.setBlend(c.srcBlend,c.destBlend):a&&f.setBlend(a.srcBlend,a.destBlend),f.setRenderingToTexture(l);f.setTexture(h[V]);f.resetModelView();f.translate(-k,-F);f.updateModelView();f.quadTex(M,
ha,Y,ha,Y,W,M,W,e);G!==z||C||f.setTexture(null)}else{f.setRenderingToTexture(h[P]);K=g-X;R=d-X-K;f.clearRect(U,R,ea-U,K);if(c){R=V=0;var S=K=1,T=1/c.width,fa=1/c.height;c.curFrame&&c.curFrame.sheetTex&&(V=c.curFrame.sheetTex.left,R=c.curFrame.sheetTex.top,K=c.curFrame.sheetTex.right,S=c.curFrame.sheetTex.bottom,c.curFrame.texture_img&&(T=1/c.curFrame.texture_img.width,fa=1/c.curFrame.texture_img.height));f.setProgramParameters(l,T,fa,V,R,K,S,V,R,K,S,c.bbox.left,c.bbox.top,c.bbox.right,c.bbox.bottom,
u.left,u.top,u.right,u.bottom,t,y,this.runtime.kahanTime.sum,c.effect_params[x]);c.drawGL(f)}else f.setProgramParameters(l,1/H,1/d,0,0,1,1,0,0,1,1,L,q,B,A,0,0,1,1,t,y,this.runtime.kahanTime.sum,a?a.effect_params[x]:this.effect_params[x]),f.setTexture(a?this.runtime.layer_tex:this.runtime.layout_tex),f.resetModelView(),f.translate(-k,-F),f.updateModelView(),f.quadTex(M,ha,Y,ha,Y,W,M,W,e);u.left=u.top=0;u.right=u.bottom=1;c&&!C&&(x=ha,ha=W,W=x)}P=0===P?1:0;V=0===P?1:0}C&&(f.switchProgram(0),c?f.setBlend(c.srcBlend,
c.destBlend):a?f.setBlend(a.srcBlend,a.destBlend):this.runtime.fullscreenScalingQuality||(f.setSize(this.runtime.width,this.runtime.height),k=this.runtime.width/2,F=this.runtime.height/2,W=M=0,Y=this.runtime.width,ha=this.runtime.height),f.setRenderingToTexture(l),f.setTexture(h[V]),f.resetModelView(),f.translate(-k,-F),f.updateModelView(),c&&1===v.length&&!p?f.quadTex(M,W,Y,W,Y,ha,M,ha,e):f.quadTex(M,ha,Y,ha,Y,W,M,W,e),f.setTexture(null))};b.prototype.getLayerBySid=function(f){var a;var c=0;for(a=
this.layers.length;c<a;c++)if(this.layers[c].sid===f)return this.layers[c];return null};b.prototype.saveToJSON=function(){var f,a={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};var c=0;for(f=this.effect_types.length;c<f;c++){var l=this.effect_types[c];a.fx.push({name:l.name,active:l.active,params:this.effect_params[l.index]})}c=0;for(f=this.layers.length;c<f;c++)l=this.layers[c],a.layers[l.sid.toString()]=
l.saveToJSON();return a};b.prototype.loadFromJSON=function(f){var a,c,l;this.scrollX=f.sx;this.scrollY=f.sy;this.scale=f.s;this.angle=f.a;this.width=f.w;this.height=f.h;this.persist_data=f.persist;"undefined"!==typeof f.fv&&(this.first_visit=f.fv);var v=f.fx;var t=0;for(a=v.length;t<a;t++)if(c=this.getEffectByName(v[t].name))c.active=v[t].active,this.effect_params[c.index]=v[t].params;this.updateActiveEffects();t=f.layers;for(l in t)t.hasOwnProperty(l)&&(f=this.getLayerBySid(parseInt(l,10)))&&f.loadFromJSON(t[l])};
cr.layout=b})();
(function(){function b(h,n){var z,P=h.length;switch(P){case 0:return!0;case 1:return h[0]===n[0];case 2:return h[0]===n[0]&&h[1]===n[1];default:for(z=0;z<P;z++)if(h[z]!==n[z])return!1;return!0}}function m(h,n){return h.index-n.index}function w(h){var n;if(2===h.length){if(h[0].index>h[1].index){var z=h[0];h[0]=h[1];h[1]=z}}else 2<h.length&&h.sort(m);h.length>=q.length&&(q.length=h.length+1);q[h.length]||(q[h.length]=[]);var P=q[h.length];z=0;for(n=P.length;z<n;z++){var V=P[z];if(b(h,V))return V}P.push(h);
return h}function E(h,n){this.runtime=h;this.triggers={};this.fasttriggers={};this.hasRun=!1;this.includes=new cr.ObjectSet;this.deep_includes=[];this.already_included_sheets=[];this.name=n[0];h=n[1];this.events=[];var z;n=0;for(z=h.length;n<z;n++)this.init_event(h[n],null,this.events)}function N(h){this.type=h;this.instances=[];this.else_instances=[];this.select_all=!0}function D(h,n,z){this.sheet=h;this.parent=n;this.runtime=h.runtime;this.solModifiers=[];this.solModifiersIncludingParents=[];this.has_else_block=
this.toplevelgroup=this.toplevelevent=this.initially_activated=this.group=this.solWriterAfterCnds=!1;this.conditions=[];this.actions=[];this.subevents=[];this.group_name="";this.group_active=this.initially_activated=this.group=!1;this.contained_includes=null;3===z[0]&&(this.group_name=z[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!z[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=
this);this.orblock=z[2];this.sid=z[4];this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var P=z[6];h=0;for(n=P.length;h<n;h++){var V=new cr.condition(this,P[h]);V.index=h;cr.seal(V);this.conditions.push(V);this.addSolModifier(V.type)}P=z[7];h=0;for(n=P.length;h<n;h++)V=new cr.action(this,P[h]),V.index=h,cr.seal(V),this.actions.push(V);if(9===z.length)for(z=z[8],h=0,n=z.length;h<n;h++)this.sheet.init_event(z[h],this,this.subevents);this.is_else_block=!1;this.conditions.length&&(this.is_else_block=
null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function f(h,n){var z;if(h&&(-1===n.indexOf(h)&&n.push(h),h.is_contained)){var P=0;for(z=h.container.length;P<z;P++){var V=h.container[P];h!==V&&-1===n.indexOf(V)&&n.push(V)}}}function a(h,n){this.block=h;this.sheet=h.sheet;this.runtime=h.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(n[1]);this.trigger=0<
n[3];this.fasttrigger=2===n[3];this.looping=n[4];this.inverted=n[5];this.isstatic=n[6];this.sid=n[7];this.runtime.cndsBySid[this.sid.toString()]=this;-1===n[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[n[0]],this.run=this.isstatic?this.run_static:this.run_object,n[2]?(this.behaviortype=this.type.getBehaviorByName(n[2]),this.beh_index=this.type.getBehaviorIndexByName(n[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&
this.block.parent.setSolWriterAfterCnds());this.fasttrigger&&(this.run=this.run_true);if(10===n.length){var z=n[9];h=0;for(n=z.length;h<n;h++){var P=new cr.parameter(this,z[h]);cr.seal(P);this.parameters.push(P)}this.results.length=z.length}}function c(h,n){this.block=h;this.sheet=h.sheet;this.runtime=h.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=!1;this.func=this.runtime.GetObjectReference(n[1]);-1===n[0]?(this.type=null,this.run=this.run_system,
this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[n[0]],this.run=this.run_object,n[2]?(this.behaviortype=this.type.getBehaviorByName(n[2]),this.beh_index=this.type.getBehaviorIndexByName(n[2])):(this.behaviortype=null,this.beh_index=-1));this.sid=n[3];this.runtime.actsBySid[this.sid.toString()]=this;if(7===n.length){var z=n[6];h=0;for(n=z.length;h<n;h++){var P=new cr.parameter(this,z[h]);cr.seal(P);this.parameters.push(P)}this.results.length=z.length}}function l(){A++;
B.length===A&&B.push(new cr.expvalue);return B[A]}function v(h,n){this.owner=h;this.block=h.block;this.sheet=h.sheet;this.runtime=h.runtime;this.type=n[0];this.expression=null;this.solindex=0;this.get=null;this.combosel=0;this.layout=null;this.key=0;this.object=null;this.index=0;this.variadicret=this.subparams=this.fileinfo=this.eventvar=this.varname=null;this.variesPerInstance=!1;var z;switch(this.type){case 0:case 7:this.expression=new cr.expNode(this,n[1]);this.solindex=0;this.get=this.get_exp;
break;case 1:case 14:this.expression=new cr.expNode(this,n[1]);this.solindex=0;this.get=this.get_exp_str;14===this.type&&(this.block.setAllSolModifiers(),this.owner instanceof cr.action&&this.block.setSolWriterAfterCnds());break;case 5:this.expression=new cr.expNode(this,n[1]);this.solindex=0;this.get=this.get_layer;break;case 3:case 8:this.combosel=n[1];this.get=this.get_combosel;break;case 16:this.combosel=n[1]?1:0;this.get=this.get_boolean;break;case 6:this.layout=this.runtime.layouts[n[1]];this.get=
this.get_layout;break;case 9:this.key=n[1];this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[n[1]];this.get=this.get_object;this.block.addSolModifier(this.object);this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=n[1];h.type&&h.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=n[1];this.eventvar=null;
this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=n[1];this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],h=1,z=n.length;h<z;h++){var P=new cr.parameter(this.owner,n[h]);cr.seal(P);this.subparams.push(P);this.variadicret.push(0)}}}function t(h,n,z){this.sheet=h;this.parent=n;this.runtime=h.runtime;this.solModifiers=[];this.name=z[1];this.vartype=z[2];this.initial=z[3];this.is_static=!!z[4];this.is_constant=!!z[5];this.sid=z[6];
this.runtime.varsBySid[this.sid.toString()]=this;this.data=this.initial;this.parent?(this.localIndex=this.is_static||this.is_constant?-1:this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function y(h,n,z){this.sheet=h;this.parent=n;this.runtime=h.runtime;this.solModifiers=[];this.include_sheet=null;this.include_sheet_name=z[1];this.active=!0}function L(){this.temp_parents_arr=[];this.reset(null);cr.seal(this)}var q=
[];E.prototype.toString=function(){return this.name};E.prototype.init_event=function(h,n,z){switch(h[0]){case 0:case 3:h=new cr.eventblock(this,n,h);cr.seal(h);if(h.orblock)for(z.push(h),z=0,n=h.conditions.length;z<n;z++)h.conditions[z].trigger&&this.init_trigger(h,z);else h.is_trigger()?this.init_trigger(h,0):z.push(h);break;case 1:h=new cr.eventvariable(this,n,h);cr.seal(h);z.push(h);break;case 2:h=new cr.eventinclude(this,n,h),cr.seal(h),z.push(h)}};E.prototype.postInit=function(){var h;var n=
0;for(h=this.events.length;n<h;n++)this.events[n].postInit(n<h-1&&this.events[n+1].is_else_block)};E.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes);cr.clearArray(this.already_included_sheets);this.addDeepIncludes(this);cr.clearArray(this.already_included_sheets)};E.prototype.addDeepIncludes=function(h){var n,z=h.deep_includes,P=h.already_included_sheets,V=this.includes.valuesRef();var H=0;for(n=V.length;H<n;++H){var d=V[H];var k=d.include_sheet;!d.isActive()||h===k||-1<
P.indexOf(k)||(P.push(k),k.addDeepIncludes(h),z.push(k))}};E.prototype.run=function(h){this.runtime.resuming_breakpoint||(this.hasRun=!0,h||(this.runtime.isRunningEvents=!0));var n;var z=0;for(n=this.events.length;z<n;z++){var P=this.events[z];P.run();this.runtime.clearSol(P.solModifiers);this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}h||(this.runtime.isRunningEvents=!1)};E.prototype.init_trigger=function(h,n){h.orblock||this.runtime.triggers_to_postinit.push(h);var z,P,V=h.conditions[n];
var H=V.type?V.type.name:"system";var d=(z=V.fasttrigger)?this.fasttriggers:this.triggers;d[H]||(d[H]=[]);H=d[H];d=V.func;if(z){if(V.parameters.length&&(V=V.parameters[0],1===V.type&&2===V.expression.type)){V=V.expression.value.toLowerCase();z=0;for(P=H.length;z<P;z++)if(H[z].method==d){z=H[z].evs;z[V]?z[V].push([h,n]):z[V]=[[h,n]];return}z={};z[V]=[[h,n]];H.push({method:d,evs:z})}}else{z=0;for(P=H.length;z<P;z++)if(H[z].method==d){H[z].evs.push([h,n]);return}V=cr.plugins_.Sprite&&d===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged?
!0:!1;V?H.unshift({method:d,evs:[[h,n]]}):H.push({method:d,evs:[[h,n]]})}};cr.eventsheet=E;N.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length};N.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances};N.prototype.pick_one=function(h){h&&(h.runtime.getCurrentEventStack().current_event.orblock?(this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,h.type.instances),this.select_all=
!1),h=this.else_instances.indexOf(h),-1!==h&&(this.instances.push(this.else_instances[h]),this.else_instances.splice(h,1))):(this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=h))};cr.selection=N;D.prototype.postInit=function(h){var n,z=this.parent;if(this.group)for(this.toplevelgroup=!0;z;){if(!z.group){this.toplevelgroup=!1;break}z=z.parent}this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup);this.has_else_block=!!h;z=this.runtime.types_by_index;
if(this.solModifiers===z)this.solModifiersIncludingParents=z;else{this.solModifiersIncludingParents=this.solModifiers.slice(0);for(z=this.parent;z;){h=0;for(n=z.solModifiers.length;h<n;h++)this.addParentSolModifier(z.solModifiers[h]);z=z.parent}this.solModifiers=w(this.solModifiers);this.solModifiersIncludingParents=w(this.solModifiersIncludingParents)}h=0;for(n=this.conditions.length;h<n;h++)this.conditions[h].postInit();h=0;for(n=this.actions.length;h<n;h++)this.actions[h].postInit();h=0;for(n=
this.subevents.length;h<n;h++)this.subevents[h].postInit(h<n-1&&this.subevents[h+1].is_else_block)};D.prototype.setGroupActive=function(h){if(this.group_active!==!!h){this.group_active=!!h;var n;h=0;for(n=this.contained_includes.length;h<n;++h)this.contained_includes[h].updateActive();0<n&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}};D.prototype.addSolModifier=function(h){f(h,this.solModifiers)};D.prototype.addParentSolModifier=function(h){f(h,
this.solModifiersIncludingParents)};D.prototype.setAllSolModifiers=function(){this.solModifiers=this.runtime.types_by_index};D.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0;this.parent&&this.parent.setSolWriterAfterCnds()};D.prototype.is_trigger=function(){return this.conditions.length?this.conditions[0].trigger:!1};D.prototype.run=function(){var h,n=!1,z=this.runtime,P=this.runtime.getCurrentEventStack();P.current_event=this;var V=this.conditions;this.is_else_block||(P.else_branch_ran=
!1);if(this.orblock){0===V.length&&(n=!0);P.cndindex=0;for(h=V.length;P.cndindex<h;P.cndindex++){var H=V[P.cndindex];H.trigger||(H=H.run())&&(n=!0)}(P.last_event_true=n)&&this.run_actions_and_subevents()}else{P.cndindex=0;for(h=V.length;P.cndindex<h;P.cndindex++)if(H=V[P.cndindex].run(),!H){P.last_event_true=!1;this.toplevelevent&&z.hasPendingInstances&&z.ClearDeathRow();return}P.last_event_true=!0;this.run_actions_and_subevents()}this.end_run(P)};D.prototype.end_run=function(h){h.last_event_true&&
this.has_else_block&&(h.else_branch_ran=!0);this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()};D.prototype.run_orblocktrigger=function(h){this.runtime.getCurrentEventStack().current_event=this;this.conditions[h].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)};D.prototype.run_actions_and_subevents=function(){var h=this.runtime.getCurrentEventStack(),n;h.actindex=0;for(n=this.actions.length;h.actindex<n;h.actindex++)if(this.actions[h.actindex].run())return;
this.run_subevents()};D.prototype.resume_actions_and_subevents=function(){var h=this.runtime.getCurrentEventStack(),n;for(n=this.actions.length;h.actindex<n;h.actindex++)if(this.actions[h.actindex].run())return;this.run_subevents()};D.prototype.run_subevents=function(){if(this.subevents.length){var h,n,z=this.subevents.length-1;this.runtime.pushEventStack(this);if(this.solWriterAfterCnds){var P=0;for(h=this.subevents.length;P<h;P++){var V=this.subevents[P];(n=!this.toplevelgroup||!this.group&&P<z)&&
this.runtime.pushCopySol(V.solModifiers);V.run();n?this.runtime.popSol(V.solModifiers):this.runtime.clearSol(V.solModifiers)}}else for(P=0,h=this.subevents.length;P<h;P++)this.subevents[P].run();this.runtime.popEventStack()}};D.prototype.run_pretrigger=function(){var h=this.runtime.getCurrentEventStack();h.current_event=this;var n=!1,z;h.cndindex=0;for(z=this.conditions.length;h.cndindex<z;h.cndindex++)if(this.conditions[h.cndindex].run())n=!0;else if(!this.orblock)return!1;return this.orblock?n:
!0};D.prototype.retrigger=function(){this.runtime.execcount++;var h=this.runtime.getCurrentEventStack().cndindex,n=this.runtime.pushEventStack(this);if(!this.orblock)for(n.cndindex=h+1,h=this.conditions.length;n.cndindex<h;n.cndindex++)if(!this.conditions[n.cndindex].run())return this.runtime.popEventStack(),!1;this.run_actions_and_subevents();this.runtime.popEventStack();return!0};D.prototype.isFirstConditionOfType=function(h){var n=h.index;if(0===n)return!0;for(--n;0<=n;--n)if(this.conditions[n].type===
h.type)return!1;return!0};cr.eventblock=D;a.prototype.postInit=function(){var h;var n=0;for(h=this.parameters.length;n<h;n++){var z=this.parameters[n];z.postInit();z.variesPerInstance&&(this.anyParamVariesPerInstance=!0)}};a.prototype.run_true=function(){return!0};a.prototype.run_system=function(){var h;var n=0;for(h=this.parameters.length;n<h;n++)this.results[n]=this.parameters[n].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)};a.prototype.run_static=function(){var h;
var n=0;for(h=this.parameters.length;n<h;n++)this.results[n]=this.parameters[n].get();n=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);this.type.applySolToContainer();return n};a.prototype.run_object=function(){var h,n,z,P=this.type,V=P.getCurrentSol(),H=this.block.orblock&&!this.trigger,d=P.is_contained,k=P.is_family,F=P.family_index,e=this.beh_index,u=-1<e,J=this.anyParamVariesPerInstance,M=this.parameters,U=this.results,W=this.inverted,X=this.func;if(J){var Y=0;for(n=
M.length;Y<n;++Y){var ea=M[Y];ea.variesPerInstance||(U[Y]=ea.get(0))}}else for(Y=0,n=M.length;Y<n;++Y)U[Y]=M[Y].get(0);if(V.select_all){cr.clearArray(V.instances);cr.clearArray(V.else_instances);var ha=P.instances;var g=0;for(h=ha.length;g<h;++g){var p=ha[g];if(J)for(Y=0,n=M.length;Y<n;++Y)ea=M[Y],ea.variesPerInstance&&(U[Y]=ea.get(g));u?(Y=0,k&&(Y=p.type.family_beh_map[F]),Y=X.apply(p.behavior_insts[e+Y],U)):Y=X.apply(p,U);(z=cr.xor(Y,W))?V.instances.push(p):H&&V.else_instances.push(p)}P.finish&&
P.finish(!0);V.select_all=!1;P.applySolToContainer();return V.hasObjects()}var C=0;ha=(z=H&&!this.block.isFirstConditionOfType(this))?V.else_instances:V.instances;var G=!1;g=0;for(h=ha.length;g<h;++g){p=ha[g];if(J)for(Y=0,n=M.length;Y<n;++Y)ea=M[Y],ea.variesPerInstance&&(U[Y]=ea.get(g));u?(Y=0,k&&(Y=p.type.family_beh_map[F]),Y=X.apply(p.behavior_insts[e+Y],U)):Y=X.apply(p,U);if(cr.xor(Y,W))if(G=!0,z){if(V.instances.push(p),d)for(Y=0,n=p.siblings.length;Y<n;Y++)ea=p.siblings[Y],ea.type.getCurrentSol().instances.push(ea)}else{ha[C]=
p;if(d)for(Y=0,n=p.siblings.length;Y<n;Y++)ea=p.siblings[Y],ea.type.getCurrentSol().instances[C]=ea;C++}else if(z){ha[C]=p;if(d)for(Y=0,n=p.siblings.length;Y<n;Y++)ea=p.siblings[Y],ea.type.getCurrentSol().else_instances[C]=ea;C++}else if(H&&(V.else_instances.push(p),d))for(Y=0,n=p.siblings.length;Y<n;Y++)ea=p.siblings[Y],ea.type.getCurrentSol().else_instances.push(ea)}cr.truncateArray(ha,C);if(d)for(k=P.container,g=0,h=k.length;g<h;g++)p=k[g].getCurrentSol(),z?cr.truncateArray(p.else_instances,C):
cr.truncateArray(p.instances,C);C=G;if(z&&!G)for(g=0,h=V.instances.length;g<h;g++){p=V.instances[g];if(J)for(Y=0,n=M.length;Y<n;Y++)ea=M[Y],ea.variesPerInstance&&(U[Y]=ea.get(g));Y=u?X.apply(p.behavior_insts[e],U):X.apply(p,U);if(cr.xor(Y,W)){G=!0;break}}P.finish&&P.finish(C||H);return H?G:V.hasObjects()};cr.condition=a;c.prototype.postInit=function(){var h;var n=0;for(h=this.parameters.length;n<h;n++){var z=this.parameters[n];z.postInit();z.variesPerInstance&&(this.anyParamVariesPerInstance=!0)}};
c.prototype.run_system=function(){var h=this.runtime,n,z=this.parameters,P=this.results;var V=0;for(n=z.length;V<n;++V)P[V]=z[V].get();return this.func.apply(h.system,P)};c.prototype.run_object=function(){var h=this.type,n=this.beh_index,z=h.family_index,P=this.anyParamVariesPerInstance,V=this.parameters,H=this.results,d=this.func,k=h.getCurrentSol().getObjects();h=h.is_family;var F=-1<n,e,u;if(P){var J=0;for(u=V.length;J<u;++J){var M=V[J];M.variesPerInstance||(H[J]=M.get(0))}}else for(J=0,u=V.length;J<
u;++J)H[J]=V[J].get(0);var U=0;for(e=k.length;U<e;++U){var W=k[U];if(P)for(J=0,u=V.length;J<u;++J)M=V[J],M.variesPerInstance&&(H[J]=M.get(U));F?(J=0,h&&(J=W.type.family_beh_map[z]),d.apply(W.behavior_insts[n+J],H)):d.apply(W,H)}return!1};cr.action=c;var B=[],A=-1;v.prototype.postInit=function(){var h;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type){var n=0;for(h=this.subparams.length;n<h;n++)this.subparams[n].postInit()}this.expression&&
this.expression.postInit()};v.prototype.maybeVaryForType=function(h){this.variesPerInstance||!h||h.plugin.singleglobal||(this.variesPerInstance=!0)};v.prototype.setVaries=function(){this.variesPerInstance=!0};v.prototype.get_exp=function(h){this.solindex=h||0;h=l();this.expression.get(h);A--;return h.data};v.prototype.get_exp_str=function(h){this.solindex=h||0;h=l();this.expression.get(h);A--;return cr.is_string(h.data)?h.data:""};v.prototype.get_object=function(){return this.object};v.prototype.get_combosel=
function(){return this.combosel};v.prototype.get_boolean=function(){return!!this.combosel};v.prototype.get_layer=function(h){this.solindex=h||0;h=l();this.expression.get(h);A--;return h.is_number()?this.runtime.getLayerByNumber(h.data):this.runtime.getLayerByName(h.data)};v.prototype.get_layout=function(){return this.layout};v.prototype.get_key=function(){return this.key};v.prototype.get_instvar=function(){return this.index};v.prototype.get_familyvar=function(h){var n=h||0;h=this.owner.type;var z=
h.getCurrentSol(),P=z.getObjects();if(P.length)n=P[n%P.length].type;else if(z.else_instances.length)n=z.else_instances[n%z.else_instances.length].type;else if(h.instances.length)n=h.instances[n%h.instances.length].type;else return 0;return this.index+n.family_var_map[h.family_index]};v.prototype.get_eventvar=function(){return this.eventvar};v.prototype.get_audiofile=function(){return this.fileinfo};v.prototype.get_variadic=function(){var h;var n=0;for(h=this.subparams.length;n<h;n++)this.variadicret[n]=
this.subparams[n].get();return this.variadicret};cr.parameter=v;t.prototype.postInit=function(){this.solModifiers=w(this.solModifiers)};t.prototype.setValue=function(h){var n=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&n?(this.localIndex>=n.length&&(n.length=this.localIndex+1),n[this.localIndex]=h):this.data=h};t.prototype.getValue=function(){var h=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!h||this.is_constant?this.data:this.localIndex>=h.length||
"undefined"===typeof h[this.localIndex]?this.initial:h[this.localIndex]};t.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)};cr.eventvariable=t;y.prototype.toString=function(){return"include:"+this.include_sheet.toString()};y.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];this.sheet.includes.add(this);this.solModifiers=w(this.solModifiers);for(var h=this.parent;h;)h.group&&h.contained_includes.push(this),
h=h.parent;this.updateActive()};y.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index);this.include_sheet.hasRun||this.include_sheet.run(!0);this.parent&&this.runtime.popSol(this.runtime.types_by_index)};y.prototype.updateActive=function(){for(var h=this.parent;h;){if(h.group&&!h.group_active){this.active=!1;return}h=h.parent}this.active=!0};y.prototype.isActive=function(){return this.active};cr.eventinclude=y;L.prototype.reset=function(h){this.current_event=
h;this.actindex=this.cndindex=0;cr.clearArray(this.temp_parents_arr);this.any_true_state=this.else_branch_ran=this.last_event_true=!1};L.prototype.isModifierAfterCnds=function(){return this.current_event.solWriterAfterCnds?!0:this.cndindex<this.current_event.conditions.length-1?!!this.current_event.solModifiers.length:!1};cr.eventStackFrame=L})();
(function(){function b(f,a){this.owner=f;this.runtime=f.runtime;this.type=a[0];this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,
this.eval_eventvar_exp][this.type];var c=null;this.object_type=this.parameters=this.results=this.func=this.third=this.second=this.first=this.value=null;this.beh_index=-1;this.instance_expr=null;this.varindex=-1;this.eventvar=this.varname=this.behavior_type=null;this.return_string=!1;switch(this.type){case 0:case 1:case 2:this.value=a[1];break;case 3:this.first=new cr.expNode(f,a[1]);break;case 18:this.first=new cr.expNode(f,a[1]);this.second=new cr.expNode(f,a[2]);this.third=new cr.expNode(f,a[3]);
break;case 19:this.func=this.runtime.GetObjectReference(a[1]);this.func!==cr.system_object.prototype.exps.random&&this.func!==cr.system_object.prototype.exps.choose||this.owner.setVaries();this.results=[];this.parameters=[];3===a.length?(c=a[2],this.results.length=c.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[a[1]];this.beh_index=-1;this.func=this.runtime.GetObjectReference(a[2]);this.return_string=a[3];cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&
this.owner.setVaries();this.instance_expr=a[4]?new cr.expNode(f,a[4]):null;this.results=[];this.parameters=[];6===a.length?(c=a[5],this.results.length=c.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[a[1]];this.return_string=a[2];this.instance_expr=a[3]?new cr.expNode(f,a[3]):null;this.varindex=a[4];break;case 22:this.object_type=this.runtime.types_by_index[a[1]];this.behavior_type=this.object_type.getBehaviorByName(a[2]);this.beh_index=this.object_type.getBehaviorIndexByName(a[2]);
this.func=this.runtime.GetObjectReference(a[3]);this.return_string=a[4];this.instance_expr=a[5]?new cr.expNode(f,a[5]):null;this.results=[];this.parameters=[];7===a.length?(c=a[6],this.results.length=c.length+1):this.results.length=1;break;case 23:this.varname=a[1],this.eventvar=null}this.owner.maybeVaryForType(this.object_type);4<=this.type&&17>=this.type&&(this.first=new cr.expNode(f,a[1]),this.second=new cr.expNode(f,a[2]));if(c){var l;a=0;for(l=c.length;a<l;a++)this.parameters.push(new cr.expNode(f,
c[a]))}cr.seal(this)}function m(){++D;N.length===D&&N.push(new cr.expvalue);return N[D]}function w(f,a,c){var l;var v=0;for(l=f.length;v<l;++v)f[v].get(c),a[v+1]=c.data}function E(f,a){this.type=f||cr.exptype.Integer;this.data=a||0;this.object_class=null;this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data));cr.seal(this)}b.prototype.postInit=function(){23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent));this.first&&this.first.postInit();
this.second&&this.second.postInit();this.third&&this.third.postInit();this.instance_expr&&this.instance_expr.postInit();if(this.parameters){var f;var a=0;for(f=this.parameters.length;a<f;a++)this.parameters[a].postInit()}};var N=[],D=-1;b.prototype.eval_system_exp=function(f){var a=this.parameters,c=this.results;c[0]=f;f=m();w(a,c,f);--D;this.func.apply(this.runtime.system,c)};b.prototype.eval_object_exp=function(f){var a=this.object_type,c=this.results,l=this.parameters,v=this.instance_expr,t=this.func,
y=this.owner.solindex,L=a.getCurrentSol(),q=L.getObjects();if(!q.length)if(L.else_instances.length)q=L.else_instances;else{this.return_string?f.set_string(""):f.set_int(0);return}c[0]=f;f.object_class=a;f=m();w(l,c,f);v&&(v.get(f),f.is_number()&&(y=f.data,q=a.instances));--D;a=q.length;if(y>=a||y<=-a)y%=a;0>y&&(y+=a);t.apply(q[y],c)};b.prototype.eval_behavior_exp=function(f){var a=this.object_type,c=this.results,l=this.parameters,v=this.instance_expr,t=this.beh_index,y=this.func,L=this.owner.solindex,
q=a.getCurrentSol(),B=q.getObjects();if(!B.length)if(q.else_instances.length)B=q.else_instances;else{this.return_string?f.set_string(""):f.set_int(0);return}c[0]=f;f.object_class=a;f=m();w(l,c,f);v&&(v.get(f),f.is_number()&&(L=f.data,B=a.instances));--D;l=B.length;if(L>=l||L<=-l)L%=l;0>L&&(L+=l);L=B[L];B=0;a.is_family&&(B=L.type.family_beh_map[a.family_index]);y.apply(L.behavior_insts[t+B],c)};b.prototype.eval_instvar_exp=function(f){var a=this.instance_expr,c=this.object_type,l=this.varindex,v=this.owner.solindex,
t=c.getCurrentSol(),y=t.getObjects();if(!y.length)if(t.else_instances.length)y=t.else_instances;else{this.return_string?f.set_string(""):f.set_int(0);return}if(a){t=m();a.get(t);if(t.is_number()){v=t.data;y=c.instances;0!==y.length&&(v%=y.length,0>v&&(v+=y.length));v=c.getInstanceByIID(v);c=v.instance_vars[l];cr.is_string(c)?f.set_string(c):f.set_float(c);--D;return}--D}a=y.length;if(v>=a||v<=-a)v%=a;0>v&&(v+=a);v=y[v];y=0;c.is_family&&(y=v.type.family_var_map[c.family_index]);c=v.instance_vars[l+
y];cr.is_string(c)?f.set_string(c):f.set_float(c)};b.prototype.eval_int=function(f){f.type=cr.exptype.Integer;f.data=this.value};b.prototype.eval_float=function(f){f.type=cr.exptype.Float;f.data=this.value};b.prototype.eval_string=function(f){f.type=cr.exptype.String;f.data=this.value};b.prototype.eval_unaryminus=function(f){this.first.get(f);f.is_number()&&(f.data=-f.data)};b.prototype.eval_add=function(f){this.first.get(f);var a=m();this.second.get(a);f.is_number()&&a.is_number()&&(f.data+=a.data,
a.is_float()&&f.make_float());--D};b.prototype.eval_subtract=function(f){this.first.get(f);var a=m();this.second.get(a);f.is_number()&&a.is_number()&&(f.data-=a.data,a.is_float()&&f.make_float());--D};b.prototype.eval_multiply=function(f){this.first.get(f);var a=m();this.second.get(a);f.is_number()&&a.is_number()&&(f.data*=a.data,a.is_float()&&f.make_float());--D};b.prototype.eval_divide=function(f){this.first.get(f);var a=m();this.second.get(a);f.is_number()&&a.is_number()&&(f.data/=a.data,f.make_float());
--D};b.prototype.eval_mod=function(f){this.first.get(f);var a=m();this.second.get(a);f.is_number()&&a.is_number()&&(f.data%=a.data,a.is_float()&&f.make_float());--D};b.prototype.eval_power=function(f){this.first.get(f);var a=m();this.second.get(a);f.is_number()&&a.is_number()&&(f.data=Math.pow(f.data,a.data),a.is_float()&&f.make_float());--D};b.prototype.eval_and=function(f){this.first.get(f);var a=m();this.second.get(a);a.is_string()||f.is_string()?this.eval_and_stringconcat(f,a):this.eval_and_logical(f,
a);--D};b.prototype.eval_and_stringconcat=function(f,a){f.is_string()&&a.is_string()?this.eval_and_stringconcat_str_str(f,a):this.eval_and_stringconcat_num(f,a)};b.prototype.eval_and_stringconcat_str_str=function(f,a){f.data+=a.data};b.prototype.eval_and_stringconcat_num=function(f,a){f.is_string()?f.data+=(Math.round(1E10*a.data)/1E10).toString():f.set_string(f.data.toString()+a.data)};b.prototype.eval_and_logical=function(f,a){f.set_int(f.data&&a.data?1:0)};b.prototype.eval_or=function(f){this.first.get(f);
var a=m();this.second.get(a);f.is_number()&&a.is_number()&&(f.data||a.data?f.set_int(1):f.set_int(0));--D};b.prototype.eval_conditional=function(f){this.first.get(f);f.data?this.second.get(f):this.third.get(f)};b.prototype.eval_equal=function(f){this.first.get(f);var a=m();this.second.get(a);f.set_int(f.data===a.data?1:0);--D};b.prototype.eval_notequal=function(f){this.first.get(f);var a=m();this.second.get(a);f.set_int(f.data!==a.data?1:0);--D};b.prototype.eval_less=function(f){this.first.get(f);
var a=m();this.second.get(a);f.set_int(f.data<a.data?1:0);--D};b.prototype.eval_lessequal=function(f){this.first.get(f);var a=m();this.second.get(a);f.set_int(f.data<=a.data?1:0);--D};b.prototype.eval_greater=function(f){this.first.get(f);var a=m();this.second.get(a);f.set_int(f.data>a.data?1:0);--D};b.prototype.eval_greaterequal=function(f){this.first.get(f);var a=m();this.second.get(a);f.set_int(f.data>=a.data?1:0);--D};b.prototype.eval_eventvar_exp=function(f){var a=this.eventvar.getValue();"number"===
typeof a?f.set_float(a):"boolean"===typeof a?f.set_int(a?1:0):f.set_string(a)};cr.expNode=b;E.prototype.is_int=function(){return this.type===cr.exptype.Integer};E.prototype.is_float=function(){return this.type===cr.exptype.Float};E.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float};E.prototype.is_string=function(){return this.type===cr.exptype.String};E.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&
(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)};E.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)};E.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)};E.prototype.set_int=function(f){this.type=cr.exptype.Integer;this.data=Math.floor(f)};E.prototype.set_float=function(f){this.type=cr.exptype.Float;this.data=f};E.prototype.set_string=function(f){this.type=
cr.exptype.String;this.data=f};E.prototype.set_any=function(f){cr.is_number(f)?(this.type=cr.exptype.Float,this.data=f):cr.is_string(f)?(this.type=cr.exptype.String,this.data=f.toString()):(this.type=cr.exptype.Integer,this.data=0)};cr.expvalue=E;cr.exptype={Integer:0,Float:1,String:2}})();cr.system_object=function(b){this.runtime=b;this.waits=[]};
cr.system_object.prototype.saveToJSON=function(){var b={},m,w,E;b.waits=[];var N=b.waits;var D=0;for(m=this.waits.length;D<m;D++){var f=this.waits[D];var a={t:f.time,st:f.signaltag,s:f.signalled,ev:f.ev.sid,sm:[],sols:{}};f.ev.actions[f.actindex]&&(a.act=f.ev.actions[f.actindex].sid);var c=0;for(w=f.solModifiers.length;c<w;c++)a.sm.push(f.solModifiers[c].sid);for(E in f.sols)if(f.sols.hasOwnProperty(E)){var l=this.runtime.types_by_index[parseInt(E,10)];var v={sa:f.sols[E].sa,insts:[]};c=0;for(w=f.sols[E].insts.length;c<
w;c++)v.insts.push(f.sols[E].insts[c].uid);a.sols[l.sid.toString()]=v}N.push(a)}return b};
cr.system_object.prototype.loadFromJSON=function(b){b=b.waits;var m,w,E,N,D;cr.clearArray(this.waits);var f=0;for(m=b.length;f<m;f++){var a=b[f];if(N=this.runtime.blocksBySid[a.ev.toString()]){var c=-1;var l=0;for(w=N.actions.length;l<w;l++)if(N.actions[l].sid===a.act){c=l;break}if(-1!==c){var v={sols:{},solModifiers:[],deleteme:!1};v.time=a.t;v.signaltag=a.st||"";v.signalled=!!a.s;v.ev=N;v.actindex=c;l=0;for(w=a.sm.length;l<w;l++)(N=this.runtime.getObjectTypeBySid(a.sm[l]))&&v.solModifiers.push(N);
for(E in a.sols)if(a.sols.hasOwnProperty(E)&&(N=this.runtime.getObjectTypeBySid(parseInt(E,10)))){c=a.sols[E];var t={sa:c.sa,insts:[]};l=0;for(w=c.insts.length;l<w;l++)(D=this.runtime.getObjectByUID(c.insts[l]))&&t.insts.push(D);v.sols[N.index.toString()]=t}this.waits.push(v)}}}};
(function(){function b(){}function m(d,k){d=d.extra.c2_feo_val;k=k.extra.c2_feo_val;if(cr.is_number(d)&&cr.is_number(k))return d-k;d=""+d;k=""+k;return d<k?-1:d>k?1:0}function w(d,k){L&&d===q&&k===B||(L=new RegExp(d,k),q=d,B=k);L.lastIndex=0;return L}function E(){}function N(){var d=h.length?h.pop():{sols:{},solModifiers:[]};d.deleteme=!1;return d}function D(){var d=n.length?n.pop():{insts:[]};d.sa=!1;return d}function f(d,k){var F=d[0]-k[0];return 0!==F?F:d[1]-k[1]}function a(d,k){return d[1]-k[1]}
function c(){}function l(d,k,F){if(d!==P||k!==V||F!==H){var e=w(k,F);z=d.match(e);P=d;V=k;H=F}}var v=cr.system_object.prototype;b.prototype.EveryTick=function(){return!0};b.prototype.OnLayoutStart=function(){return!0};b.prototype.OnLayoutEnd=function(){return!0};b.prototype.Compare=function(d,k,F){return cr.do_cmp(d,k,F)};b.prototype.CompareTime=function(d,k){var F=this.runtime.kahanTime.sum;return 0===d?(d=this.runtime.getCurrentCondition(),!d.extra.CompareTime_executed&&F>=k?d.extra.CompareTime_executed=
!0:!1):cr.do_cmp(F,d,k)};b.prototype.LayerVisible=function(d){return d?d.visible:!1};b.prototype.LayerEmpty=function(d){return d?!d.instances.length:!1};b.prototype.LayerCmpOpacity=function(d,k,F){return d?cr.do_cmp(100*d.opacity,k,F):!1};b.prototype.Repeat=function(d){var k=this.runtime.getCurrentEventStack(),F=k.current_event,e=k.isModifierAfterCnds();k=this.runtime.pushLoopStack();if(e)for(e=0;e<d&&!k.stopped;e++)this.runtime.pushCopySol(F.solModifiers),k.index=e,F.retrigger(),this.runtime.popSol(F.solModifiers);
else for(e=0;e<d&&!k.stopped;e++)k.index=e,F.retrigger();this.runtime.popLoopStack();return!1};b.prototype.While=function(d){var k=this.runtime.getCurrentEventStack();d=k.current_event;var F=k.isModifierAfterCnds();k=this.runtime.pushLoopStack();if(F)for(F=0;!k.stopped;F++)this.runtime.pushCopySol(d.solModifiers),k.index=F,d.retrigger()||(k.stopped=!0),this.runtime.popSol(d.solModifiers);else for(F=0;!k.stopped;F++)k.index=F,d.retrigger()||(k.stopped=!0);this.runtime.popLoopStack();return!1};b.prototype.For=
function(d,k,F){var e=this.runtime.getCurrentEventStack(),u=e.current_event;e=e.isModifierAfterCnds();d=this.runtime.pushLoopStack(d);if(F<k)if(e)for(;k>=F&&!d.stopped;--k)this.runtime.pushCopySol(u.solModifiers),d.index=k,u.retrigger(),this.runtime.popSol(u.solModifiers);else for(;k>=F&&!d.stopped;--k)d.index=k,u.retrigger();else if(e)for(;k<=F&&!d.stopped;++k)this.runtime.pushCopySol(u.solModifiers),d.index=k,u.retrigger(),this.runtime.popSol(u.solModifiers);else for(;k<=F&&!d.stopped;++k)d.index=
k,u.retrigger();this.runtime.popLoopStack();return!1};var t=[],y=-1;b.prototype.ForEach=function(d){var k=d.getCurrentSol();y++;t.length===y&&t.push([]);var F=t[y];cr.shallowAssignArray(F,k.getObjects());var e=this.runtime.getCurrentEventStack(),u=e.current_event,J=e.isModifierAfterCnds();e=this.runtime.pushLoopStack();var M,U,W=d.is_contained;if(J)for(J=0,M=F.length;J<M&&!e.stopped;J++){this.runtime.pushCopySol(u.solModifiers);var X=F[J];k=d.getCurrentSol();k.select_all=!1;cr.clearArray(k.instances);
k.instances[0]=X;if(W){var Y=0;for(U=X.siblings.length;Y<U;Y++){var ea=X.siblings[Y];var ha=ea.type.getCurrentSol();ha.select_all=!1;cr.clearArray(ha.instances);ha.instances[0]=ea}}e.index=J;u.retrigger();this.runtime.popSol(u.solModifiers)}else for(k.select_all=!1,cr.clearArray(k.instances),J=0,M=F.length;J<M&&!e.stopped;J++){X=F[J];k.instances[0]=X;if(W)for(Y=0,U=X.siblings.length;Y<U;Y++)ea=X.siblings[Y],ha=ea.type.getCurrentSol(),ha.select_all=!1,cr.clearArray(ha.instances),ha.instances[0]=ea;
e.index=J;u.retrigger()}cr.clearArray(F);this.runtime.popLoopStack();y--;return!1};b.prototype.ForEachOrdered=function(d,k,F){k=d.getCurrentSol();y++;t.length===y&&t.push([]);var e=t[y];cr.shallowAssignArray(e,k.getObjects());var u=this.runtime.getCurrentEventStack(),J=u.current_event,M=this.runtime.getCurrentCondition(),U=u.isModifierAfterCnds();u=this.runtime.pushLoopStack();var W;var X=0;for(W=e.length;X<W;X++)e[X].extra.c2_feo_val=M.parameters[1].get(X);e.sort(m);1===F&&e.reverse();F=d.is_contained;
if(U)for(X=0,W=e.length;X<W&&!u.stopped;X++){this.runtime.pushCopySol(J.solModifiers);var Y=e[X];k=d.getCurrentSol();k.select_all=!1;cr.clearArray(k.instances);k.instances[0]=Y;if(F)for(M=0,U=Y.siblings.length;M<U;M++){var ea=Y.siblings[M];var ha=ea.type.getCurrentSol();ha.select_all=!1;cr.clearArray(ha.instances);ha.instances[0]=ea}u.index=X;J.retrigger();this.runtime.popSol(J.solModifiers)}else for(k.select_all=!1,cr.clearArray(k.instances),X=0,W=e.length;X<W&&!u.stopped;X++){Y=e[X];k.instances[0]=
Y;if(F)for(M=0,U=Y.siblings.length;M<U;M++)ea=Y.siblings[M],ha=ea.type.getCurrentSol(),ha.select_all=!1,cr.clearArray(ha.instances),ha.instances[0]=ea;u.index=X;J.retrigger()}cr.clearArray(e);this.runtime.popLoopStack();y--;return!1};b.prototype.PickByComparison=function(d,k,F,e){var u,J;if(d){y++;t.length===y&&t.push([]);var M=t[y],U=d.getCurrentSol();cr.shallowAssignArray(M,U.getObjects());U.select_all&&cr.clearArray(U.else_instances);var W=this.runtime.getCurrentCondition();var X=u=0;for(J=M.length;u<
J;u++){var Y=M[u];M[X]=Y;k=W.parameters[1].get(u);e=W.parameters[3].get(u);cr.do_cmp(k,F,e)?X++:U.else_instances.push(Y)}cr.truncateArray(M,X);U.select_all=!1;cr.shallowAssignArray(U.instances,M);cr.clearArray(M);y--;d.applySolToContainer();return!!U.instances.length}};b.prototype.PickByEvaluate=function(d,k){var F,e;if(d){y++;t.length===y&&t.push([]);var u=t[y],J=d.getCurrentSol();cr.shallowAssignArray(u,J.getObjects());J.select_all&&cr.clearArray(J.else_instances);var M=this.runtime.getCurrentCondition();
var U=F=0;for(e=u.length;F<e;F++){var W=u[F];u[U]=W;(k=M.parameters[1].get(F))?U++:J.else_instances.push(W)}cr.truncateArray(u,U);J.select_all=!1;cr.shallowAssignArray(J.instances,u);cr.clearArray(u);y--;d.applySolToContainer();return!!J.instances.length}};b.prototype.TriggerOnce=function(){var d=this.runtime.getCurrentCondition().extra;"undefined"===typeof d.TriggerOnce_lastTick&&(d.TriggerOnce_lastTick=-1);var k=d.TriggerOnce_lastTick,F=this.runtime.tickcount;d.TriggerOnce_lastTick=F;return this.runtime.layout_first_tick||
k!==F-1};b.prototype.Every=function(d){var k=this.runtime.getCurrentCondition(),F=k.extra.Every_lastTime||0,e=this.runtime.kahanTime.sum;"undefined"===typeof k.extra.Every_seconds&&(k.extra.Every_seconds=d);var u=k.extra.Every_seconds;if(e>=F+u)return k.extra.Every_lastTime=F+u,e>=k.extra.Every_lastTime+.04&&(k.extra.Every_lastTime=e),k.extra.Every_seconds=d,!0;e<F-.1&&(k.extra.Every_lastTime=e);return!1};b.prototype.PickNth=function(d,k){if(!d)return!1;var F=d.getCurrentSol(),e=F.getObjects();k=
cr.floor(k);if(0>k||k>=e.length)return!1;F.pick_one(e[k]);d.applySolToContainer();return!0};b.prototype.PickRandom=function(d){if(!d)return!1;var k=d.getCurrentSol(),F=k.getObjects(),e=cr.floor(Math.random()*F.length);if(e>=F.length)return!1;k.pick_one(F[e]);d.applySolToContainer();return!0};b.prototype.CompareVar=function(d,k,F){return cr.do_cmp(d.getValue(),k,F)};b.prototype.CompareBoolVar=function(d){return d.getValue()};b.prototype.IsGroupActive=function(d){return(d=this.runtime.groups_by_name[d.toLowerCase()])&&
d.group_active};b.prototype.IsPreview=function(){return this.runtime.isPreview};b.prototype.PickAll=function(d){if(!d||!d.instances.length)return!1;d.getCurrentSol().select_all=!0;d.applySolToContainer();return!0};b.prototype.IsMobile=function(){return this.runtime.isMobile};b.prototype.CompareBetween=function(d,k,F){return d>=k&&d<=F};b.prototype.Else=function(){var d=this.runtime.getCurrentEventStack();return d.else_branch_ran?!1:!d.last_event_true};b.prototype.OnLoadFinished=function(){return!0};
b.prototype.OnCanvasSnapshot=function(){return!0};b.prototype.EffectsSupported=function(){return!!this.runtime.glwrap};b.prototype.OnSaveComplete=function(){return!0};b.prototype.OnSaveFailed=function(){return!0};b.prototype.OnLoadComplete=function(){return!0};b.prototype.OnLoadFailed=function(){return!0};b.prototype.ObjectUIDExists=function(d){return!!this.runtime.getObjectByUID(d)};b.prototype.IsOnPlatform=function(d){var k=this.runtime;switch(d){case 0:return!k.isNodeWebkit&&!k.isCordova&&!k.isWinJS&&
!k.isWindowsPhone8&&!k.isBlackberry10&&!k.isAmazonWebApp;case 1:return k.isiOS;case 2:return k.isAndroid;case 3:return k.isWindows8App;case 4:return k.isWindowsPhone8;case 5:return k.isBlackberry10;case 6:return k.isTizen;case 7:return!1;case 8:return k.isCordova;case 9:return k.isArcade;case 10:return k.isNodeWebkit;case 11:return k.isCrosswalk;case 12:return k.isAmazonWebApp;case 13:return k.isWindows10;default:return!1}};var L=null,q="",B="";b.prototype.RegexTest=function(d,k,F){return w(k,F).test(d)};
var A=[];b.prototype.PickOverlappingPoint=function(d,k,F){if(!d)return!1;var e=d.getCurrentSol(),u=e.getObjects(),J=this.runtime.getCurrentEventStack().current_event.orblock,M=this.runtime.getCurrentCondition(),U;e.select_all?(cr.shallowAssignArray(A,u),cr.clearArray(e.else_instances),e.select_all=!1,cr.clearArray(e.instances)):J?(cr.shallowAssignArray(A,e.else_instances),cr.clearArray(e.else_instances)):(cr.shallowAssignArray(A,u),cr.clearArray(e.instances));u=0;for(J=A.length;u<J;++u){var W=A[u];
W.update_bbox();(U=cr.xor(W.contains_pt(k,F),M.inverted))?e.instances.push(W):e.else_instances.push(W)}d.applySolToContainer();return cr.xor(!!e.instances.length,M.inverted)};b.prototype.PickLastCreated=function(d){if(!d)return!1;var k=this.runtime.createRow,F,e=null,u=d.is_family;for(F=k.length-1;0<=F;--F){var J=k[F];if(u){if(0<=J.type.families.indexOf(d)){e=J;break}}else if(J.type===d){e=J;break}}!e&&d.instances.length&&(e=d.instances[d.instances.length-1]);if(!e)return!1;d.getCurrentSol().pick_one(e);
d.applySolToContainer();return!0};b.prototype.IsNaN=function(d){return!!isNaN(d)};b.prototype.AngleWithin=function(d,k,F){return cr.angleDiff(cr.to_radians(d),cr.to_radians(F))<=cr.to_radians(k)};b.prototype.IsClockwiseFrom=function(d,k){return cr.angleClockwise(cr.to_radians(d),cr.to_radians(k))};b.prototype.IsBetweenAngles=function(d,k,F){d=cr.to_clamped_radians(d);k=cr.to_clamped_radians(k);F=cr.to_clamped_radians(F);return cr.angleClockwise(F,k)?cr.angleClockwise(d,k)&&!cr.angleClockwise(d,F):
!(!cr.angleClockwise(d,k)&&cr.angleClockwise(d,F))};b.prototype.IsValueType=function(d,k){return"number"===typeof d?0===k:1===k};v.cnds=new b;E.prototype.GoToLayout=function(d){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=d)};E.prototype.NextPrevLayout=function(d){if(!this.runtime.isloading&&!this.runtime.changelayout){var k=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if(!d||0!==k)if(d||k!==this.runtime.layouts_by_index.length-1)this.runtime.changelayout=
this.runtime.layouts_by_index[k+(d?-1:1)]}};E.prototype.CreateObject=function(d,k,F,e){if(k&&d&&(k=this.runtime.createInstance(d,k,F,e))){this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(d.plugin).cnds.OnCreated,k);if(k.is_contained)for(F=0,e=k.siblings.length;F<e;F++){var u=k.siblings[F];this.runtime.trigger(Object.getPrototypeOf(u.type.plugin).cnds.OnCreated,u)}this.runtime.isInOnDestroy--;d=d.getCurrentSol();d.select_all=!1;cr.clearArray(d.instances);d.instances[0]=k;if(k.is_contained)for(F=
0,e=k.siblings.length;F<e;F++)u=k.siblings[F],d=u.type.getCurrentSol(),d.select_all=!1,cr.clearArray(d.instances),d.instances[0]=u}};E.prototype.CreateObjectByName=function(d,k,F,e){k&&d&&(d=this.runtime.types_lowercase[d.toLowerCase()])&&E.prototype.CreateObject.call(this,d,k,F,e)};E.prototype.SetLayerVisible=function(d,k){d&&d.visible!==k&&(d.visible=k,this.runtime.redraw=!0)};E.prototype.SetLayerOpacity=function(d,k){d&&(k=cr.clamp(k/100,0,1),d.opacity!==k&&(d.opacity=k,this.runtime.redraw=!0))};
E.prototype.SetLayerScaleRate=function(d,k){d&&d.zoomRate!==k&&(d.zoomRate=k,this.runtime.redraw=!0)};E.prototype.SetLayerForceOwnTexture=function(d,k){d&&(k=!!k,d.forceOwnTexture!==k&&(d.forceOwnTexture=k,this.runtime.redraw=!0))};E.prototype.SetLayoutScale=function(d){this.runtime.running_layout&&this.runtime.running_layout.scale!==d&&(this.runtime.running_layout.scale=d,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)};E.prototype.ScrollX=function(d){this.runtime.running_layout.scrollToX(d)};
E.prototype.ScrollY=function(d){this.runtime.running_layout.scrollToY(d)};E.prototype.Scroll=function(d,k){this.runtime.running_layout.scrollToX(d);this.runtime.running_layout.scrollToY(k)};E.prototype.ScrollToObject=function(d){if(d=d.getFirstPicked())this.runtime.running_layout.scrollToX(d.x),this.runtime.running_layout.scrollToY(d.y)};E.prototype.SetVar=function(d,k){0===d.vartype?cr.is_number(k)?d.setValue(k):d.setValue(parseFloat(k)):1===d.vartype&&d.setValue(k.toString())};E.prototype.AddVar=
function(d,k){0===d.vartype?cr.is_number(k)?d.setValue(d.getValue()+k):d.setValue(d.getValue()+parseFloat(k)):1===d.vartype&&d.setValue(d.getValue()+k.toString())};E.prototype.SubVar=function(d,k){0===d.vartype&&(cr.is_number(k)?d.setValue(d.getValue()-k):d.setValue(d.getValue()-parseFloat(k)))};E.prototype.SetBoolVar=function(d,k){d.setValue(0!==k)};E.prototype.ToggleBoolVar=function(d){d.setValue(!d.getValue())};E.prototype.SetGroupActive=function(d,k){if(d=this.runtime.groups_by_name[d.toLowerCase()])switch(k){case 0:d.setGroupActive(!1);
break;case 1:d.setGroupActive(!0);break;case 2:d.setGroupActive(!d.group_active)}};E.prototype.SetTimescale=function(d){0>d&&(d=0);this.runtime.timescale=d};E.prototype.SetObjectTimescale=function(d,k){0>k&&(k=0);if(d){d=d.getCurrentSol().getObjects();var F;var e=0;for(F=d.length;e<F;e++)d[e].my_timescale=k}};E.prototype.RestoreObjectTimescale=function(d){if(!d)return!1;d=d.getCurrentSol().getObjects();var k;var F=0;for(k=d.length;F<k;F++)d[F].my_timescale=-1};var h=[],n=[];E.prototype.Wait=function(d){if(!(0>
d)){var k,F=this.runtime.getCurrentEventStack(),e=N();e.time=this.runtime.kahanTime.sum+d;e.signaltag="";e.signalled=!1;e.ev=F.current_event;e.actindex=F.actindex+1;d=0;for(k=this.runtime.types_by_index.length;d<k;d++){var u=this.runtime.types_by_index[d];var J=u.getCurrentSol();J.select_all&&-1===F.current_event.solModifiers.indexOf(u)||(e.solModifiers.push(u),u=D(),u.sa=J.select_all,cr.shallowAssignArray(u.insts,J.instances),e.sols[d.toString()]=u)}this.waits.push(e);return!0}};E.prototype.WaitForSignal=
function(d){var k,F=this.runtime.getCurrentEventStack(),e=N();e.time=-1;e.signaltag=d.toLowerCase();e.signalled=!1;e.ev=F.current_event;e.actindex=F.actindex+1;d=0;for(k=this.runtime.types_by_index.length;d<k;d++){var u=this.runtime.types_by_index[d];var J=u.getCurrentSol();J.select_all&&-1===F.current_event.solModifiers.indexOf(u)||(e.solModifiers.push(u),u=D(),u.sa=J.select_all,cr.shallowAssignArray(u.insts,J.instances),e.sols[d.toString()]=u)}this.waits.push(e);return!0};E.prototype.Signal=function(d){d=
d.toLowerCase();var k;var F=0;for(k=this.waits.length;F<k;++F){var e=this.waits[F];-1===e.time&&e.signaltag===d&&(e.signalled=!0)}};E.prototype.SetLayerScale=function(d,k){d&&d.scale!==k&&(d.scale=k,this.runtime.redraw=!0)};E.prototype.ResetGlobals=function(){var d;var k=0;for(d=this.runtime.all_global_vars.length;k<d;k++){var F=this.runtime.all_global_vars[k];F.data=F.initial}};E.prototype.SetLayoutAngle=function(d){d=cr.to_radians(d);d=cr.clamp_angle(d);this.runtime.running_layout&&this.runtime.running_layout.angle!==
d&&(this.runtime.running_layout.angle=d,this.runtime.redraw=!0)};E.prototype.SetLayerAngle=function(d,k){d&&(k=cr.to_radians(k),k=cr.clamp_angle(k),d.angle!==k&&(d.angle=k,this.runtime.redraw=!0))};E.prototype.SetLayerParallax=function(d,k,F){if(d&&(d.parallaxX!==k/100||d.parallaxY!==F/100)){d.parallaxX=k/100;d.parallaxY=F/100;if(1!==d.parallaxX||1!==d.parallaxY)for(F=d.instances,d=0,k=F.length;d<k;++d)F[d].type.any_instance_parallaxed=!0;this.runtime.redraw=!0}};E.prototype.SetLayerBackground=function(d,
k){if(d){var F=cr.clamp(Math.floor(255*cr.GetRValue(k)),0,255),e=cr.clamp(Math.floor(255*cr.GetGValue(k)),0,255);k=cr.clamp(Math.floor(255*cr.GetBValue(k)),0,255);if(d.background_color[0]!==F||d.background_color[1]!==e||d.background_color[2]!==k)d.background_color[0]=F,d.background_color[1]=e,d.background_color[2]=k,this.runtime.redraw=!0}};E.prototype.SetLayerTransparent=function(d,k){d&&!!k!==!!d.transparent&&(d.transparent=!!k,this.runtime.redraw=!0)};E.prototype.SetLayerBlendMode=function(d,k){d&&
d.blend_mode!==k&&(d.blend_mode=k,d.compositeOp=cr.effectToCompositeOp(d.blend_mode),this.runtime.gl&&cr.setGLBlend(d,d.blend_mode,this.runtime.gl),this.runtime.redraw=!0)};E.prototype.StopLoop=function(){0>this.runtime.loop_stack_index||(this.runtime.getCurrentLoop().stopped=!0)};E.prototype.GoToLayoutByName=function(d){if(!this.runtime.isloading&&!this.runtime.changelayout)for(var k in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(k)&&cr.equals_nocase(k,d)){this.runtime.changelayout=
this.runtime.layouts[k];break}};E.prototype.RestartLayout=function(d){if(!this.runtime.isloading&&!this.runtime.changelayout&&this.runtime.running_layout){this.runtime.changelayout=this.runtime.running_layout;var k;d=0;for(k=this.runtime.allGroups.length;d<k;d++){var F=this.runtime.allGroups[d];F.setGroupActive(F.initially_activated)}}};E.prototype.SnapshotCanvas=function(d,k){this.runtime.doCanvasSnapshot(0===d?"image/png":"image/jpeg",k/100)};E.prototype.SetCanvasSize=function(d,k){if(!(0>=d||0>=
k)){var F=this.runtime.fullscreen_mode;(document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen)&&0<this.runtime.fullscreen_scaling&&(F=this.runtime.fullscreen_scaling);0===F?this.runtime.setSize(d,k,!0):(this.runtime.original_width=d,this.runtime.original_height=k,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}};E.prototype.SetLayoutEffectEnabled=function(d,k){this.runtime.running_layout&&this.runtime.glwrap&&(k=
this.runtime.running_layout.getEffectByName(k))&&(d=1===d,k.active!=d&&(k.active=d,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0))};E.prototype.SetLayerEffectEnabled=function(d,k,F){d&&this.runtime.glwrap&&(F=d.getEffectByName(F))&&(k=1===k,F.active!=k&&(F.active=k,d.updateActiveEffects(),this.runtime.redraw=!0))};E.prototype.SetLayoutEffectParam=function(d,k,F){if(this.runtime.running_layout&&this.runtime.glwrap&&(d=this.runtime.running_layout.getEffectByName(d))){var e=
this.runtime.running_layout.effect_params[d.index];k=Math.floor(k);if(!(0>k||k>=e.length)){var u=this.runtime.glwrap.getProgramParameterType(d.shaderindex,k);1===u?F/=100:2===u&&(F=[cr.GetRValue(F),cr.GetGValue(F),cr.GetBValue(F)]);e[k]!==F&&(e[k]=F,d.active&&(this.runtime.redraw=!0))}}};E.prototype.SetLayerEffectParam=function(d,k,F,e){if(d&&this.runtime.glwrap&&(k=d.getEffectByName(k))&&(d=d.effect_params[k.index],F=Math.floor(F),!(0>F||F>=d.length))){var u=this.runtime.glwrap.getProgramParameterType(k.shaderindex,
F);1===u?e/=100:2===u&&(e=[cr.GetRValue(e),cr.GetGValue(e),cr.GetBValue(e)]);d[F]!==e&&(d[F]=e,k.active&&(this.runtime.redraw=!0))}};E.prototype.SaveState=function(d){this.runtime.saveToSlot=d};E.prototype.LoadState=function(d){this.runtime.loadFromSlot=d};E.prototype.LoadStateJSON=function(d){this.runtime.loadFromJson=d};E.prototype.SetHalfFramerateMode=function(d){this.runtime.halfFramerateMode=0!==d};E.prototype.SetFullscreenQuality=function(d){if(document.mozFullScreen||document.webkitIsFullScreen||
document.msFullscreenElement||document.fullScreen||0!==this.runtime.fullscreen_mode)this.runtime.wantFullscreenScalingQuality=0!==d,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0)};E.prototype.ResetPersisted=function(){var d;var k=0;for(d=this.runtime.layouts_by_index.length;k<d;++k)this.runtime.layouts_by_index[k].persist_data={},this.runtime.layouts_by_index[k].first_visit=!0};E.prototype.RecreateInitialObjects=function(d,k,F,e,u){d&&this.runtime.running_layout.recreateInitialObjects(d,
k,F,e,u)};E.prototype.SetPixelRounding=function(d){this.runtime.pixel_rounding=0!==d;this.runtime.redraw=!0};E.prototype.SetMinimumFramerate=function(d){1>d&&(d=1);120<d&&(d=120);this.runtime.minimumFramerate=d};E.prototype.SortZOrderByInstVar=function(d,k){if(d){var F;var e=d.getCurrentSol().getObjects();var u=[],J=[],M=this.runtime.running_layout,U=d.is_family,W=d.family_index,X=!1;d=0;for(F=e.length;d<F;++d){var Y=e[d];if(Y.layer){var ea=U?Y.instance_vars[k+Y.type.family_var_map[W]]:Y.instance_vars[k];
u.push([Y.layer.index,Y.get_zindex()]);J.push([Y,ea])}}if(u.length){u.sort(f);J.sort(a);d=0;for(F=u.length;d<F;++d)Y=J[d][0],k=M.layers[u[d][0]],e=u[d][1],k.instances[e]!==Y&&(k.instances[e]=Y,Y.layer=k,k.setZIndicesStaleFrom(e),X=!0);X&&(this.runtime.redraw=!0)}}};v.acts=new E;c.prototype.int=function(d,k){cr.is_string(k)?(d.set_int(parseInt(k,10)),isNaN(d.data)&&(d.data=0)):d.set_int(k)};c.prototype.float=function(d,k){cr.is_string(k)?(d.set_float(parseFloat(k)),isNaN(d.data)&&(d.data=0)):d.set_float(k)};
c.prototype.str=function(d,k){cr.is_string(k)?d.set_string(k):d.set_string(k.toString())};c.prototype.len=function(d,k){d.set_int(k.length||0)};c.prototype.random=function(d,k,F){void 0===F?d.set_float(Math.random()*k):d.set_float(Math.random()*(F-k)+k)};c.prototype.sqrt=function(d,k){d.set_float(Math.sqrt(k))};c.prototype.abs=function(d,k){d.set_float(Math.abs(k))};c.prototype.round=function(d,k){d.set_int(Math.round(k))};c.prototype.floor=function(d,k){d.set_int(Math.floor(k))};c.prototype.ceil=
function(d,k){d.set_int(Math.ceil(k))};c.prototype.sign=function(d,k){d.set_float(Math.sign(k))};c.prototype.sin=function(d,k){d.set_float(Math.sin(cr.to_radians(k)))};c.prototype.cos=function(d,k){d.set_float(Math.cos(cr.to_radians(k)))};c.prototype.tan=function(d,k){d.set_float(Math.tan(cr.to_radians(k)))};c.prototype.asin=function(d,k){d.set_float(cr.to_degrees(Math.asin(k)))};c.prototype.acos=function(d,k){d.set_float(cr.to_degrees(Math.acos(k)))};c.prototype.atan=function(d,k){d.set_float(cr.to_degrees(Math.atan(k)))};
c.prototype.exp=function(d,k){d.set_float(Math.exp(k))};c.prototype.ln=function(d,k){d.set_float(Math.log(k))};c.prototype.log10=function(d,k){d.set_float(Math.log(k)/Math.LN10)};c.prototype.max=function(d){var k=arguments[1];"number"!==typeof k&&(k=0);var F;var e=2;for(F=arguments.length;e<F;e++){var u=arguments[e];"number"===typeof u&&k<u&&(k=u)}d.set_float(k)};c.prototype.min=function(d){var k=arguments[1];"number"!==typeof k&&(k=0);var F;var e=2;for(F=arguments.length;e<F;e++){var u=arguments[e];
"number"===typeof u&&k>u&&(k=u)}d.set_float(k)};c.prototype.dt=function(d){d.set_float(this.runtime.dt)};c.prototype.timescale=function(d){d.set_float(this.runtime.timescale)};c.prototype.wallclocktime=function(d){d.set_float((Date.now()-this.runtime.start_time)/1E3)};c.prototype.unixtime=function(d){d.set_float(Date.now())};c.prototype.time=function(d){d.set_float(this.runtime.kahanTime.sum)};c.prototype.tickcount=function(d){d.set_int(this.runtime.tickcount)};c.prototype.objectcount=function(d){d.set_int(this.runtime.objectcount)};
c.prototype.fps=function(d){d.set_int(this.runtime.fps)};c.prototype.loopindex=function(d,k){var F;if(this.runtime.loop_stack.length)if(k){for(F=this.runtime.loop_stack_index;0<=F;--F){var e=this.runtime.loop_stack[F];if(e.name===k){d.set_int(e.index);return}}d.set_int(0)}else e=this.runtime.getCurrentLoop(),d.set_int(e?e.index:-1);else d.set_int(0)};c.prototype.distance=function(d,k,F,e,u){d.set_float(cr.distanceTo(k,F,e,u))};c.prototype.angle=function(d,k,F,e,u){d.set_float(cr.to_degrees(cr.angleTo(k,
F,e,u)))};c.prototype.scrollx=function(d){d.set_float(this.runtime.running_layout.scrollX)};c.prototype.scrolly=function(d){d.set_float(this.runtime.running_layout.scrollY)};c.prototype.newline=function(d){d.set_string("\n")};c.prototype.lerp=function(d,k,F,e){d.set_float(cr.lerp(k,F,e))};c.prototype.qarp=function(d,k,F,e,u){d.set_float(cr.qarp(k,F,e,u))};c.prototype.cubic=function(d,k,F,e,u,J){d.set_float(cr.cubic(k,F,e,u,J))};c.prototype.cosp=function(d,k,F,e){d.set_float(cr.cosp(k,F,e))};c.prototype.windowwidth=
function(d){d.set_int(this.runtime.width)};c.prototype.windowheight=function(d){d.set_int(this.runtime.height)};c.prototype.uppercase=function(d,k){d.set_string(cr.is_string(k)?k.toUpperCase():"")};c.prototype.lowercase=function(d,k){d.set_string(cr.is_string(k)?k.toLowerCase():"")};c.prototype.clamp=function(d,k,F,e){k<F?d.set_float(F):k>e?d.set_float(e):d.set_float(k)};c.prototype.layerscale=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(k.scale):d.set_float(0)};c.prototype.layeropacity=
function(d,k){(k=this.runtime.getLayer(k))?d.set_float(100*k.opacity):d.set_float(0)};c.prototype.layerscalerate=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(k.zoomRate):d.set_float(0)};c.prototype.layerparallaxx=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(100*k.parallaxX):d.set_float(0)};c.prototype.layerparallaxy=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(100*k.parallaxY):d.set_float(0)};c.prototype.layerindex=function(d,k){(k=this.runtime.getLayer(k))?d.set_int(k.index):
d.set_int(-1)};c.prototype.layoutscale=function(d){this.runtime.running_layout?d.set_float(this.runtime.running_layout.scale):d.set_float(0)};c.prototype.layoutangle=function(d){d.set_float(cr.to_degrees(this.runtime.running_layout.angle))};c.prototype.layerangle=function(d,k){(k=this.runtime.getLayer(k))?d.set_float(cr.to_degrees(k.angle)):d.set_float(0)};c.prototype.layoutwidth=function(d){d.set_int(this.runtime.running_layout.width)};c.prototype.layoutheight=function(d){d.set_int(this.runtime.running_layout.height)};
c.prototype.find=function(d,k,F){cr.is_string(k)&&cr.is_string(F)?d.set_int(k.search(new RegExp(cr.regexp_escape(F),"i"))):d.set_int(-1)};c.prototype.findcase=function(d,k,F){cr.is_string(k)&&cr.is_string(F)?d.set_int(k.search(new RegExp(cr.regexp_escape(F),""))):d.set_int(-1)};c.prototype.left=function(d,k,F){d.set_string(cr.is_string(k)?k.substr(0,F):"")};c.prototype.right=function(d,k,F){d.set_string(cr.is_string(k)?k.substr(k.length-F):"")};c.prototype.mid=function(d,k,F,e){d.set_string(cr.is_string(k)?
k.substr(F,e):"")};c.prototype.tokenat=function(d,k,F,e){cr.is_string(k)&&cr.is_string(e)?(k=k.split(e),F=cr.floor(F),0>F||F>=k.length?d.set_string(""):d.set_string(k[F])):d.set_string("")};c.prototype.tokencount=function(d,k,F){cr.is_string(k)&&k.length?d.set_int(k.split(F).length):d.set_int(0)};c.prototype.replace=function(d,k,F,e){cr.is_string(k)&&cr.is_string(F)&&cr.is_string(e)?d.set_string(k.replace(new RegExp(cr.regexp_escape(F),"gi"),e)):d.set_string(cr.is_string(k)?k:"")};c.prototype.trim=
function(d,k){d.set_string(cr.is_string(k)?k.trim():"")};c.prototype.pi=function(d){d.set_float(cr.PI)};c.prototype.layoutname=function(d){this.runtime.running_layout?d.set_string(this.runtime.running_layout.name):d.set_string("")};c.prototype.renderer=function(d){d.set_string(this.runtime.gl?"webgl":"canvas2d")};c.prototype.rendererdetail=function(d){d.set_string(this.runtime.glUnmaskedRenderer)};c.prototype.anglediff=function(d,k,F){d.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(k),cr.to_radians(F))))};
c.prototype.choose=function(d){var k=cr.floor(Math.random()*(arguments.length-1));d.set_any(arguments[k+1])};c.prototype.rgb=function(d,k,F,e){d.set_int(cr.RGB(k,F,e))};c.prototype.rgbex=function(d,k,F,e){d.set_float(cr.RGBEx(k/100,F/100,e/100))};c.prototype.projectversion=function(d){d.set_string(this.runtime.versionstr)};c.prototype.projectname=function(d){d.set_string(this.runtime.name)};c.prototype.anglelerp=function(d,k,F,e){k=cr.to_radians(k);F=cr.to_radians(F);var u=cr.angleDiff(k,F);cr.angleClockwise(F,
k)?d.set_float(cr.to_clamped_degrees(k+u*e)):d.set_float(cr.to_clamped_degrees(k-u*e))};c.prototype.anglerotate=function(d,k,F,e){k=cr.to_radians(k);F=cr.to_radians(F);e=cr.to_radians(e);d.set_float(cr.to_clamped_degrees(cr.angleRotate(k,F,e)))};c.prototype.zeropad=function(d,k,F){var e=0>k?"-":"";0>k&&(k=-k);F-=k.toString().length;for(var u=0;u<F;u++)e+="0";d.set_string(e+k.toString())};c.prototype.cpuutilisation=function(d){d.set_float(this.runtime.cpuutilisation/1E3)};c.prototype.gpuutilisation=
function(d){d.set_float(this.runtime.gpuLastUtilisation)};c.prototype.viewportleft=function(d,k){k=this.runtime.getLayer(k);d.set_float(k?k.viewLeft:0)};c.prototype.viewporttop=function(d,k){k=this.runtime.getLayer(k);d.set_float(k?k.viewTop:0)};c.prototype.viewportright=function(d,k){k=this.runtime.getLayer(k);d.set_float(k?k.viewRight:0)};c.prototype.viewportbottom=function(d,k){k=this.runtime.getLayer(k);d.set_float(k?k.viewBottom:0)};c.prototype.loadingprogress=function(d){d.set_float(this.runtime.loadingprogress)};
c.prototype.unlerp=function(d,k,F,e){d.set_float(cr.unlerp(k,F,e))};c.prototype.canvassnapshot=function(d){d.set_string(this.runtime.snapshotData)};c.prototype.urlencode=function(d,k){d.set_string(encodeURIComponent(k))};c.prototype.urldecode=function(d,k){d.set_string(decodeURIComponent(k))};c.prototype.canvastolayerx=function(d,k,F,e){k=this.runtime.getLayer(k);d.set_float(k?k.canvasToLayer(F,e,!0):0)};c.prototype.canvastolayery=function(d,k,F,e){k=this.runtime.getLayer(k);d.set_float(k?k.canvasToLayer(F,
e,!1):0)};c.prototype.layertocanvasx=function(d,k,F,e){k=this.runtime.getLayer(k);d.set_float(k?k.layerToCanvas(F,e,!0):0)};c.prototype.layertocanvasy=function(d,k,F,e){k=this.runtime.getLayer(k);d.set_float(k?k.layerToCanvas(F,e,!1):0)};c.prototype.savestatejson=function(d){d.set_string(this.runtime.lastSaveJson)};c.prototype.imagememoryusage=function(d){this.runtime.glwrap?d.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):d.set_float(0)};c.prototype.regexsearch=function(d,
k,F,e){F=w(F,e);d.set_int(k?k.search(F):-1)};c.prototype.regexreplace=function(d,k,F,e,u){F=w(F,e);d.set_string(k?k.replace(F,u):"")};var z=[],P="",V="",H="";c.prototype.regexmatchcount=function(d,k,F,e){w(F,e);l(k.toString(),F,e);d.set_int(z?z.length:0)};c.prototype.regexmatchat=function(d,k,F,e,u){u=Math.floor(u);w(F,e);l(k.toString(),F,e);!z||0>u||u>=z.length?d.set_string(""):d.set_string(z[u])};c.prototype.infinity=function(d){d.set_float(Infinity)};c.prototype.setbit=function(d,k,F,e){F|=0;d.set_int((k|
0)&~(1<<F)|(0!==e?1:0)<<F)};c.prototype.togglebit=function(d,k,F){d.set_int((k|0)^1<<(F|0))};c.prototype.getbit=function(d,k,F){d.set_int((k|0)&1<<(F|0)?1:0)};c.prototype.originalwindowwidth=function(d){d.set_int(this.runtime.original_width)};c.prototype.originalwindowheight=function(d){d.set_int(this.runtime.original_height)};c.prototype.originalviewportwidth=function(d){d.set_int(this.runtime.original_width)};c.prototype.originalviewportheight=function(d){d.set_int(this.runtime.original_height)};
v.exps=new c;v.runWaits=function(){var d,k=this.runtime.getCurrentEventStack();var F=0;for(d=this.waits.length;F<d;F++){var e=this.waits[F];if(-1===e.time){if(!e.signalled)continue}else if(e.time>this.runtime.kahanTime.sum)continue;k.current_event=e.ev;k.actindex=e.actindex;k.cndindex=0;for(M in e.sols)if(e.sols.hasOwnProperty(M)){var u=this.runtime.types_by_index[parseInt(M,10)].getCurrentSol();var J=e.sols[M];u.select_all=J.sa;cr.shallowAssignArray(u.instances,J.insts);u=J;cr.clearArray(u.insts);
n.push(u)}e.ev.resume_actions_and_subevents();this.runtime.clearSol(e.solModifiers);e.deleteme=!0}var M=F=0;for(d=this.waits.length;F<d;F++)e=this.waits[F],this.waits[M]=e,e.deleteme?(cr.wipe(e.sols),cr.clearArray(e.solModifiers),h.push(e)):M++;cr.truncateArray(this.waits,M)}})();
(function(){cr.add_common_aces=function(m,w){var E=m[1],N=m[3],D=m[4],f=m[5],a=m[6],c=m[7],l=m[8],v=m[10],t=m[11];m=m[12];w.cnds||(w.cnds={});w.acts||(w.acts={});w.exps||(w.exps={});var y=w.cnds,L=w.acts;w=w.exps;N&&(y.CompareX=function(q,B){return cr.do_cmp(this.x,q,B)},y.CompareY=function(q,B){return cr.do_cmp(this.y,q,B)},y.IsOnScreen=function(){var q=this.layer;this.update_bbox();var B=this.bbox;return!(B.right<q.viewLeft||B.bottom<q.viewTop||B.left>q.viewRight||B.top>q.viewBottom)},y.IsOutsideLayout=
function(){this.update_bbox();var q=this.bbox,B=this.runtime.running_layout;return 0>q.right||0>q.bottom||q.left>B.width||q.top>B.height},y.PickDistance=function(q,B,A){var h=this.getCurrentSol(),n=h.getObjects();if(!n.length)return!1;var z=n[0],P=z,V=cr.distanceTo(z.x,z.y,B,A),H;var d=1;for(H=n.length;d<H;d++){z=n[d];var k=cr.distanceTo(z.x,z.y,B,A);if(0===q&&k<V||1===q&&k>V)V=k,P=z}h.pick_one(P);return!0},L.SetX=function(q){this.x!==q&&(this.x=q,this.set_bbox_changed())},L.SetY=function(q){this.y!==
q&&(this.y=q,this.set_bbox_changed())},L.SetPos=function(q,B){if(this.x!==q||this.y!==B)this.x=q,this.y=B,this.set_bbox_changed()},L.SetPosToObject=function(q,B){var A=q.getPairedInstance(this);A&&(A.getImagePoint?(q=A.getImagePoint(B,!0),B=A.getImagePoint(B,!1)):(q=A.x,B=A.y),this.x!==q||this.y!==B)&&(this.x=q,this.y=B,this.set_bbox_changed())},L.MoveForward=function(q){0!==q&&(this.x+=Math.cos(this.angle)*q,this.y+=Math.sin(this.angle)*q,this.set_bbox_changed())},L.MoveAtAngle=function(q,B){0!==
B&&(this.x+=Math.cos(cr.to_radians(q))*B,this.y+=Math.sin(cr.to_radians(q))*B,this.set_bbox_changed())},w.X=function(q){q.set_float(this.x)},w.Y=function(q){q.set_float(this.y)},w.dt=function(q){q.set_float(this.runtime.getDt(this))});D&&(y.CompareWidth=function(q,B){return cr.do_cmp(this.width,q,B)},y.CompareHeight=function(q,B){return cr.do_cmp(this.height,q,B)},L.SetWidth=function(q){this.width!==q&&(this.width=q,this.set_bbox_changed())},L.SetHeight=function(q){this.height!==q&&(this.height=q,
this.set_bbox_changed())},L.SetSize=function(q,B){if(this.width!==q||this.height!==B)this.width=q,this.height=B,this.set_bbox_changed()},w.Width=function(q){q.set_float(this.width)},w.Height=function(q){q.set_float(this.height)},w.BBoxLeft=function(q){this.update_bbox();q.set_float(this.bbox.left)},w.BBoxTop=function(q){this.update_bbox();q.set_float(this.bbox.top)},w.BBoxRight=function(q){this.update_bbox();q.set_float(this.bbox.right)},w.BBoxBottom=function(q){this.update_bbox();q.set_float(this.bbox.bottom)});
f&&(y.AngleWithin=function(q,B){return cr.angleDiff(this.angle,cr.to_radians(B))<=cr.to_radians(q)},y.IsClockwiseFrom=function(q){return cr.angleClockwise(this.angle,cr.to_radians(q))},y.IsBetweenAngles=function(q,B){q=cr.to_clamped_radians(q);B=cr.to_clamped_radians(B);var A=cr.clamp_angle(this.angle);return cr.angleClockwise(B,q)?cr.angleClockwise(A,q)&&!cr.angleClockwise(A,B):!(!cr.angleClockwise(A,q)&&cr.angleClockwise(A,B))},L.SetAngle=function(q){q=cr.to_radians(cr.clamp_angle_degrees(q));isNaN(q)||
this.angle===q||(this.angle=q,this.set_bbox_changed())},L.RotateClockwise=function(q){0===q||isNaN(q)||(this.angle+=cr.to_radians(q),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},L.RotateCounterclockwise=function(q){0===q||isNaN(q)||(this.angle-=cr.to_radians(q),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},L.RotateTowardAngle=function(q,B){q=cr.angleRotate(this.angle,cr.to_radians(B),cr.to_radians(q));isNaN(q)||this.angle===q||(this.angle=q,this.set_bbox_changed())},
L.RotateTowardPosition=function(q,B,A){q=cr.angleRotate(this.angle,Math.atan2(A-this.y,B-this.x),cr.to_radians(q));isNaN(q)||this.angle===q||(this.angle=q,this.set_bbox_changed())},L.SetTowardPosition=function(q,B){q=Math.atan2(B-this.y,q-this.x);isNaN(q)||this.angle===q||(this.angle=q,this.set_bbox_changed())},w.Angle=function(q){q.set_float(cr.to_clamped_degrees(this.angle))});E||(y.CompareInstanceVar=function(q,B,A){return cr.do_cmp(this.instance_vars[q],B,A)},y.IsBoolInstanceVarSet=function(q){return this.instance_vars[q]},
y.PickInstVarHiLow=function(q,B){var A=this.getCurrentSol(),h=A.getObjects();if(!h.length)return!1;var n=h[0],z=n,P=n.instance_vars[B],V;var H=1;for(V=h.length;H<V;H++){n=h[H];var d=n.instance_vars[B];if(0===q&&d<P||1===q&&d>P)P=d,z=n}A.pick_one(z);return!0},y.PickByUID=function(q){var B;if(this.runtime.getCurrentCondition().inverted){var A=this.getCurrentSol();if(A.select_all){A.select_all=!1;cr.clearArray(A.instances);cr.clearArray(A.else_instances);var h=this.instances;var n=0;for(B=h.length;n<
B;n++){var z=h[n];z.uid===q?A.else_instances.push(z):A.instances.push(z)}}else{h=n=0;for(B=A.instances.length;n<B;n++)z=A.instances[n],A.instances[h]=z,z.uid===q?A.else_instances.push(z):h++;cr.truncateArray(A.instances,h)}this.applySolToContainer();return!!A.instances.length}z=this.runtime.getObjectByUID(q);if(!z)return!1;A=this.getCurrentSol();if(!A.select_all&&-1===A.instances.indexOf(z))return!1;if(this.is_family)for(q=z.type.families,n=0,B=q.length;n<B;n++){if(q[n]===this)return A.pick_one(z),
this.applySolToContainer(),!0}else if(z.type===this)return A.pick_one(z),this.applySolToContainer(),!0;return!1},y.OnCreated=function(){return!0},y.OnDestroyed=function(){return!0},L.SetInstanceVar=function(q,B){var A=this.instance_vars;cr.is_number(A[q])?cr.is_number(B)?A[q]=B:A[q]=parseFloat(B):cr.is_string(A[q])&&(cr.is_string(B)?A[q]=B:A[q]=B.toString())},L.AddInstanceVar=function(q,B){var A=this.instance_vars;cr.is_number(A[q])?cr.is_number(B)?A[q]+=B:A[q]+=parseFloat(B):cr.is_string(A[q])&&
(cr.is_string(B)?A[q]+=B:A[q]+=B.toString())},L.SubInstanceVar=function(q,B){var A=this.instance_vars;cr.is_number(A[q])&&(cr.is_number(B)?A[q]-=B:A[q]-=parseFloat(B))},L.SetBoolInstanceVar=function(q,B){this.instance_vars[q]=B?1:0},L.ToggleBoolInstanceVar=function(q){this.instance_vars[q]=1-this.instance_vars[q]},L.Destroy=function(){this.runtime.DestroyInstance(this)},L.LoadFromJsonString||(L.LoadFromJsonString=function(q){try{var B=JSON.parse(q)}catch(h){return}this.runtime.loadInstanceFromJSON(this,
B,!0);this.afterLoad&&this.afterLoad();if(this.behavior_insts)for(q=0,B=this.behavior_insts.length;q<B;++q){var A=this.behavior_insts[q];A.afterLoad&&A.afterLoad()}}),w.Count=function(q){var B=q.object_class.instances.length,A;var h=0;for(A=this.runtime.createRow.length;h<A;h++){var n=this.runtime.createRow[h];q.object_class.is_family?0<=n.type.families.indexOf(q.object_class)&&B++:n.type===q.object_class&&B++}q.set_int(B)},w.PickedCount=function(q){q.set_int(q.object_class.getCurrentSol().getObjects().length)},
w.UID=function(q){q.set_int(this.uid)},w.IID=function(q){q.set_int(this.get_iid())},w.AsJSON||(w.AsJSON=function(q){q.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))}));a&&(y.IsVisible=function(){return this.visible},L.SetVisible=function(q){q=2===q?!this.visible:0!==q;q!==this.visible&&(this.visible=q,this.runtime.redraw=!0)},y.CompareOpacity=function(q,B){return cr.do_cmp(cr.round6dp(100*this.opacity),q,B)},L.SetOpacity=function(q){q/=100;0>q?q=0:1<q&&(q=1);q!==this.opacity&&
(this.opacity=q,this.runtime.redraw=!0)},w.Opacity=function(q){q.set_float(cr.round6dp(100*this.opacity))});c&&(y.IsOnLayer=function(q){return q?this.layer===q:!1},y.PickTopBottom=function(q){var B=this.getCurrentSol(),A=B.getObjects();if(!A.length)return!1;var h=A[0],n=h,z;var P=1;for(z=A.length;P<z;P++)if(h=A[P],0===q){if(h.layer.index>n.layer.index||h.layer.index===n.layer.index&&h.get_zindex()>n.get_zindex())n=h}else if(h.layer.index<n.layer.index||h.layer.index===n.layer.index&&h.get_zindex()<
n.get_zindex())n=h;B.pick_one(n);return!0},L.MoveToTop=function(){var q=this.layer,B=q.instances;B.length&&B[B.length-1]===this||(q.removeFromInstanceList(this,!1),q.appendToInstanceList(this,!1),this.runtime.redraw=!0)},L.MoveToBottom=function(){var q=this.layer,B=q.instances;B.length&&B[0]===this||(q.removeFromInstanceList(this,!1),q.prependToInstanceList(this,!1),this.runtime.redraw=!0)},L.MoveToLayer=function(q){q&&q!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=q,q.appendToInstanceList(this,
!0),this.runtime.redraw=!0)},L.ZMoveToObject=function(q,B){q=0===q;B&&(B=B.getFirstPicked(this))&&B.uid!==this.uid&&(this.layer.index!==B.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=B.layer,B.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,B,q),this.runtime.redraw=!0)},w.LayerNumber=function(q){q.set_int(this.layer.number)},w.LayerName=function(q){q.set_string(this.layer.name)},w.ZIndex=function(q){q.set_int(this.get_zindex())});l&&(L.SetEffectEnabled=
function(q,B){this.runtime.glwrap&&(B=this.type.getEffectIndexByName(B),0>B||(q=1===q,this.active_effect_flags[B]!==q&&(this.active_effect_flags[B]=q,this.updateActiveEffects(),this.runtime.redraw=!0)))},L.SetEffectParam=function(q,B,A){if(this.runtime.glwrap){var h=this.type.getEffectIndexByName(q);if(!(0>h||(q=this.type.effect_types[h],h=this.effect_params[h],B=Math.floor(B),0>B||B>=h.length))){var n=this.runtime.glwrap.getProgramParameterType(q.shaderindex,B);1===n&&(A/=100);if(2===n){n=cr.GetRValue(A);
var z=cr.GetGValue(A);A=cr.GetBValue(A);B=h[B];if(B[0]===n&&B[1]===z&&B[2]===A)return;B[0]=n;B[1]=z;B[2]=A}else{if(h[B]===A)return;h[B]=A}q.active&&(this.runtime.redraw=!0)}}});v&&(L.SetVisible=function(q){this.visible=0!==q},L.SetCSSStyle=function(q,B){this.elem.style[cr.cssToCamelCase(q)]=B});t&&(L.SetFocus=function(){(this.inputElem||this.elem).focus()},L.SetBlur=function(){(this.inputElem||this.elem).blur()});m&&(L.SetEnabled=function(q){(this.inputElem||this.elem).disabled=0===q})};cr.set_bbox_changed=
function(){this.cell_changed=this.bbox_changed=!0;this.type.any_cell_changed=!0;this.runtime.redraw=!0;var m,w=this.bbox_changed_callbacks;var E=0;for(m=w.length;E<m;++E)w[E](this);this.layer.useRenderCells&&this.update_bbox()};cr.add_bbox_changed_callback=function(m){m&&this.bbox_changed_callbacks.push(m)};cr.update_bbox=function(){if(this.bbox_changed){var m=this.bbox,w=this.bquad;m.set(this.x,this.y,this.x+this.width,this.y+this.height);m.offset(-this.hotspotX*this.width,-this.hotspotY*this.height);
this.angle?(m.offset(-this.x,-this.y),w.set_from_rotated_rect(m,this.angle),w.offset(this.x,this.y),w.bounding_box(m)):w.set_from_rect(m);m.normalize();this.bbox_changed=!1;this.update_render_cell()}};var b=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var m=this.layer.render_grid,w=this.bbox;b.set(m.XToCell(w.left),m.YToCell(w.top),m.XToCell(w.right),m.YToCell(w.bottom));this.rendercells.equals(b)||(this.rendercells.right<this.rendercells.left?m.update(this,
null,b):m.update(this,this.rendercells,b),this.rendercells.copy(b),this.layer.render_list_stale=!0)}};cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var m=this.type.collision_grid,w=this.bbox;b.set(m.XToCell(w.left),m.YToCell(w.top),m.XToCell(w.right),m.YToCell(w.bottom));this.collcells.equals(b)||(this.collcells.right<this.collcells.left?m.update(this,null,b):m.update(this,this.collcells,b),this.collcells.copy(b),this.cell_changed=!1)}};cr.inst_contains_pt=
function(m,w){return this.bbox.contains_pt(m,w)&&this.bquad.contains_pt(m,w)?this.tilemap_exists?this.testPointOverlapTile(m,w):this.collision_poly&&!this.collision_poly.is_empty()?(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(m-this.x,w-this.y)):!0:!1};cr.inst_get_iid=function(){this.type.updateIIDs();return this.iid};cr.inst_get_zindex=function(){this.layer.updateZIndices();return this.zindex};cr.inst_updateActiveEffects=function(){cr.clearArray(this.active_effect_types);
var m,w=!0;var E=0;for(m=this.active_effect_flags.length;E<m;E++)if(this.active_effect_flags[E]){var N=this.type.effect_types[E];this.active_effect_types.push(N);N.preservesOpaqueness||(w=!1)}this.uses_shaders=!!this.active_effect_types.length;this.shaders_preserve_opaqueness=w};cr.inst_toString=function(){return"Inst"+this.puid};cr.type_getFirstPicked=function(m){if(m&&m.is_contained&&m.type!=this){var w;var E=0;for(w=m.siblings.length;E<w;E++){var N=m.siblings[E];if(N.type==this)return N}}m=this.getCurrentSol().getObjects();
return m.length?m[0]:null};cr.type_getPairedInstance=function(m){var w=this.getCurrentSol().getObjects();return w.length?w[m.get_iid()%w.length]:null};cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var m;var w=0;for(m=this.instances.length;w<m;w++)this.instances[w].iid=w;var E=w,N=this.runtime.createRow;w=0;for(m=N.length;w<m;++w)N[w].type===this&&(N[w].iid=E++);this.stale_iids=!1}};cr.type_getInstanceByIID=function(m){if(m<this.instances.length)return this.instances[m];m-=this.instances.length;
var w=this.runtime.createRow,E;var N=0;for(E=w.length;N<E;++N)if(w[N].type===this){if(0===m)return w[N];--m}return null};cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]};cr.type_pushCleanSol=function(){this.cur_sol++;this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))};cr.type_pushCopySol=function(){this.cur_sol++;this.cur_sol===this.solstack.length&&
this.solstack.push(new cr.selection(this));var m=this.solstack[this.cur_sol],w=this.solstack[this.cur_sol-1];w.select_all?m.select_all=!0:(m.select_all=!1,cr.shallowAssignArray(m.instances,w.instances));cr.clearArray(m.else_instances)};cr.type_popSol=function(){this.cur_sol--};cr.type_getBehaviorByName=function(m){var w,E,N=0;if(!this.is_family){var D=0;for(w=this.families.length;D<w;D++){var f=this.families[D];var a=0;for(E=f.behaviors.length;a<E;a++){if(m===f.behaviors[a].name)return this.extra.lastBehIndex=
N,f.behaviors[a];N++}}}D=0;for(w=this.behaviors.length;D<w;D++){if(m===this.behaviors[D].name)return this.extra.lastBehIndex=N,this.behaviors[D];N++}return null};cr.type_getBehaviorIndexByName=function(m){return this.getBehaviorByName(m)?this.extra.lastBehIndex:-1};cr.type_getEffectIndexByName=function(m){var w;var E=0;for(w=this.effect_types.length;E<w;E++)if(this.effect_types[E].name===m)return E;return-1};cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var m,w,E;this.updateIIDs();
var N=this.getCurrentSol();var D=N.select_all,f=(m=this.runtime.getCurrentEventStack())&&m.current_event&&m.current_event.orblock;m=0;for(w=this.container.length;m<w;m++){var a=this.container[m];if(a!==this){a.updateIIDs();var c=a.getCurrentSol();c.select_all=D;if(!D){cr.clearArray(c.instances);var l=0;for(E=N.instances.length;l<E;++l)c.instances[l]=a.getInstanceByIID(N.instances[l].iid);if(f)for(cr.clearArray(c.else_instances),l=0,E=N.else_instances.length;l<E;++l)c.else_instances[l]=a.getInstanceByIID(N.else_instances[l].iid)}}}}};
cr.type_toString=function(){return"Type"+this.sid};cr.do_cmp=function(m,w,E){if("undefined"===typeof m||"undefined"===typeof E)return!1;switch(w){case 0:return m===E;case 1:return m!==E;case 2:return m<E;case 3:return m<=E;case 4:return m>E;case 5:return m>=E;default:return!1}}})();cr.shaders={};cr.plugins_.Sprite=function(b){this.runtime=b};
(function(){function b(){if(0===this.datauri.length){var H=document.createElement("canvas");H.width=this.width;H.height=this.height;var d=H.getContext("2d");this.spritesheeted?d.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):d.drawImage(this.texture_img,0,0,this.width,this.height);this.datauri=H.toDataURL("image/png")}return this.datauri}function m(){}function w(H){H[0]=0;H[1]=0;H[2]=0;q.push(H)}function E(H,d){return H<d?""+H+","+d:""+d+","+H}function N(H,
d,k,F){d=d.uid;k=k.uid;var e=E(d,k);if(H.hasOwnProperty(e))H[e][2]=F;else{var u=q.length?q.pop():[0,0,0];u[0]=d;u[1]=k;u[2]=F;H[e]=u}}function D(H,d,k){d=E(d.uid,k.uid);H.hasOwnProperty(d)&&(w(H[d]),delete H[d])}function f(H,d,k){d=E(d.uid,k.uid);if(H.hasOwnProperty(d))return B=H[d][2],!0;B=-2;return!1}function a(H,d,k){if(!H)return!1;var F=0!==d||0!==k,e=!1,u=this.runtime.getCurrentCondition(),J=u.type;u=u.inverted;var M=H.getCurrentSol();var U=this.runtime.getCurrentEventStack().current_event.orblock;
M.select_all?(this.update_bbox(),V.copy(this.bbox),V.offset(d,k),this.runtime.getCollisionCandidates(this.layer,H,V,P),M=P):M=U?this.runtime.isCurrentConditionFirst()&&!M.else_instances.length&&M.instances.length?M.instances:M.else_instances:M.instances;h=H;z=J!==H&&!u;if(F){var W=this.x;var X=this.y;this.x+=d;this.y+=k;this.set_bbox_changed()}d=0;for(k=M.length;d<k;d++)if(U=M[d],this.runtime.testOverlap(this,U)){e=!0;if(u)break;J!==H&&n.add(U)}F&&(this.x=W,this.y=X,this.set_bbox_changed());cr.clearArray(P);
return e}function c(){}function l(){}var v=cr.plugins_.Sprite.prototype;v.Type=function(H){this.plugin=H;this.runtime=H.runtime};var t=v.Type.prototype;t.onCreate=function(){if(!this.is_family){var H,d;this.all_frames=[];this.has_loaded_textures=!1;var k=0;for(H=this.animations.length;k<H;k++){var F=this.animations[k];var e={};e.name=F[0];e.speed=F[1];e.loop=F[2];e.repeatcount=F[3];e.repeatto=F[4];e.pingpong=F[5];e.sid=F[6];e.frames=[];var u=0;for(d=F[7].length;u<d;u++){var J=F[7][u];var M={};M.texture_file=
J[0];M.texture_filesize=J[1];M.offx=J[2];M.offy=J[3];M.width=J[4];M.height=J[5];M.duration=J[6];M.hotspotX=J[7];M.hotspotY=J[8];M.image_points=J[9];M.poly_pts=J[10];M.pixelformat=J[11];M.spritesheeted=0!==M.width;M.datauri="";M.getDataUri=b;var U={left:0,top:0,right:1,bottom:1};M.sheetTex=U;M.webGL_texture=null;(U=this.runtime.findWaitingTexture(J[0]))?M.texture_img=U:(M.texture_img=new Image,M.texture_img.cr_src=J[0],M.texture_img.cr_filesize=J[1],M.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(M.texture_img,
J[0]));cr.seal(M);e.frames.push(M);this.all_frames.push(M)}cr.seal(e);this.animations[k]=e}}};t.updateAllCurrentTexture=function(){var H;var d=0;for(H=this.instances.length;d<H;d++){var k=this.instances[d];k.curWebGLTexture=k.curFrame.webGL_texture}};t.onLostWebGLContext=function(){if(!this.is_family){var H;var d=0;for(H=this.all_frames.length;d<H;++d){var k=this.all_frames[d];k.texture_img.c2webGL_texture=null;k.webGL_texture=null}this.has_loaded_textures=!1;this.updateAllCurrentTexture()}};t.onRestoreWebGLContext=
function(){if(!this.is_family&&this.instances.length){var H;var d=0;for(H=this.all_frames.length;d<H;++d){var k=this.all_frames[d];k.webGL_texture=this.runtime.glwrap.loadTexture(k.texture_img,!1,this.runtime.linearSampling,k.pixelformat)}this.updateAllCurrentTexture()}};t.loadTextures=function(){if(!this.is_family&&!this.has_loaded_textures&&this.runtime.glwrap){var H;var d=0;for(H=this.all_frames.length;d<H;++d){var k=this.all_frames[d];k.webGL_texture=this.runtime.glwrap.loadTexture(k.texture_img,
!1,this.runtime.linearSampling,k.pixelformat)}this.has_loaded_textures=!0}};t.unloadTextures=function(){if(!this.is_family&&!this.instances.length&&this.has_loaded_textures){var H;var d=0;for(H=this.all_frames.length;d<H;++d){var k=this.all_frames[d];this.runtime.glwrap.deleteTexture(k.webGL_texture);k.webGL_texture=null}this.has_loaded_textures=!1}};var y=[];t.preloadCanvas2D=function(H){var d;cr.clearArray(y);var k=0;for(d=this.all_frames.length;k<d;++k){var F=this.all_frames[k].texture_img;-1===
y.indexOf(F)&&(H.drawImage(F,0,0),y.push(F))}};v.Instance=function(H){this.type=H;this.runtime=H.runtime;H=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(H):this.collision_poly=new cr.CollisionPoly(H)};var L=v.Instance.prototype;L.onCreate=function(){this.visible=this.properties[0];this.inAnimTrigger=this.isTicking=!1;this.collisionsEnabled=this.properties[3];this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0];this.cur_frame=
this.properties[2];0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var H=this.cur_animation.frames[this.cur_frame];this.collision_poly.set_pts(H.poly_pts);this.hotspotX=H.hotspotX;this.hotspotY=H.hotspotY;this.animForwards=0<=this.cur_animation.speed;this.cur_anim_speed=Math.abs(this.cur_animation.speed);this.cur_anim_repeatto=this.cur_animation.repeatto;1===this.type.animations.length&&1===this.type.animations[0].frames.length||
0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0);this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder;this.frameStart=this.getNowTime();this.animPlaying=!0;this.animRepeats=0;this.changeAnimName=this.animTriggerName="";this.changeAnimFrom=0;this.changeAnimFrame=-1;this.type.loadTextures();var d,k;H=0;for(d=this.type.animations.length;H<d;H++){var F=this.type.animations[H];var e=0;for(k=F.frames.length;e<k;e++){var u=F.frames[e];0===u.width&&(u.width=u.texture_img.width,
u.height=u.texture_img.height);if(u.spritesheeted){var J=u.texture_img;var M=u.sheetTex;M.left=u.offx/J.width;M.top=u.offy/J.height;M.right=(u.offx+u.width)/J.width;M.bottom=(u.offy+u.height)/J.height;0===u.offx&&0===u.offy&&u.width===J.width&&u.height===J.height&&(u.spritesheeted=!1)}}}this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture};L.saveToJSON=function(){var H={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,
ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};this.animPlaying||(H.ap=this.animPlaying);this.animForwards||(H.af=this.animForwards);return H};L.loadFromJSON=function(H){var d=this.getAnimationBySid(H.a);d&&(this.cur_animation=d);this.cur_frame=H.f;0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);this.cur_anim_speed=H.cas;this.frameStart=H.fs;this.animRepeats=H.ar;this.animTimer.reset();
this.animTimer.sum=H.at;this.animPlaying=H.hasOwnProperty("ap")?H.ap:!0;this.animForwards=H.hasOwnProperty("af")?H.af:!0;H.hasOwnProperty("rt")?this.cur_anim_repeatto=H.rt:this.cur_anim_repeatto=this.cur_animation.repeatto;this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture;this.collision_poly.set_pts(this.curFrame.poly_pts);this.hotspotX=this.curFrame.hotspotX;this.hotspotY=this.curFrame.hotspotY};L.animationFinish=function(H){this.cur_frame=H?
0:this.cur_animation.frames.length-1;this.animPlaying=!1;this.animTriggerName=this.cur_animation.name;this.inAnimTrigger=!0;this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this);this.inAnimTrigger=!1;this.animRepeats=0};L.getNowTime=function(){return this.animTimer.sum};L.tick=function(){this.animTimer.add(this.runtime.getDt(this));this.changeAnimName.length&&this.doChangeAnim();0<=this.changeAnimFrame&&
this.doChangeAnimFrame();var H=this.getNowTime(),d=this.cur_animation,k=d.frames[this.cur_frame],F=k.duration/this.cur_anim_speed;this.animPlaying&&H>=this.frameStart+F&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=F,this.cur_frame>=d.frames.length&&(d.pingpong?(this.animForwards=!1,this.cur_frame=d.frames.length-2):d.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=d.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),
0>this.cur_frame&&(d.pingpong?(this.cur_frame=1,this.animForwards=!0,d.loop||(this.animRepeats++,this.animRepeats>=d.repeatcount&&this.animationFinish(!0))):d.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=d.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),0>this.cur_frame?this.cur_frame=0:this.cur_frame>=d.frames.length&&(this.cur_frame=d.frames.length-1),H>this.frameStart+d.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=
H),H=d.frames[this.cur_frame],this.OnFrameChanged(k,H),this.runtime.redraw=!0)};L.getAnimationByName=function(H){var d;var k=0;for(d=this.type.animations.length;k<d;k++){var F=this.type.animations[k];if(cr.equals_nocase(F.name,H))return F}return null};L.getAnimationBySid=function(H){var d;var k=0;for(d=this.type.animations.length;k<d;k++){var F=this.type.animations[k];if(F.sid===H)return F}return null};L.doChangeAnim=function(){var H=this.cur_animation.frames[this.cur_frame],d=this.getAnimationByName(this.changeAnimName);
this.changeAnimName="";!d||cr.equals_nocase(d.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=d,this.animForwards=0<=d.speed,this.cur_anim_speed=Math.abs(d.speed),this.cur_anim_repeatto=d.repeatto,0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.OnFrameChanged(H,this.cur_animation.frames[this.cur_frame]),
this.runtime.redraw=!0)};L.doChangeAnimFrame=function(){var H=this.cur_animation.frames[this.cur_frame],d=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame);0>this.cur_frame&&(this.cur_frame=0);this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);d!==this.cur_frame&&(this.OnFrameChanged(H,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0);this.changeAnimFrame=-1};L.OnFrameChanged=function(H,
d){var k=H.width,F=H.height,e=d.width,u=d.height;k!=e&&(this.width*=e/k);F!=u&&(this.height*=u/F);this.hotspotX=d.hotspotX;this.hotspotY=d.hotspotY;this.collision_poly.set_pts(d.poly_pts);this.set_bbox_changed();this.curFrame=d;this.curWebGLTexture=d.webGL_texture;k=0;for(F=this.behavior_insts.length;k<F;k++)if(e=this.behavior_insts[k],e.onSpriteFrameChanged)e.onSpriteFrameChanged(H,d);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)};L.draw=function(H){H.globalAlpha=this.opacity;
var d=this.curFrame,k=d.spritesheeted,F=d.texture_img,e=this.x,u=this.y,J=this.width,M=this.height;if(0===this.angle&&0<=J&&0<=M)e-=this.hotspotX*J,u-=this.hotspotY*M,this.runtime.pixel_rounding&&(e=Math.round(e),u=Math.round(u)),k?H.drawImage(F,d.offx,d.offy,d.width,d.height,e,u,J,M):H.drawImage(F,e,u,J,M);else{this.runtime.pixel_rounding&&(e=Math.round(e),u=Math.round(u));H.save();var U=0<J?1:-1,W=0<M?1:-1;H.translate(e,u);1===U&&1===W||H.scale(U,W);H.rotate(this.angle*U*W);e=-(this.hotspotX*cr.abs(J));
u=-(this.hotspotY*cr.abs(M));k?H.drawImage(F,d.offx,d.offy,d.width,d.height,e,u,cr.abs(J),cr.abs(M)):H.drawImage(F,e,u,cr.abs(J),cr.abs(M));H.restore()}};L.drawGL_earlyZPass=function(H){this.drawGL(H)};L.drawGL=function(H){H.setTexture(this.curWebGLTexture);H.setOpacity(this.opacity);var d=this.curFrame,k=this.bquad;if(this.runtime.pixel_rounding){var F=Math.round(this.x)-this.x,e=Math.round(this.y)-this.y;d.spritesheeted?H.quadTex(k.tlx+F,k.tly+e,k.trx+F,k.try_+e,k.brx+F,k.bry+e,k.blx+F,k.bly+e,
d.sheetTex):H.quad(k.tlx+F,k.tly+e,k.trx+F,k.try_+e,k.brx+F,k.bry+e,k.blx+F,k.bly+e)}else d.spritesheeted?H.quadTex(k.tlx,k.tly,k.trx,k.try_,k.brx,k.bry,k.blx,k.bly,d.sheetTex):H.quad(k.tlx,k.tly,k.trx,k.try_,k.brx,k.bry,k.blx,k.bly)};L.getImagePointIndexByName=function(H){var d=this.curFrame,k;var F=0;for(k=d.image_points.length;F<k;F++)if(cr.equals_nocase(H,d.image_points[F][0]))return F;return-1};L.getImagePoint=function(H,d){var k=this.curFrame,F=k.image_points;var e=cr.is_string(H)?this.getImagePointIndexByName(H):
H-1;e=cr.floor(e);if(0>e||e>=F.length)return d?this.x:this.y;H=(F[e][1]-k.hotspotX)*this.width;F=F[e][2];F=(F-k.hotspotY)*this.height;k=Math.cos(this.angle);e=Math.sin(this.angle);var u=H*k-F*e;F=F*k+H*e;H=u+this.x;F+=this.y;return d?H:F};var q=[],B=-2,A=[];m.prototype.OnCollision=function(H){if(!H)return!1;var d=this.runtime,k=d.getCurrentCondition(),F=k.type,e=null;k.extra.collmemory?e=k.extra.collmemory:(e={},k.extra.collmemory=e);k.extra.spriteCreatedDestroyCallback||(k.extra.spriteCreatedDestroyCallback=
!0,d.addDestroyCallback(function(G){var x=k.extra.collmemory;G=G.uid;var K;for(K in x)if(x.hasOwnProperty(K)){var R=x[K];if(R[0]===G||R[1]===G)w(x[K]),delete x[K]}}));var u=F.getCurrentSol(),J=H.getCurrentSol();u=u.getObjects();var M,U,W=this.runtime.tickcount,X=W-1,Y=d.getCurrentEventStack().current_event;for(M=0;M<u.length;M++){var ea=u[M];if(J.select_all){ea.update_bbox();this.runtime.getCollisionCandidates(ea.layer,H,ea.bbox,A);var ha=A;this.runtime.addRegisteredCollisionCandidates(ea,H,ha)}else ha=
J.getObjects();for(U=0;U<ha.length;U++){var g=ha[U];if(d.testOverlap(ea,g)||d.checkRegisteredCollision(ea,g)){var p=f(e,ea,g);p=!p||B<X;N(e,ea,g,W);if(p){d.pushCopySol(Y.solModifiers);p=F.getCurrentSol();var C=H.getCurrentSol();p.select_all=!1;C.select_all=!1;F===H?(p.instances.length=2,p.instances[0]=ea,p.instances[1]=g,F.applySolToContainer()):(p.instances.length=1,C.instances.length=1,p.instances[0]=ea,C.instances[0]=g,F.applySolToContainer(),H.applySolToContainer());Y.retrigger();d.popSol(Y.solModifiers)}}else D(e,
ea,g)}cr.clearArray(A)}return!1};var h=null,n=new cr.ObjectSet,z=!1,P=[],V=new cr.rect(0,0,0,0);t.finish=function(H){if(z){if(H){var d=this.runtime.getCurrentEventStack().current_event.orblock;H=h.getCurrentSol();var k=n.valuesRef(),F;if(H.select_all){H.select_all=!1;cr.clearArray(H.instances);var e=0;for(F=k.length;e<F;++e)H.instances[e]=k[e];if(d)for(cr.clearArray(H.else_instances),e=0,F=h.instances.length;e<F;++e)k=h.instances[e],n.contains(k)||H.else_instances.push(k)}else if(d)for(d=H.instances.length,
e=0,F=k.length;e<F;++e)H.instances[d+e]=k[e],cr.arrayFindRemove(H.else_instances,k[e]);else cr.shallowAssignArray(H.instances,k);h.applySolToContainer()}n.clear();z=!1}};m.prototype.IsOverlapping=function(H){return a.call(this,H,0,0)};m.prototype.IsOverlappingOffset=function(H,d,k){return a.call(this,H,d,k)};m.prototype.IsAnimPlaying=function(H){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,H):cr.equals_nocase(this.cur_animation.name,H)};m.prototype.CompareFrame=function(H,
d){return cr.do_cmp(this.cur_frame,H,d)};m.prototype.CompareAnimSpeed=function(H,d){return cr.do_cmp(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed,H,d)};m.prototype.OnAnimFinished=function(H){return cr.equals_nocase(this.animTriggerName,H)};m.prototype.OnAnyAnimFinished=function(){return!0};m.prototype.OnFrameChanged=function(){return!0};m.prototype.IsMirrored=function(){return 0>this.width};m.prototype.IsFlipped=function(){return 0>this.height};m.prototype.OnURLLoaded=function(){return!0};
m.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled};v.cnds=new m;c.prototype.Spawn=function(H,d,k){if(H&&d&&(d=this.runtime.createInstance(H,d,this.getImagePoint(k,!0),this.getImagePoint(k,!1)))){"undefined"!==typeof d.angle&&(d.angle=this.angle,d.set_bbox_changed());this.runtime.isInOnDestroy++;var F;this.runtime.trigger(Object.getPrototypeOf(H.plugin).cnds.OnCreated,d);if(d.is_contained){var e=0;for(F=d.siblings.length;e<F;e++){var u=d.siblings[e];this.runtime.trigger(Object.getPrototypeOf(u.type.plugin).cnds.OnCreated,
u)}}this.runtime.isInOnDestroy--;e=this.runtime.getCurrentAction();k=!1;if(cr.is_undefined(e.extra.Spawn_LastExec)||e.extra.Spawn_LastExec<this.runtime.execcount)k=!0,e.extra.Spawn_LastExec=this.runtime.execcount;if(H!=this.type&&(H=H.getCurrentSol(),H.select_all=!1,k?(cr.clearArray(H.instances),H.instances[0]=d):H.instances.push(d),d.is_contained))for(e=0,F=d.siblings.length;e<F;e++)u=d.siblings[e],H=u.type.getCurrentSol(),H.select_all=!1,k?(cr.clearArray(H.instances),H.instances[0]=u):H.instances.push(u)}};
c.prototype.SetEffect=function(H){this.blend_mode=H;this.compositeOp=cr.effectToCompositeOp(H);cr.setGLBlend(this,H,this.runtime.gl);this.runtime.redraw=!0};c.prototype.StopAnim=function(){this.animPlaying=!1};c.prototype.StartAnim=function(H){this.animPlaying=!0;this.frameStart=this.getNowTime();1===H&&0!==this.cur_frame&&(this.changeAnimFrame=0,this.inAnimTrigger||this.doChangeAnimFrame());this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};c.prototype.SetAnim=function(H,d){this.changeAnimName=
H;this.changeAnimFrom=d;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnim()};c.prototype.SetAnimFrame=function(H){this.changeAnimFrame=H;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0);this.inAnimTrigger||this.doChangeAnimFrame()};c.prototype.SetAnimSpeed=function(H){this.cur_anim_speed=cr.abs(H);this.animForwards=0<=H;this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)};c.prototype.SetAnimRepeatToFrame=function(H){H=Math.floor(H);
0>H&&(H=0);H>=this.cur_animation.frames.length&&(H=this.cur_animation.frames.length-1);this.cur_anim_repeatto=H};c.prototype.SetMirrored=function(H){H=cr.abs(this.width)*(0===H?-1:1);this.width!==H&&(this.width=H,this.set_bbox_changed())};c.prototype.SetFlipped=function(H){H=cr.abs(this.height)*(0===H?-1:1);this.height!==H&&(this.height=H,this.set_bbox_changed())};c.prototype.SetScale=function(H){var d=this.curFrame,k=d.width*H*(0>this.width?-1:1);H=d.height*H*(0>this.height?-1:1);if(this.width!==
k||this.height!==H)this.width=k,this.height=H,this.set_bbox_changed()};c.prototype.LoadURL=function(H,d,k){var F=new Image,e=this,u=this.curFrame;F.onload=function(){u.texture_img.src===F.src?e.runtime.glwrap&&e.curFrame===u&&(e.curWebGLTexture=u.webGL_texture):(u.texture_img=F,u.offx=0,u.offy=0,u.width=F.width,u.height=F.height,u.spritesheeted=!1,u.datauri="",u.pixelformat=0,e.runtime.glwrap&&(u.webGL_texture&&e.runtime.glwrap.deleteTexture(u.webGL_texture),u.webGL_texture=e.runtime.glwrap.loadTexture(F,
!1,e.runtime.linearSampling),e.curFrame===u&&(e.curWebGLTexture=u.webGL_texture),e.type.updateAllCurrentTexture()));0===d&&(e.width=F.width,e.height=F.height,e.set_bbox_changed());e.runtime.redraw=!0;e.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,e)};"data:"!==H.substr(0,5)&&0===k&&(F.crossOrigin="anonymous");this.runtime.setImageSrc(F,H)};c.prototype.SetCollisions=function(H){this.collisionsEnabled!==(0!==H)&&((this.collisionsEnabled=0!==H)?this.set_bbox_changed():(this.collcells.right>=
this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))};v.acts=new c;l.prototype.AnimationFrame=function(H){H.set_int(this.cur_frame)};l.prototype.AnimationFrameCount=function(H){H.set_int(this.cur_animation.frames.length)};l.prototype.AnimationName=function(H){H.set_string(this.cur_animation.name)};l.prototype.AnimationSpeed=function(H){H.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)};l.prototype.ImagePointX=function(H,
d){H.set_float(this.getImagePoint(d,!0))};l.prototype.ImagePointY=function(H,d){H.set_float(this.getImagePoint(d,!1))};l.prototype.ImagePointCount=function(H){H.set_int(this.curFrame.image_points.length)};l.prototype.ImageWidth=function(H){H.set_float(this.curFrame.width)};l.prototype.ImageHeight=function(H){H.set_float(this.curFrame.height)};v.exps=new l})();cr.plugins_.Touch=function(b){this.runtime=b};
(function(){function b(h){l=h.x;v=h.y;t=h.z}function m(h,n,z,P){var V=y.length?y.pop():new w;V.init(h,n,z,P);return V}function w(){this.startindex=this.id=this.lasty=this.lastx=this.y=this.x=this.starty=this.startx=this.lasttime=this.time=this.starttime=0;this.tooFarForHold=this.triggeredHold=!1}function E(h){return h.sourceCapabilities&&h.sourceCapabilities.firesTouchEvents||h.originalEvent&&h.originalEvent.sourceCapabilities&&h.originalEvent.sourceCapabilities.firesTouchEvents}function N(){}function D(){}
function f(){}var a=cr.plugins_.Touch.prototype;a.Type=function(h){this.plugin=h;this.runtime=h.runtime};a.Type.prototype.onCreate=function(){};a.Instance=function(h){this.type=h;this.runtime=h.runtime;this.touches=[];this.mouseDown=!1};var c=a.Instance.prototype;c.findTouch=function(h){var n;var z=0;for(n=this.touches.length;z<n;z++)if(this.touches[z].id===h)return z;return-1};var l=0,v=0,t=0,y=[];w.prototype.init=function(h,n,z,P){var V=cr.performance_now();this.starttime=this.lasttime=this.time=
V;this.startx=h;this.starty=n;this.x=h;this.y=n;this.lastx=h;this.lasty=n;this.pressure=this.height=this.width=0;this.id=z;this.startindex=P;this.tooFarForHold=this.triggeredHold=!1};w.prototype.update=function(h,n,z,P,V,H){this.lasttime=this.time;this.time=h;this.lastx=this.x;this.lasty=this.y;this.x=n;this.y=z;this.width=P;this.height=V;this.pressure=H;!this.tooFarForHold&&15<=cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.tooFarForHold=!0)};w.prototype.maybeTriggerHold=function(h,
n){!this.triggeredHold&&500<=cr.performance_now()-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.triggeredHold=!0,h.trigger_index=this.startindex,h.trigger_id=this.id,h.getTouchIndex=n,h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,h),h.curTouchX=this.x,h.curTouchY=this.y,h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,h),h.getTouchIndex=0)};var L=-1E3,q=-1E3,B=-1E4;w.prototype.maybeTriggerTap=function(h,
n){if(!this.triggeredHold){var z=cr.performance_now();333>=z-this.starttime&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(h.trigger_index=this.startindex,h.trigger_id=this.id,h.getTouchIndex=n,666>=z-B&&25>cr.distanceTo(L,q,this.x,this.y)?(h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,h),h.curTouchX=this.x,h.curTouchY=this.y,h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,h),q=L=-1E3,B=-1E4):(h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,
h),h.curTouchX=this.x,h.curTouchY=this.y,h.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,h),L=this.x,q=this.y,B=z),h.getTouchIndex=0)}};c.onCreate=function(){this.isWindows8=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.getTouchIndex=this.trigger_permission=this.trigger_id=this.trigger_index=this.curTouchY=this.curTouchX=this.acc_z=this.acc_y=this.acc_x=this.acc_g_z=this.acc_g_y=this.acc_g_x=this.orient_gamma=this.orient_beta=this.orient_alpha=0;this.useMouseInput=
this.properties[0];var h=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,n=document,z=this;"undefined"!==typeof PointerEvent?(h.addEventListener("pointerdown",function(k){z.onPointerStart(k)},!1),h.addEventListener("pointermove",function(k){z.onPointerMove(k)},!1),n.addEventListener("pointerup",function(k){z.onPointerEnd(k,!1)},!1),n.addEventListener("pointercancel",function(k){z.onPointerEnd(k,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(k){k.preventDefault()},
!1),document.addEventListener("MSGestureHold",function(k){k.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(k){k.preventDefault()},!1),document.addEventListener("gesturehold",function(k){k.preventDefault()},!1))):window.navigator.msPointerEnabled?(h.addEventListener("MSPointerDown",function(k){z.onPointerStart(k)},!1),h.addEventListener("MSPointerMove",function(k){z.onPointerMove(k)},!1),n.addEventListener("MSPointerUp",function(k){z.onPointerEnd(k,!1)},!1),n.addEventListener("MSPointerCancel",
function(k){z.onPointerEnd(k,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(k){k.preventDefault()},!1),document.addEventListener("MSGestureHold",function(k){k.preventDefault()},!1))):(h.addEventListener("touchstart",function(k){z.onTouchStart(k)},!1),h.addEventListener("touchmove",function(k){z.onTouchMove(k)},!1),n.addEventListener("touchend",function(k){z.onTouchEnd(k,!1)},!1),n.addEventListener("touchcancel",function(k){z.onTouchEnd(k,!0)},!1));if(this.isWindows8){var P=
function(k){k=k.reading;z.acc_x=k.accelerationX;z.acc_y=k.accelerationY;z.acc_z=k.accelerationZ},V=function(k){k=k.reading;z.orient_alpha=k.yawDegrees;z.orient_beta=k.pitchDegrees;z.orient_gamma=k.rollDegrees},H=Windows.Devices.Sensors.Accelerometer.getDefault();H&&(H.reportInterval=Math.max(H.minimumReportInterval,16),H.addEventListener("readingchanged",P));var d=Windows.Devices.Sensors.Inclinometer.getDefault();d&&(d.reportInterval=Math.max(d.minimumReportInterval,16),d.addEventListener("readingchanged",
V));document.addEventListener("visibilitychange",function(k){document.hidden||document.msHidden?(H&&H.removeEventListener("readingchanged",P),d&&d.removeEventListener("readingchanged",V)):(H&&H.addEventListener("readingchanged",P),d&&d.addEventListener("readingchanged",V))},!1)}else window.addEventListener("deviceorientation",function(k){z.orient_alpha=k.alpha||0;z.orient_beta=k.beta||0;z.orient_gamma=k.gamma||0},!1),window.addEventListener("devicemotion",function(k){k.accelerationIncludingGravity&&
(z.acc_g_x=k.accelerationIncludingGravity.x||0,z.acc_g_y=k.accelerationIncludingGravity.y||0,z.acc_g_z=k.accelerationIncludingGravity.z||0);k.acceleration&&(z.acc_x=k.acceleration.x||0,z.acc_y=k.acceleration.y||0,z.acc_z=k.acceleration.z||0)},!1);this.useMouseInput&&(document.addEventListener("mousemove",function(k){z.onMouseMove(k)}),document.addEventListener("mousedown",function(k){z.onMouseDown(k)}),document.addEventListener("mouseup",function(k){z.onMouseUp(k)}));!this.runtime.isiOS&&this.runtime.isCordova&&
navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(b,null,{frequency:40});this.runtime.tick2Me(this)};c.onPointerMove=function(h){if(h.pointerType!==h.MSPOINTER_TYPE_MOUSE&&"mouse"!==h.pointerType){h.preventDefault&&h.preventDefault();var n=this.findTouch(h.pointerId),z=cr.performance_now();0<=n&&(n=this.touches[n],2>z-n.time||n.update(z,h.pageX-this.runtime.canvas.offsetLeft,h.pageY-this.runtime.canvas.offsetTop,h.width||0,h.height||0,h.pressure||
0))}};c.onPointerStart=function(h){if(h.pointerType!==h.MSPOINTER_TYPE_MOUSE&&"mouse"!==h.pointerType&&-1===this.findTouch(h.pointerId)){h.preventDefault&&cr.isCanvasInputEvent(h)&&h.preventDefault();var n=h.pageX-this.runtime.canvas.offsetLeft,z=h.pageY-this.runtime.canvas.offsetTop;cr.performance_now();this.trigger_index=this.touches.length;this.trigger_id=h.pointerId;this.touches.push(m(n,z,h.pointerId,this.trigger_index));this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,
this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=n;this.curTouchY=z;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this);this.runtime.isInUserInputEvent=!1}};c.onPointerEnd=function(h,n){h.pointerType!==h.MSPOINTER_TYPE_MOUSE&&"mouse"!==h.pointerType&&(h.preventDefault&&cr.isCanvasInputEvent(h)&&h.preventDefault(),h=this.findTouch(h.pointerId),this.trigger_index=0<=h?this.touches[h].startindex:-1,this.trigger_id=0<=h?this.touches[h].id:
-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=h&&(n||this.touches[h].maybeTriggerTap(this,h),100>y.length&&y.push(this.touches[h]),this.touches.splice(h,1)),this.runtime.isInUserInputEvent=!1)};c.onTouchMove=function(h){h.preventDefault&&h.preventDefault();var n=cr.performance_now(),z;var P=0;for(z=h.changedTouches.length;P<z;P++){var V=h.changedTouches[P];var H=
this.findTouch(V.identifier);if(0<=H){var d=this.runtime.canvas.offsetLeft,k=this.runtime.canvas.offsetTop;H=this.touches[H];2>n-H.time||H.update(n,V.pageX-d,V.pageY-k,2*(V.radiusX||V.webkitRadiusX||V.mozRadiusX||V.msRadiusX||0),2*(V.radiusY||V.webkitRadiusY||V.mozRadiusY||V.msRadiusY||0),V.force||V.webkitForce||V.mozForce||V.msForce||0)}}};c.onTouchStart=function(h){h.preventDefault&&cr.isCanvasInputEvent(h)&&h.preventDefault();var n=this.runtime.canvas.offsetLeft,z=this.runtime.canvas.offsetTop;
cr.performance_now();this.runtime.isInUserInputEvent=!0;var P;var V=0;for(P=h.changedTouches.length;V<P;V++){var H=h.changedTouches[V];var d=this.findTouch(H.identifier);if(-1===d){d=H.pageX-n;var k=H.pageY-z;this.trigger_index=this.touches.length;this.trigger_id=H.identifier;this.touches.push(m(d,k,H.identifier,this.trigger_index));this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=d;
this.curTouchY=k;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}}this.runtime.isInUserInputEvent=!1};c.onTouchEnd=function(h,n){h.preventDefault&&cr.isCanvasInputEvent(h)&&h.preventDefault();this.runtime.isInUserInputEvent=!0;var z;var P=0;for(z=h.changedTouches.length;P<z;P++){var V=h.changedTouches[P];V=this.findTouch(V.identifier);0<=V&&(this.trigger_index=this.touches[V].startindex,this.trigger_id=this.touches[V].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,
this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),n||this.touches[V].maybeTriggerTap(this,V),100>y.length&&y.push(this.touches[V]),this.touches.splice(V,1))}this.runtime.isInUserInputEvent=!1};c.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==t?90*t:this.orient_alpha};c.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==v?90*v:this.orient_beta};c.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&
0!==l?90*l:this.orient_gamma};c.onMouseDown=function(h){E(h)||(this.onTouchStart({changedTouches:[{pageX:h.pageX,pageY:h.pageY,identifier:0}]}),this.mouseDown=!0)};c.onMouseMove=function(h){if(this.mouseDown&&!E(h))this.onTouchMove({changedTouches:[{pageX:h.pageX,pageY:h.pageY,identifier:0}]})};c.onMouseUp=function(h){h.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&h.preventDefault();this.runtime.had_a_click=!0;E(h)||(this.onTouchEnd({changedTouches:[{pageX:h.pageX,pageY:h.pageY,
identifier:0}]}),this.mouseDown=!1)};c.isClientPosOverCanvas=function(h,n){return 0<=h&&0<=n&&h<this.runtime.width&&n<this.runtime.height};c.tick2=function(){var h,n=cr.performance_now();var z=0;for(h=this.touches.length;z<h;++z){var P=this.touches[z];P.time<=n-50&&(P.lasttime=n);P.maybeTriggerHold(this,z)}};N.prototype.OnTouchStart=function(){return!0};N.prototype.OnTouchEnd=function(){return!0};N.prototype.IsInTouch=function(){return this.touches.length};N.prototype.OnTouchObject=function(h){return h&&
this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(h,this.curTouchX,this.curTouchY,!1):!1};var A=[];N.prototype.IsTouchingObject=function(h){if(!h)return!1;var n=h.getCurrentSol(),z=n.getObjects(),P,V;var H=0;for(P=z.length;H<P;H++){var d=z[H];d.update_bbox();var k=0;for(V=this.touches.length;k<V;k++){var F=this.touches[k];if(this.isClientPosOverCanvas(F.x,F.y)){var e=d.layer.canvasToLayer(F.x,F.y,!0);F=d.layer.canvasToLayer(F.x,F.y,!1);if(d.contains_pt(e,
F)){A.push(d);break}}}}return A.length?(n.select_all=!1,cr.shallowAssignArray(n.instances,A),h.applySolToContainer(),cr.clearArray(A),!0):!1};N.prototype.CompareTouchSpeed=function(h,n,z){h=Math.floor(h);if(0>h||h>=this.touches.length)return!1;var P=this.touches[h];h=cr.distanceTo(P.x,P.y,P.lastx,P.lasty);P=(P.time-P.lasttime)/1E3;var V=0;0<P&&(V=h/P);return cr.do_cmp(V,n,z)};N.prototype.OrientationSupported=function(){return"undefined"!==typeof window.DeviceOrientationEvent};N.prototype.MotionSupported=
function(){return"undefined"!==typeof window.DeviceMotionEvent};N.prototype.CompareOrientation=function(h,n,z){h=0===h?this.getAlpha():1===h?this.getBeta():this.getGamma();return cr.do_cmp(h,n,z)};N.prototype.CompareAcceleration=function(h,n,z){var P=0;0===h?P=this.acc_g_x:1===h?P=this.acc_g_y:2===h?P=this.acc_g_z:3===h?P=this.acc_x:4===h?P=this.acc_y:5===h&&(P=this.acc_z);return cr.do_cmp(P,n,z)};N.prototype.OnNthTouchStart=function(h){h=Math.floor(h);return h===this.trigger_index};N.prototype.OnNthTouchEnd=
function(h){h=Math.floor(h);return h===this.trigger_index};N.prototype.HasNthTouch=function(h){h=Math.floor(h);return this.touches.length>=h+1};N.prototype.OnHoldGesture=function(){return!0};N.prototype.OnTapGesture=function(){return!0};N.prototype.OnDoubleTapGesture=function(){return!0};N.prototype.OnHoldGestureObject=function(h){return h&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(h,this.curTouchX,this.curTouchY,!1):!1};N.prototype.OnTapGestureObject=
function(h){return h&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(h,this.curTouchX,this.curTouchY,!1):!1};N.prototype.OnDoubleTapGestureObject=function(h){return h&&this.isClientPosOverCanvas(this.curTouchX,this.curTouchY)?this.runtime.testAndSelectCanvasPointOverlap(h,this.curTouchX,this.curTouchY,!1):!1};N.prototype.OnPermissionGranted=function(h){return this.trigger_permission===h};N.prototype.OnPermissionDenied=function(h){return this.trigger_permission===
h};a.cnds=new N;D.prototype.RequestPermission=function(h){var n=this,z=Promise.resolve(!0);0===h?window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&(z=window.DeviceOrientationEvent.requestPermission().then(function(P){return"granted"===P})):window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&(z=window.DeviceMotionEvent.requestPermission().then(function(P){return"granted"===P}));z.then(function(P){n.trigger_permission=h;P?n.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionGranted,
n):n.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionDenied,n)})};a.acts=new D;f.prototype.TouchCount=function(h){h.set_int(this.touches.length)};f.prototype.X=function(h,n){var z=this.getTouchIndex;if(0>z||z>=this.touches.length)h.set_float(0);else if(cr.is_undefined(n)){n=this.runtime.getLayerByNumber(0);var P=n.scale;var V=n.zoomRate;var H=n.parallaxX;var d=n.angle;n.scale=1;n.zoomRate=1;n.parallaxX=1;n.angle=0;h.set_float(n.canvasToLayer(this.touches[z].x,this.touches[z].y,!0));n.scale=
P;n.zoomRate=V;n.parallaxX=H;n.angle=d}else(n=cr.is_number(n)?this.runtime.getLayerByNumber(n):this.runtime.getLayerByName(n))?h.set_float(n.canvasToLayer(this.touches[z].x,this.touches[z].y,!0)):h.set_float(0)};f.prototype.XAt=function(h,n,z){n=Math.floor(n);if(0>n||n>=this.touches.length)h.set_float(0);else if(cr.is_undefined(z)){z=this.runtime.getLayerByNumber(0);var P=z.scale;var V=z.zoomRate;var H=z.parallaxX;var d=z.angle;z.scale=1;z.zoomRate=1;z.parallaxX=1;z.angle=0;h.set_float(z.canvasToLayer(this.touches[n].x,
this.touches[n].y,!0));z.scale=P;z.zoomRate=V;z.parallaxX=H;z.angle=d}else(z=cr.is_number(z)?this.runtime.getLayerByNumber(z):this.runtime.getLayerByName(z))?h.set_float(z.canvasToLayer(this.touches[n].x,this.touches[n].y,!0)):h.set_float(0)};f.prototype.XForID=function(h,n,z){n=this.findTouch(n);if(0>n)h.set_float(0);else if(n=this.touches[n],cr.is_undefined(z)){z=this.runtime.getLayerByNumber(0);var P=z.scale;var V=z.zoomRate;var H=z.parallaxX;var d=z.angle;z.scale=1;z.zoomRate=1;z.parallaxX=1;
z.angle=0;h.set_float(z.canvasToLayer(n.x,n.y,!0));z.scale=P;z.zoomRate=V;z.parallaxX=H;z.angle=d}else(z=cr.is_number(z)?this.runtime.getLayerByNumber(z):this.runtime.getLayerByName(z))?h.set_float(z.canvasToLayer(n.x,n.y,!0)):h.set_float(0)};f.prototype.Y=function(h,n){var z=this.getTouchIndex;if(0>z||z>=this.touches.length)h.set_float(0);else if(cr.is_undefined(n)){n=this.runtime.getLayerByNumber(0);var P=n.scale;var V=n.zoomRate;var H=n.parallaxY;var d=n.angle;n.scale=1;n.zoomRate=1;n.parallaxY=
1;n.angle=0;h.set_float(n.canvasToLayer(this.touches[z].x,this.touches[z].y,!1));n.scale=P;n.zoomRate=V;n.parallaxY=H;n.angle=d}else(n=cr.is_number(n)?this.runtime.getLayerByNumber(n):this.runtime.getLayerByName(n))?h.set_float(n.canvasToLayer(this.touches[z].x,this.touches[z].y,!1)):h.set_float(0)};f.prototype.YAt=function(h,n,z){n=Math.floor(n);if(0>n||n>=this.touches.length)h.set_float(0);else if(cr.is_undefined(z)){z=this.runtime.getLayerByNumber(0);var P=z.scale;var V=z.zoomRate;var H=z.parallaxY;
var d=z.angle;z.scale=1;z.zoomRate=1;z.parallaxY=1;z.angle=0;h.set_float(z.canvasToLayer(this.touches[n].x,this.touches[n].y,!1));z.scale=P;z.zoomRate=V;z.parallaxY=H;z.angle=d}else(z=cr.is_number(z)?this.runtime.getLayerByNumber(z):this.runtime.getLayerByName(z))?h.set_float(z.canvasToLayer(this.touches[n].x,this.touches[n].y,!1)):h.set_float(0)};f.prototype.YForID=function(h,n,z){n=this.findTouch(n);if(0>n)h.set_float(0);else if(n=this.touches[n],cr.is_undefined(z)){z=this.runtime.getLayerByNumber(0);
var P=z.scale;var V=z.zoomRate;var H=z.parallaxY;var d=z.angle;z.scale=1;z.zoomRate=1;z.parallaxY=1;z.angle=0;h.set_float(z.canvasToLayer(n.x,n.y,!1));z.scale=P;z.zoomRate=V;z.parallaxY=H;z.angle=d}else(z=cr.is_number(z)?this.runtime.getLayerByNumber(z):this.runtime.getLayerByName(z))?h.set_float(z.canvasToLayer(n.x,n.y,!1)):h.set_float(0)};f.prototype.AbsoluteX=function(h){this.touches.length?h.set_float(this.touches[0].x):h.set_float(0)};f.prototype.AbsoluteXAt=function(h,n){n=Math.floor(n);0>n||
n>=this.touches.length?h.set_float(0):h.set_float(this.touches[n].x)};f.prototype.AbsoluteXForID=function(h,n){n=this.findTouch(n);0>n?h.set_float(0):h.set_float(this.touches[n].x)};f.prototype.AbsoluteY=function(h){this.touches.length?h.set_float(this.touches[0].y):h.set_float(0)};f.prototype.AbsoluteYAt=function(h,n){n=Math.floor(n);0>n||n>=this.touches.length?h.set_float(0):h.set_float(this.touches[n].y)};f.prototype.AbsoluteYForID=function(h,n){n=this.findTouch(n);0>n?h.set_float(0):h.set_float(this.touches[n].y)};
f.prototype.SpeedAt=function(h,n){n=Math.floor(n);if(0>n||n>=this.touches.length)h.set_float(0);else{var z=this.touches[n];n=cr.distanceTo(z.x,z.y,z.lastx,z.lasty);z=(z.time-z.lasttime)/1E3;0>=z?h.set_float(0):h.set_float(n/z)}};f.prototype.SpeedForID=function(h,n){n=this.findTouch(n);if(0>n)h.set_float(0);else{var z=this.touches[n];n=cr.distanceTo(z.x,z.y,z.lastx,z.lasty);z=(z.time-z.lasttime)/1E3;0>=z?h.set_float(0):h.set_float(n/z)}};f.prototype.AngleAt=function(h,n){n=Math.floor(n);0>n||n>=this.touches.length?
h.set_float(0):(n=this.touches[n],h.set_float(cr.to_degrees(cr.angleTo(n.lastx,n.lasty,n.x,n.y))))};f.prototype.AngleForID=function(h,n){n=this.findTouch(n);0>n?h.set_float(0):(n=this.touches[n],h.set_float(cr.to_degrees(cr.angleTo(n.lastx,n.lasty,n.x,n.y))))};f.prototype.Alpha=function(h){h.set_float(this.getAlpha())};f.prototype.Beta=function(h){h.set_float(this.getBeta())};f.prototype.Gamma=function(h){h.set_float(this.getGamma())};f.prototype.AccelerationXWithG=function(h){h.set_float(this.acc_g_x)};
f.prototype.AccelerationYWithG=function(h){h.set_float(this.acc_g_y)};f.prototype.AccelerationZWithG=function(h){h.set_float(this.acc_g_z)};f.prototype.AccelerationX=function(h){h.set_float(this.acc_x)};f.prototype.AccelerationY=function(h){h.set_float(this.acc_y)};f.prototype.AccelerationZ=function(h){h.set_float(this.acc_z)};f.prototype.TouchIndex=function(h){h.set_int(this.trigger_index)};f.prototype.TouchID=function(h){h.set_float(this.trigger_id)};f.prototype.WidthForID=function(h,n){n=this.findTouch(n);
0>n?h.set_float(0):h.set_float(this.touches[n].width)};f.prototype.HeightForID=function(h,n){n=this.findTouch(n);0>n?h.set_float(0):h.set_float(this.touches[n].height)};f.prototype.PressureForID=function(h,n){n=this.findTouch(n);0>n?h.set_float(0):h.set_float(this.touches[n].pressure)};a.exps=new f})();cr.plugins_.Function=function(b){this.runtime=b};
(function(){function b(){this.name="";this.retVal=0;this.params=[]}function m(){c++;c===a.length&&a.push(new b);return a[c]}function w(){return 0>c?null:a[c]}function E(){}function N(){}function D(){}var f=cr.plugins_.Function.prototype;f.Type=function(l){this.plugin=l;this.runtime=l.runtime};f.Type.prototype.onCreate=function(){};f.Instance=function(l){this.type=l;this.runtime=l.runtime};var a=[],c=-1;f.Instance.prototype.onCreate=function(){var l=this;window.c2_callFunction=function(v,t){var y,
L=m();L.name=v.toLowerCase();L.retVal=0;if(t)for(L.params.length=t.length,v=0,y=t.length;v<y;++v){var q=t[v];L.params[v]="number"===typeof q||"string"===typeof q?q:"boolean"===typeof q?q?1:0:0}else cr.clearArray(L.params);l.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,l,L.name);c--;return L.retVal}};E.prototype.OnFunction=function(l){var v=w();return v?cr.equals_nocase(l,v.name):!1};E.prototype.CompareParam=function(l,v,t){var y=w();if(!y)return!1;l=cr.floor(l);var L=0;0<=l&&l<y.params.length&&
(L=y.params[l]);return cr.do_cmp(L,v,t)};f.cnds=new E;N.prototype.CallFunction=function(l,v){var t=m();t.name=l.toLowerCase();t.retVal=0;cr.shallowAssignArray(t.params,v);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,t.name);c--};N.prototype.SetReturnValue=function(l){var v=w();v&&(v.retVal=l)};N.prototype.CallExpression=function(l){};f.acts=new N;D.prototype.ReturnValue=function(l){if(a.length){var v=c+1;v>=a.length&&(v=a.length-1);v=a[v]}else v=null;v?l.set_any(v.retVal):
l.set_int(0)};D.prototype.ParamCount=function(l){var v=w();v?l.set_int(v.params.length):l.set_int(0)};D.prototype.Param=function(l,v){v=cr.floor(v);var t=w();t?0<=v&&v<t.params.length?l.set_any(t.params[v]):l.set_int(0):l.set_int(0)};D.prototype.Call=function(l,v){var t=m();t.name=v.toLowerCase();t.retVal=0;cr.clearArray(t.params);var y;var L=2;for(y=arguments.length;L<y;L++)t.params.push(arguments[L]);this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,t.name);c--;l.set_any(t.retVal)};
f.exps=new D})();cr.plugins_.WebStorage=function(b){this.runtime=b};
(function(){function b(){}function m(){}function w(){}var E=cr.plugins_.WebStorage.prototype;E.Type=function(c){this.plugin=c;this.runtime=c.runtime};E.Type.prototype.onCreate=function(){};E.Instance=function(c){this.type=c;this.runtime=c.runtime};var N=E.Instance.prototype,D="",f="undefined"!==typeof window.is_scirra_arcade;f&&(D="arcade"+window.scirra_arcade_id);var a=!1;try{localStorage.getItem("test"),a=!0}catch(c){a=!1}N.onCreate=function(){a||cr.logexport("[Construct 2] Webstorage plugin: local storage is not supported on this platform.")};
b.prototype.LocalStorageEnabled=function(){return a};b.prototype.SessionStorageEnabled=function(){return a};b.prototype.LocalStorageExists=function(c){return a?null!=localStorage.getItem(D+c):!1};b.prototype.SessionStorageExists=function(c){return a?null!=sessionStorage.getItem(D+c):!1};b.prototype.OnQuotaExceeded=function(){return!0};b.prototype.CompareKeyText=function(c,l,v){if(!a)return!1;c=localStorage.getItem(D+c)||"";return v?c==l:cr.equals_nocase(c,l)};b.prototype.CompareKeyNumber=function(c,
l,v){if(!a)return!1;c=localStorage.getItem(D+c)||"";return cr.do_cmp(parseFloat(c),l,v)};E.cnds=new b;m.prototype.StoreLocal=function(c,l){if(a)try{localStorage.setItem(D+c,l)}catch(v){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};m.prototype.StoreSession=function(c,l){if(a)try{sessionStorage.setItem(D+c,l)}catch(v){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};m.prototype.RemoveLocal=function(c){a&&localStorage.removeItem(D+
c)};m.prototype.RemoveSession=function(c){a&&sessionStorage.removeItem(D+c)};m.prototype.ClearLocal=function(){a&&(f||localStorage.clear())};m.prototype.ClearSession=function(){a&&(f||sessionStorage.clear())};m.prototype.JSONLoad=function(c,l){if(a){try{var v=JSON.parse(c)}catch(y){return}if(v.c2dictionary){c=v.data;0!==l||f||localStorage.clear();for(var t in c)if(c.hasOwnProperty(t))try{localStorage.setItem(D+t,c[t])}catch(y){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,
this);break}}}};E.acts=new m;w.prototype.LocalValue=function(c,l){a?c.set_string(localStorage.getItem(D+l)||""):c.set_string("")};w.prototype.SessionValue=function(c,l){a?c.set_string(sessionStorage.getItem(D+l)||""):c.set_string("")};w.prototype.LocalCount=function(c){a?c.set_int(f?0:localStorage.length):c.set_int(0)};w.prototype.SessionCount=function(c){a?c.set_int(f?0:sessionStorage.length):c.set_int(0)};w.prototype.LocalAt=function(c,l){f||!a?c.set_string(""):c.set_string(localStorage.getItem(localStorage.key(l))||
"")};w.prototype.SessionAt=function(c,l){f||!a?c.set_string(""):c.set_string(sessionStorage.getItem(sessionStorage.key(l))||"")};w.prototype.LocalKeyAt=function(c,l){f||!a?c.set_string(""):c.set_string(localStorage.key(l)||"")};w.prototype.SessionKeyAt=function(c,l){f||!a?c.set_string(""):c.set_string(sessionStorage.key(l)||"")};w.prototype.AsJSON=function(c){if(a){var l={},v;var t=0;for(v=localStorage.length;t<v;t++){var y=localStorage.key(t);f?y.substr(0,D.length)===D&&(l[y.substr(D.length)]=localStorage.getItem(y)):
l[y]=localStorage.getItem(y)}c.set_string(JSON.stringify({c2dictionary:!0,data:l}))}else c.set_string("")};E.exps=new w})();cr.plugins_.Audio=function(b){this.runtime=b};
(function(){function b(r){-1===xa.indexOf(r)&&xa.push(r)}function m(r){var I=r.instanceObject;try{var O=I.play()}catch(Q){b(r);return}O?O.catch(function(Q){b(r)}):Ca&&!g.isInUserInputEvent&&b(r)}function w(){var r,I;Da||ka||!K||(E(),"running"===K.state&&(Da=!0));var O=xa.slice(0);cr.clearArray(xa);if(!ba){var Q=0;for(r=O.length;Q<r;++Q){var aa=O[Q];aa.stopped||aa.is_paused||(I=aa.instanceObject.play())&&I.catch(function(ca){b(aa)})}}}function E(){"suspended"===K.state&&K.resume&&K.resume();if(K.createBuffer){var r=
K.createBuffer(1,220,22050),I=K.createBufferSource();I.buffer=r;I.connect(K.destination);l(I)}}function N(r){r=Math.pow(10,r/20);isFinite(r)||(r=0);0>r&&(r=0);1<r&&(r=1);return r}function D(r){0>r&&(r=0);1<r&&(r=1);return Math.log(r)/Math.log(10)*20}function f(r){r=r.toLowerCase();return oa.hasOwnProperty(r)&&oa[r].length?oa[r][0].getInputNode():K.destination}function a(){return K.createGain?K.createGain():K.createGainNode()}function c(r){return K.createDelay?K.createDelay(r):K.createDelayNode(r)}
function l(r,I){r.start?r.start(I||0):r.noteOn(I||0)}function v(r,I,O,Q){r.start?r.start(Q||0,I):r.noteGrainOn(Q||0,I,O-I)}function t(r){try{r.stop?r.stop(0):r.noteOff(0)}catch(I){}}function y(r,I,O,Q){if(r)if(r.cancelScheduledValues(0),0===Q)r.value=I;else{var aa=K.currentTime;Q+=aa;switch(O){case 0:r.setValueAtTime(I,Q);break;case 1:r.setValueAtTime(r.value,aa);r.linearRampToValueAtTime(I,Q);break;case 2:r.setValueAtTime(r.value,aa),r.exponentialRampToValueAtTime(I,Q)}}}function L(r,I,O,Q,aa,ca){this.type=
"filter";this.params=[r,I,O,Q,aa,ca];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=ca;this.dryNode=a();this.dryNode.gain.value=1-ca;this.filterNode=K.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?r:Ea[r];this.filterNode.frequency.value=I;this.filterNode.detune&&(this.filterNode.detune.value=O);this.filterNode.Q.value=Q;this.filterNode.gain.value=aa;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode)}
function q(r,I,O){this.type="delay";this.params=[r,I,O];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=O;this.dryNode=a();this.dryNode.gain.value=1-O;this.mainNode=a();this.delayNode=c(r);this.delayNode.delayTime.value=r;this.delayGainNode=a();this.delayGainNode.gain.value=I;this.inputNode.connect(this.mainNode);this.inputNode.connect(this.dryNode);this.mainNode.connect(this.wetNode);this.mainNode.connect(this.delayNode);this.delayNode.connect(this.delayGainNode);this.delayGainNode.connect(this.mainNode)}
function B(r,I,O,Q){this.type="convolve";this.params=[I,O,Q];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=O;this.dryNode=a();this.dryNode.gain.value=1-O;this.convolveNode=K.createConvolver();r&&(this.convolveNode.normalize=I,this.convolveNode.buffer=r);this.inputNode.connect(this.convolveNode);this.inputNode.connect(this.dryNode);this.convolveNode.connect(this.wetNode)}function A(r,I,O,Q,aa){this.type="flanger";this.params=[r,I,O,Q,aa];this.inputNode=a();this.dryNode=a();this.dryNode.gain.value=
1-aa/2;this.wetNode=a();this.wetNode.gain.value=aa/2;this.feedbackNode=a();this.feedbackNode.gain.value=Q;this.delayNode=c(r+I);this.delayNode.delayTime.value=r;this.oscNode=K.createOscillator();this.oscNode.frequency.value=O;this.oscGainNode=a();this.oscGainNode.gain.value=I;this.inputNode.connect(this.delayNode);this.inputNode.connect(this.dryNode);this.delayNode.connect(this.wetNode);this.delayNode.connect(this.feedbackNode);this.feedbackNode.connect(this.delayNode);this.oscNode.connect(this.oscGainNode);
this.oscGainNode.connect(this.delayNode.delayTime);l(this.oscNode)}function h(r,I,O,Q,aa,ca){this.type="phaser";this.params=[r,I,O,Q,aa,ca];this.inputNode=a();this.dryNode=a();this.dryNode.gain.value=1-ca/2;this.wetNode=a();this.wetNode.gain.value=ca/2;this.filterNode=K.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?7:"allpass";this.filterNode.frequency.value=r;this.filterNode.detune&&(this.filterNode.detune.value=I);this.filterNode.Q.value=O;this.oscNode=K.createOscillator();
this.oscNode.frequency.value=aa;this.oscGainNode=a();this.oscGainNode.gain.value=Q;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode);this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.filterNode.frequency);l(this.oscNode)}function n(r){this.type="gain";this.params=[r];this.node=a();this.node.gain.value=r}function z(r,I){this.type="tremolo";this.params=[r,I];this.node=a();this.node.gain.value=1-I/2;this.oscNode=K.createOscillator();
this.oscNode.frequency.value=r;this.oscGainNode=a();this.oscGainNode.gain.value=I/2;this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.node.gain);l(this.oscNode)}function P(r,I){this.type="ringmod";this.params=[r,I];this.inputNode=a();this.wetNode=a();this.wetNode.gain.value=I;this.dryNode=a();this.dryNode.gain.value=1-I;this.ringNode=a();this.ringNode.gain.value=0;this.oscNode=K.createOscillator();this.oscNode.frequency.value=r;this.oscNode.connect(this.ringNode.gain);l(this.oscNode);
this.inputNode.connect(this.ringNode);this.inputNode.connect(this.dryNode);this.ringNode.connect(this.wetNode)}function V(r,I,O,Q,aa){this.type="distortion";this.params=[r,I,O,Q,aa];this.inputNode=a();this.preGain=a();this.postGain=a();this.setDrive(O,Math.pow(10,Q/20));this.wetNode=a();this.wetNode.gain.value=aa;this.dryNode=a();this.dryNode.gain.value=1-aa;this.waveShaper=K.createWaveShaper();this.curve=new Float32Array(65536);this.generateColortouchCurve(r,I);this.waveShaper.curve=this.curve;this.inputNode.connect(this.preGain);
this.inputNode.connect(this.dryNode);this.preGain.connect(this.waveShaper);this.waveShaper.connect(this.postGain);this.postGain.connect(this.wetNode)}function H(r,I,O,Q,aa){this.type="compressor";this.params=[r,I,O,Q,aa];this.node=K.createDynamicsCompressor();try{this.node.threshold.value=r,this.node.knee.value=I,this.node.ratio.value=O,this.node.attack.value=Q,this.node.release.value=aa}catch(ca){}}function d(r,I){this.type="analyser";this.params=[r,I];this.node=K.createAnalyser();this.node.fftSize=
r;this.node.smoothingTimeConstant=I;this.freqBins=new Float32Array(this.node.frequencyBinCount);this.signal=new Uint8Array(r);this.rms=this.peak=0}function k(){this.obj=null;this.loadUid=0}function F(r,I,O){this.src=r;this.type=I;this.myapi=x;this.is_music=O;this.added_end_listener=!1;var Q=this;this.mediaSourceNode=this.outNode=null;this.panWhenReady=[];this.seekWhenReady=0;this.failedToLoad=this.supportWebAudioAPI=this.pauseWhenReady=!1;this.needsSoftwareDecode="audio/webm; codecs=opus"===this.type&&
!ta;this.wasEverReady=!1;this.is_music&&this.needsSoftwareDecode&&(Fa=!0);1!==x||!O||ya||this.needsSoftwareDecode||(this.myapi=0,this.outNode=a());this.audioData=this.bufferObject=null;switch(this.myapi){case 0:this.bufferObject=new Audio;this.bufferObject.crossOrigin="anonymous";this.bufferObject.addEventListener("canplaythrough",function(){Q.wasEverReady=!0});1===x&&K.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",
function(){!Q.mediaSourceNode&&Q.bufferObject&&(Q.mediaSourceNode=K.createMediaElementSource(Q.bufferObject),Q.mediaSourceNode.connect(Q.outNode))}));this.bufferObject.autoplay=!1;this.bufferObject.preload="auto";this.bufferObject.src=r;break;case 1:if(g.isWKWebView)g.fetchLocalFileViaCordovaAsArrayBuffer(r,function(ca){Q.audioData=ca;Q.decodeAudioBuffer()},function(ca){Q.failedToLoad=!0});else{var aa=new XMLHttpRequest;aa.open("GET",r,!0);aa.responseType="arraybuffer";aa.onload=function(){Q.audioData=
aa.response;Q.decodeAudioBuffer()};aa.onerror=function(){Q.failedToLoad=!0};aa.send()}break;case 2:this.bufferObject=!0}}function e(r,I){var O=this;this.tag=I;this.stopped=this.fresh=!0;this.src=r.src;this.buffer=r;this.myapi=x;this.is_music=r.is_music;this.playbackRate=1;this.hasPlaybackEnded=!0;this.is_paused=this.resume_me=!1;this.resume_position=0;this.is_silent=this.is_muted=this.looping=!1;this.volume=1;this.onended_handler=function(aa){if(!O.is_paused&&!O.resume_me){var ca=this;ca||(ca=aa.target);
ca===O.active_buffer&&(O.hasPlaybackEnded=!0,O.stopped=!0,C=O.tag,g.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,p))}};this.active_buffer=null;this.isTimescaled=1===fa&&!this.is_music||2===fa;this.mutevol=1;this.startTime=this.isTimescaled?g.kahanTime.sum:g.wallTime.sum;this.pannerNode=this.gainNode=null;this.pannerEnabled=!1;this.objectTracker=null;this.panConeOuterGain=this.panConeOuter=this.panConeInner=this.panAngle=this.panY=this.panX=0;this.instanceObject=null;var Q=!1;1!==this.myapi||0!==
this.buffer.myapi||this.buffer.supportWebAudioAPI||(this.myapi=0);switch(this.myapi){case 0:this.is_music?(this.instanceObject=r.bufferObject,Q=!r.added_end_listener,r.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=r.bufferObject.src,Q=!0);Q&&this.instanceObject.addEventListener("ended",function(){C=O.tag;O.stopped=!0;g.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,p)});break;case 1:this.gainNode=
a();this.gainNode.connect(f(I));1===this.buffer.myapi?r.bufferObject&&(this.instanceObject=K.createBufferSource(),this.instanceObject.buffer=r.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),this.buffer.added_end_listener||(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){C=O.tag;O.stopped=!0;g.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,p)})));break;
case 2:this.instanceObject=new window.Media(G+this.src,null,null,function(aa){aa===window.Media.MEDIA_STOPPED&&(O.hasPlaybackEnded=!0,O.stopped=!0,C=O.tag,g.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,p))})}}function u(r,I){r=r.isPlaying()?1:0;I=I.isPlaying()?1:0;return r===I?0:r<I?1:-1}function J(r,I){cr.clearArray(na);if(r.length){var O;var Q=0;for(O=S.length;Q<O;Q++){var aa=S[Q];cr.equals_nocase(r,aa.tag)&&na.push(aa)}I&&na.sort(u)}else T&&!T.hasEnded()&&(cr.clearArray(na),na[0]=T)}function M(r){var I,
O=K.destination;if(oa.hasOwnProperty(r)){var Q=oa[r];if(Q.length){O=Q[0].getInputNode();var aa=0;for(I=Q.length;aa<I;aa++){var ca=Q[aa];aa+1===I?ca.connectTo(K.destination):ca.connectTo(Q[aa+1].getInputNode())}}}J(r);aa=0;for(I=na.length;aa<I;aa++)na[aa].reconnect(O);ua&&Aa===r&&(ua.disconnect(),ua.connect(O))}function U(r,I){oa.hasOwnProperty(r)?oa[r].push(I):oa[r]=[I];M(r)}function W(){}function X(){}function Y(){}function ea(r,I){var O=null;oa.hasOwnProperty(r)&&(O=oa[r]);return O&&0<=I&&I<O.length&&
O[I].freqBins?O[I]:null}var ha=cr.plugins_.Audio.prototype;ha.Type=function(r){this.plugin=r;this.runtime=r.runtime};ha.Type.prototype.onCreate=function(){};var g=null,p=null,C="",G="",x=0,K=null,R=[],S=[],T=null,fa=0,ba=!1,Z=1,da=0,ia=0,ka=!1,ta=!!(new Audio).canPlayType("audio/webm; codecs=opus"),qa=1,Ba=1,Ga=10,Ha=1E4,Ia=1,ua=null,Aa="",Ca=!1,xa=[],ya=!1,Fa=!1,Da=!1;document.addEventListener("pointerup",w,!0);document.addEventListener("touchend",w,!0);document.addEventListener("click",w,!0);document.addEventListener("keydown",
w,!0);document.addEventListener("gamepadconnected",w,!0);var oa={},Ea="lowpass highpass bandpass lowshelf highshelf peaking notch allpass".split(" ");L.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();this.dryNode.connect(r)};L.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};L.prototype.getInputNode=function(){return this.inputNode};L.prototype.setParam=
function(r,I,O,Q){switch(r){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[5]=I;y(this.wetNode.gain,I,O,Q);y(this.dryNode.gain,1-I,O,Q);break;case 1:this.params[1]=I;y(this.filterNode.frequency,I,O,Q);break;case 2:this.params[2]=I;y(this.filterNode.detune,I,O,Q);break;case 3:this.params[3]=I;y(this.filterNode.Q,I,O,Q);break;case 4:this.params[4]=I,y(this.filterNode.gain,I,O,Q)}};q.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();this.dryNode.connect(r)};
q.prototype.remove=function(){this.inputNode.disconnect();this.mainNode.disconnect();this.delayNode.disconnect();this.delayGainNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};q.prototype.getInputNode=function(){return this.inputNode};q.prototype.setParam=function(r,I,O,Q){switch(r){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[2]=I;y(this.wetNode.gain,I,O,Q);y(this.dryNode.gain,1-I,O,Q);break;case 4:this.params[1]=N(I);y(this.delayGainNode.gain,N(I),O,Q);break;case 5:this.params[0]=
I,y(this.delayNode.delayTime,I,O,Q)}};B.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();this.dryNode.connect(r)};B.prototype.remove=function(){this.inputNode.disconnect();this.convolveNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};B.prototype.getInputNode=function(){return this.inputNode};B.prototype.setParam=function(r,I,O,Q){switch(r){case 0:I/=100,0>I&&(I=0),1<I&&(I=1),this.params[1]=I,y(this.wetNode.gain,I,O,Q),
y(this.dryNode.gain,1-I,O,Q)}};A.prototype.connectTo=function(r){this.dryNode.disconnect();this.dryNode.connect(r);this.wetNode.disconnect();this.wetNode.connect(r)};A.prototype.remove=function(){this.inputNode.disconnect();this.delayNode.disconnect();this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect();this.feedbackNode.disconnect()};A.prototype.getInputNode=function(){return this.inputNode};A.prototype.setParam=function(r,I,O,Q){switch(r){case 0:I/=
100;0>I&&(I=0);1<I&&(I=1);this.params[4]=I;y(this.wetNode.gain,I/2,O,Q);y(this.dryNode.gain,1-I/2,O,Q);break;case 6:this.params[1]=I/1E3;y(this.oscGainNode.gain,I/1E3,O,Q);break;case 7:this.params[2]=I;y(this.oscNode.frequency,I,O,Q);break;case 8:this.params[3]=I/100,y(this.feedbackNode.gain,I/100,O,Q)}};h.prototype.connectTo=function(r){this.dryNode.disconnect();this.dryNode.connect(r);this.wetNode.disconnect();this.wetNode.connect(r)};h.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();
this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect()};h.prototype.getInputNode=function(){return this.inputNode};h.prototype.setParam=function(r,I,O,Q){switch(r){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[5]=I;y(this.wetNode.gain,I/2,O,Q);y(this.dryNode.gain,1-I/2,O,Q);break;case 1:this.params[0]=I;y(this.filterNode.frequency,I,O,Q);break;case 2:this.params[1]=I;y(this.filterNode.detune,I,O,Q);break;case 3:this.params[2]=I;y(this.filterNode.Q,
I,O,Q);break;case 6:this.params[3]=I;y(this.oscGainNode.gain,I,O,Q);break;case 7:this.params[4]=I,y(this.oscNode.frequency,I,O,Q)}};n.prototype.connectTo=function(r){this.node.disconnect();this.node.connect(r)};n.prototype.remove=function(){this.node.disconnect()};n.prototype.getInputNode=function(){return this.node};n.prototype.setParam=function(r,I,O,Q){switch(r){case 4:this.params[0]=N(I),y(this.node.gain,N(I),O,Q)}};z.prototype.connectTo=function(r){this.node.disconnect();this.node.connect(r)};
z.prototype.remove=function(){this.oscNode.disconnect();this.oscGainNode.disconnect();this.node.disconnect()};z.prototype.getInputNode=function(){return this.node};z.prototype.setParam=function(r,I,O,Q){switch(r){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[1]=I;y(this.node.gain.value,1-I/2,O,Q);y(this.oscGainNode.gain.value,I/2,O,Q);break;case 7:this.params[0]=I,y(this.oscNode.frequency,I,O,Q)}};P.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();
this.dryNode.connect(r)};P.prototype.remove=function(){this.oscNode.disconnect();this.ringNode.disconnect();this.inputNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};P.prototype.getInputNode=function(){return this.inputNode};P.prototype.setParam=function(r,I,O,Q){switch(r){case 0:I/=100;0>I&&(I=0);1<I&&(I=1);this.params[1]=I;y(this.wetNode.gain,I,O,Q);y(this.dryNode.gain,1-I,O,Q);break;case 7:this.params[0]=I,y(this.oscNode.frequency,I,O,Q)}};V.prototype.setDrive=function(r,
I){.01>r&&(r=.01);this.preGain.gain.value=r;this.postGain.gain.value=Math.pow(1/r,.6)*I};V.prototype.shape=function(r,I,O){O=1.05*O*I-I;var Q=0>r?-r:r;return(Q<I?Q:I+O*(1-Math.exp(-(1/O)*(Q-I))))*(0>r?-1:1)};V.prototype.generateColortouchCurve=function(r,I){r=Math.pow(10,r/20);I=Math.pow(10,I/20);for(var O,Q=0;32768>Q;++Q)O=Q/32768,O=this.shape(O,r,I),this.curve[32768+Q]=O,this.curve[32768-Q-1]=-O};V.prototype.connectTo=function(r){this.wetNode.disconnect();this.wetNode.connect(r);this.dryNode.disconnect();
this.dryNode.connect(r)};V.prototype.remove=function(){this.inputNode.disconnect();this.preGain.disconnect();this.waveShaper.disconnect();this.postGain.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};V.prototype.getInputNode=function(){return this.inputNode};V.prototype.setParam=function(r,I,O,Q){switch(r){case 0:I/=100,0>I&&(I=0),1<I&&(I=1),this.params[4]=I,y(this.wetNode.gain,I,O,Q),y(this.dryNode.gain,1-I,O,Q)}};H.prototype.connectTo=function(r){this.node.disconnect();this.node.connect(r)};
H.prototype.remove=function(){this.node.disconnect()};H.prototype.getInputNode=function(){return this.node};H.prototype.setParam=function(r,I,O,Q){};d.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins);this.node.getByteTimeDomainData(this.signal);for(var r=this.node.fftSize,I=0,O=this.peak=0,Q;I<r;I++)Q=(this.signal[I]-128)/128,0>Q&&(Q=-Q),this.peak<Q&&(this.peak=Q),O+=Q*Q;this.peak=D(this.peak);this.rms=D(Math.sqrt(O/r))};d.prototype.connectTo=function(r){this.node.disconnect();
this.node.connect(r)};d.prototype.remove=function(){this.node.disconnect()};d.prototype.getInputNode=function(){return this.node};d.prototype.setParam=function(r,I,O,Q){};k.prototype.setObject=function(r){this.obj=r};k.prototype.hasObject=function(){return!!this.obj};k.prototype.tick=function(r){};F.prototype.release=function(){var r,I;var O=r=0;for(I=S.length;r<I;++r){var Q=S[r];S[O]=Q;Q.buffer===this?Q.stop():++O}S.length=O;this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=
null);this.outNode&&(this.outNode.disconnect(),this.outNode=null);this.audioData=this.bufferObject=null};F.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var r=this;if(this.needsSoftwareDecode){var I=this.audioData;this.audioData=null;window.OpusDecoder(I,function(O,Q){if(O)r.onDecodeError(O);else O=new Float32Array(Q),Q=K.createBuffer(1,O.length,48E3),Q.getChannelData(0).set(O),r.onDecodeComplete(Q)})}else K.decodeAudioData(this.audioData,function(O){r.onDecodeComplete(O)},
function(O){r.onDecodeError(O)})}};F.prototype.onDecodeComplete=function(r){this.bufferObject=r;this.audioData=null;var I;if(cr.is_undefined(this.playTagWhenReady)||ba)cr.is_undefined(this.convolveWhenReady)||(O=this.convolveWhenReady.convolveNode,O.normalize=this.normalizeWhenReady,O.buffer=r);else if(this.panWhenReady.length){var O=0;for(I=this.panWhenReady.length;O<I;O++){r=this.panWhenReady[O];var Q=new e(this,r.thistag);Q.setPannerEnabled(!0);if("undefined"!==typeof r.objUid&&(r.obj=g.getObjectByUID(r.objUid),
!r.obj))continue;if(r.obj){var aa=cr.rotatePtAround(r.obj.x,r.obj.y,-r.obj.layer.getAngle(),da,ia,!0),ca=cr.rotatePtAround(r.obj.x,r.obj.y,-r.obj.layer.getAngle(),da,ia,!1);Q.setPan(aa,ca,cr.to_degrees(r.obj.angle-r.obj.layer.getAngle()),r.ia,r.oa,r.og);Q.setObject(r.obj)}else Q.setPan(r.x,r.y,r.a,r.ia,r.oa,r.og);Q.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady);this.pauseWhenReady&&Q.pause();S.push(Q)}cr.clearArray(this.panWhenReady)}else Q=new e(this,this.playTagWhenReady||""),
Q.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&Q.pause(),S.push(Q)};F.prototype.onDecodeError=function(r){self.failedToLoad=!0;console.error("Failed to decode audio '"+this.src+"': "+r)};F.prototype.isLoaded=function(){switch(this.myapi){case 0:var r=4<=this.bufferObject.readyState;r&&(this.wasEverReady=!0);return r||this.wasEverReady;case 1:return!!this.audioData||!!this.bufferObject;case 2:return!0}return!1};F.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case 0:return this.isLoaded();
case 1:return!!this.bufferObject;case 2:return!0}return!1};F.prototype.hasFailedToLoad=function(){switch(this.myapi){case 0:return!!this.bufferObject.error;case 1:return this.failedToLoad}return!1};e.prototype.hasEnded=function(){switch(this.myapi){case 0:return this.instanceObject.ended;case 1:return 1===this.buffer.myapi?!this.fresh&&!this.stopped&&this.instanceObject.loop||this.is_paused?!1:this.hasPlaybackEnded:this.instanceObject.ended;case 2:return this.hasPlaybackEnded}return!0};e.prototype.canBeRecycled=
function(){return this.fresh||this.stopped?!0:this.hasEnded()};e.prototype.setPannerEnabled=function(r){1===x&&(!this.pannerEnabled&&r?this.gainNode&&(this.pannerNode||(this.pannerNode=K.createPanner(),this.pannerNode.panningModel="number"===typeof this.pannerNode.panningModel?qa:["equalpower","HRTF","soundfield"][qa],this.pannerNode.distanceModel="number"===typeof this.pannerNode.distanceModel?Ba:["linear","inverse","exponential"][Ba],this.pannerNode.refDistance=Ga,this.pannerNode.maxDistance=Ha,
this.pannerNode.rolloffFactor=Ia),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(f(this.tag)),this.pannerEnabled=!0):this.pannerEnabled&&!r&&this.gainNode&&(this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(f(this.tag)),this.pannerEnabled=!1))};e.prototype.setPan=function(r,I,O,Q,aa,ca){this.pannerEnabled&&1===x&&(this.pannerNode.setPosition(r,I,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(O)),Math.sin(cr.to_radians(O)),
0),this.pannerNode.coneInnerAngle=Q,this.pannerNode.coneOuterAngle=aa,this.pannerNode.coneOuterGain=ca,this.panX=r,this.panY=I,this.panAngle=O,this.panConeInner=Q,this.panConeOuter=aa,this.panConeOuterGain=ca)};e.prototype.setObject=function(r){this.pannerEnabled&&1===x&&(this.objectTracker||(this.objectTracker=new k),this.objectTracker.setObject(r))};e.prototype.tick=function(r){if(this.pannerEnabled&&1===x&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(r);
r=this.objectTracker.obj;var I=cr.rotatePtAround(r.x,r.y,-r.layer.getAngle(),da,ia,!0),O=cr.rotatePtAround(r.x,r.y,-r.layer.getAngle(),da,ia,!1);this.pannerNode.setPosition(I,O,0);"undefined"!==typeof this.objectTracker.obj.angle&&(r=r.angle-r.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(r),Math.sin(r),0))}};e.prototype.play=function(r,I,O,Q){var aa=this.instanceObject;this.looping=r;this.volume=I;O=O||0;Q=Q||0;switch(this.myapi){case 0:1!==aa.playbackRate&&(aa.playbackRate=1);aa.volume!==
I*Z&&(aa.volume=I*Z);aa.loop!==r&&(aa.loop=r);aa.muted&&(aa.muted=!1);if(aa.currentTime!==O)try{aa.currentTime=O}catch(ca){}m(this);break;case 1:this.muted=!1;this.mutevol=1;if(1===this.buffer.myapi)this.gainNode.gain.value=I*Z,this.fresh||(this.instanceObject=K.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=r,this.hasPlaybackEnded=
!1,0===O?l(this.instanceObject,Q):v(this.instanceObject,O,this.getDuration(),Q);else{1!==aa.playbackRate&&(aa.playbackRate=1);aa.loop!==r&&(aa.loop=r);aa.volume=I*Z;if(aa.currentTime!==O)try{aa.currentTime=O}catch(ca){}m(this)}break;case 2:(!this.fresh&&this.stopped||0!==O)&&aa.seekTo(O),aa.play(),this.hasPlaybackEnded=!1}this.playbackRate=1;this.startTime=(this.isTimescaled?g.kahanTime.sum:g.wallTime.sum)-O;this.is_paused=this.stopped=this.fresh=!1};e.prototype.stop=function(){switch(this.myapi){case 0:this.instanceObject.paused||
this.instanceObject.pause();break;case 1:1===this.buffer.myapi?t(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.stop()}this.stopped=!0;this.is_paused=!1};e.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case 0:this.instanceObject.paused||this.instanceObject.pause();break;case 1:1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=
this.getDuration()),this.is_paused=!0,t(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case 2:this.instanceObject.pause()}this.is_paused=!0}};e.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded())&&this.is_paused){switch(this.myapi){case 0:m(this);break;case 1:1===this.buffer.myapi?(this.instanceObject=K.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=
this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=Z*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?g.kahanTime.sum:g.wallTime.sum)-this.resume_position/(this.playbackRate||.001),v(this.instanceObject,this.resume_position,this.getDuration())):m(this);break;case 2:this.instanceObject.play()}this.is_paused=!1}};e.prototype.seek=function(r){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case 0:try{this.instanceObject.currentTime=
r}catch(I){}break;case 1:if(1===this.buffer.myapi)this.is_paused?this.resume_position=r:(this.pause(),this.resume_position=r,this.resume());else try{this.instanceObject.currentTime=r}catch(I){}}};e.prototype.reconnect=function(r){1===this.myapi&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(r)):(this.gainNode.disconnect(),this.gainNode.connect(r)))};e.prototype.getDuration=function(r){var I=0;switch(this.myapi){case 0:"undefined"!==typeof this.instanceObject.duration&&
(I=this.instanceObject.duration);break;case 1:I=this.buffer.bufferObject.duration;break;case 2:I=this.instanceObject.getDuration()}r&&(I/=this.playbackRate||.001);return I};e.prototype.getPlaybackTime=function(r){var I=this.getDuration(),O=0;switch(this.myapi){case 0:"undefined"!==typeof this.instanceObject.currentTime&&(O=this.instanceObject.currentTime);break;case 1:if(1===this.buffer.myapi){if(this.is_paused)return this.resume_position;O=(this.isTimescaled?g.kahanTime.sum:g.wallTime.sum)-this.startTime}else"undefined"!==
typeof this.instanceObject.currentTime&&(O=this.instanceObject.currentTime)}r&&(O*=this.playbackRate);!this.looping&&O>I&&(O=I);return O};e.prototype.isPlaying=function(){return!this.is_paused&&!this.fresh&&!this.stopped&&!this.hasEnded()};e.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()};e.prototype.setVolume=function(r){this.volume=r;this.updateVolume()};e.prototype.updateVolume=function(){var r=this.volume*Z;isFinite(r)||(r=0);switch(this.myapi){case 0:"undefined"!==
typeof this.instanceObject.volume&&this.instanceObject.volume!==r&&(this.instanceObject.volume=r);break;case 1:1===this.buffer.myapi?this.gainNode.gain.value=r*this.mutevol:"undefined"!==typeof this.instanceObject.volume&&this.instanceObject.volume!==r&&(this.instanceObject.volume=r)}};e.prototype.getVolume=function(){return this.volume};e.prototype.doSetMuted=function(r){switch(this.myapi){case 0:this.instanceObject.muted!==!!r&&(this.instanceObject.muted=!!r);break;case 1:1===this.buffer.myapi?
(this.mutevol=r?0:1,this.gainNode.gain.value=Z*this.volume*this.mutevol):this.instanceObject.muted!==!!r&&(this.instanceObject.muted=!!r)}};e.prototype.setMuted=function(r){this.is_muted=!!r;this.doSetMuted(this.is_muted||this.is_silent)};e.prototype.setSilent=function(r){this.is_silent=!!r;this.doSetMuted(this.is_muted||this.is_silent)};e.prototype.setLooping=function(r){this.looping=r;switch(this.myapi){case 0:this.instanceObject.loop!==!!r&&(this.instanceObject.loop=!!r);break;case 1:this.instanceObject.loop!==
!!r&&(this.instanceObject.loop=!!r)}};e.prototype.setPlaybackRate=function(r){this.playbackRate=r;this.updatePlaybackRate()};e.prototype.getPlaybackRate=function(r){return this.playbackRate};e.prototype.updatePlaybackRate=function(){var r=this.playbackRate;this.isTimescaled&&(r*=g.timescale);switch(this.myapi){case 0:this.instanceObject.playbackRate!==r&&(this.instanceObject.playbackRate=r);break;case 1:1===this.buffer.myapi?this.instanceObject.playbackRate.value!==r&&(this.instanceObject.playbackRate.value=
r):this.instanceObject.playbackRate!==r&&(this.instanceObject.playbackRate=r)}};e.prototype.setSuspended=function(r){switch(this.myapi){case 0:r?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case 1:r?this.isPlaying()?(this.resume_me=!0,1===this.buffer.myapi?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=this.getDuration()),t(this.instanceObject)):this.instanceObject.pause()):
this.resume_me=!1:this.resume_me&&(1===this.buffer.myapi?(this.instanceObject=K.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=Z*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?g.kahanTime.sum:g.wallTime.sum)-this.resume_position/(this.playbackRate||
.001),v(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case 2:r?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play())}};ha.Instance=function(r){this.type=r;g=this.runtime=r.runtime;p=this;this.listenerTracker=null;this.listenerZ=-600;this.runtime.isWKWebView&&(ya=!0);!(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))||
this.runtime.isCrosswalk||this.runtime.isAmazonWebApp||ya||(Ca=!0);K=null;"undefined"!==typeof AudioContext?(x=1,K=new AudioContext):"undefined"!==typeof webkitAudioContext&&(x=1,K=new webkitAudioContext);this.runtime.isiOS&&K&&(K.close&&K.close(),"undefined"!==typeof AudioContext?K=new AudioContext:"undefined"!==typeof webkitAudioContext&&(K=new webkitAudioContext));1!==x&&this.runtime.isCordova&&"undefined"!==typeof window.Media&&(x=2);2===x&&(G=location.href,r=G.lastIndexOf("/"),-1<r&&(G=G.substr(0,
r+1)),G=G.replace("file://",""));this.runtime.tickMe(this)};var ra=ha.Instance.prototype;ra.onCreate=function(){this.runtime.audioInstance=this;fa=this.properties[0];this.saveload=this.properties[1];this.playinbackground=this.properties[2];this.nextPlayTime=0;qa=this.properties[4];Ba=this.properties[5];this.listenerZ=-this.properties[6];Ga=this.properties[7];Ha=this.properties[8];Ia=this.properties[9];this.listenerTracker=new k;var r=this.runtime.draw_width||this.runtime.width,I=this.runtime.draw_height||
this.runtime.height;1===x&&(K.listener.setPosition(r/2,I/2,this.listenerZ),K.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(Q,aa){ua&&ua.disconnect();Aa=aa.toLowerCase();ua=K.createMediaStreamSource(Q);ua.connect(f(Aa))});this.runtime.addSuspendCallback(function(Q){p.onSuspend(Q)});var O=this;this.runtime.addDestroyCallback(function(Q){O.onInstanceDestroyed(Q)})};ra.onInstanceDestroyed=function(r){var I;var O=0;for(I=S.length;O<I;O++){var Q=S[O];Q.objectTracker&&Q.objectTracker.obj===
r&&(Q.objectTracker.obj=null,Q.pannerEnabled&&Q.isPlaying()&&Q.looping&&Q.stop())}this.listenerTracker.obj===r&&(this.listenerTracker.obj=null)};ra.saveToJSON=function(){var r={silent:ba,masterVolume:Z,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},I=r.playing,O,Q;var aa=0;for(O=S.length;aa<O;aa++){var ca=S[aa];if(ca.shouldSave()&&3!==this.saveload&&(!ca.is_music||1!==this.saveload)&&(ca.is_music||2!==this.saveload)){var la=
ca.getPlaybackTime();ca.looping&&(la%=ca.getDuration());la={tag:ca.tag,buffersrc:ca.buffer.src,buffertype:ca.buffer.type,is_music:ca.is_music,playbackTime:la,volume:ca.volume,looping:ca.looping,muted:ca.is_muted,playbackRate:ca.playbackRate,paused:ca.is_paused,resume_position:ca.resume_position};if(ca.pannerEnabled){la.pan={};var ma=la.pan;ca.objectTracker&&ca.objectTracker.hasObject()?ma.objUid=ca.objectTracker.obj.uid:(ma.x=ca.panX,ma.y=ca.panY,ma.a=ca.panAngle);ma.ia=ca.panConeInner;ma.oa=ca.panConeOuter;
ma.og=ca.panConeOuterGain}I.push(la)}}I=r.effects;for(Q in oa)if(oa.hasOwnProperty(Q)){ca=[];aa=0;for(O=oa[Q].length;aa<O;aa++)ca.push({type:oa[Q][aa].type,params:oa[Q][aa].params});I[Q]=ca}return r};var va=[];ra.loadFromJSON=function(r){var I=r.silent;Z=r.masterVolume;this.listenerZ=r.listenerZ;this.listenerTracker.setObject(null);var O=r.listenerUid;-1!==O&&(this.listenerTracker.loadUid=O,va.push(this.listenerTracker));O=r.playing;var Q;if(3!==this.saveload){var aa=0;for(Q=S.length;aa<Q;aa++){var ca=
S[aa];ca.is_music&&1===this.saveload||(ca.is_music||2!==this.saveload)&&ca.stop()}}for(pa in oa)if(oa.hasOwnProperty(pa))for(aa=0,Q=oa[pa].length;aa<Q;aa++)oa[pa][aa].remove();cr.wipe(oa);for(pa in r.effects)if(r.effects.hasOwnProperty(pa)){var la=r.effects[pa];aa=0;for(Q=la.length;aa<Q;aa++){var ma=la[aa].type;var ja=la[aa].params;switch(ma){case "filter":U(pa,new L(ja[0],ja[1],ja[2],ja[3],ja[4],ja[5]));break;case "delay":U(pa,new q(ja[0],ja[1],ja[2]));break;case "convolve":ma=ja[2];ca=this.getAudioBuffer(ma,
!1);ca.bufferObject?ma=new B(ca.bufferObject,ja[0],ja[1],ma):(ma=new B(null,ja[0],ja[1],ma),ca.normalizeWhenReady=ja[0],ca.convolveWhenReady=ma);U(pa,ma);break;case "flanger":U(pa,new A(ja[0],ja[1],ja[2],ja[3],ja[4]));break;case "phaser":U(pa,new h(ja[0],ja[1],ja[2],ja[3],ja[4],ja[5]));break;case "gain":U(pa,new n(ja[0]));break;case "tremolo":U(pa,new z(ja[0],ja[1]));break;case "ringmod":U(pa,new P(ja[0],ja[1]));break;case "distortion":U(pa,new V(ja[0],ja[1],ja[2],ja[3],ja[4]));break;case "compressor":U(pa,
new H(ja[0],ja[1],ja[2],ja[3],ja[4]));break;case "analyser":U(pa,new d(ja[0],ja[1]))}}}aa=0;for(Q=O.length;aa<Q;aa++)if(3!==this.saveload){r=O[aa];ma=r.buffersrc;ca=r.buffertype||"";var sa=r.is_music;var pa=r.tag;la=r.playbackTime;var Ja=r.looping;var Ka=r.volume;var za=(ja=r.pan)&&ja.hasOwnProperty("objUid")?ja.objUid:-1;if(!sa||1!==this.saveload)if(sa||2!==this.saveload)(ca=this.getAudioInstance({url:ma,type:ca},pa,sa,Ja,Ka))?(ca.resume_position=r.resume_position,ca.setPannerEnabled(!!ja),ca.play(Ja,
Ka,la),ca.updatePlaybackRate(),ca.updateVolume(),ca.doSetMuted(ca.is_muted||ca.is_silent),r.paused&&ca.pause(),r.muted&&ca.setMuted(!0),ca.doSetMuted(ca.is_muted||ca.is_silent),ja&&(-1!==za?(ca.objectTracker=ca.objectTracker||new k,ca.objectTracker.loadUid=za,va.push(ca.objectTracker)):ca.setPan(ja.x,ja.y,ja.a,ja.ia,ja.oa,ja.og))):(ca=this.getAudioBuffer({url:ma,type:""},sa),ca.seekWhenReady=la,ca.pauseWhenReady=r.paused,ja&&(-1!==za?ca.panWhenReady.push({objUid:za,ia:ja.ia,oa:ja.oa,og:ja.og,thistag:pa}):
ca.panWhenReady.push({x:ja.x,y:ja.y,a:ja.a,ia:ja.ia,oa:ja.oa,og:ja.og,thistag:pa})))}if(I&&!ba){aa=0;for(Q=S.length;aa<Q;aa++)S[aa].setSilent(!0);ba=!0}else if(!I&&ba){aa=0;for(Q=S.length;aa<Q;aa++)S[aa].setSilent(!1);ba=!1}};ra.afterLoad=function(){var r;var I=0;for(r=va.length;I<r;I++){var O=va[I];var Q=this.runtime.getObjectByUID(O.loadUid);O.setObject(Q);O.loadUid=-1;Q&&(da=Q.x,ia=Q.y)}cr.clearArray(va)};ra.onSuspend=function(r){if(!this.playinbackground){!r&&K&&K.resume&&(K.resume(),ka=!1);var I;
var O=0;for(I=S.length;O<I;O++)S[O].setSuspended(r);r&&K&&K.suspend&&(K.suspend(),ka=!0)}};ra.tick=function(){var r=this.runtime.dt,I;var O=0;for(I=S.length;O<I;O++){var Q=S[O];Q.tick(r);0!==fa&&Q.updatePlaybackRate()}var aa;for(aa in oa)if(oa.hasOwnProperty(aa))for(Q=oa[aa],O=0,I=Q.length;O<I;O++){var ca=Q[O];ca.tick&&ca.tick()}1===x&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(r),da=this.listenerTracker.obj.x,ia=this.listenerTracker.obj.y,K.listener.setPosition(this.listenerTracker.obj.x,
this.listenerTracker.obj.y,this.listenerZ))};var wa=[];ra.setPreloadList=function(r){var I,O=0;var Q=0;for(I=r.length;Q<I;++Q){var aa=r[Q];var ca=2*aa.size;wa.push({filename:aa.filename,size:ca,type:aa.type,obj:null});O+=ca}return O};ra.startPreloads=function(){var r;var I=0;for(r=wa.length;I<r;++I){var O=wa[I];var Q=this.runtime.getProjectFileUrl(O.filename);O.obj=this.getAudioBuffer({url:Q,type:O.type},!1)}};ra.getPreloadedSize=function(){var r=0,I;var O=0;for(I=wa.length;O<I;++O){var Q=wa[O];Q.obj.isLoadedAndDecoded()||
Q.obj.hasFailedToLoad()||this.runtime.isAndroidStockBrowser?r+=Q.size:Q.obj.isLoaded()&&(r+=Math.floor(Q.size/2))}return r};ra.releaseAllMusicBuffers=function(){var r,I;var O=r=0;for(I=R.length;r<I;++r){var Q=R[r];R[O]=Q;Q.is_music?Q.release():++O}R.length=O};ra.getAudioBuffer=function(r,I,O){var Q,aa=null,ca=r.url;var la=0;for(Q=R.length;la<Q;la++){var ma=R[la];if(ma.src===ca){aa=ma;break}}aa||O||((ya||Fa)&&I&&this.releaseAllMusicBuffers(),aa=new F(ca,r.type,I),R.push(aa));return aa};ra.getAudioInstance=
function(r,I,O,Q,aa){var ca,la=r.url;var ma=0;for(ca=S.length;ma<ca;ma++){var ja=S[ma];if(ja.src===la&&(ja.canBeRecycled()||O))return ja.tag=I,ja}r=this.getAudioBuffer(r,O);if(!r.bufferObject)return"<preload>"!==I&&(r.playTagWhenReady=I,r.loopWhenReady=Q,r.volumeWhenReady=aa),null;ja=new e(r,I);S.push(ja);return ja};var na=[];W.prototype.OnEnded=function(r){return cr.equals_nocase(C,r)};W.prototype.PreloadsComplete=function(){var r;var I=0;for(r=R.length;I<r;I++)if(!R[I].isLoadedAndDecoded()&&!R[I].hasFailedToLoad())return!1;
return!0};W.prototype.AdvancedAudioSupported=function(){return 1===x};W.prototype.IsSilent=function(){return ba};W.prototype.IsAnyPlaying=function(){var r;var I=0;for(r=S.length;I<r;I++)if(S[I].isPlaying())return!0;return!1};W.prototype.IsTagPlaying=function(r){J(r);var I;r=0;for(I=na.length;r<I;r++)if(na[r].isPlaying())return!0;return!1};ha.cnds=new W;X.prototype.Play=function(r,I,O,Q){if(!ba){O=N(O);var aa=r[1];if(r=this.runtime.getProjectAudioFileUrl(r[0]))if(T=this.getAudioInstance(r,Q,aa,0!==
I,O))T.setPannerEnabled(!1),T.play(0!==I,O,0,this.nextPlayTime),this.nextPlayTime=0}};X.prototype.PlayAtPosition=function(r,I,O,Q,aa,ca,la,ma,ja,sa){if(!ba){O=N(O);var pa=r[1];if(r=this.runtime.getProjectAudioFileUrl(r[0]))(T=this.getAudioInstance(r,sa,pa,0!==I,O))?(T.setPannerEnabled(!0),T.setPan(Q,aa,ca,la,ma,N(ja)),T.play(0!==I,O,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(r,pa).panWhenReady.push({x:Q,y:aa,a:ca,ia:la,oa:ma,og:N(ja),thistag:sa})}};X.prototype.PlayAtObject=function(r,
I,O,Q,aa,ca,la,ma){if(!ba&&Q&&(Q=Q.getFirstPicked())){O=N(O);var ja=r[1];if(r=this.runtime.getProjectAudioFileUrl(r[0]))(T=this.getAudioInstance(r,ma,ja,0!==I,O))?(T.setPannerEnabled(!0),ma=cr.rotatePtAround(Q.x,Q.y,-Q.layer.getAngle(),da,ia,!0),r=cr.rotatePtAround(Q.x,Q.y,-Q.layer.getAngle(),da,ia,!1),T.setPan(ma,r,cr.to_degrees(Q.angle-Q.layer.getAngle()),aa,ca,N(la)),T.setObject(Q),T.play(0!==I,O,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(r,ja).panWhenReady.push({obj:Q,ia:aa,
oa:ca,og:N(la),thistag:ma})}};X.prototype.PlayByName=function(r,I,O,Q,aa){!ba&&(Q=N(Q),r=1===r,I=this.runtime.getProjectAudioFileUrl(I))&&(T=this.getAudioInstance(I,aa,r,0!==O,Q))&&(T.setPannerEnabled(!1),T.play(0!==O,Q,0,this.nextPlayTime),this.nextPlayTime=0)};X.prototype.PlayAtPositionByName=function(r,I,O,Q,aa,ca,la,ma,ja,sa,pa){!ba&&(Q=N(Q),r=1===r,I=this.runtime.getProjectAudioFileUrl(I))&&((T=this.getAudioInstance(I,pa,r,0!==O,Q))?(T.setPannerEnabled(!0),T.setPan(aa,ca,la,ma,ja,N(sa)),T.play(0!==
O,Q,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(I,r).panWhenReady.push({x:aa,y:ca,a:la,ia:ma,oa:ja,og:N(sa),thistag:pa}))};X.prototype.PlayAtObjectByName=function(r,I,O,Q,aa,ca,la,ma,ja){!ba&&aa&&(aa=aa.getFirstPicked())&&(Q=N(Q),r=1===r,I=this.runtime.getProjectAudioFileUrl(I))&&((T=this.getAudioInstance(I,ja,r,0!==O,Q))?(T.setPannerEnabled(!0),ja=cr.rotatePtAround(aa.x,aa.y,-aa.layer.getAngle(),da,ia,!0),I=cr.rotatePtAround(aa.x,aa.y,-aa.layer.getAngle(),da,ia,!1),T.setPan(ja,
I,cr.to_degrees(aa.angle-aa.layer.getAngle()),ca,la,N(ma)),T.setObject(aa),T.play(0!==O,Q,0,this.nextPlayTime),this.nextPlayTime=0):this.getAudioBuffer(I,r).panWhenReady.push({obj:aa,ia:ca,oa:la,og:N(ma),thistag:ja}))};X.prototype.SetLooping=function(r,I){J(r);var O;r=0;for(O=na.length;r<O;r++)na[r].setLooping(0===I)};X.prototype.SetMuted=function(r,I){J(r);var O;r=0;for(O=na.length;r<O;r++)na[r].setMuted(0===I)};X.prototype.SetVolume=function(r,I){J(r);r=N(I);var O;I=0;for(O=na.length;I<O;I++)na[I].setVolume(r)};
X.prototype.Preload=function(r){if(!ba){var I=r[1];(r=this.runtime.getProjectAudioFileUrl(r[0]))&&2!==x&&this.getAudioInstance(r,"<preload>",I,!1)}};X.prototype.PreloadByName=function(r,I){ba||(r=1===r,(I=this.runtime.getProjectAudioFileUrl(I))&&2!==x&&this.getAudioInstance(I,"<preload>",r,!1))};X.prototype.SetPlaybackRate=function(r,I){J(r);0>I&&(I=0);var O;r=0;for(O=na.length;r<O;r++)na[r].setPlaybackRate(I)};X.prototype.Stop=function(r){J(r);var I;r=0;for(I=na.length;r<I;r++)na[r].stop()};X.prototype.StopAll=
function(){var r;var I=0;for(r=S.length;I<r;I++)S[I].stop()};X.prototype.SetPaused=function(r,I){J(r);var O;r=0;for(O=na.length;r<O;r++)0===I?na[r].pause():na[r].resume()};X.prototype.Seek=function(r,I){J(r);var O;r=0;for(O=na.length;r<O;r++)na[r].seek(I)};X.prototype.SetSilent=function(r){var I;2===r&&(r=ba?1:0);if(0===r&&!ba){r=0;for(I=S.length;r<I;r++)S[r].setSilent(!0);ba=!0}else if(1===r&&ba){r=0;for(I=S.length;r<I;r++)S[r].setSilent(!1);ba=!1}};X.prototype.SetMasterVolume=function(r){Z=N(r);
var I;r=0;for(I=S.length;r<I;r++)S[r].updateVolume()};X.prototype.AddFilterEffect=function(r,I,O,Q,aa,ca,la){1!==x||0>I||I>=Ea.length||!K.createBiquadFilter||(r=r.toLowerCase(),la/=100,0>la&&(la=0),1<la&&(la=1),U(r,new L(I,O,Q,aa,ca,la)))};X.prototype.AddDelayEffect=function(r,I,O,Q){1===x&&(r=r.toLowerCase(),Q/=100,0>Q&&(Q=0),1<Q&&(Q=1),U(r,new q(I,N(O),Q)))};X.prototype.AddFlangerEffect=function(r,I,O,Q,aa,ca){1===x&&K.createOscillator&&(r=r.toLowerCase(),ca/=100,0>ca&&(ca=0),1<ca&&(ca=1),U(r,new A(I/
1E3,O/1E3,Q,aa/100,ca)))};X.prototype.AddPhaserEffect=function(r,I,O,Q,aa,ca,la){1===x&&K.createOscillator&&(r=r.toLowerCase(),la/=100,0>la&&(la=0),1<la&&(la=1),U(r,new h(I,O,Q,aa,ca,la)))};X.prototype.AddConvolutionEffect=function(r,I,O,Q){if(1===x&&K.createConvolver){O=0===O;var aa=this.runtime.getProjectAudioFileUrl(I[0]);aa&&(I=this.getAudioBuffer(aa,!1),r=r.toLowerCase(),Q/=100,0>Q&&(Q=0),1<Q&&(Q=1),I.bufferObject?Q=new B(I.bufferObject,O,Q,aa.url):(Q=new B(null,O,Q,aa.url),I.normalizeWhenReady=
O,I.convolveWhenReady=Q),U(r,Q))}};X.prototype.AddGainEffect=function(r,I){1===x&&(r=r.toLowerCase(),U(r,new n(N(I))))};X.prototype.AddMuteEffect=function(r){1===x&&(r=r.toLowerCase(),U(r,new n(0)))};X.prototype.AddTremoloEffect=function(r,I,O){1===x&&K.createOscillator&&(r=r.toLowerCase(),O/=100,0>O&&(O=0),1<O&&(O=1),U(r,new z(I,O)))};X.prototype.AddRingModEffect=function(r,I,O){1===x&&K.createOscillator&&(r=r.toLowerCase(),O/=100,0>O&&(O=0),1<O&&(O=1),U(r,new P(I,O)))};X.prototype.AddDistortionEffect=
function(r,I,O,Q,aa,ca){1===x&&K.createWaveShaper&&(r=r.toLowerCase(),ca/=100,0>ca&&(ca=0),1<ca&&(ca=1),U(r,new V(I,O,Q,aa,ca)))};X.prototype.AddCompressorEffect=function(r,I,O,Q,aa,ca){1===x&&K.createDynamicsCompressor&&(r=r.toLowerCase(),U(r,new H(I,O,Q,aa/1E3,ca/1E3)))};X.prototype.AddAnalyserEffect=function(r,I,O){1===x&&(r=r.toLowerCase(),U(r,new d(I,O)))};X.prototype.RemoveEffects=function(r){if(1===x){r=r.toLowerCase();var I;if(oa.hasOwnProperty(r)){var O=oa[r];if(O.length){var Q=0;for(I=O.length;Q<
I;Q++)O[Q].remove();cr.clearArray(O);M(r)}}}};X.prototype.SetEffectParameter=function(r,I,O,Q,aa,ca){1===x&&(r=r.toLowerCase(),I=Math.floor(I),oa.hasOwnProperty(r)&&(r=oa[r],0>I||I>=r.length||r[I].setParam(O,Q,aa,ca)))};X.prototype.SetListenerObject=function(r){r&&1===x&&(r=r.getFirstPicked())&&(this.listenerTracker.setObject(r),da=r.x,ia=r.y)};X.prototype.SetListenerZ=function(r){this.listenerZ=r};X.prototype.ScheduleNextPlay=function(r){K&&(this.nextPlayTime=r)};X.prototype.UnloadAudio=function(r){var I=
r[1];if(r=this.runtime.getProjectAudioFileUrl(r[0]))if(I=this.getAudioBuffer(r,I,!0))I.release(),cr.arrayFindRemove(R,I)};X.prototype.UnloadAudioByName=function(r,I){r=1===r;if(I=this.runtime.getProjectAudioFileUrl(I))if(I=this.getAudioBuffer(I,r,!0))I.release(),cr.arrayFindRemove(R,I)};X.prototype.UnloadAll=function(){var r;var I=0;for(r=R.length;I<r;++I)R[I].release();cr.clearArray(R)};ha.acts=new X;Y.prototype.Duration=function(r,I){J(I,!0);na.length?r.set_float(na[0].getDuration()):r.set_float(0)};
Y.prototype.PlaybackTime=function(r,I){J(I,!0);na.length?r.set_float(na[0].getPlaybackTime(!0)):r.set_float(0)};Y.prototype.PlaybackRate=function(r,I){J(I,!0);na.length?r.set_float(na[0].getPlaybackRate()):r.set_float(0)};Y.prototype.Volume=function(r,I){J(I,!0);na.length?(I=na[0].getVolume(),r.set_float(D(I))):r.set_float(0)};Y.prototype.MasterVolume=function(r){r.set_float(D(Z))};Y.prototype.EffectCount=function(r,I){I=I.toLowerCase();var O=null;oa.hasOwnProperty(I)&&(O=oa[I]);r.set_int(O?O.length:
0)};Y.prototype.AnalyserFreqBinCount=function(r,I,O){I=I.toLowerCase();O=Math.floor(O);I=ea(I,O);r.set_int(I?I.node.frequencyBinCount:0)};Y.prototype.AnalyserFreqBinAt=function(r,I,O,Q){I=I.toLowerCase();O=Math.floor(O);Q=Math.floor(Q);(I=ea(I,O))?0>Q||Q>=I.node.frequencyBinCount?r.set_float(0):r.set_float(I.freqBins[Q]):r.set_float(0)};Y.prototype.AnalyserPeakLevel=function(r,I,O){I=I.toLowerCase();O=Math.floor(O);(I=ea(I,O))?r.set_float(I.peak):r.set_float(0)};Y.prototype.AnalyserRMSLevel=function(r,
I,O){I=I.toLowerCase();O=Math.floor(O);(I=ea(I,O))?r.set_float(I.rms):r.set_float(0)};Y.prototype.SampleRate=function(r){r.set_int(K?K.sampleRate:0)};Y.prototype.CurrentTime=function(r){r.set_float(K?K.currentTime:cr.performance_now())};ha.exps=new Y})();cr.plugins_.Spritefont2=function(b){this.runtime=b};
(function(){function b(q,B){return q.length?q.pop():new B}function m(q,B,A){if(A){var h;A=0;for(h=B.length;A<h;A++)q.length<c&&q.push(B[A]);cr.clearArray(B)}else for(h in B)Object.prototype.hasOwnProperty.call(B,h)&&(q.length<c&&q.push(B[h]),delete B[h])}function w(q,B,A){var h=q.lines;A=A.replace(/\s\s*$/,"");B>=h.length&&h.push(b(l,Object));B=h[B];B.text=A;B.width=q.measureWidth(A);q.textWidth=cr.max(q.textWidth,B.width)}function E(){}function N(){}function D(){}var f=cr.plugins_.Spritefont2.prototype;
f.onCreate=function(){};f.Type=function(q){this.plugin=q;this.runtime=q.runtime};var a=f.Type.prototype;a.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.spriteX=this.texture_data[3],this.spriteY=
this.texture_data[4],this.spriteWidth=this.texture_data[5],this.spriteHeight=this.texture_data[6],this.webGL_texture=null)};a.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};a.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat));var q;var B=0;for(q=this.instances.length;B<q;B++)this.instances[B].webGL_texture=
this.webGL_texture}};a.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};a.preloadCanvas2D=function(q){q.drawImage(this.texture_img,0,0)};f.Instance=function(q){this.type=q;this.runtime=q.runtime};a=f.Instance.prototype;a.onDestroy=function(){m(l,this.lines,!0);m(v,this.clipList,!1);m(t,this.clipUV,!1);cr.wipe(this.characterWidthList)};a.onCreate=function(){this.texture_img=this.type.texture_img;
this.text=this.properties[0];this.characterWidth=this.properties[2];this.characterHeight=this.properties[3];this.characterSet=this.properties[4];var q=this.properties[5];this.characterScale=this.properties[6];this.characterSpacing=this.properties[7];this.lineHeight=this.properties[8];this.halign=this.properties[9]/2;this.valign=this.properties[10]/2;this.wrapbyword=0===this.properties[11];this.visible=this.properties[12];this.textHeight=this.textWidth=0;this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),
cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={});this.text_changed=!0;this.lastwrapwidth=this.width;this.runtime.glwrap&&(this.type.webGL_texture||(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture);this.LoadCharacterSpacingData(q);this.SplitSheet()};a.saveToJSON=function(){var q={t:this.text,
csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}},B;for(B in this.characterWidthList)q.cw[B]=this.characterWidthList[B];return q};a.loadFromJSON=function(q){this.text=q.t;this.characterScale=q.csc;this.characterSpacing=q.csp;this.lineHeight=q.lh;this.textWidth=q.tw;this.textHeight=q.th;this.last_render_tick=q.lrt;q.hasOwnProperty("ha")&&(this.halign=q.ha);q.hasOwnProperty("va")&&
(this.valign=q.va);for(var B in q.cw)this.characterWidthList[B]=q.cw[B];this.text_changed=!0;this.lastwrapwidth=this.width};var c=1E3,l=[],v=[],t=[];a.SplitSheet=function(){var q=this.texture_img.width,B=this.texture_img.height,A=this.type.spriteX,h=this.type.spriteY,n=this.characterWidth,z=this.characterHeight,P=A/q,V=h/B;q=n/q;B=z/B;for(var H=this.characterSet,d=Math.floor(this.type.spriteWidth/n),k=Math.floor(this.type.spriteHeight/z),F=0;F<H.length&&!(F>=d*k);F++){var e=F%d,u=Math.floor(F/d),
J=H.charAt(F);if(this.runtime.glwrap){var M=this.clipUV,U=e*q+P,W=u*B+V;e=(e+1)*q+P;u=(u+1)*B+V;void 0===M[J]&&(M[J]=b(t,cr.rect));M[J].left=U;M[J].top=W;M[J].right=e;M[J].bottom=u}else M=this.clipList,e=e*n+A,u=u*z+h,U=n,W=z,void 0===M[J]&&(M[J]=b(v,Object)),M[J].x=e,M[J].y=u,M[J].w=U,M[J].h=W}};var y=[];f.TokeniseWords=function(q){cr.clearArray(y);for(var B="",A,h=0;h<q.length;)if(A=q.charAt(h),"\n"===A)B.length&&(y.push(B),B=""),y.push("\n"),++h;else if(" "===A||"\t"===A||"-"===A){do B+=q.charAt(h),
h++;while(h<q.length&&(" "===q.charAt(h)||"\t"===q.charAt(h)));y.push(B);B=""}else h<q.length&&(B+=A,h++);B.length&&y.push(B)};f.WordWrap=function(q){var B=q.text,A=q.lines;if(B&&B.length){var h=q.width;if(2>=h)m(l,A,!0);else{var n=q.characterScale,z=q.characterSpacing;if(B.length*(q.characterWidth*n+z)-z<=h&&-1===B.indexOf("\n")&&(z=q.measureWidth(B),z<=h)){m(l,A,!0);A.push(b(l,Object));A[0].text=B;A[0].width=z;q.textWidth=z;q.textHeight=q.characterHeight*n+q.lineHeight;return}this.WrapText(q);q.textHeight=
A.length*(q.characterHeight*n+q.lineHeight)}}else m(l,A,!0)};f.WrapText=function(q){var B=q.wrapbyword,A=q.text,h=q.lines,n=q.width;B&&(this.TokeniseWords(A),A=y);var z="",P,V=0,H=!1;for(P=0;P<A.length;P++)if("\n"===A[P])!0===H?H=!1:(w(q,V,z),V++),z="";else{H=!1;var d=z;z+=A[P];var k=q.measureWidth(z.replace(/\s\s*$/,""));k>n&&(""===d?(w(q,V,z),z="",H=!0):(w(q,V,d),z=A[P]),V++,B||" "!==z||(z=""))}z.replace(/\s\s*$/,"").length&&(w(q,V,z),V++);for(P=V;P<h.length;P++)l.length<c&&l.push(h[P]);h.length=
V};a.measureWidth=function(q){for(var B=this.characterSpacing,A=q.length,h=0,n=0;n<A;n++)h+=this.getCharacterWidth(q.charAt(n))*this.characterScale+B;return h-(0<h?B:0)};a.getCharacterWidth=function(q){var B=this.characterWidthList;return void 0!==B[q]?B[q]:this.characterWidth};a.rebuildText=function(){if(this.text_changed||this.width!==this.lastwrapwidth)this.textHeight=this.textWidth=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width};a.draw=function(q,B){B=this.texture_img;
if(""!==this.text&&null!=B&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){q.globalAlpha=this.opacity;B=this.x;var A=this.y;this.runtime.pixel_rounding&&(B=Math.round(B),A=Math.round(A));var h=this.layer.viewLeft,n=this.layer.viewTop,z=this.layer.viewRight,P=this.layer.viewBottom;q.save();q.translate(B,A);q.rotate(this.angle);var V=this.angle,H=this.halign,d=this.characterScale,k=this.characterHeight*d,F=this.lineHeight,e=this.characterSpacing,u=this.lines,
J=this.valign*cr.max(0,this.height-this.textHeight),M=-(this.hotspotX*this.width);J=-(this.hotspotY*this.height)+J;for(var U,W,X=0;X<u.length;X++){var Y=u[X].text;var ea=H*cr.max(0,this.width-u[X].width);var ha=M+ea;J+=F;if(0===V&&A+J+k<n)J+=k;else{for(var g=0;g<Y.length;g++){U=Y.charAt(g);ea=this.getCharacterWidth(U);var p=this.clipList[U];if(0===V&&B+ha+ea*d+e<h)ha+=ea*d+e;else{if(ha+ea*d>this.width+1E-5)break;void 0!==p&&(U=ha,W=J,0===V&&1===d&&(U=Math.round(U),W=Math.round(W)),q.drawImage(this.texture_img,
p.x,p.y,p.w,p.h,U,W,p.w*d,p.h*d));ha+=ea*d+e;if(0===V&&B+ha>z)break}}J+=k;if(0===V&&(J+k+F>this.height||A+J>P))break}}q.restore()}};var L=new cr.quad;a.drawGL=function(q){q.setTexture(this.webGL_texture);q.setOpacity(this.opacity);if(this.text&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var B=this.bquad,A=0,h=0;this.runtime.pixel_rounding&&(A=Math.round(this.x)-this.x,h=Math.round(this.y)-this.y);var n=this.layer.viewLeft,z=this.layer.viewTop,
P=this.layer.viewRight,V=this.layer.viewBottom,H=this.angle,d=this.halign,k=this.valign,F=this.characterScale,e=this.characterHeight*F,u=this.lineHeight,J=this.characterSpacing,M=this.lines,U=this.textHeight,W;if(0!==H){var X=Math.cos(H);var Y=Math.sin(H)}k*=cr.max(0,this.height-U);A=B.tlx+A;B=B.tly+h;h=k;for(k=0;k<M.length;k++){U=M[k].text;var ea=W=d*cr.max(0,this.width-M[k].width);h+=u;if(0===H&&B+h+e<z)h+=e;else{for(var ha=0;ha<U.length;ha++){var g=U.charAt(ha);W=this.getCharacterWidth(g);g=this.clipUV[g];
if(0===H&&A+ea+W*F+J<n)ea+=W*F+J;else{if(ea+W*F>this.width+1E-5)break;if(void 0!==g){var p=this.characterWidth*F,C=this.characterHeight*F;var G=ea;var x=h;0===H&&1===F&&(G=Math.round(G),x=Math.round(x));L.tlx=G;L.tly=x;L.trx=G+p;L.try_=x;L.blx=G;L.bly=x+C;L.brx=G+p;L.bry=x+C;0!==H&&(x=L,p=X,C=Y,G=x.tlx*p-x.tly*C,x.tly=x.tly*p+x.tlx*C,x.tlx=G,G=x.trx*p-x.try_*C,x.try_=x.try_*p+x.trx*C,x.trx=G,G=x.blx*p-x.bly*C,x.bly=x.bly*p+x.blx*C,x.blx=G,G=x.brx*p-x.bry*C,x.bry=x.bry*p+x.brx*C,x.brx=G);L.offset(A,
B);q.quadTex(L.tlx,L.tly,L.trx,L.try_,L.brx,L.bry,L.blx,L.bly,g)}ea+=W*F+J;if(0===H&&A+ea>P)break}}h+=e;if(0===H&&(h+e+u>this.height||B+h>V))break}}}};E.prototype.CompareText=function(q,B){return B?this.text==q:cr.equals_nocase(this.text,q)};f.cnds=new E;N.prototype.SetText=function(q){cr.is_number(q)&&1E9>q&&(q=Math.round(1E10*q)/1E10);q=q.toString();this.text!==q&&(this.text=q,this.text_changed=!0,this.runtime.redraw=!0)};N.prototype.AppendText=function(q){cr.is_number(q)&&(q=Math.round(1E10*q)/
1E10);if(q=q.toString())this.text+=q,this.text_changed=!0,this.runtime.redraw=!0};N.prototype.SetScale=function(q){q!==this.characterScale&&(this.characterScale=q,this.text_changed=!0,this.runtime.redraw=!0)};N.prototype.SetCharacterSpacing=function(q){q!==this.CharacterSpacing&&(this.characterSpacing=q,this.text_changed=!0,this.runtime.redraw=!0)};N.prototype.SetLineHeight=function(q){q!==this.lineHeight&&(this.lineHeight=q,this.text_changed=!0,this.runtime.redraw=!0)};a.SetCharWidth=function(q,
B){B=parseInt(B,10);this.characterWidthList[q]!==B&&(this.characterWidthList[q]=B,this.text_changed=!0,this.runtime.redraw=!0)};a.LoadCharacterSpacingData=function(q){var B,A;if(q){try{var h=JSON.parse(q)}catch(V){return}if(Array.isArray(h))for(q=0,B=h.length;q<B;++q){var n=h[q];if(Array.isArray(n)&&2===n.length&&"number"===typeof n[0]&&"string"===typeof n[1]){var z=n[0];n=n[1];var P=0;for(A=n.length;P<A;++P)this.SetCharWidth(n.charAt(P),z)}}}};N.prototype.SetCharacterWidth=function(q,B){if(""!==
q)for(var A=0;A<q.length;A++)this.SetCharWidth(q.charAt(A),B)};N.prototype.SetEffect=function(q){this.blend_mode=q;this.compositeOp=cr.effectToCompositeOp(q);cr.setGLBlend(this,q,this.runtime.gl);this.runtime.redraw=!0};N.prototype.SetHAlign=function(q){this.halign=q/2;this.text_changed=!0;this.runtime.redraw=!0};N.prototype.SetVAlign=function(q){this.valign=q/2;this.text_changed=!0;this.runtime.redraw=!0};f.acts=new N;D.prototype.CharacterWidth=function(q,B){q.set_int(this.getCharacterWidth(B))};
D.prototype.CharacterHeight=function(q){q.set_int(this.characterHeight)};D.prototype.CharacterScale=function(q){q.set_float(this.characterScale)};D.prototype.CharacterSpacing=function(q){q.set_int(this.characterSpacing)};D.prototype.LineHeight=function(q){q.set_int(this.lineHeight)};D.prototype.Text=function(q){q.set_string(this.text)};D.prototype.TextWidth=function(q){this.rebuildText();q.set_float(this.textWidth)};D.prototype.TextHeight=function(q){this.rebuildText();q.set_float(this.textHeight)};
f.exps=new D})();cr.plugins_.Mouse=function(b){this.runtime=b};
(function(){function b(){}function m(){}function w(){}var E=cr.plugins_.Mouse.prototype;E.Type=function(f){this.plugin=f;this.runtime=f.runtime};E.Type.prototype.onCreate=function(){};E.Instance=function(f){this.type=f;this.runtime=f.runtime;this.buttonMap=Array(4);this.triggerDir=this.triggerType=this.triggerButton=this.mouseYcanvas=this.mouseXcanvas=0;this.handled=!1};var N=E.Instance.prototype;N.onCreate=function(){var f=this;document.addEventListener("mousemove",function(c){f.onMouseMove(c)});
document.addEventListener("mousedown",function(c){f.onMouseDown(c)});document.addEventListener("mouseup",function(c){f.onMouseUp(c)});document.addEventListener("dblclick",function(c){f.onDoubleClick(c)});var a=function(c){f.onWheel(c)};document.addEventListener("mousewheel",a,!1);document.addEventListener("DOMMouseScroll",a,!1)};N.onMouseMove=function(f){this.mouseXcanvas=f.pageX-this.runtime.canvas.offsetLeft;this.mouseYcanvas=f.pageY-this.runtime.canvas.offsetTop};N.mouseInGame=function(){return 0<
this.runtime.fullscreen_mode?!0:0<=this.mouseXcanvas&&0<=this.mouseYcanvas&&this.mouseXcanvas<this.runtime.width&&this.mouseYcanvas<this.runtime.height};N.onMouseDown=function(f){this.mouseInGame()&&(this.buttonMap[f.which]=!0,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnAnyClick,this),this.triggerButton=f.which-1,this.triggerType=0,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this),this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,
this),this.runtime.isInUserInputEvent=!1)};N.onMouseUp=function(f){this.buttonMap[f.which]&&(this.runtime.had_a_click&&!this.runtime.isMobile&&f.preventDefault(),this.runtime.had_a_click=!0,this.buttonMap[f.which]=!1,this.runtime.isInUserInputEvent=!0,this.triggerButton=f.which-1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease,this),this.runtime.isInUserInputEvent=!1)};N.onDoubleClick=function(f){this.mouseInGame()&&(f.preventDefault(),this.runtime.isInUserInputEvent=!0,this.triggerButton=
f.which-1,this.triggerType=1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this),this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,this),this.runtime.isInUserInputEvent=!1)};N.onWheel=function(f){this.triggerDir=0>(f.wheelDelta?f.wheelDelta:f.detail?-f.detail:0)?0:1;this.handled=!1;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnWheel,this);this.runtime.isInUserInputEvent=!1;this.handled&&cr.isCanvasInputEvent(f)&&f.preventDefault()};
N.onWindowBlur=function(){var f;var a=0;for(f=this.buttonMap.length;a<f;++a)this.buttonMap[a]&&(this.buttonMap[a]=!1,this.triggerButton=a-1,this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease,this))};N.isMouseOverCanvas=function(){return 0<=this.mouseXcanvas&&0<=this.mouseYcanvas&&this.mouseXcanvas<this.runtime.width&&this.mouseYcanvas<this.runtime.height};b.prototype.OnClick=function(f,a){return f===this.triggerButton&&a===this.triggerType};b.prototype.OnAnyClick=function(){return!0};
b.prototype.IsButtonDown=function(f){return this.buttonMap[f+1]};b.prototype.OnRelease=function(f){return f===this.triggerButton};b.prototype.IsOverObject=function(f){if(this.isMouseOverCanvas()){var a=this.runtime.getCurrentCondition();return cr.xor(this.runtime.testAndSelectCanvasPointOverlap(f,this.mouseXcanvas,this.mouseYcanvas,a.inverted),a.inverted)}};b.prototype.OnObjectClicked=function(f,a,c){if(f!==this.triggerButton||a!==this.triggerType)return!1;if(this.isMouseOverCanvas())return this.runtime.testAndSelectCanvasPointOverlap(c,
this.mouseXcanvas,this.mouseYcanvas,!1)};b.prototype.OnWheel=function(f){this.handled=!0;return f===this.triggerDir};E.cnds=new b;var D=null;m.prototype.SetCursor=function(f){f="auto pointer text crosshair move help wait none".split(" ")[f];D!==f&&(D=f,document.body.style.cursor=f)};m.prototype.SetCursorSprite=function(f){!this.runtime.isMobile&&f&&(f=f.getFirstPicked())&&f.curFrame&&(f=f.curFrame,D!==f&&(D=f,f="url("+f.getDataUri()+") "+Math.round(f.hotspotX*f.width)+" "+Math.round(f.hotspotY*f.height)+
", auto",document.body.style.cursor="",document.body.style.cursor=f))};E.acts=new m;w.prototype.X=function(f,a){if(cr.is_undefined(a)){a=this.runtime.getLayerByNumber(0);var c=a.scale;var l=a.zoomRate;var v=a.parallaxX;var t=a.angle;a.scale=1;a.zoomRate=1;a.parallaxX=1;a.angle=0;f.set_float(a.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!0));a.scale=c;a.zoomRate=l;a.parallaxX=v;a.angle=t}else(a=cr.is_number(a)?this.runtime.getLayerByNumber(a):this.runtime.getLayerByName(a))?f.set_float(a.canvasToLayer(this.mouseXcanvas,
this.mouseYcanvas,!0)):f.set_float(0)};w.prototype.Y=function(f,a){if(cr.is_undefined(a)){a=this.runtime.getLayerByNumber(0);var c=a.scale;var l=a.zoomRate;var v=a.parallaxY;var t=a.angle;a.scale=1;a.zoomRate=1;a.parallaxY=1;a.angle=0;f.set_float(a.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,!1));a.scale=c;a.zoomRate=l;a.parallaxY=v;a.angle=t}else(a=cr.is_number(a)?this.runtime.getLayerByNumber(a):this.runtime.getLayerByName(a))?f.set_float(a.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,
!1)):f.set_float(0)};w.prototype.AbsoluteX=function(f){f.set_float(this.mouseXcanvas)};w.prototype.AbsoluteY=function(f){f.set_float(this.mouseYcanvas)};E.exps=new w})();cr.plugins_.Browser=function(b){this.runtime=b};
(function(){function b(){c&&l&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(A){v.onSWMessage(A)})}function m(){if(!y&&navigator.getBattery){var A=navigator.getBattery();y=!0;A&&A.then(function(h){t=h})}}function w(){}function E(){}function N(A){console&&console.warn&&console.warn("Fullscreen request failed: ",A);q.setSize(window.innerWidth,window.innerHeight)}function D(){}var f=cr.plugins_.Browser.prototype;f.Type=function(A){this.plugin=A;this.runtime=A.runtime};
var a=f.Type.prototype;a.onCreate=function(){};var c=!1,l=!1;document.addEventListener("DOMContentLoaded",function(){if(window.C3_RegisterSW&&navigator.serviceWorker){var A=document.createElement("script");A.onload=function(){c=!0;b()};A.src="offlineclient.js";document.head.appendChild(A)}});var v=null;a.onAppBegin=function(){l=!0;b()};f.Instance=function(A){this.type=A;this.runtime=A.runtime};a=f.Instance.prototype;a.onCreate=function(){var A=this;window.addEventListener("resize",function(){A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,
A)});v=this;"undefined"!==typeof navigator.onLine&&(window.addEventListener("online",function(){A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,A)}),window.addEventListener("offline",function(){A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,A)}));document.addEventListener("backbutton",function(){A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,A)});document.addEventListener("menubutton",function(){A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,
A)});document.addEventListener("searchbutton",function(){A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,A)});document.addEventListener("tizenhwkey",function(h){switch(h.keyName){case "back":var n=A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,A);!n&&window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case "menu":(n=A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,A))||h.preventDefault()}});this.runtime.isWindows10&&"undefined"!==
typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(h){A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,A)&&(h.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(h){return!!A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,A)});this.runtime.addSuspendCallback(function(h){h?A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,A):A.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,
A)});this.is_arcade="undefined"!==typeof window.is_scirra_arcade};a.onSWMessage=function(A){A=A.data.type;"downloading-update"===A?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===A||"update-pending"===A?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===A&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var t=null,y=!1;w.prototype.CookiesEnabled=function(){return navigator?navigator.cookieEnabled:
!1};w.prototype.IsOnline=function(){return navigator?navigator.onLine:!1};w.prototype.HasJava=function(){return navigator?navigator.javaEnabled():!1};w.prototype.OnOnline=function(){return!0};w.prototype.OnOffline=function(){return!0};w.prototype.IsDownloadingUpdate=function(){return!1};w.prototype.PageVisible=function(){return!this.runtime.isSuspended};w.prototype.OnPageVisible=function(){return!0};w.prototype.OnPageHidden=function(){return!0};w.prototype.OnResize=function(){return!0};w.prototype.IsFullscreen=
function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen)};w.prototype.OnBackButton=function(){return!0};w.prototype.OnMenuButton=function(){return!0};w.prototype.OnSearchButton=function(){return!0};w.prototype.IsMetered=function(){var A=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return A?!!A.metered:!1};w.prototype.IsCharging=function(){var A=navigator.battery||navigator.mozBattery||navigator.webkitBattery;if(A)return!!A.charging;
m();return t?!!t.charging:!0};w.prototype.IsPortraitLandscape=function(A){return(window.innerWidth<=window.innerHeight?0:1)===A};w.prototype.SupportsFullscreen=function(){if(this.runtime.isNWjs)return!0;var A=this.runtime.canvas;return!!(A.requestFullscreen||A.mozRequestFullScreen||A.msRequestFullscreen||A.webkitRequestFullScreen)};w.prototype.OnUpdateFound=function(){return!0};w.prototype.OnUpdateReady=function(){return!0};w.prototype.OnOfflineReady=function(){return!0};f.cnds=new w;E.prototype.Alert=
function(A){alert(A.toString())};E.prototype.Close=function(){window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():this.is_arcade||window.close()};E.prototype.Focus=function(){this.runtime.isNWjs?nw.Window.get().focus():this.is_arcade||window.focus()};E.prototype.Blur=function(){this.runtime.isNWjs?nw.Window.get().blur():this.is_arcade||window.blur()};
E.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():!this.is_arcade&&window.back&&window.back()};E.prototype.GoForward=function(){!this.is_arcade&&window.forward&&window.forward()};E.prototype.GoHome=function(){!this.is_arcade&&window.home&&window.home()};E.prototype.GoToURL=function(A,h){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(A)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(A,{openExternal:!0}):
this.runtime.isCordova?window.open(A,"_system"):this.runtime.isPreview?window.open(A,"_blank"):this.is_arcade||(2!==h||this.is_arcade?1!==h||this.is_arcade?window.location=A:window.parent.location=A:window.top.location=A)};E.prototype.GoToURLWindow=function(A,h){this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(A)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(A,{openExternal:!0}):this.runtime.isCordova?window.open(A,"_system"):this.is_arcade||window.open(A,
h)};E.prototype.Reload=function(){this.is_arcade||window.location.reload()};var L=!0,q=null;E.prototype.RequestFullScreen=function(A,h){2<=A&&(A+=1);6===A&&(A=2);document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement||document.fullScreen||document.fullScreenElement||(this.runtime.fullscreen_scaling=2<=A?A:0,A={navigationUI:"auto"},1===h?A.navigationUI="hide":2===h&&(A.navigationUI="show"),h=document.documentElement,L&&(L=!1,q=this.runtime,h.addEventListener("mozfullscreenerror",
N),h.addEventListener("webkitfullscreenerror",N),h.addEventListener("MSFullscreenError",N),h.addEventListener("fullscreenerror",N)),h.requestFullscreen?h.requestFullscreen(A):h.mozRequestFullScreen?h.mozRequestFullScreen(A):h.msRequestFullscreen?h.msRequestFullscreen(A):h.webkitRequestFullScreen&&("undefined"!==typeof Element&&"undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?h.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):h.webkitRequestFullScreen()))};E.prototype.CancelFullScreen=function(){document.exitFullscreen?
document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()};E.prototype.Vibrate=function(A){try{var h=A.split(","),n;var z=0;for(n=h.length;z<n;z++)h[z]=parseInt(h[z],10);navigator.vibrate?navigator.vibrate(h):navigator.mozVibrate?navigator.mozVibrate(h):navigator.webkitVibrate?navigator.webkitVibrate(h):navigator.msVibrate&&navigator.msVibrate(h)}catch(P){}};
E.prototype.InvokeDownload=function(A,h){if(h){var n=document.createElement("a");if("undefined"===typeof n.download)window.open(A);else{var z=document.getElementsByTagName("body")[0];n.textContent=h;n.href=A;n.download=h;z.appendChild(n);A=new MouseEvent("click");n.dispatchEvent(A);z.removeChild(n)}}};E.prototype.InvokeDownloadString=function(A,h,n){if(n){var z="data:"+h+","+encodeURIComponent(A);A=document.createElement("a");"undefined"===typeof A.download?window.open(z):(h=document.getElementsByTagName("body")[0],
A.textContent=n,A.href=z,A.download=n,h.appendChild(A),n=new MouseEvent("click"),A.dispatchEvent(n),h.removeChild(A))}};E.prototype.ConsoleLog=function(A,h){"undefined"!==typeof console&&(0===A&&console.log&&console.log(h.toString()),1===A&&console.warn&&console.warn(h.toString()),2===A&&console.error&&console.error(h.toString()))};E.prototype.ConsoleGroup=function(A){console&&console.group&&console.group(A)};E.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()};E.prototype.ExecJs=
function(A){try{eval&&eval(A)}catch(h){console&&console.error&&console.error("Error executing Javascript: ",h)}};var B="portrait landscape portrait-primary portrait-secondary landscape-primary landscape-secondary".split(" ");E.prototype.LockOrientation=function(A){A=Math.floor(A);0>A||A>=B.length||(this.runtime.autoLockOrientation=!1,A=B[A],screen.orientation&&screen.orientation.lock?screen.orientation.lock(A):screen.lockOrientation?screen.lockOrientation(A):screen.webkitLockOrientation?screen.webkitLockOrientation(A):
screen.mozLockOrientation?screen.mozLockOrientation(A):screen.msLockOrientation&&screen.msLockOrientation(A))};E.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1;screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()};f.acts=
new E;D.prototype.URL=function(A){A.set_string(window.location.toString())};D.prototype.Protocol=function(A){A.set_string(window.location.protocol)};D.prototype.Domain=function(A){A.set_string(window.location.hostname)};D.prototype.PathName=function(A){A.set_string(window.location.pathname)};D.prototype.Hash=function(A){A.set_string(window.location.hash)};D.prototype.Referrer=function(A){A.set_string(document.referrer)};D.prototype.Title=function(A){A.set_string(document.title)};D.prototype.Name=
function(A){A.set_string(navigator.appName)};D.prototype.Version=function(A){A.set_string(navigator.appVersion)};D.prototype.Language=function(A){navigator&&navigator.language?A.set_string(navigator.language):A.set_string("")};D.prototype.Platform=function(A){A.set_string(navigator.platform)};D.prototype.Product=function(A){navigator&&navigator.product?A.set_string(navigator.product):A.set_string("")};D.prototype.Vendor=function(A){navigator&&navigator.vendor?A.set_string(navigator.vendor):A.set_string("")};
D.prototype.UserAgent=function(A){A.set_string(navigator.userAgent)};D.prototype.QueryString=function(A){A.set_string(window.location.search)};D.prototype.QueryParam=function(A,h){(h=RegExp("[?&]"+h+"=([^&]*)").exec(window.location.search))?A.set_string(decodeURIComponent(h[1].replace(/\+/g," "))):A.set_string("")};D.prototype.Bandwidth=function(A){var h=navigator.connection||navigator.mozConnection||navigator.webkitConnection;h?"undefined"!==typeof h.bandwidth?A.set_float(h.bandwidth):"undefined"!==
typeof h.downlinkMax?A.set_float(h.downlinkMax):A.set_float(Number.POSITIVE_INFINITY):A.set_float(Number.POSITIVE_INFINITY)};D.prototype.ConnectionType=function(A){var h=navigator.connection||navigator.mozConnection||navigator.webkitConnection;h?A.set_string(h.type||"unknown"):A.set_string("unknown")};D.prototype.BatteryLevel=function(A){var h=navigator.battery||navigator.mozBattery||navigator.webkitBattery;h?A.set_float(h.level):(m(),t?A.set_float(t.level):A.set_float(1))};D.prototype.BatteryTimeLeft=
function(A){var h=navigator.battery||navigator.mozBattery||navigator.webkitBattery;h?A.set_float(h.dischargingTime):(m(),t?A.set_float(t.dischargingTime):A.set_float(Number.POSITIVE_INFINITY))};D.prototype.ExecJS=function(A,h){if(eval){var n=0;try{n=eval(h)}catch(z){console&&console.error&&console.error("Error executing Javascript: ",z)}"number"===typeof n?A.set_any(n):"string"===typeof n?A.set_any(n):"boolean"===typeof n?A.set_any(n?1:0):A.set_any(0)}else A.set_any(0)};D.prototype.ScreenWidth=function(A){A.set_int(screen.width)};
D.prototype.ScreenHeight=function(A){A.set_int(screen.height)};D.prototype.DevicePixelRatio=function(A){A.set_float(this.runtime.devicePixelRatio)};D.prototype.WindowInnerWidth=function(A){A.set_int(window.innerWidth)};D.prototype.WindowInnerHeight=function(A){A.set_int(window.innerHeight)};D.prototype.WindowOuterWidth=function(A){A.set_int(window.outerWidth)};D.prototype.WindowOuterHeight=function(A){A.set_int(window.outerHeight)};f.exps=new D})();cr.plugins_.Keyboard=function(b){this.runtime=b};
(function(){function b(){}function m(){}function w(f){f=Math.floor(f);switch(f){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"\u2190";case 38:return"\u2191";case 39:return"\u2192";case 40:return"\u2193";case 45:return"insert";case 46:return"del";
case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";
case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(f)}}
var E=cr.plugins_.Keyboard.prototype;E.Type=function(f){this.plugin=f;this.runtime=f.runtime};E.Type.prototype.onCreate=function(){};E.Instance=function(f){this.type=f;this.runtime=f.runtime;this.keyMap=Array(256);this.typedKeyMap=Array(256);this.usedKeys=Array(256);this.triggerKey=0};var N=E.Instance.prototype;N.onCreate=function(){var f=this;document.addEventListener("keydown",function(a){f.onKeyDown(a)});document.addEventListener("keyup",function(a){f.onKeyUp(a)})};var D=[32,33,34,35,36,37,38,
39,40,44];N.onKeyDown=function(f){var a=!1;window!=window.top&&-1<D.indexOf(f.which)&&(f.preventDefault(),a=!0,f.stopPropagation());if(this.keyMap[f.which])this.usedKeys[f.which]&&!a&&f.preventDefault();else{var c=f.which;this.typedKeyMap[c]=f.key;this.keyMap[c]=!0;this.triggerKey=c;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var l=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),v=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,
this);this.runtime.isInUserInputEvent=!1;if(l||v)this.usedKeys[c]=!0,a||f.preventDefault()}};N.onKeyUp=function(f){var a=f.which;this.typedKeyMap[a]=f.key;this.keyMap[a]=!1;this.triggerKey=a;this.runtime.isInUserInputEvent=!0;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var c=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),l=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=
!1;if(c||l||this.usedKeys[f.which])this.usedKeys[a]=!0,f.preventDefault()};N.onWindowBlur=function(){var f;for(f=0;256>f;++f)if(this.keyMap[f]){this.keyMap[f]=!1;this.triggerKey=f;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var a=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),c=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);if(a||c)this.usedKeys[f]=!0}};N.saveToJSON=function(){return{triggerKey:this.triggerKey}};
N.loadFromJSON=function(f){this.triggerKey=f.triggerKey};b.prototype.IsKeyDown=function(f){return this.keyMap[f]};b.prototype.OnKey=function(f){return f===this.triggerKey};b.prototype.OnAnyKey=function(f){return!0};b.prototype.OnAnyKeyReleased=function(f){return!0};b.prototype.OnKeyReleased=function(f){return f===this.triggerKey};b.prototype.IsKeyCodeDown=function(f){f=Math.floor(f);return 0>f||f>=this.keyMap.length?!1:this.keyMap[f]};b.prototype.OnKeyCode=function(f){return f===this.triggerKey};
b.prototype.OnKeyCodeReleased=function(f){return f===this.triggerKey};E.cnds=new b;E.acts=new function(){};m.prototype.TypedKey=function(f){f.set_string(this.typedKeyMap[this.triggerKey]||"")};m.prototype.LastKeyCode=function(f){f.set_int(this.triggerKey)};m.prototype.StringFromKeyCode=function(f,a){f.set_string(w(a))};E.exps=new m})();cr.plugins_.NinePatch=function(b){this.runtime=b};
(function(){function b(D,f,a,c,l,v,t,y,L,q){D.save();D.fillStyle=f;f=l%a;var B=v%c;0>f&&(f+=a);0>B&&(B+=c);D.translate(f+L,B+q);D.fillRect(l-f-L,v-B-q,t,y);D.restore()}function m(){}function w(){}var E=cr.plugins_.NinePatch.prototype;E.Type=function(D){this.plugin=D;this.runtime=D.runtime};var N=E.Type.prototype;N.onCreate=function(){this.is_family||(this.texture_img=this.runtime.findWaitingTexture(this.texture_file),this.texture_img||(this.texture_img=new Image,this.texture_img.cr_src=this.texture_file,
this.texture_img.cr_filesize=this.texture_filesize,this.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file)),this.webGL_bottomTexture=this.webGL_topTexture=this.webGL_rightTexture=this.webGL_leftTexture=this.webGL_fillTexture=this.webGL_texture=this.bottomPattern=this.topPattern=this.rightPattern=this.leftPattern=this.fillPattern=null)};N.onLostWebGLContext=function(){this.is_family||(this.webGL_bottomTexture=this.webGL_topTexture=this.webGL_rightTexture=
this.webGL_leftTexture=this.webGL_fillTexture=this.webGL_texture=null)};N.onRestoreWebGLContext=function(){this.is_family||!this.instances.length||this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))};N.unloadTextures=function(){this.is_family||this.instances.length||!this.runtime.glwrap||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.runtime.glwrap.deleteTexture(this.webGL_fillTexture),this.runtime.glwrap.deleteTexture(this.webGL_leftTexture),
this.runtime.glwrap.deleteTexture(this.webGL_rightTexture),this.runtime.glwrap.deleteTexture(this.webGL_topTexture),this.runtime.glwrap.deleteTexture(this.webGL_bottomTexture),this.webGL_bottomTexture=this.webGL_topTexture=this.webGL_rightTexture=this.webGL_leftTexture=this.webGL_fillTexture=this.webGL_texture=null)};N.slicePatch=function(D,f,a,c){var l=this.texture_data[3],v=this.texture_data[4],t=document.createElement("canvas");a-=D;c-=f;t.width=a;t.height=c;t.getContext("2d").drawImage(this.texture_img,
D+l,f+v,a,c,0,0,a,c);return t};N.createPatch=function(D,f,a,c){var l=this.texture_data[5],v=this.texture_data[6],t=l-f,y=v-c;if(this.runtime.glwrap){if(!this.webGL_fillTexture){var L=this.runtime.glwrap,q=this.runtime.linearSampling,B=this.texture_pixelformat;t>D&&y>a&&(this.webGL_fillTexture=L.loadTexture(this.slicePatch(D,a,t,y),!0,q,B));0<D&&y>a&&(this.webGL_leftTexture=L.loadTexture(this.slicePatch(0,a,D,y),!0,q,B,"repeat-y"));0<f&&y>a&&(this.webGL_rightTexture=L.loadTexture(this.slicePatch(t,
a,l,y),!0,q,B,"repeat-y"));0<a&&t>D&&(this.webGL_topTexture=L.loadTexture(this.slicePatch(D,0,t,a),!0,q,B,"repeat-x"));0<c&&t>D&&(this.webGL_bottomTexture=L.loadTexture(this.slicePatch(D,y,t,v),!0,q,B,"repeat-x"))}}else this.fillPattern||(L=this.runtime.ctx,t>D&&y>a&&(this.fillPattern=L.createPattern(this.slicePatch(D,a,t,y),"repeat")),0<D&&y>a&&(this.leftPattern=L.createPattern(this.slicePatch(0,a,D,y),"repeat")),0<f&&y>a&&(this.rightPattern=L.createPattern(this.slicePatch(t,a,l,y),"repeat")),0<
a&&t>D&&(this.topPattern=L.createPattern(this.slicePatch(D,0,t,a),"repeat")),0<c&&t>D&&(this.bottomPattern=L.createPattern(this.slicePatch(D,y,t,v),"repeat")))};E.Instance=function(D){this.type=D;this.runtime=D.runtime};N=E.Instance.prototype;N.onCreate=function(){this.leftMargin=this.properties[0];this.rightMargin=this.properties[1];this.topMargin=this.properties[2];this.bottomMargin=this.properties[3];this.edges=this.properties[4];this.fill=this.properties[5];this.visible=this.properties[6];this.seamless=
0!==this.properties[8];this.recycled?this.rcTex.set(0,0,0,0):this.rcTex=new cr.rect(0,0,0,0);this.runtime.glwrap&&!this.type.webGL_texture&&(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat));this.type.createPatch(this.leftMargin,this.rightMargin,this.topMargin,this.bottomMargin)};N.draw=function(D){var f=this.type.texture_img,a=this.leftMargin,c=this.rightMargin,l=this.topMargin,v=this.bottomMargin,t=this.type.texture_data[5],
y=this.type.texture_data[6],L=this.type.texture_data[3],q=this.type.texture_data[4],B=t-c,A=y-v;D.globalAlpha=this.opacity;D.save();var h=this.x,n=this.y,z=this.width,P=this.height;this.runtime.pixel_rounding&&(h=Math.round(h),n=Math.round(n));var V=-(this.hotspotX*this.width),H=-(this.hotspotY*this.height),d=V%t,k=H%y;0>d&&(d+=t);0>k&&(k+=y);D.translate(h+d,n+k);t=V-d;H-=k;k=this.seamless?1:0;0<a&&0<l&&D.drawImage(f,L,q,a+k,l+k,t,H,a+k,l+k);0<c&&0<l&&D.drawImage(f,L+B-k,q,c+k,l+k,t+z-c-k,H,c+k,l+
k);0<c&&0<v&&D.drawImage(f,L+B-k,q+A-k,c+k,v+k,t+z-c-k,H+P-v-k,c+k,v+k);0<a&&0<v&&D.drawImage(f,L,q+A-k,a+k,v+k,t,H+P-v-k,a+k,v+k);0===this.edges?(k=2===this.fill?0:k,0<a&&A>l&&b(D,this.type.leftPattern,a,A-l,t,H+l,a+k,P-l-v,0,0),0<c&&A>l&&b(D,this.type.rightPattern,c,A-l,t+z-c-k,H+l,c+k,P-l-v,k,0),0<l&&B>a&&b(D,this.type.topPattern,B-a,l,t+a,H,z-a-c,l+k,0,0),0<v&&B>a&&b(D,this.type.bottomPattern,B-a,v,t+a,H+P-v-k,z-a-c,v+k,0,k)):1===this.edges&&(0<a&&A>l&&0<P-l-v&&D.drawImage(f,L,q+l,a,A-l,t,H+l,
a,P-l-v),0<c&&A>l&&0<P-l-v&&D.drawImage(f,L+B,q+l,c,A-l,t+z-c,H+l,c,P-l-v),0<l&&B>a&&0<z-a-c&&D.drawImage(f,L+a,q,B-a,l,t+a,H,z-a-c,l),0<v&&B>a&&0<z-a-c&&D.drawImage(f,L+a,q+A,B-a,v,t+a,H+P-v,z-a-c,v));A>l&&B>a&&(0===this.fill?b(D,this.type.fillPattern,B-a,A-l,t+a,H+l,z-a-c,P-l-v,0,0):1===this.fill&&0<z-a-c&&0<P-l-v&&D.drawImage(f,L+a,q+l,B-a,A-l,t+a,H+l,z-a-c,P-l-v));D.restore()};N.drawPatch=function(D,f,a,c,l,v,t,y,L,q){D.setTexture(f);var B=this.rcTex;B.left=a/f.c2width;B.top=c/f.c2height;B.right=
(a+l)/f.c2width;B.bottom=(c+v)/f.c2height;D.quadTex(t,y,t+L,y,t+L,y+q,t,y+q,B)};N.tilePatch=function(D,f,a,c,l,v,t,y){D.setTexture(f);var L=this.rcTex;L.left=-t/f.c2width;L.top=-y/f.c2height;L.right=(l-t)/f.c2width;L.bottom=(v-y)/f.c2height;D.quadTex(a,c,a+l,c,a+l,c+v,a,c+v,L)};N.drawGL_earlyZPass=function(D){this.drawGL(D)};N.drawGL=function(D){var f=this.leftMargin,a=this.rightMargin,c=this.topMargin,l=this.bottomMargin,v=this.type.texture_data[3],t=this.type.texture_data[4],y=this.type.texture_data[5]-
a,L=this.type.texture_data[6]-l;D.setOpacity(this.opacity);var q=this.bquad,B=q.tlx;q=q.tly;var A=this.width,h=this.height;this.runtime.pixel_rounding&&(B=Math.round(B),q=Math.round(q));var n=this.seamless?1:0;0<f&&0<c&&this.drawPatch(D,this.type.webGL_texture,v,t,f+n,c+n,B,q,f+n,c+n);0<a&&0<c&&this.drawPatch(D,this.type.webGL_texture,v+y-n,t,a+n,c+n,B+A-a-n,q,a+n,c+n);0<a&&0<l&&this.drawPatch(D,this.type.webGL_texture,v+y-n,t+L-n,a+n,l+n,B+A-a-n,q+h-l-n,a+n,l+n);0<f&&0<l&&this.drawPatch(D,this.type.webGL_texture,
v,t+L-n,f+n,l+n,B,q+h-l-n,f+n,l+n);0===this.edges?(n=2===this.fill?0:n,0<f&&L>c&&this.tilePatch(D,this.type.webGL_leftTexture,B,q+c,f+n,h-c-l,0,0),0<a&&L>c&&this.tilePatch(D,this.type.webGL_rightTexture,B+A-a-n,q+c,a+n,h-c-l,n,0),0<c&&y>f&&this.tilePatch(D,this.type.webGL_topTexture,B+f,q,A-f-a,c+n,0,0),0<l&&y>f&&this.tilePatch(D,this.type.webGL_bottomTexture,B+f,q+h-l-n,A-f-a,l+n,0,n)):1===this.edges&&(0<f&&L>c&&this.drawPatch(D,this.type.webGL_texture,v,t+c,f,L-c,B,q+c,f,h-c-l),0<a&&L>c&&this.drawPatch(D,
this.type.webGL_texture,v+y,t+c,a,L-c,B+A-a,q+c,a,h-c-l),0<c&&y>f&&this.drawPatch(D,this.type.webGL_texture,v+f,t,y-f,c,B+f,q,A-f-a,c),0<l&&y>f&&this.drawPatch(D,this.type.webGL_texture,v+f,t+L,y-f,l,B+f,q+h-l,A-f-a,l));L>c&&y>f&&(0===this.fill?this.tilePatch(D,this.type.webGL_fillTexture,B+f,q+c,A-f-a,h-c-l,0,0):1===this.fill&&this.drawPatch(D,this.type.webGL_texture,v+f,t+c,y-f,L-c,B+f,q+c,A-f-a,h-c-l))};m.prototype.OnURLLoaded=function(){return!0};E.cnds=new m;w.prototype.SetEffect=function(D){this.blend_mode=
D;this.compositeOp=cr.effectToCompositeOp(D);cr.setGLBlend(this,D,this.runtime.gl);this.runtime.redraw=!0};E.acts=new w;E.exps=new function(){}})();cr.plugins_.Text=function(b){this.runtime=b};
(function(){function b(){return v.length?v.pop():{}}function m(t){var y;var L=0;for(y=t.length;L<y;L++)v.push(t[L]);cr.clearArray(t)}function w(t){return t.length&&" "===t.charAt(t.length-1)?t.substring(0,t.length-1):t}function E(){}function N(){}function D(){}var f=cr.plugins_.Text.prototype;f.onCreate=function(){f.acts.SetWidth=function(t){this.width!==t&&(this.width=t,this.text_changed=!0,this.set_bbox_changed())}};f.Type=function(t){this.plugin=t;this.runtime=t.runtime};var a=f.Type.prototype;
a.onCreate=function(){};a.onLostWebGLContext=function(){if(!this.is_family){var t;var y=0;for(t=this.instances.length;y<t;y++){var L=this.instances[y];L.mycanvas=null;L.myctx=null;L.mytex=null}}};f.Instance=function(t){this.type=t;this.runtime=t.runtime;this.recycled?cr.clearArray(this.lines):this.lines=[];this.text_changed=!0};a=f.Instance.prototype;var c={};a.onCreate=function(){this.text=this.properties[0];this.facename=this.properties[2];this.ptSize=this.properties[3];this.line_height_offset=
this.properties[4];this.isBold=this.properties[5];this.isItalic=this.properties[6];var t=this.properties[7];this.color="rgb("+Math.floor(255*t[0])+","+Math.floor(255*t[1])+","+Math.floor(255*t[2])+")";this.halign=this.properties[8];this.valign=this.properties[9];this.wrapbyword=0===this.properties[10];this.visible=this.properties[11];this.lastwrapwidth=this.lastwidth=this.width;this.lastheight=this.height;this.fontstyle=this.font="";this.textHeight=this.textWidth=this.pxHeight=0;this.updateFont();
this.mytex=this.myctx=this.mycanvas=null;this.need_text_redraw=!1;this.last_render_tick=this.runtime.tickcount;this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1);this.runtime.glwrap&&this.runtime.tickMe(this)};a.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapbyword,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}};
a.loadFromJSON=function(t){this.text=t.t;this.font=t.f;this.color=t.c;this.halign=t.ha;this.valign=t.va;this.wrapbyword=t.wr;this.line_height_offset=t.lho;this.facename=t.fn;this.fontstyle=t.fs;this.ptSize=t.ps;this.pxHeight=t.pxh;this.textWidth=t.tw;this.textHeight=t.th;this.last_render_tick=t.lrt;this.isBold=0!==this.fontstyle.indexOf("bold");this.isItalic=0!==this.fontstyle.indexOf("italic");this.text_changed=!0;this.lastwrapwidth=this.lastwidth=this.width;this.lastheight=this.height};a.tick=function(){if(this.runtime.glwrap&&
this.mytex&&300<=this.runtime.tickcount-this.last_render_tick){var t=this.layer;this.update_bbox();var y=this.bbox;if(y.right<t.viewLeft||y.bottom<t.viewTop||y.left>t.viewRight||y.top>t.viewBottom)this.runtime.glwrap.deleteTexture(this.mytex),this.mycanvas=this.myctx=this.mytex=null}};a.onDestroy=function(){this.mycanvas=this.myctx=null;this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex);this.mytex=null};a.updateFont=function(){this.pxHeight=Math.ceil(this.ptSize/72*96)+
4;var t=[];this.isBold&&t.push("bold");this.isItalic&&t.push("italic");this.fontstyle=t.join(" ");this.font=this.fontstyle+" "+this.ptSize.toString()+"pt '"+this.facename+"'";this.text_changed=!0;this.runtime.redraw=!0};a.draw=function(t,y){t.font=this.font;t.textBaseline="top";t.fillStyle=this.color;t.globalAlpha=y?1:this.opacity;if(y){var L=this.layer.getScale();t.save();t.scale(L,L)}if(this.text_changed||this.width!==this.lastwrapwidth)this.type.plugin.WordWrap(this.text,this.lines,t,this.width,
this.wrapbyword),this.text_changed=!1,this.lastwrapwidth=this.width;this.update_bbox();L=y?0:this.bquad.tlx;var q=y?0:this.bquad.tly;this.runtime.pixel_rounding&&(L=L+.5|0,q=q+.5|0);0===this.angle||y||(t.save(),t.translate(L,q),t.rotate(this.angle),q=L=0);var B=q+this.height,A=this.pxHeight;A+=this.line_height_offset;var h;1===this.valign?q+=Math.max(this.height/2-this.lines.length*A/2,0):2===this.valign&&(q+=Math.max(this.height-this.lines.length*A-2,0));for(h=0;h<this.lines.length;h++){var n=L;
1===this.halign?n=L+(this.width-this.lines[h].width)/2:2===this.halign&&(n=L+(this.width-this.lines[h].width));t.fillText(this.lines[h].text,n,q);q+=A;if(q>=B-A)break}(0!==this.angle||y)&&t.restore();this.last_render_tick=this.runtime.tickcount};a.drawGL=function(t){if(!(1>this.width||1>this.height)){var y=this.text_changed||this.need_text_redraw;this.need_text_redraw=!1;var L=this.layer.getScale(),q=this.layer.getAngle(),B=this.rcTex,A=L*this.width,h=L*this.height,n=Math.ceil(A),z=Math.ceil(h),P=
this.runtime.draw_width/2,V=this.runtime.draw_height/2;this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=n,this.mycanvas.height=z,this.lastwidth=n,this.lastheight=z,y=!0,this.myctx=this.mycanvas.getContext("2d"));if(n!==this.lastwidth||z!==this.lastheight)this.mycanvas.width=n,this.mycanvas.height=z,this.mytex&&(t.deleteTexture(this.mytex),this.mytex=null),y=!0;y&&(this.myctx.clearRect(0,0,n,z),this.draw(this.myctx,!0),this.mytex||(this.mytex=t.createEmptyTexture(n,z,
this.runtime.linearSampling,this.runtime.isMobile)),t.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile));this.lastwidth=n;this.lastheight=z;t.setTexture(this.mytex);t.setOpacity(this.opacity);t.resetModelView();t.translate(-P,-V);t.updateModelView();var H=this.bquad;y=this.layer.layerToCanvas(H.tlx,H.tly,!0,!0);P=this.layer.layerToCanvas(H.tlx,H.tly,!1,!0);V=this.layer.layerToCanvas(H.trx,H.try_,!0,!0);var d=this.layer.layerToCanvas(H.trx,H.try_,!1,!0),k=this.layer.layerToCanvas(H.brx,
H.bry,!0,!0),F=this.layer.layerToCanvas(H.brx,H.bry,!1,!0),e=this.layer.layerToCanvas(H.blx,H.bly,!0,!0);H=this.layer.layerToCanvas(H.blx,H.bly,!1,!0);if(this.runtime.pixel_rounding||0===this.angle&&0===q){var u=(y+.5|0)-y,J=(P+.5|0)-P;y+=u;P+=J;V+=u;d+=J;k+=u;F+=J;e+=u;H+=J}0===this.angle&&0===q?(V=y+n,d=P,k=V,F=P+z,e=y,H=F,B.right=1,B.bottom=1):(B.right=A/n,B.bottom=h/z);t.quadTex(y,P,V,d,k,F,e,H,B);t.resetModelView();t.scale(L,L);t.rotateZ(-this.layer.getAngle());t.translate((this.layer.viewLeft+
this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2);t.updateModelView();this.last_render_tick=this.runtime.tickcount}};var l=[];f.TokeniseWords=function(t){cr.clearArray(l);for(var y="",L,q=0;q<t.length;)if(L=t.charAt(q),"\n"===L)y.length&&(l.push(y),y=""),l.push("\n"),++q;else if(" "===L||"\t"===L||"-"===L){do y+=t.charAt(q),q++;while(q<t.length&&(" "===t.charAt(q)||"\t"===t.charAt(q)));l.push(y);y=""}else q<t.length&&(y+=L,q++);y.length&&l.push(y)};var v=[];f.WordWrap=function(t,
y,L,q,B){if(t&&t.length)if(2>=q)m(y);else{if(100>=t.length&&-1===t.indexOf("\n")){var A=L.measureText(t).width;if(A<=q){m(y);y.push(b());y[0].text=t;y[0].width=A;return}}this.WrapText(t,y,L,q,B)}else m(y)};f.WrapText=function(t,y,L,q,B){B&&(this.TokeniseWords(t),t=l);var A="",h,n=0;for(h=0;h<t.length;h++)if("\n"===t[h]){n>=y.length&&y.push(b());A=w(A);var z=y[n];z.text=A;z.width=L.measureText(A).width;n++;A=""}else{var P=A;A+=t[h];z=L.measureText(w(A)).width;z>=q&&(n>=y.length&&y.push(b()),P=w(P),
z=y[n],z.text=P,z.width=L.measureText(P).width,n++,A=t[h],B||" "!==A||(A=""))}A.length&&(n>=y.length&&y.push(b()),A=w(A),z=y[n],z.text=A,z.width=L.measureText(A).width,n++);for(h=n;h<y.length;h++)v.push(y[h]);y.length=n};E.prototype.CompareText=function(t,y){return y?this.text==t:cr.equals_nocase(this.text,t)};f.cnds=new E;N.prototype.SetText=function(t){cr.is_number(t)&&1E9>t&&(t=Math.round(1E10*t)/1E10);t=t.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)};N.prototype.AppendText=
function(t){cr.is_number(t)&&(t=Math.round(1E10*t)/1E10);if(t=t.toString())this.text+=t,this.text_changed=!0,this.runtime.redraw=!0};N.prototype.SetFontFace=function(t,y){var L=!1,q=!1;switch(y){case 1:L=!0;break;case 2:q=!0;break;case 3:q=L=!0}if(t!==this.facename||this.isBold!==L||this.isItalic!==q)this.facename=t,this.isBold=L,this.isItalic=q,this.updateFont()};N.prototype.SetFontSize=function(t){this.ptSize!==t&&(this.ptSize=t,this.updateFont())};N.prototype.SetFontColor=function(t){var y=cr.clamp(Math.floor(255*
cr.GetRValue(t)),0,255),L=cr.clamp(Math.floor(255*cr.GetGValue(t)),0,255);t=cr.clamp(Math.floor(255*cr.GetBValue(t)),0,255);y="rgb("+y+","+L+","+t+")";y!==this.color&&(this.color=y,this.need_text_redraw=!0,this.runtime.redraw=!0)};N.prototype.SetWebFont=function(t,y){var L=this,q=function(){L.runtime.redraw=!0;L.text_changed=!0};if(c.hasOwnProperty(y)){if(t="'"+t+"'",this.facename!==t)for(this.facename=t,this.updateFont(),t=1;10>t;t++)setTimeout(q,100*t),setTimeout(q,1E3*t)}else{var B=document.createElement("link");
B.href=y;B.rel="stylesheet";B.type="text/css";B.onload=q;document.getElementsByTagName("head")[0].appendChild(B);c[y]=!0;this.facename="'"+t+"'";this.updateFont();for(t=1;10>t;t++)setTimeout(q,100*t),setTimeout(q,1E3*t)}};N.prototype.SetEffect=function(t){this.blend_mode=t;this.compositeOp=cr.effectToCompositeOp(t);cr.setGLBlend(this,t,this.runtime.gl);this.runtime.redraw=!0};f.acts=new N;D.prototype.Text=function(t){t.set_string(this.text)};D.prototype.FaceName=function(t){t.set_string(this.facename)};
D.prototype.FaceSize=function(t){t.set_int(this.ptSize)};D.prototype.TextWidth=function(t){var y=0,L;var q=0;for(L=this.lines.length;q<L;q++){var B=this.lines[q].width;y<B&&(y=B)}t.set_int(y)};D.prototype.TextHeight=function(t){t.set_int(this.lines.length*(this.pxHeight+this.line_height_offset)-this.line_height_offset)};f.exps=new D})();cr.behaviors.Timer=function(b){this.runtime=b};
(function(){function b(){}function m(){}function w(){}var E=cr.behaviors.Timer.prototype;E.Type=function(D,f){this.behavior=D;this.objtype=f;this.runtime=D.runtime};E.Type.prototype.onCreate=function(){};E.Instance=function(D,f){this.type=D;this.behavior=D.behavior;this.inst=f;this.runtime=D.runtime};var N=E.Instance.prototype;N.onCreate=function(){this.timers={}};N.onDestroy=function(){cr.wipe(this.timers)};N.saveToJSON=function(){var D={},f;for(f in this.timers)if(this.timers.hasOwnProperty(f)){var a=
this.timers[f];D[f]={c:a.current.sum,t:a.total.sum,d:a.duration,r:a.regular,p:a.paused}}return D};N.loadFromJSON=function(D){this.timers={};for(var f in D)D.hasOwnProperty(f)&&(this.timers[f]={current:new cr.KahanAdder,total:new cr.KahanAdder,duration:D[f].d,regular:D[f].r,paused:!!D[f].p},this.timers[f].current.sum=D[f].c,this.timers[f].total.sum=D[f].t)};N.tick=function(){var D=this.runtime.getDt(this.inst),f;for(f in this.timers)if(this.timers.hasOwnProperty(f)){var a=this.timers[f];a.paused||
(a.current.add(D),a.total.add(D))}};N.tick2=function(){var D;for(D in this.timers)if(this.timers.hasOwnProperty(D)){var f=this.timers[D];f.current.sum>=f.duration&&(f.regular?f.current.sum-=f.duration:delete this.timers[D])}};b.prototype.OnTimer=function(D){D=D.toLowerCase();return(D=this.timers[D])?D.current.sum>=D.duration:!1};b.prototype.IsTimerRunning=function(D){return this.timers.hasOwnProperty(D.toLowerCase())};b.prototype.IsTimerPaused=function(D){return(D=this.timers[D.toLowerCase()])&&D.paused};
E.cnds=new b;m.prototype.StartTimer=function(D,f,a){this.timers[a.toLowerCase()]={current:new cr.KahanAdder,total:new cr.KahanAdder,duration:D,regular:1===f,paused:!1}};m.prototype.StopTimer=function(D){D=D.toLowerCase();this.timers.hasOwnProperty(D)&&delete this.timers[D]};m.prototype.PauseResumeTimer=function(D,f){if(D=this.timers[D.toLowerCase()])D.paused=0===f};E.acts=new m;w.prototype.CurrentTime=function(D,f){f=this.timers[f.toLowerCase()];D.set_float(f?f.current.sum:0)};w.prototype.TotalTime=
function(D,f){f=this.timers[f.toLowerCase()];D.set_float(f?f.total.sum:0)};w.prototype.Duration=function(D,f){f=this.timers[f.toLowerCase()];D.set_float(f?f.duration:0)};E.exps=new w})();cr.behaviors.Pin=function(b){this.runtime=b};
(function(){function b(){}function m(){}function w(){}var E=cr.behaviors.Pin.prototype;E.Type=function(D,f){this.behavior=D;this.objtype=f;this.runtime=D.runtime};E.Type.prototype.onCreate=function(){};E.Instance=function(D,f){this.type=D;this.behavior=D.behavior;this.inst=f;this.runtime=D.runtime};var N=E.Instance.prototype;N.onCreate=function(){this.pinObject=null;this.pinObjectUid=-1;this.mode=this.lastKnownAngle=this.theirStartAngle=this.myStartAngle=this.pinDist=this.pinAngle=0;var D=this;this.recycled||
(this.myDestroyCallback=function(f){D.onInstanceDestroyed(f)});this.runtime.addDestroyCallback(this.myDestroyCallback)};N.saveToJSON=function(){return{uid:this.pinObject?this.pinObject.uid:-1,pa:this.pinAngle,pd:this.pinDist,msa:this.myStartAngle,tsa:this.theirStartAngle,lka:this.lastKnownAngle,m:this.mode}};N.loadFromJSON=function(D){this.pinObjectUid=D.uid;this.pinAngle=D.pa;this.pinDist=D.pd;this.myStartAngle=D.msa;this.theirStartAngle=D.tsa;this.lastKnownAngle=D.lka;this.mode=D.m};N.afterLoad=
function(){this.pinObject=-1===this.pinObjectUid?null:this.runtime.getObjectByUID(this.pinObjectUid);this.pinObjectUid=-1};N.onInstanceDestroyed=function(D){this.pinObject==D&&(this.pinObject=null)};N.onDestroy=function(){this.pinObject=null;this.runtime.removeDestroyCallback(this.myDestroyCallback)};N.tick=function(){};N.tick2=function(){if(this.pinObject){this.lastKnownAngle!==this.inst.angle&&(this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle)));var D=this.inst.x,
f=this.inst.y;if(3===this.mode||4===this.mode){var a=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y);if(a>this.pinDist||4===this.mode&&a<this.pinDist)f=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y),D=this.pinObject.x+Math.cos(f)*this.pinDist,f=this.pinObject.y+Math.sin(f)*this.pinDist}else D=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist,f=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist;this.lastKnownAngle=
a=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle));0!==this.mode&&1!==this.mode&&3!==this.mode&&4!==this.mode||this.inst.x===D&&this.inst.y===f||(this.inst.x=D,this.inst.y=f,this.inst.set_bbox_changed());0!==this.mode&&2!==this.mode||this.inst.angle===a||(this.inst.angle=a,this.inst.set_bbox_changed())}};b.prototype.IsPinned=function(){return!!this.pinObject};E.cnds=new b;m.prototype.Pin=function(D,f){D&&(D=D.getFirstPicked(this.inst))&&(this.pinObject=D,this.pinAngle=
cr.angleTo(D.x,D.y,this.inst.x,this.inst.y)-D.angle,this.pinDist=cr.distanceTo(D.x,D.y,this.inst.x,this.inst.y),this.lastKnownAngle=this.myStartAngle=this.inst.angle,this.theirStartAngle=D.angle,this.mode=f)};m.prototype.Unpin=function(){this.pinObject=null};E.acts=new m;w.prototype.PinnedUID=function(D){D.set_int(this.pinObject?this.pinObject.uid:-1)};E.exps=new w})();cr.behaviors.Sin=function(b){this.runtime=b};
(function(){function b(){}function m(){}function w(){}var E=cr.behaviors.Sin.prototype;E.Type=function(l,v){this.behavior=l;this.objtype=v;this.runtime=l.runtime};E.Type.prototype.onCreate=function(){};E.Instance=function(l,v){this.type=l;this.behavior=l.behavior;this.inst=v;this.runtime=l.runtime;this.i=0};var N=E.Instance.prototype,D=2*Math.PI,f=Math.PI/2,a=3*Math.PI/2,c=[0,1,8,3,4,2,5,6,7];N.onCreate=function(){this.movement=c[this.properties[0]];this.wave=this.properties[1];this.period=this.properties[2];
this.period+=Math.random()*this.properties[3];0===this.period?this.i=0:(this.i=this.properties[4]/this.period*D,this.i+=Math.random()*this.properties[5]/this.period*D);this.mag=this.properties[6];this.mag+=Math.random()*this.properties[7];this.isEnabled=this.properties[8];this.ratio=this.initialValue2=this.initialValue=0;5===this.movement&&(this.mag=cr.to_radians(this.mag));this.init()};N.saveToJSON=function(){return{i:this.i,a:this.isEnabled,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,
iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}};N.loadFromJSON=function(l){this.i=l.i;this.isEnabled=l.a;this.movement=l.mv;this.wave=l.w;this.period=l.p;this.mag=l.mag;this.initialValue=l.iv;this.initialValue2=l.iv2||0;this.ratio=l.r;this.lastKnownValue=l.lkv;this.lastKnownValue2=l.lkv2||0};N.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=
this.inst.width;this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y}this.lastKnownValue=this.initialValue;this.lastKnownValue2=this.initialValue2};N.waveFunc=function(l){l%=D;switch(this.wave){case 0:return Math.sin(l);
case 1:return l<=f?l/f:l<=a?1-2*(l-f)/Math.PI:(l-a)/f-1;case 2:return 2*l/D-1;case 3:return-2*l/D+1;case 4:return l<Math.PI?-1:1}return 0};N.tick=function(){var l=this.runtime.getDt(this.inst);this.isEnabled&&0!==l&&(0===this.period?this.i=0:(this.i+=l/this.period*D,this.i%=D),this.updateFromPhase())};N.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue);this.inst.x=this.initialValue+this.waveFunc(this.i)*
this.mag;this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue);this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag;this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*
this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue)));this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag);this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100;0>this.inst.opacity?this.inst.opacity=0:1<this.inst.opacity&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=
this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y}this.inst.set_bbox_changed()};N.onSpriteFrameChanged=function(l,v){switch(this.movement){case 2:this.initialValue*=v.width/l.width;this.ratio=
v.height/v.width;break;case 3:this.initialValue*=v.width/l.width;break;case 4:this.initialValue*=v.height/l.height}};b.prototype.IsEnabled=function(){return this.isEnabled};b.prototype.CompareMovement=function(l){return this.movement===l};b.prototype.ComparePeriod=function(l,v){return cr.do_cmp(this.period,l,v)};b.prototype.CompareMagnitude=function(l,v){return 5===this.movement?cr.do_cmp(this.mag,l,cr.to_radians(v)):cr.do_cmp(this.mag,l,v)};b.prototype.CompareWave=function(l){return this.wave===
l};E.cnds=new b;m.prototype.SetEnabled=function(l){this.isEnabled=1===l};m.prototype.SetPeriod=function(l){this.period=l};m.prototype.SetMagnitude=function(l){this.mag=l;5===this.movement&&(this.mag=cr.to_radians(this.mag))};m.prototype.SetMovement=function(l){5===this.movement&&5!==l&&(this.mag=cr.to_degrees(this.mag));this.movement=l;this.init()};m.prototype.SetWave=function(l){this.wave=l};m.prototype.SetPhase=function(l){this.i=l*D%D;this.updateFromPhase()};m.prototype.UpdateInitialState=function(){this.init()};
E.acts=new m;w.prototype.CyclePosition=function(l){l.set_float(this.i/D)};w.prototype.Period=function(l){l.set_float(this.period)};w.prototype.Magnitude=function(l){5===this.movement?l.set_float(cr.to_degrees(this.mag)):l.set_float(this.mag)};w.prototype.Value=function(l){l.set_float(this.waveFunc(this.i)*this.mag)};E.exps=new w})();cr.behaviors.Rotate=function(b){this.runtime=b};
(function(){function b(){}function m(){}function w(){}var E=cr.behaviors.Rotate.prototype;E.Type=function(D,f){this.behavior=D;this.objtype=f;this.runtime=D.runtime};E.Type.prototype.onCreate=function(){};E.Instance=function(D,f){this.type=D;this.behavior=D.behavior;this.inst=f;this.runtime=D.runtime};var N=E.Instance.prototype;N.onCreate=function(){this.speed=cr.to_radians(this.properties[0]);this.acc=cr.to_radians(this.properties[1]);this.enabled=this.properties[2]};N.saveToJSON=function(){return{speed:this.speed,
acc:this.acc,e:this.enabled}};N.loadFromJSON=function(D){this.speed=D.speed;this.acc=D.acc;D.hasOwnProperty("e")?this.enabled=D.e:this.enabled=!0};N.tick=function(){if(this.enabled){var D=this.runtime.getDt(this.inst);0!==D&&(0!==this.acc&&(this.speed+=this.acc*D),0!==this.speed&&(this.inst.angle=cr.clamp_angle(this.inst.angle+this.speed*D),this.inst.set_bbox_changed()))}};b.prototype.IsEnabled=function(){return this.enabled};E.cnds=new b;m.prototype.SetSpeed=function(D){this.speed=cr.to_radians(D)};
m.prototype.SetAcceleration=function(D){this.acc=cr.to_radians(D)};m.prototype.SetEnabled=function(D){this.enabled=1===D};E.acts=new m;w.prototype.Speed=function(D){D.set_float(cr.to_degrees(this.speed))};w.prototype.Acceleration=function(D){D.set_float(cr.to_degrees(this.acc))};E.exps=new w})();
cr.getObjectRefTable=function(){return[cr.plugins_.Sprite,cr.behaviors.Timer,cr.behaviors.Pin,cr.plugins_.Touch,cr.plugins_.Function,cr.behaviors.Sin,cr.plugins_.WebStorage,cr.plugins_.Audio,cr.plugins_.Spritefont2,cr.behaviors.Rotate,cr.plugins_.Mouse,cr.plugins_.Browser,cr.plugins_.Keyboard,cr.plugins_.NinePatch,cr.plugins_.Text,cr.system_object.prototype.cnds.OnLayoutStart,cr.system_object.prototype.acts.SetLayerOpacity,cr.plugins_.Function.prototype.acts.CallFunction,cr.behaviors.Pin.prototype.acts.Pin,
cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.exps.Width,cr.plugins_.Sprite.prototype.exps.X,cr.plugins_.Sprite.prototype.exps.Y,cr.plugins_.Sprite.prototype.acts.MoveToTop,cr.plugins_.Sprite.prototype.acts.MoveToBottom,cr.system_object.prototype.acts.SetGroupActive,cr.system_object.prototype.acts.SetLayerParallax,cr.plugins_.WebStorage.prototype.cnds.CompareKeyNumber,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.WebStorage.prototype.acts.StoreLocal,cr.system_object.prototype.cnds.ForEach,
cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.system_object.prototype.acts.CreateObject,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.plugins_.Sprite.prototype.exps.Angle,cr.plugins_.Sprite.prototype.exps.UID,cr.plugins_.WebStorage.prototype.cnds.LocalStorageExists,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.system_object.prototype.exps.int,cr.plugins_.WebStorage.prototype.exps.LocalValue,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.plugins_.Sprite.prototype.acts.Destroy,cr.plugins_.Audio.prototype.acts.SetMasterVolume,
cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.plugins_.Sprite.prototype.exps.AnimationFrame,cr.system_object.prototype.acts.SetVar,cr.plugins_.Sprite.prototype.acts.SetY,cr.plugins_.Sprite.prototype.acts.SetX,cr.plugins_.Browser.prototype.acts.ExecJs,cr.system_object.prototype.acts.Wait,cr.system_object.prototype.exps.dt,cr.plugins_.Function.prototype.cnds.OnFunction,cr.plugins_.Audio.prototype.acts.SetSilent,cr.system_object.prototype.acts.SetBoolVar,
cr.plugins_.Sprite.prototype.acts.SetPos,cr.plugins_.Text.prototype.acts.SetY,cr.plugins_.Text.prototype.exps.Y,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.system_object.prototype.acts.Signal,cr.system_object.prototype.cnds.IsGroupActive,cr.plugins_.Touch.prototype.cnds.OnTouchStart,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.plugins_.Sprite.prototype.cnds.IsOverlapping,cr.plugins_.Audio.prototype.acts.PlayByName,cr.plugins_.Sprite.prototype.acts.SetSize,cr.system_object.prototype.exps.abs,
cr.behaviors.Pin.prototype.acts.Unpin,cr.plugins_.Sprite.prototype.cnds.CompareOpacity,cr.plugins_.Touch.prototype.cnds.OnTouchEnd,cr.plugins_.Sprite.prototype.cnds.PickByUID,cr.system_object.prototype.cnds.Else,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.plugins_.Sprite.prototype.acts.SetAnimSpeed,cr.plugins_.Sprite.prototype.cnds.CompareY,cr.system_object.prototype.cnds.CompareVar,cr.plugins_.Sprite.prototype.acts.MoveToLayer,cr.behaviors.Sin.prototype.acts.SetEnabled,cr.behaviors.Sin.prototype.acts.SetPhase,
cr.system_object.prototype.acts.WaitForSignal,cr.behaviors.Rotate.prototype.acts.SetSpeed,cr.plugins_.Sprite.prototype.exps.ImagePointY,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.plugins_.Sprite.prototype.cnds.IsVisible,cr.plugins_.Sprite.prototype.cnds.PickInstVarHiLow,cr.plugins_.Sprite.prototype.acts.SetOpacity,cr.plugins_.Sprite.prototype.acts.SetWidth,cr.plugins_.Sprite.prototype.acts.SetPosToObject,cr.plugins_.Sprite.prototype.acts.SetCollisions,cr.plugins_.Function.prototype.exps.Param,
cr.plugins_.Sprite.prototype.exps.ImagePointX,cr.behaviors.Timer.prototype.acts.StartTimer,cr.system_object.prototype.acts.AddVar,cr.system_object.prototype.exps.zeropad,cr.plugins_.Sprite.prototype.exps.Height,cr.plugins_.Sprite.prototype.acts.SetBoolInstanceVar,cr.behaviors.Timer.prototype.cnds.OnTimer,cr.plugins_.Sprite.prototype.cnds.CompareWidth,cr.plugins_.Sprite.prototype.acts.SubInstanceVar,cr.plugins_.Audio.prototype.acts.SetPlaybackRate,cr.system_object.prototype.cnds.LayerCmpOpacity,cr.system_object.prototype.exps.layeropacity,
cr.system_object.prototype.acts.RestartLayout,cr.system_object.prototype.acts.ResetGlobals,cr.system_object.prototype.acts.NextPrevLayout,cr.system_object.prototype.acts.GoToLayout,cr.plugins_.Sprite.prototype.cnds.IsBoolInstanceVarSet,cr.system_object.prototype.exps.tokenat,cr.behaviors.Timer.prototype.acts.StopTimer,cr.system_object.prototype.acts.SubVar,cr.system_object.prototype.exps.left,cr.system_object.prototype.cnds.Every,cr.plugins_.Audio.prototype.cnds.IsTagPlaying,cr.plugins_.Mouse.prototype.cnds.IsOverObject,
cr.plugins_.Mouse.prototype.acts.SetCursor,cr.plugins_.Keyboard.prototype.cnds.OnKey,cr.plugins_.Browser.prototype.acts.Close,cr.system_object.prototype.cnds.OnLoadFinished,cr.system_object.prototype.acts.GoToLayoutByName]};
self.C3_JsPropNameTable=[{Rhomb:0},{Timer:0},{Line:0},{Slot:0},{Corner:0},{Pin:0},{RhombShadow:0},{Touch:0},{Function:0},{Arrow:0},{ArrowShadow:0},{Sine:0},{ButtonSound:0},{ButtonShadowSound:0},{WebStorage:0},{Audio:0},{LevelNum:0},{Button3dots:0},{ButtonShadow3dots:0},{ButtonUndo:0},{ButtonShadowUndo:0},{ButtonHint:0},{ButtonShadowHint:0},{Rotate:0},{CircleHint:0},{CircleHintShadow:0},{Stoper:0},{WiFi:0},{AngleShadow:0},{thx:0},{Mouse:0},{Browser:0},{Keyboard:0},{"9patch":0},{TextAd:0},{Cross:0},
{WatchAd:0},{ticker:0},{StepCount:0},{StepLogs:0},{Level:0},{funcParam:0},{TouchingUID:0},{POKI_Touch:0},{POKI_Pause:0}];
